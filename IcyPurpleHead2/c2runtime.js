"use strict";var cr=window.cr={};cr.plugins_={},cr.behaviors={},"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"==typeof"test".__proto__?function(t){return t.__proto__}:function(t){return t.constructor.prototype}),function(){function t(t,e){this.x=t,this.y=e,cr.seal(this)}function e(t,e,i,r){this.set(t,e,i,r),cr.seal(this)}function i(){this.tlx=0,this.tly=0,this.trx=0,this.try_=0,this.brx=0,this.bry=0,this.blx=0,this.bly=0,cr.seal(this)}cr.logexport=function(t){window.console&&window.console.log&&window.console.log(t)},cr.logerror=function(t){window.console&&window.console.error&&window.console.error(t)},cr.seal=function(t){return t},cr.freeze=function(t){return t},cr.is_undefined=function(t){return void 0===t},cr.is_number=function(t){return"number"==typeof t},cr.is_string=function(t){return"string"==typeof t},cr.isPOT=function(t){return t>0&&0==(t-1&t)},cr.nextHighestPowerOfTwo=function(t){--t;for(var e=1;e<32;e<<=1)t|=t>>e;return t+1},cr.abs=function(t){return t<0?-t:t},cr.max=function(t,e){return t>e?t:e},cr.min=function(t,e){return t<e?t:e},cr.PI=Math.PI,cr.round=function(t){return t+.5|0},cr.floor=function(t){return t>=0?0|t:(0|t)-1},cr.ceil=function(t){var e=0|t;return e===t?e:e+1},t.prototype.offset=function(t,e){return this.x+=t,this.y+=e,this},t.prototype.mul=function(t,e){return this.x*=t,this.y*=e,this},cr.vector2=t,cr.segments_intersect=function(t,e,i,r,n,s,o,a){var h,c,l,u,p,d,f,g;if(t<i?(c=t,h=i):(c=i,h=t),n<o?(d=n,p=o):(d=o,p=n),h<d||c>p)return!1;if(e<r?(u=e,l=r):(u=r,l=e),s<a?(g=s,f=a):(g=a,f=s),l<g||u>f)return!1;var y=n-t+o-i,m=s-e+a-r,_=i-t,v=r-e,b=o-n,w=a-s,x=cr.abs(v*b-w*_),S=b*m-w*y;if(cr.abs(S)>x)return!1;var T=_*m-v*y;return cr.abs(T)<=x},e.prototype.set=function(t,e,i,r){this.left=t,this.top=e,this.right=i,this.bottom=r},e.prototype.copy=function(t){this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom},e.prototype.width=function(){return this.right-this.left},e.prototype.height=function(){return this.bottom-this.top},e.prototype.offset=function(t,e){return this.left+=t,this.top+=e,this.right+=t,this.bottom+=e,this},e.prototype.normalize=function(){var t=0;this.left>this.right&&(t=this.left,this.left=this.right,this.right=t),this.top>this.bottom&&(t=this.top,this.top=this.bottom,this.bottom=t)},e.prototype.intersects_rect=function(t){return!(t.right<this.left||t.bottom<this.top||t.left>this.right||t.top>this.bottom)},e.prototype.intersects_rect_off=function(t,e,i){return!(t.right+e<this.left||t.bottom+i<this.top||t.left+e>this.right||t.top+i>this.bottom)},e.prototype.contains_pt=function(t,e){return t>=this.left&&t<=this.right&&e>=this.top&&e<=this.bottom},e.prototype.equals=function(t){return this.left===t.left&&this.top===t.top&&this.right===t.right&&this.bottom===t.bottom},cr.rect=e,i.prototype.set_from_rect=function(t){this.tlx=t.left,this.tly=t.top,this.trx=t.right,this.try_=t.top,this.brx=t.right,this.bry=t.bottom,this.blx=t.left,this.bly=t.bottom},i.prototype.set_from_rotated_rect=function(t,e){if(0===e)this.set_from_rect(t);else{var i=Math.sin(e),r=Math.cos(e),n=t.left*i,s=t.top*i,o=t.right*i,a=t.bottom*i,h=t.left*r,c=t.top*r,l=t.right*r,u=t.bottom*r;this.tlx=h-s,this.tly=c+n,this.trx=l-s,this.try_=c+o,this.brx=l-a,this.bry=u+o,this.blx=h-a,this.bly=u+n}},i.prototype.offset=function(t,e){return this.tlx+=t,this.tly+=e,this.trx+=t,this.try_+=e,this.brx+=t,this.bry+=e,this.blx+=t,this.bly+=e,this};var r=0,n=0;function s(t,e,i,s){t<e?i<s?(r=t<i?t:i,n=e>s?e:s):(r=t<s?t:s,n=e>i?e:i):i<s?(r=e<i?e:i,n=t>s?t:s):(r=e<s?e:s,n=t>i?t:i)}i.prototype.bounding_box=function(t){s(this.tlx,this.trx,this.brx,this.blx),t.left=r,t.right=n,s(this.tly,this.try_,this.bry,this.bly),t.top=r,t.bottom=n},i.prototype.contains_pt=function(t,e){var i,r,n,s=this.tlx,o=this.tly,a=this.trx-s,h=this.try_-o,c=this.brx-s,l=this.bry-o,u=t-s,p=e-o,d=c*c+l*l,f=c*u+l*p,g=1/((i=a*a+h*h)*d-(r=a*c+h*l)*r),y=(d*(n=a*u+h*p)-r*f)*g,m=(i*f-r*n)*g;return y>=0&&m>0&&y+m<1||(m=((i=(a=this.blx-s)*a+(h=this.bly-o)*h)*f-(r=a*c+h*l)*(n=a*u+h*p))*(g=1/(i*d-r*r)),(y=(d*n-r*f)*g)>=0&&m>0&&y+m<1)},i.prototype.at=function(t,e){if(e)switch(t){case 0:case 4:default:return this.tlx;case 1:return this.trx;case 2:return this.brx;case 3:return this.blx}else switch(t){case 0:case 4:default:return this.tly;case 1:return this.try_;case 2:return this.bry;case 3:return this.bly}},i.prototype.midX=function(){return(this.tlx+this.trx+this.brx+this.blx)/4},i.prototype.midY=function(){return(this.tly+this.try_+this.bry+this.bly)/4},i.prototype.intersects_segment=function(t,e,i,r){if(this.contains_pt(t,e)||this.contains_pt(i,r))return!0;var n,s,o,a,h;for(h=0;h<4;h++)if(n=this.at(h,!0),s=this.at(h,!1),o=this.at(h+1,!0),a=this.at(h+1,!1),cr.segments_intersect(t,e,i,r,n,s,o,a))return!0;return!1},i.prototype.intersects_quad=function(t){var e,i,r,n,s,o,a,h,c,l,u=t.midX(),p=t.midY();if(this.contains_pt(u,p))return!0;if(u=this.midX(),p=this.midY(),t.contains_pt(u,p))return!0;for(c=0;c<4;c++)for(l=0;l<4;l++)if(e=this.at(c,!0),i=this.at(c,!1),r=this.at(c+1,!0),n=this.at(c+1,!1),s=t.at(l,!0),o=t.at(l,!1),a=t.at(l+1,!0),h=t.at(l+1,!1),cr.segments_intersect(e,i,r,n,s,o,a,h))return!0;return!1},cr.quad=i,cr.RGB=function(t,e,i){return Math.max(Math.min(t,255),0)|Math.max(Math.min(e,255),0)<<8|Math.max(Math.min(i,255),0)<<16};var o=1024,a=16384,h=8191,c=-8192;cr.RGBAEx=function(t,e,i,r){return t=cr.clamp(Math.floor(1024*t),c,h),e=cr.clamp(Math.floor(1024*e),c,h),i=cr.clamp(Math.floor(1024*i),c,h),r=cr.clamp(Math.floor(1024*r),0,1024),t<0&&(t+=a),e<0&&(e+=a),i<0&&(i+=a),-(t*a*a*o+e*a*o+i*o+r)},cr.RGBEx=function(t,e,i){return cr.RGBAEx(t,e,i,1)},cr.GetRValue=function(t){if(t>=0)return(255&t)/255;var e=Math.floor(-t/274877906944);return e>h&&(e-=a),e/1024},cr.GetGValue=function(t){if(t>=0)return((65280&t)>>8)/255;var e=Math.floor(-t%274877906944/16777216);return e>h&&(e-=a),e/1024},cr.GetBValue=function(t){if(t>=0)return((16711680&t)>>16)/255;var e=Math.floor(-t%16777216/o);return e>h&&(e-=a),e/1024},cr.GetAValue=function(t){return 0===(e=t)&&1/e<0?0:t>=0?1:Math.floor(-t%o)/1024;var e},cr.shallowCopy=function(t,e,i){var r;for(r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},cr.arrayRemove=function(t,e){var i,r;if(!((e=cr.floor(e))<0||e>=t.length)){for(i=e,r=t.length-1;i<r;i++)t[i]=t[i+1];cr.truncateArray(t,r)}},cr.truncateArray=function(t,e){t.length=e},cr.clearArray=function(t){cr.truncateArray(t,0)},cr.shallowAssignArray=function(t,e){var i,r;for(cr.clearArray(t),i=0,r=e.length;i<r;++i)t[i]=e[i]},cr.appendArray=function(t,e){t.push.apply(t,e)},cr.fastIndexOf=function(t,e){var i,r;for(i=0,r=t.length;i<r;++i)if(t[i]===e)return i;return-1},cr.arrayFindRemove=function(t,e){var i=cr.fastIndexOf(t,e);-1!==i&&cr.arrayRemove(t,i)},cr.clamp=function(t,e,i){return t<e?e:t>i?i:t},cr.to_radians=function(t){return t/(180/cr.PI)},cr.to_degrees=function(t){return t*(180/cr.PI)},cr.clamp_angle_degrees=function(t){return(t%=360)<0&&(t+=360),t},cr.clamp_angle=function(t){return(t%=2*cr.PI)<0&&(t+=2*cr.PI),t},cr.to_clamped_degrees=function(t){return cr.clamp_angle_degrees(cr.to_degrees(t))},cr.to_clamped_radians=function(t){return cr.clamp_angle(cr.to_radians(t))},cr.angleTo=function(t,e,i,r){var n=i-t,s=r-e;return Math.atan2(s,n)},cr.angleDiff=function(t,e){if(t===e)return 0;var i=Math.sin(t),r=Math.cos(t),n=i*Math.sin(e)+r*Math.cos(e);return n>=1?0:n<=-1?cr.PI:Math.acos(n)},cr.angleRotate=function(t,e,i){var r=Math.sin(t),n=Math.cos(t),s=Math.sin(e),o=Math.cos(e);return Math.acos(r*s+n*o)>i?n*s-r*o>0?cr.clamp_angle(t+i):cr.clamp_angle(t-i):cr.clamp_angle(e)},cr.angleClockwise=function(t,e){var i=Math.sin(t);return Math.cos(t)*Math.sin(e)-i*Math.cos(e)<=0},cr.rotatePtAround=function(t,e,i,r,n,s){if(0===i)return s?t:e;var o=Math.sin(i),a=Math.cos(i),h=(t-=r)*o;return t=t*a-(e-=n)*o,e=e*a+h,t+=r,e+=n,s?t:e},cr.distanceTo=function(t,e,i,r){var n=i-t,s=r-e;return Math.sqrt(n*n+s*s)},cr.xor=function(t,e){return!t!=!e},cr.lerp=function(t,e,i){return t+(e-t)*i},cr.unlerp=function(t,e,i){return t===e?0:(i-t)/(e-t)},cr.anglelerp=function(t,e,i){var r=cr.angleDiff(t,e);return cr.angleClockwise(e,t)?t+r*i:t-r*i},cr.qarp=function(t,e,i,r){return cr.lerp(cr.lerp(t,e,r),cr.lerp(e,i,r),r)},cr.cubic=function(t,e,i,r,n){return cr.lerp(cr.qarp(t,e,i,n),cr.qarp(e,i,r,n),n)},cr.cosp=function(t,e,i){return(t+e+(t-e)*Math.cos(i*Math.PI))/2},cr.hasAnyOwnProperty=function(t){var e;for(e in t)if(t.hasOwnProperty(e))return!0;return!1},cr.wipe=function(t){var e;for(e in t)t.hasOwnProperty(e)&&delete t[e]};var l=+new Date;cr.performance_now=function(){if(void 0!==window.performance){var t=window.performance;if(void 0!==t.now)return t.now();if(void 0!==t.webkitNow)return t.webkitNow();if(void 0!==t.mozNow)return t.mozNow();if(void 0!==t.msNow)return t.msNow()}return Date.now()-l};void 0!==window&&(!(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&/safari/i.test(navigator.userAgent),/(iphone|ipod|ipad)/i.test(navigator.userAgent));var u="undefined"!=typeof Set&&void 0!==Set.prototype.forEach;function p(){this.s=null,this.items=null,this.item_count=0,u&&(this.s=new Set),this.values_cache=[],this.cache_valid=!0,cr.seal(this)}p.prototype.contains=function(t){return!this.isEmpty()&&(u?this.s.has(t):this.items&&this.items.hasOwnProperty(t))},p.prototype.add=function(t){if(u)this.s.has(t)||(this.s.add(t),this.cache_valid=!1);else{var e=t.toString(),i=this.items;i?i.hasOwnProperty(e)||(i[e]=t,this.item_count++,this.cache_valid=!1):(this.items={},this.items[e]=t,this.item_count=1,this.cache_valid=!1)}},p.prototype.remove=function(t){if(!this.isEmpty())if(u)this.s.has(t)&&(this.s.delete(t),this.cache_valid=!1);else if(this.items){var e=t.toString(),i=this.items;i.hasOwnProperty(e)&&(delete i[e],this.item_count--,this.cache_valid=!1)}},p.prototype.clear=function(){this.isEmpty()||(u?this.s.clear():(this.items=null,this.item_count=0),cr.clearArray(this.values_cache),this.cache_valid=!0)},p.prototype.isEmpty=function(){return 0===this.count()},p.prototype.count=function(){return u?this.s.size:this.item_count};var d=null,f=0;function g(t){d[f++]=t}p.prototype.update_cache=function(){if(!this.cache_valid){if(u)cr.clearArray(this.values_cache),d=this.values_cache,f=0,this.s.forEach(g),d=null,f=0;else{var t=this.values_cache;cr.clearArray(t);var e,i=0,r=this.items;if(r)for(e in r)r.hasOwnProperty(e)&&(t[i++]=r[e])}this.cache_valid=!0}},p.prototype.valuesRef=function(){return this.update_cache(),this.values_cache},cr.ObjectSet=p;var y=new cr.ObjectSet;function m(){this.c=0,this.y=0,this.t=0,this.sum=0,cr.seal(this)}function _(t,e){t||(t=[0,0,1,0,1,1,0,1]),this.pts_cache=[],this.bboxLeft=0,this.bboxTop=0,this.bboxRight=0,this.bboxBottom=0,this.convexpolys=null,this.enabled=void 0===e||e,this.set_pts(t),cr.seal(this)}function v(t,e){this.cellwidth=t,this.cellheight=e,this.cells={}}function b(t,e){this.cellwidth=t,this.cellheight=e,this.cells={}}cr.removeArrayDuplicates=function(t){var e,i;for(e=0,i=t.length;e<i;++e)y.add(t[e]);cr.shallowAssignArray(t,y.valuesRef()),y.clear()},cr.arrayRemoveAllFromObjectSet=function(t,e){u?cr.arrayRemoveAll_set(t,e.s):cr.arrayRemoveAll_arr(t,e.valuesRef())},cr.arrayRemoveAll_set=function(t,e){var i,r,n,s;for(i=0,r=0,n=t.length;i<n;++i)s=t[i],e.has(s)||(t[r++]=s);cr.truncateArray(t,r)},cr.arrayRemoveAll_arr=function(t,e){var i,r,n,s;for(i=0,r=0,n=t.length;i<n;++i)s=t[i],-1===cr.fastIndexOf(e,s)&&(t[r++]=s);cr.truncateArray(t,r)},m.prototype.add=function(t){this.y=t-this.c,this.t=this.sum+this.y,this.c=this.t-this.sum-this.y,this.sum=this.t},m.prototype.reset=function(){this.c=0,this.y=0,this.t=0,this.sum=0},cr.KahanAdder=m,cr.regexp_escape=function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},_.prototype.set_pts=function(t){this.pts_array=t,this.pts_count=t.length/2,this.pts_cache.length=t.length,this.cache_width=-1,this.cache_height=-1,this.cache_angle=0},_.prototype.is_empty=function(){return!this.pts_array.length},_.prototype.update_bbox=function(){for(var t,e,i,r=this.pts_cache,n=r[0],s=n,o=r[1],a=o,h=1,c=this.pts_count;h<c;++h)(t=r[i=2*h])<n&&(n=t),t>s&&(s=t),(e=r[i+1])<o&&(o=e),e>a&&(a=e);this.bboxLeft=n,this.bboxRight=s,this.bboxTop=o,this.bboxBottom=a},_.prototype.set_from_rect=function(t,e,i){this.pts_cache.length=8,this.pts_count=4;var r=this.pts_cache;r[0]=t.left-e,r[1]=t.top-i,r[2]=t.right-e,r[3]=t.top-i,r[4]=t.right-e,r[5]=t.bottom-i,r[6]=t.left-e,r[7]=t.bottom-i,this.cache_width=t.right-t.left,this.cache_height=t.bottom-t.top,this.update_bbox()},_.prototype.set_from_quad=function(t,e,i,r,n){this.pts_cache.length=8,this.pts_count=4;var s=this.pts_cache;s[0]=t.tlx-e,s[1]=t.tly-i,s[2]=t.trx-e,s[3]=t.try_-i,s[4]=t.brx-e,s[5]=t.bry-i,s[6]=t.blx-e,s[7]=t.bly-i,this.cache_width=r,this.cache_height=n,this.update_bbox()},_.prototype.set_from_poly=function(t){this.pts_count=t.pts_count,cr.shallowAssignArray(this.pts_cache,t.pts_cache),this.bboxLeft=t.bboxLeft,this.bboxTop,t.bboxTop,this.bboxRight=t.bboxRight,this.bboxBottom=t.bboxBottom},_.prototype.cache_poly=function(t,e,i){if(this.cache_width!==t||this.cache_height!==e||this.cache_angle!==i){var r,n,s,o,a,h;this.cache_width=t,this.cache_height=e,this.cache_angle=i;var c=0,l=1,u=this.pts_array,p=this.pts_cache;for(0!==i&&(c=Math.sin(i),l=Math.cos(i)),r=0,o=this.pts_count;r<o;r++)s=(n=2*r)+1,a=u[n]*t,h=u[s]*e,p[n]=a*l-h*c,p[s]=h*l+a*c;this.update_bbox()}},_.prototype.contains_pt=function(t,e){var i=this.pts_cache;if(t===i[0]&&e===i[1])return!0;var r,n,s,o,a,h,c,l=this.pts_count,u=this.bboxLeft-110,p=this.bboxTop-101,d=this.bboxRight+131,f=this.bboxBottom+120,g=0,y=0;for(r=0;r<l;r++)s=(r+1)%l*2,o=i[n=2*r],a=i[n+1],h=i[s],c=i[s+1],cr.segments_intersect(u,p,t,e,o,a,h,c)&&g++,cr.segments_intersect(d,f,t,e,o,a,h,c)&&y++;return g%2==1||y%2==1},_.prototype.intersects_poly=function(t,e,i){var r,n,s,o,a,h,c,l,u,p,d,f,g,y,m,_,v=t.pts_cache,b=this.pts_cache;if(this.contains_pt(v[0]+e,v[1]+i))return!0;if(t.contains_pt(b[0]-e,b[1]-i))return!0;for(r=0,o=this.pts_count;r<o;r++)for(s=(r+1)%o*2,u=b[n=2*r],p=b[n+1],d=b[s],f=b[s+1],a=0,l=t.pts_count;a<l;a++)if(c=(a+1)%l*2,g=v[h=2*a]+e,y=v[h+1]+i,m=v[c]+e,_=v[c+1]+i,cr.segments_intersect(u,p,d,f,g,y,m,_))return!0;return!1},_.prototype.intersects_segment=function(t,e,i,r,n,s){var o,a,h,c,l,u,p,d,f=this.pts_cache;if(this.contains_pt(i-t,r-e))return!0;for(o=0,a=this.pts_count;o<a;o++)if(c=(o+1)%a*2,l=f[h=2*o]+t,u=f[h+1]+e,p=f[c]+t,d=f[c+1]+e,cr.segments_intersect(i,r,n,s,l,u,p,d))return!0;return!1},_.prototype.mirror=function(t){var e,i,r;for(e=0,i=this.pts_count;e<i;++e)r=2*e,this.pts_cache[r]=2*t-this.pts_cache[r]},_.prototype.flip=function(t){var e,i,r;for(e=0,i=this.pts_count;e<i;++e)r=2*e+1,this.pts_cache[r]=2*t-this.pts_cache[r]},_.prototype.diag=function(){var t,e,i,r,n;for(t=0,e=this.pts_count;t<e;++t)r=(i=2*t)+1,n=this.pts_cache[i],this.pts_cache[i]=this.pts_cache[r],this.pts_cache[r]=n},_.prototype.is_enabled=function(){return this.enabled},cr.CollisionPoly=_,v.prototype.totalCellCount=0,v.prototype.getCell=function(t,e,i){var r,n=this.cells[t];return n?(r=n[e])||(i?(r=x(this,t,e),this.cells[t][e]=r,r):null):i?(r=x(this,t,e),this.cells[t]={},this.cells[t][e]=r,r):null},v.prototype.XToCell=function(t){return cr.floor(t/this.cellwidth)},v.prototype.YToCell=function(t){return cr.floor(t/this.cellheight)},v.prototype.update=function(t,e,i){var r,n,s,o,a;if(e)for(r=e.left,n=e.right;r<=n;++r)for(s=e.top,o=e.bottom;s<=o;++s)i&&i.contains_pt(r,s)||(a=this.getCell(r,s,!1))&&(a.remove(t),a.isEmpty()&&(S(a),this.cells[r][s]=null));if(i)for(r=i.left,n=i.right;r<=n;++r)for(s=i.top,o=i.bottom;s<=o;++s)e&&e.contains_pt(r,s)||this.getCell(r,s,!0).insert(t)},v.prototype.queryRange=function(t,e){var i,r,n,s,o,a;for(i=this.XToCell(t.left),n=this.YToCell(t.top),r=this.XToCell(t.right),o=this.YToCell(t.bottom);i<=r;++i)for(s=n;s<=o;++s)(a=this.getCell(i,s,!1))&&a.dump(e)},cr.SparseGrid=v,b.prototype.totalCellCount=0,b.prototype.getCell=function(t,e,i){var r,n=this.cells[t];return n?(r=n[e])||(i?(r=A(this,t,e),this.cells[t][e]=r,r):null):i?(r=A(this,t,e),this.cells[t]={},this.cells[t][e]=r,r):null},b.prototype.XToCell=function(t){return cr.floor(t/this.cellwidth)},b.prototype.YToCell=function(t){return cr.floor(t/this.cellheight)},b.prototype.update=function(t,e,i){var r,n,s,o,a;if(e)for(r=e.left,n=e.right;r<=n;++r)for(s=e.top,o=e.bottom;s<=o;++s)i&&i.contains_pt(r,s)||(a=this.getCell(r,s,!1))&&(a.remove(t),a.isEmpty()&&(O(a),this.cells[r][s]=null));if(i)for(r=i.left,n=i.right;r<=n;++r)for(s=i.top,o=i.bottom;s<=o;++s)e&&e.contains_pt(r,s)||this.getCell(r,s,!0).insert(t)},b.prototype.queryRange=function(t,e,i,r,n){var s,o,a,h,c,l;for(s=this.XToCell(t),a=this.YToCell(e),o=this.XToCell(i),c=this.YToCell(r);s<=o;++s)for(h=a;h<=c;++h)(l=this.getCell(s,h,!1))&&l.dump(n)},b.prototype.markRangeChanged=function(t){var e,i,r,n,s,o;for(e=t.left,r=t.top,i=t.right,s=t.bottom;e<=i;++e)for(n=r;n<=s;++n)(o=this.getCell(e,n,!1))&&(o.is_sorted=!1)},cr.RenderGrid=b;var w=[];function x(t,e,i){var r;return v.prototype.totalCellCount++,w.length?((r=w.pop()).grid=t,r.x=e,r.y=i,r):new cr.GridCell(t,e,i)}function S(t){v.prototype.totalCellCount--,t.objects.clear(),w.length<1e3&&w.push(t)}function T(t,e,i){this.grid=t,this.x=e,this.y=i,this.objects=new cr.ObjectSet}T.prototype.isEmpty=function(){return this.objects.isEmpty()},T.prototype.insert=function(t){this.objects.add(t)},T.prototype.remove=function(t){this.objects.remove(t)},T.prototype.dump=function(t){cr.appendArray(t,this.objects.valuesRef())},cr.GridCell=T;var C=[];function A(t,e,i){var r;return b.prototype.totalCellCount++,C.length?((r=C.pop()).grid=t,r.x=e,r.y=i,r):new cr.RenderCell(t,e,i)}function O(t){b.prototype.totalCellCount--,t.reset(),C.length<1e3&&C.push(t)}function E(t,e,i){this.grid=t,this.x=e,this.y=i,this.objects=[],this.is_sorted=!0,this.pending_removal=new cr.ObjectSet,this.any_pending_removal=!1}function P(t,e){return t.zindex-e.zindex}E.prototype.isEmpty=function(){return!this.objects.length||!(this.objects.length>this.pending_removal.count())&&(this.flush_pending(),!0)},E.prototype.insert=function(t){if(this.pending_removal.contains(t))return this.pending_removal.remove(t),void(this.pending_removal.isEmpty()&&(this.any_pending_removal=!1));this.objects.length?(this.objects[this.objects.length-1].get_zindex()>t.get_zindex()&&(this.is_sorted=!1),this.objects.push(t)):(this.objects.push(t),this.is_sorted=!0)},E.prototype.remove=function(t){this.pending_removal.add(t),this.any_pending_removal=!0,this.pending_removal.count()>=30&&this.flush_pending()},E.prototype.flush_pending=function(){this.any_pending_removal&&(this.pending_removal.count()!==this.objects.length?(cr.arrayRemoveAllFromObjectSet(this.objects,this.pending_removal),this.pending_removal.clear(),this.any_pending_removal=!1):this.reset())},E.prototype.ensure_sorted=function(){this.is_sorted||(this.objects.sort(P),this.is_sorted=!0)},E.prototype.reset=function(){cr.clearArray(this.objects),this.is_sorted=!0,this.pending_removal.clear(),this.any_pending_removal=!1},E.prototype.dump=function(t){this.flush_pending(),this.ensure_sorted(),this.objects.length&&t.push(this.objects)},cr.RenderCell=E;var I=["lighter","xor","copy","destination-over","source-in","destination-in","source-out","destination-out","source-atop","destination-atop"];cr.effectToCompositeOp=function(t){return t<=0||t>=11?"source-over":I[t-1]},cr.setGLBlend=function(t,e,i){if(i)switch(t.srcBlend=i.ONE,t.destBlend=i.ONE_MINUS_SRC_ALPHA,e){case 1:t.srcBlend=i.ONE,t.destBlend=i.ONE;break;case 2:break;case 3:t.srcBlend=i.ONE,t.destBlend=i.ZERO;break;case 4:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.ONE;break;case 5:t.srcBlend=i.DST_ALPHA,t.destBlend=i.ZERO;break;case 6:t.srcBlend=i.ZERO,t.destBlend=i.SRC_ALPHA;break;case 7:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.ZERO;break;case 8:t.srcBlend=i.ZERO,t.destBlend=i.ONE_MINUS_SRC_ALPHA;break;case 9:t.srcBlend=i.DST_ALPHA,t.destBlend=i.ONE_MINUS_SRC_ALPHA;break;case 10:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.SRC_ALPHA}},cr.round6dp=function(t){return Math.round(1e6*t)/1e6},cr.equals_nocase=function(t,e){return"string"==typeof t&&"string"==typeof e&&(t.length===e.length&&(t===e||t.toLowerCase()===e.toLowerCase()))},cr.cssToCamelCase=function(t){var e,i,r,n="",s=!1;for(e=0,i=t.length;e<i;++e)"-"===(r=t.charAt(e))?s=!0:s?(n+=r.toUpperCase(),s=!1):n+=r;return n},cr.isCanvasInputEvent=function(t){var e=t.target;return!e||(e===document||e===window||(!(!document||!document.body||e!==document.body)||!!cr.equals_nocase(e.tagName,"canvas")))}}();var MatrixArray="undefined"!=typeof Float32Array?Float32Array:Array,glMatrixArrayType=MatrixArray,vec3={},mat3={},mat4={},quat4={};if(vec3.create=function(t){var e=new MatrixArray(3);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2]),e},vec3.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},vec3.add=function(t,e,i){return i&&t!==i?(i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i):(t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t)},vec3.subtract=function(t,e,i){return i&&t!==i?(i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i):(t[0]-=e[0],t[1]-=e[1],t[2]-=e[2],t)},vec3.negate=function(t,e){return e||(e=t),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},vec3.scale=function(t,e,i){return i&&t!==i?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i):(t[0]*=e,t[1]*=e,t[2]*=e,t)},vec3.normalize=function(t,e){e||(e=t);var i=t[0],r=t[1],n=t[2],s=Math.sqrt(i*i+r*r+n*n);return s?1===s?(e[0]=i,e[1]=r,e[2]=n,e):(s=1/s,e[0]=i*s,e[1]=r*s,e[2]=n*s,e):(e[0]=0,e[1]=0,e[2]=0,e)},vec3.cross=function(t,e,i){i||(i=t);var r=t[0],n=t[1],s=(t=t[2],e[0]),o=e[1];e=e[2];return i[0]=n*e-t*o,i[1]=t*s-r*e,i[2]=r*o-n*s,i},vec3.length=function(t){var e=t[0],i=t[1];t=t[2];return Math.sqrt(e*e+i*i+t*t)},vec3.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},vec3.direction=function(t,e,i){i||(i=t);var r=t[0]-e[0],n=t[1]-e[1];t=t[2]-e[2];return(e=Math.sqrt(r*r+n*n+t*t))?(e=1/e,i[0]=r*e,i[1]=n*e,i[2]=t*e,i):(i[0]=0,i[1]=0,i[2]=0,i)},vec3.lerp=function(t,e,i,r){return r||(r=t),r[0]=t[0]+i*(e[0]-t[0]),r[1]=t[1]+i*(e[1]-t[1]),r[2]=t[2]+i*(e[2]-t[2]),r},vec3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+"]"},mat3.create=function(t){var e=new MatrixArray(9);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]),e},mat3.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},mat3.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mat3.transpose=function(t,e){if(!e||t===e){var i=t[1],r=t[2],n=t[5];return t[1]=t[3],t[2]=t[6],t[3]=i,t[5]=t[7],t[6]=r,t[7]=n,t}return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e},mat3.toMat4=function(t,e){return e||(e=mat4.create()),e[15]=1,e[14]=0,e[13]=0,e[12]=0,e[11]=0,e[10]=t[8],e[9]=t[7],e[8]=t[6],e[7]=0,e[6]=t[5],e[5]=t[4],e[4]=t[3],e[3]=0,e[2]=t[2],e[1]=t[1],e[0]=t[0],e},mat3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+"]"},mat4.create=function(t){var e=new MatrixArray(16);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},mat4.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},mat4.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.transpose=function(t,e){if(!e||t===e){var i=t[1],r=t[2],n=t[3],s=t[6],o=t[7],a=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=i,t[6]=t[9],t[7]=t[13],t[8]=r,t[9]=s,t[11]=t[14],t[12]=n,t[13]=o,t[14]=a,t}return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},mat4.determinant=function(t){var e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],h=t[7],c=t[8],l=t[9],u=t[10],p=t[11],d=t[12],f=t[13],g=t[14];return d*l*a*n-c*f*a*n-d*o*u*n+s*f*u*n+c*o*g*n-s*l*g*n-d*l*r*h+c*f*r*h+d*i*u*h-e*f*u*h-c*i*g*h+e*l*g*h+d*o*r*p-s*f*r*p-d*i*a*p+e*f*a*p+s*i*g*p-e*o*g*p-c*o*r*(t=t[15])+s*l*r*t+c*i*a*t-e*l*a*t-s*i*u*t+e*o*u*t},mat4.inverse=function(t,e){e||(e=t);var i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],h=t[6],c=t[7],l=t[8],u=t[9],p=t[10],d=t[11],f=t[12],g=t[13],y=t[14],m=t[15],_=i*a-r*o,v=i*h-n*o,b=i*c-s*o,w=r*h-n*a,x=r*c-s*a,S=n*c-s*h,T=l*g-u*f,C=l*y-p*f,A=l*m-d*f,O=u*y-p*g,E=u*m-d*g,P=p*m-d*y,I=1/(_*P-v*E+b*O+w*A-x*C+S*T);return e[0]=(a*P-h*E+c*O)*I,e[1]=(-r*P+n*E-s*O)*I,e[2]=(g*S-y*x+m*w)*I,e[3]=(-u*S+p*x-d*w)*I,e[4]=(-o*P+h*A-c*C)*I,e[5]=(i*P-n*A+s*C)*I,e[6]=(-f*S+y*b-m*v)*I,e[7]=(l*S-p*b+d*v)*I,e[8]=(o*E-a*A+c*T)*I,e[9]=(-i*E+r*A-s*T)*I,e[10]=(f*x-g*b+m*_)*I,e[11]=(-l*x+u*b-d*_)*I,e[12]=(-o*O+a*C-h*T)*I,e[13]=(i*O-r*C+n*T)*I,e[14]=(-f*w+g*v-y*_)*I,e[15]=(l*w-u*v+p*_)*I,e},mat4.toRotationMat=function(t,e){return e||(e=mat4.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.toMat3=function(t,e){return e||(e=mat3.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},mat4.toInverseMat3=function(t,e){var i=t[0],r=t[1],n=t[2],s=t[4],o=t[5],a=t[6],h=t[8],c=t[9],l=t[10],u=l*o-a*c,p=-l*s+a*h,d=c*s-o*h,f=i*u+r*p+n*d;return f?(f=1/f,e||(e=mat3.create()),e[0]=u*f,e[1]=(-l*r+n*c)*f,e[2]=(a*r-n*o)*f,e[3]=p*f,e[4]=(l*i-n*h)*f,e[5]=(-a*i+n*s)*f,e[6]=d*f,e[7]=(-c*i+r*h)*f,e[8]=(o*i-r*s)*f,e):null},mat4.multiply=function(t,e,i){i||(i=t);var r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],h=t[5],c=t[6],l=t[7],u=t[8],p=t[9],d=t[10],f=t[11],g=t[12],y=t[13],m=t[14],_=(t=t[15],e[0]),v=e[1],b=e[2],w=e[3],x=e[4],S=e[5],T=e[6],C=e[7],A=e[8],O=e[9],E=e[10],P=e[11],I=e[12],k=e[13],R=e[14];e=e[15];return i[0]=_*r+v*a+b*u+w*g,i[1]=_*n+v*h+b*p+w*y,i[2]=_*s+v*c+b*d+w*m,i[3]=_*o+v*l+b*f+w*t,i[4]=x*r+S*a+T*u+C*g,i[5]=x*n+S*h+T*p+C*y,i[6]=x*s+S*c+T*d+C*m,i[7]=x*o+S*l+T*f+C*t,i[8]=A*r+O*a+E*u+P*g,i[9]=A*n+O*h+E*p+P*y,i[10]=A*s+O*c+E*d+P*m,i[11]=A*o+O*l+E*f+P*t,i[12]=I*r+k*a+R*u+e*g,i[13]=I*n+k*h+R*p+e*y,i[14]=I*s+k*c+R*d+e*m,i[15]=I*o+k*l+R*f+e*t,i},mat4.multiplyVec3=function(t,e,i){i||(i=e);var r=e[0],n=e[1];e=e[2];return i[0]=t[0]*r+t[4]*n+t[8]*e+t[12],i[1]=t[1]*r+t[5]*n+t[9]*e+t[13],i[2]=t[2]*r+t[6]*n+t[10]*e+t[14],i},mat4.multiplyVec4=function(t,e,i){i||(i=e);var r=e[0],n=e[1],s=e[2];e=e[3];return i[0]=t[0]*r+t[4]*n+t[8]*s+t[12]*e,i[1]=t[1]*r+t[5]*n+t[9]*s+t[13]*e,i[2]=t[2]*r+t[6]*n+t[10]*s+t[14]*e,i[3]=t[3]*r+t[7]*n+t[11]*s+t[15]*e,i},mat4.translate=function(t,e,i){var r,n,s,o,a,h,c,l,u,p,d,f,g=e[0],y=e[1];e=e[2];return i&&t!==i?(r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],h=t[5],c=t[6],l=t[7],u=t[8],p=t[9],d=t[10],f=t[11],i[0]=r,i[1]=n,i[2]=s,i[3]=o,i[4]=a,i[5]=h,i[6]=c,i[7]=l,i[8]=u,i[9]=p,i[10]=d,i[11]=f,i[12]=r*g+a*y+u*e+t[12],i[13]=n*g+h*y+p*e+t[13],i[14]=s*g+c*y+d*e+t[14],i[15]=o*g+l*y+f*e+t[15],i):(t[12]=t[0]*g+t[4]*y+t[8]*e+t[12],t[13]=t[1]*g+t[5]*y+t[9]*e+t[13],t[14]=t[2]*g+t[6]*y+t[10]*e+t[14],t[15]=t[3]*g+t[7]*y+t[11]*e+t[15],t)},mat4.scale=function(t,e,i){var r=e[0],n=e[1];e=e[2];return i&&t!==i?(i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i[3]=t[3]*r,i[4]=t[4]*n,i[5]=t[5]*n,i[6]=t[6]*n,i[7]=t[7]*n,i[8]=t[8]*e,i[9]=t[9]*e,i[10]=t[10]*e,i[11]=t[11]*e,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i):(t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r,t[4]*=n,t[5]*=n,t[6]*=n,t[7]*=n,t[8]*=e,t[9]*=e,t[10]*=e,t[11]*=e,t)},mat4.rotate=function(t,e,i,r){var n,s,o,a,h,c,l,u,p,d,f,g,y,m,_,v,b,w,x,S,T=i[0],C=i[1],A=(i=i[2],Math.sqrt(T*T+C*C+i*i));return A?(1!==A&&(T*=A=1/A,C*=A,i*=A),n=Math.sin(e),o=1-(s=Math.cos(e)),e=t[0],A=t[1],a=t[2],h=t[3],c=t[4],l=t[5],u=t[6],p=t[7],d=t[8],f=t[9],g=t[10],y=t[11],m=T*T*o+s,_=C*T*o+i*n,v=i*T*o-C*n,b=T*C*o-i*n,w=C*C*o+s,x=i*C*o+T*n,S=T*i*o+C*n,T=C*i*o-T*n,C=i*i*o+s,r?t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]):r=t,r[0]=e*m+c*_+d*v,r[1]=A*m+l*_+f*v,r[2]=a*m+u*_+g*v,r[3]=h*m+p*_+y*v,r[4]=e*b+c*w+d*x,r[5]=A*b+l*w+f*x,r[6]=a*b+u*w+g*x,r[7]=h*b+p*w+y*x,r[8]=e*S+c*T+d*C,r[9]=A*S+l*T+f*C,r[10]=a*S+u*T+g*C,r[11]=h*S+p*T+y*C,r):null},mat4.rotateX=function(t,e,i){var r=Math.sin(e),n=(e=Math.cos(e),t[4]),s=t[5],o=t[6],a=t[7],h=t[8],c=t[9],l=t[10],u=t[11];return i?t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[4]=n*e+h*r,i[5]=s*e+c*r,i[6]=o*e+l*r,i[7]=a*e+u*r,i[8]=n*-r+h*e,i[9]=s*-r+c*e,i[10]=o*-r+l*e,i[11]=a*-r+u*e,i},mat4.rotateY=function(t,e,i){var r=Math.sin(e),n=(e=Math.cos(e),t[0]),s=t[1],o=t[2],a=t[3],h=t[8],c=t[9],l=t[10],u=t[11];return i?t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=n*e+h*-r,i[1]=s*e+c*-r,i[2]=o*e+l*-r,i[3]=a*e+u*-r,i[8]=n*r+h*e,i[9]=s*r+c*e,i[10]=o*r+l*e,i[11]=a*r+u*e,i},mat4.rotateZ=function(t,e,i){var r=Math.sin(e),n=(e=Math.cos(e),t[0]),s=t[1],o=t[2],a=t[3],h=t[4],c=t[5],l=t[6],u=t[7];return i?t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=n*e+h*r,i[1]=s*e+c*r,i[2]=o*e+l*r,i[3]=a*e+u*r,i[4]=n*-r+h*e,i[5]=s*-r+c*e,i[6]=o*-r+l*e,i[7]=a*-r+u*e,i},mat4.frustum=function(t,e,i,r,n,s,o){o||(o=mat4.create());var a=e-t,h=r-i,c=s-n;return o[0]=2*n/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*n/h,o[6]=0,o[7]=0,o[8]=(e+t)/a,o[9]=(r+i)/h,o[10]=-(s+n)/c,o[11]=-1,o[12]=0,o[13]=0,o[14]=-s*n*2/c,o[15]=0,o},mat4.perspective=function(t,e,i,r,n){return e*=t=i*Math.tan(t*Math.PI/360),mat4.frustum(-e,e,-t,t,i,r,n)},mat4.ortho=function(t,e,i,r,n,s,o){o||(o=mat4.create());var a=e-t,h=r-i,c=s-n;return o[0]=2/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/h,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2/c,o[11]=0,o[12]=-(t+e)/a,o[13]=-(r+i)/h,o[14]=-(s+n)/c,o[15]=1,o},mat4.lookAt=function(t,e,i,r){r||(r=mat4.create());var n,s,o,a,h,c,l,u,p=t[0],d=t[1];t=t[2];return s=i[0],o=i[1],n=i[2],i=e[1],c=e[2],p===e[0]&&d===i&&t===c?mat4.identity(r):(i=p-e[0],c=d-e[1],l=t-e[2],e=o*(l*=u=1/Math.sqrt(i*i+c*c+l*l))-n*(c*=u),n=n*(i*=u)-s*l,s=s*c-o*i,(u=Math.sqrt(e*e+n*n+s*s))?(e*=u=1/u,n*=u,s*=u):s=n=e=0,o=c*s-l*n,a=l*e-i*s,h=i*n-c*e,(u=Math.sqrt(o*o+a*a+h*h))?(o*=u=1/u,a*=u,h*=u):h=a=o=0,r[0]=e,r[1]=o,r[2]=i,r[3]=0,r[4]=n,r[5]=a,r[6]=c,r[7]=0,r[8]=s,r[9]=h,r[10]=l,r[11]=0,r[12]=-(e*p+n*d+s*t),r[13]=-(o*p+a*d+h*t),r[14]=-(i*p+c*d+l*t),r[15]=1,r)},mat4.fromRotationTranslation=function(t,e,i){i||(i=mat4.create());var r=t[0],n=t[1],s=t[2],o=t[3],a=r+r,h=n+n,c=s+s,l=(t=r*a,r*h);r*=c;var u=n*h;return n*=c,s*=c,a*=o,h*=o,o*=c,i[0]=1-(u+s),i[1]=l+o,i[2]=r-h,i[3]=0,i[4]=l-o,i[5]=1-(t+s),i[6]=n+a,i[7]=0,i[8]=r+h,i[9]=n-a,i[10]=1-(t+u),i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i},mat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"},quat4.create=function(t){var e=new MatrixArray(4);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e},quat4.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},quat4.calculateW=function(t,e){var i=t[0],r=t[1],n=t[2];return e&&t!==e?(e[0]=i,e[1]=r,e[2]=n,e[3]=-Math.sqrt(Math.abs(1-i*i-r*r-n*n)),e):(t[3]=-Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t)},quat4.inverse=function(t,e){return e&&t!==e?(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e):(t[0]*=-1,t[1]*=-1,t[2]*=-1,t)},quat4.length=function(t){var e=t[0],i=t[1],r=t[2];t=t[3];return Math.sqrt(e*e+i*i+r*r+t*t)},quat4.normalize=function(t,e){e||(e=t);var i=t[0],r=t[1],n=t[2],s=t[3],o=Math.sqrt(i*i+r*r+n*n+s*s);return 0===o?(e[0]=0,e[1]=0,e[2]=0,e[3]=0,e):(o=1/o,e[0]=i*o,e[1]=r*o,e[2]=n*o,e[3]=s*o,e)},quat4.multiply=function(t,e,i){i||(i=t);var r=t[0],n=t[1],s=t[2],o=(t=t[3],e[0]),a=e[1],h=e[2];e=e[3];return i[0]=r*e+t*o+n*h-s*a,i[1]=n*e+t*a+s*o-r*h,i[2]=s*e+t*h+r*a-n*o,i[3]=t*e-r*o-n*a-s*h,i},quat4.multiplyVec3=function(t,e,i){i||(i=e);var r=e[0],n=e[1],s=e[2],o=(e=t[0],t[1]),a=t[2],h=(t=t[3])*r+o*s-a*n,c=t*n+a*r-e*s,l=t*s+e*n-o*r;r=-e*r-o*n-a*s;return i[0]=h*t+r*-e+c*-a-l*-o,i[1]=c*t+r*-o+l*-e-h*-a,i[2]=l*t+r*-a+h*-o-c*-e,i},quat4.toMat3=function(t,e){e||(e=mat3.create());var i=t[0],r=t[1],n=t[2],s=t[3],o=i+i,a=r+r,h=n+n,c=i*o,l=i*a;i*=h;var u=r*a;return r*=h,n*=h,o*=s,a*=s,s*=h,e[0]=1-(u+n),e[1]=l+s,e[2]=i-a,e[3]=l-s,e[4]=1-(c+n),e[5]=r+o,e[6]=i+a,e[7]=r-o,e[8]=1-(c+u),e},quat4.toMat4=function(t,e){e||(e=mat4.create());var i=t[0],r=t[1],n=t[2],s=t[3],o=i+i,a=r+r,h=n+n,c=i*o,l=i*a;i*=h;var u=r*a;return r*=h,n*=h,o*=s,a*=s,s*=h,e[0]=1-(u+n),e[1]=l+s,e[2]=i-a,e[3]=0,e[4]=l-s,e[5]=1-(c+n),e[6]=r+o,e[7]=0,e[8]=i+a,e[9]=r-o,e[10]=1-(c+u),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},quat4.slerp=function(t,e,i,r){r||(r=t);var n,s,o=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3];return Math.abs(o)>=1?(r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]),r):(n=Math.acos(o),s=Math.sqrt(1-o*o),Math.abs(s)<.001?(r[0]=.5*t[0]+.5*e[0],r[1]=.5*t[1]+.5*e[1],r[2]=.5*t[2]+.5*e[2],r[3]=.5*t[3]+.5*e[3],r):(o=Math.sin((1-i)*n)/s,i=Math.sin(i*n)/s,r[0]=t[0]*o+e[0]*i,r[1]=t[1]*o+e[1]*i,r[2]=t[2]*o+e[2]*i,r[3]=t[3]*o+e[3]*i,r))},quat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"},function(){var t=8e3,e=mat4.create();function i(t,e,i){this.isIE=/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent),this.width=0,this.height=0,this.enableFrontToBack=!!i,this.isEarlyZPass=!1,this.isBatchInEarlyZPass=!1,this.currentZ=0,this.zNear=1,this.zFar=1e3,this.zIncrement=(this.zFar-this.zNear)/32768,this.zA=this.zFar/(this.zFar-this.zNear),this.zB=this.zFar*this.zNear/(this.zNear-this.zFar),this.kzA=65536*this.zA,this.kzB=65536*this.zB,this.cam=vec3.create([0,0,100]),this.look=vec3.create([0,0,0]),this.up=vec3.create([0,1,0]),this.worldScale=vec3.create([1,1,1]),this.enable_mipmaps=!0,this.matP=mat4.create(),this.matMV=mat4.create(),this.lastMV=mat4.create(),this.currentMV=mat4.create(),this.gl=t,this.version=0===this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2")?2:1,this.timerExt=null,this.isTiming=!1,2===this.version?this.timerExt=this.gl.getExtension("EXT_disjoint_timer_query_webgl2")||this.gl.getExtension("EXT_disjoint_timer_query"):this.timerExt=this.gl.getExtension("EXT_disjoint_timer_query"),this.frameNumber=0,this.timerResults=[],this.initState()}function r(t,e,i){this.gl=t,this.shaderProgram=e,this.name=i,this.locAPos=t.getAttribLocation(e,"aPos"),this.locATex=t.getAttribLocation(e,"aTex"),this.locMatP=t.getUniformLocation(e,"matP"),this.locMatMV=t.getUniformLocation(e,"matMV"),this.locOpacity=t.getUniformLocation(e,"opacity"),this.locColorFill=t.getUniformLocation(e,"colorFill"),this.locSamplerFront=t.getUniformLocation(e,"samplerFront"),this.locSamplerBack=t.getUniformLocation(e,"samplerBack"),this.locSrcStart=t.getUniformLocation(e,"srcStart"),this.locSrcEnd=t.getUniformLocation(e,"srcEnd"),this.locSrcOriginStart=t.getUniformLocation(e,"srcOriginStart"),this.locSrcOriginEnd=t.getUniformLocation(e,"srcOriginEnd"),this.locLayoutStart=t.getUniformLocation(e,"layoutStart"),this.locLayoutEnd=t.getUniformLocation(e,"layoutEnd"),this.locDestStart=t.getUniformLocation(e,"destStart"),this.locDestEnd=t.getUniformLocation(e,"destEnd"),this.locSeconds=t.getUniformLocation(e,"seconds"),this.locPixelSize=t.getUniformLocation(e,"pixelSize"),this.locLayerScale=t.getUniformLocation(e,"layerScale"),this.locLayerAngle=t.getUniformLocation(e,"layerAngle"),this.hasAnyOptionalUniforms=!!(this.locPixelSize||this.locSeconds||this.locSamplerBack||this.locSrcStart||this.locSrcEnd||this.locSrcOriginStart||this.locSrcOriginEnd||this.locLayoutStart||this.locLayoutEnd||this.locDestStart||this.locDestEnd||this.locLayerScale||this.locLayerAngle),this.lpPixelWidth=-999,this.lpPixelHeight=-999,this.lpOpacity=1,this.lpSrcStartX=0,this.lpSrcStartY=0,this.lpSrcEndX=0,this.lpSrcEndY=0,this.lpSrcOriginStartX=0,this.lpSrcOriginStartY=0,this.lpSrcOriginEndX=0,this.lpSrcOriginEndY=0,this.lpLayoutStartX=0,this.lpLayoutStartY=0,this.lpLayoutEndX=0,this.lpLayoutEndY=0,this.lpDestStartX=0,this.lpDestStartY=0,this.lpDestEndX=1,this.lpDestEndY=1,this.lpLayerScale=1,this.lpLayerAngle=0,this.lpSeconds=0,this.lastCustomParams=[],this.lpMatMV=mat4.create(),this.locOpacity&&t.uniform1f(this.locOpacity,1),this.locColorFill&&t.uniform4f(this.locColorFill,1,1,1,1),this.locSamplerFront&&t.uniform1i(this.locSamplerFront,0),this.locSamplerBack&&t.uniform1i(this.locSamplerBack,1),this.locSrcStart&&t.uniform2f(this.locSrcStart,0,0),this.locSrcEnd&&t.uniform2f(this.locSrcEnd,1,1),this.locSrcOriginStart&&t.uniform2f(this.locSrcOriginStart,0,0),this.locSrcOriginEnd&&t.uniform2f(this.locSrcOriginEnd,0,0),this.locLayoutStart&&t.uniform2f(this.locLayoutStart,0,0),this.locLayoutEnd&&t.uniform2f(this.locLayoutEnd,0,0),this.locDestStart&&t.uniform2f(this.locDestStart,0,0),this.locDestEnd&&t.uniform2f(this.locDestEnd,1,1),this.locLayerScale&&t.uniform1f(this.locLayerScale,1),this.locLayerAngle&&t.uniform1f(this.locLayerAngle,0),this.locSeconds&&t.uniform1f(this.locSeconds,0),this.hasCurrentMatMV=!1}function n(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function s(t,e){this.type=t,this.glwrap=e,this.gl=e.gl,this.opacityParam=0,this.startIndex=0,this.indexCount=0,this.texParam=null,this.mat4param=null,this.layoutRect=quat4.create(),this.srcOriginRect=quat4.create(),this.shaderParams=[],cr.seal(this)}i.prototype.initState=function(){var e,i=this.gl;for(this.lastOpacity=1,this.lastTexture0=null,this.lastTexture1=null,this.currentOpacity=1,i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.disable(i.CULL_FACE),i.disable(i.STENCIL_TEST),i.disable(i.DITHER),this.enableFrontToBack?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.lastSrcBlend=i.ONE,this.lastDestBlend=i.ONE_MINUS_SRC_ALPHA,this.vertexData=new Float32Array(t*(this.enableFrontToBack?3:2)),this.texcoordData=new Float32Array(16e3),this.pointData=new Float32Array(32e3),this.pointBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.pointBuffer),i.bufferData(i.ARRAY_BUFFER,this.pointData.byteLength,i.DYNAMIC_DRAW),this.vertexBuffers=new Array(4),this.texcoordBuffers=new Array(4),e=0;e<4;e++)this.vertexBuffers[e]=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffers[e]),i.bufferData(i.ARRAY_BUFFER,this.vertexData.byteLength,i.DYNAMIC_DRAW),this.texcoordBuffers[e]=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.texcoordBuffers[e]),i.bufferData(i.ARRAY_BUFFER,this.texcoordData.byteLength,i.DYNAMIC_DRAW);this.curBuffer=0,this.indexBuffer=i.createBuffer(),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var r=new Uint16Array(12e3);e=0;for(var n,s,o=0;e<12e3;)r[e++]=o,r[e++]=o+1,r[e++]=o+2,r[e++]=o,r[e++]=o+2,r[e++]=o+3,o+=4;i.bufferData(i.ELEMENT_ARRAY_BUFFER,r,i.STATIC_DRAW),this.vertexPtr=0,this.texPtr=0,this.pointPtr=0,this.shaderPrograms=[],n=["varying mediump vec2 vTex;","uniform lowp float opacity;","uniform lowp sampler2D samplerFront;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, vTex);","\tgl_FragColor *= opacity;","}"].join("\n"),s=this.enableFrontToBack?["attribute highp vec3 aPos;","attribute mediump vec2 aTex;","varying mediump vec2 vTex;","uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, aPos.z, 1.0);","\tvTex = aTex;","}"].join("\n"):["attribute highp vec2 aPos;","attribute mediump vec2 aTex;","varying mediump vec2 vTex;","uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);","\tvTex = aTex;","}"].join("\n");var a=this.createShaderProgram({src:n},s,"<default>");this.shaderPrograms.push(a),n=["uniform mediump sampler2D samplerFront;","varying lowp float opacity;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, gl_PointCoord);","\tgl_FragColor *= opacity;","}"].join("\n");var h=["attribute vec4 aPos;","varying float opacity;","uniform mat4 matP;","uniform mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);","\tgl_PointSize = aPos.z;","\topacity = aPos.w;","}"].join("\n");a=this.createShaderProgram({src:n},h,"<point>"),this.shaderPrograms.push(a),n=["varying mediump vec2 vTex;","uniform lowp sampler2D samplerFront;","void main(void) {","\tif (texture2D(samplerFront, vTex).a < 1.0)","\t\tdiscard;","}"].join("\n");a=this.createShaderProgram({src:n},s,"<earlyz>");this.shaderPrograms.push(a),n=["uniform lowp vec4 colorFill;","void main(void) {","\tgl_FragColor = colorFill;","}"].join("\n");a=this.createShaderProgram({src:n},s,"<fill>");for(var c in this.shaderPrograms.push(a),cr.shaders)cr.shaders.hasOwnProperty(c)&&this.shaderPrograms.push(this.createShaderProgram(cr.shaders[c],s,c));i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,null),this.batch=[],this.batchPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.lastProgram=-1,this.currentProgram=-1,this.currentShader=null,this.fbo=i.createFramebuffer(),this.renderToTex=null,this.depthBuffer=null,this.attachedDepthBuffer=!1,this.enableFrontToBack&&(this.depthBuffer=i.createRenderbuffer()),this.tmpVec3=vec3.create([0,0,0]);var l=i.getParameter(i.ALIASED_POINT_SIZE_RANGE);this.minPointSize=l[0],this.maxPointSize=l[1],this.maxPointSize>2048&&(this.maxPointSize=2048),this.switchProgram(0),cr.seal(this)},r.prototype.updateMatMV=function(t){n(this.lpMatMV,t)||(mat4.set(t,this.lpMatMV),this.gl.uniformMatrix4fv(this.locMatMV,!1,t))},i.prototype.createShaderProgram=function(t,e,i){var n=this.gl,s=n.createShader(n.FRAGMENT_SHADER);if(n.shaderSource(s,t.src),n.compileShader(s),!n.getShaderParameter(s,n.COMPILE_STATUS)){var o=n.getShaderInfoLog(s);throw n.deleteShader(s),new Error("error compiling fragment shader: "+o)}var a=n.createShader(n.VERTEX_SHADER);if(n.shaderSource(a,e),n.compileShader(a),!n.getShaderParameter(a,n.COMPILE_STATUS)){o=n.getShaderInfoLog(a);throw n.deleteShader(s),n.deleteShader(a),new Error("error compiling vertex shader: "+o)}var h=n.createProgram();if(n.attachShader(h,s),n.attachShader(h,a),n.linkProgram(h),!n.getProgramParameter(h,n.LINK_STATUS)){o=n.getProgramInfoLog(h);throw n.deleteShader(s),n.deleteShader(a),n.deleteProgram(h),new Error("error linking shader program: "+o)}n.useProgram(h),n.deleteShader(s),n.deleteShader(a);var c,l,u=new r(n,h,i);for(u.extendBoxHorizontal=t.extendBoxHorizontal||0,u.extendBoxVertical=t.extendBoxVertical||0,u.crossSampling=!!t.crossSampling,u.preservesOpaqueness=!!t.preservesOpaqueness,u.animated=!!t.animated,u.parameters=t.parameters||[],c=0,l=u.parameters.length;c<l;c++)u.parameters[c][1]=n.getUniformLocation(h,u.parameters[c][0]),u.lastCustomParams.push(0);return cr.seal(u),u},i.prototype.getShaderIndex=function(t){var e,i;for(e=0,i=this.shaderPrograms.length;e<i;e++)if(this.shaderPrograms[e].name===t)return e;return-1},i.prototype.project=function(t,e,i){var r=this.matMV,n=this.matP,s=[0,0,0,0,0,0,0,0];s[0]=r[0]*t+r[4]*e+r[12],s[1]=r[1]*t+r[5]*e+r[13],s[2]=r[2]*t+r[6]*e+r[14],s[3]=r[3]*t+r[7]*e+r[15],s[4]=n[0]*s[0]+n[4]*s[1]+n[8]*s[2]+n[12]*s[3],s[5]=n[1]*s[0]+n[5]*s[1]+n[9]*s[2]+n[13]*s[3],s[6]=n[2]*s[0]+n[6]*s[1]+n[10]*s[2]+n[14]*s[3],s[7]=-s[2],0!==s[7]&&(s[7]=1/s[7],s[4]*=s[7],s[5]*=s[7],s[6]*=s[7],i[0]=(.5*s[4]+.5)*this.width,i[1]=(.5*s[5]+.5)*this.height)},i.prototype.setSize=function(t,e,i){if(this.width!==t||this.height!==e||i){this.endBatch();var r,n,s,o=this.gl;if(this.width=t,this.height=e,o.viewport(0,0,t,e),mat4.lookAt(this.cam,this.look,this.up,this.matMV),this.enableFrontToBack)mat4.ortho(-t/2,t/2,e/2,-e/2,this.zNear,this.zFar,this.matP),this.worldScale[0]=1,this.worldScale[1]=1;else{mat4.perspective(45,t/e,this.zNear,this.zFar,this.matP);var a=[0,0],h=[0,0];this.project(0,0,a),this.project(1,1,h),this.worldScale[0]=1/(h[0]-a[0]),this.worldScale[1]=-1/(h[1]-a[1])}for(r=0,n=this.shaderPrograms.length;r<n;r++)(s=this.shaderPrograms[r]).hasCurrentMatMV=!1,s.locMatP&&(o.useProgram(s.shaderProgram),o.uniformMatrix4fv(s.locMatP,!1,this.matP));o.useProgram(this.shaderPrograms[this.lastProgram].shaderProgram),o.bindTexture(o.TEXTURE_2D,null),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,null),o.activeTexture(o.TEXTURE0),this.lastTexture0=null,this.lastTexture1=null,this.depthBuffer&&(o.bindFramebuffer(o.FRAMEBUFFER,this.fbo),o.bindRenderbuffer(o.RENDERBUFFER,this.depthBuffer),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,this.width,this.height),this.attachedDepthBuffer||(o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,this.depthBuffer),this.attachedDepthBuffer=!0),o.bindRenderbuffer(o.RENDERBUFFER,null),o.bindFramebuffer(o.FRAMEBUFFER,null),this.renderToTex=null)}},i.prototype.resetModelView=function(){mat4.lookAt(this.cam,this.look,this.up,this.matMV),mat4.scale(this.matMV,this.worldScale)},i.prototype.translate=function(t,e){0===t&&0===e||(this.tmpVec3[0]=t,this.tmpVec3[1]=e,this.tmpVec3[2]=0,mat4.translate(this.matMV,this.tmpVec3))},i.prototype.scale=function(t,e){1===t&&1===e||(this.tmpVec3[0]=t,this.tmpVec3[1]=e,this.tmpVec3[2]=1,mat4.scale(this.matMV,this.tmpVec3))},i.prototype.rotateZ=function(t){0!==t&&mat4.rotateZ(this.matMV,t)},i.prototype.updateModelView=function(){if(!n(this.lastMV,this.matMV)){var t=this.pushBatch();t.type=5,t.mat4param?mat4.set(this.matMV,t.mat4param):t.mat4param=mat4.create(this.matMV),mat4.set(this.matMV,this.lastMV),this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},i.prototype.setEarlyZIndex=function(t){this.enableFrontToBack&&(t>32760&&(t=32760),this.currentZ=this.cam[2]-this.zNear-t*this.zIncrement)},s.prototype.doSetEarlyZPass=function(){var t=this.gl,e=this.glwrap;0!==this.startIndex?(t.depthMask(!0),t.colorMask(!1,!1,!1,!1),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,e.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0),t.clear(t.DEPTH_BUFFER_BIT),t.bindFramebuffer(t.FRAMEBUFFER,null),e.isBatchInEarlyZPass=!0):(t.depthMask(!1),t.colorMask(!0,!0,!0,!0),t.enable(t.BLEND),e.isBatchInEarlyZPass=!1)},s.prototype.doSetTexture=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texParam)},s.prototype.doSetTexture1=function(){var t=this.gl;t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.texParam),t.activeTexture(t.TEXTURE0)},s.prototype.doSetOpacity=function(){var t=this.opacityParam,e=this.glwrap;e.currentOpacity=t;var i=e.currentShader;i.locOpacity&&i.lpOpacity!==t&&(i.lpOpacity=t,this.gl.uniform1f(i.locOpacity,t))},s.prototype.doQuad=function(){this.gl.drawElements(this.gl.TRIANGLES,this.indexCount,this.gl.UNSIGNED_SHORT,this.startIndex)},s.prototype.doSetBlend=function(){this.gl.blendFunc(this.startIndex,this.indexCount)},s.prototype.doUpdateModelView=function(){var t,e,i,r=this.glwrap.shaderPrograms,n=this.glwrap.currentProgram;for(t=0,e=r.length;t<e;t++)i=r[t],t===n&&i.locMatMV?(i.updateMatMV(this.mat4param),i.hasCurrentMatMV=!0):i.hasCurrentMatMV=!1;mat4.set(this.mat4param,this.glwrap.currentMV)},s.prototype.doRenderToTexture=function(){var t=this.gl,e=this.glwrap;this.texParam?(e.lastTexture1===this.texParam&&(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,null),e.lastTexture1=null,t.activeTexture(t.TEXTURE0)),t.bindFramebuffer(t.FRAMEBUFFER,e.fbo),e.isBatchInEarlyZPass||t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texParam,0)):(e.enableFrontToBack||t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0),t.bindFramebuffer(t.FRAMEBUFFER,null))},s.prototype.doClear=function(){var t=this.gl,e=this.startIndex;0===e?(t.clearColor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),t.clear(t.COLOR_BUFFER_BIT)):1===e?(t.enable(t.SCISSOR_TEST),t.scissor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.SCISSOR_TEST)):t.clear(t.DEPTH_BUFFER_BIT)},s.prototype.doSetDepthTestEnabled=function(){var t=this.gl;0!==this.startIndex?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)},s.prototype.doPoints=function(){var t=this.gl,e=this.glwrap;e.enableFrontToBack&&t.disable(t.DEPTH_TEST);var i=e.shaderPrograms[1];t.useProgram(i.shaderProgram),!i.hasCurrentMatMV&&i.locMatMV&&(i.updateMatMV(e.currentMV),i.hasCurrentMatMV=!0),t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.pointBuffer),t.vertexAttribPointer(i.locAPos,4,t.FLOAT,!1,0,0),t.drawArrays(t.POINTS,this.startIndex/4,this.indexCount),i=e.currentShader,t.useProgram(i.shaderProgram),i.locAPos>=0&&(t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.vertexBuffers[e.curBuffer]),t.vertexAttribPointer(i.locAPos,e.enableFrontToBack?3:2,t.FLOAT,!1,0,0)),i.locATex>=0&&(t.enableVertexAttribArray(i.locATex),t.bindBuffer(t.ARRAY_BUFFER,e.texcoordBuffers[e.curBuffer]),t.vertexAttribPointer(i.locATex,2,t.FLOAT,!1,0,0)),e.enableFrontToBack&&t.enable(t.DEPTH_TEST)},s.prototype.doSetProgram=function(){var t=this.gl,e=this.glwrap,i=e.shaderPrograms[this.startIndex];e.currentProgram=this.startIndex,e.currentShader=i,t.useProgram(i.shaderProgram),!i.hasCurrentMatMV&&i.locMatMV&&(i.updateMatMV(e.currentMV),i.hasCurrentMatMV=!0),i.locOpacity&&i.lpOpacity!==e.currentOpacity&&(i.lpOpacity=e.currentOpacity,t.uniform1f(i.locOpacity,e.currentOpacity)),i.locAPos>=0&&(t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.vertexBuffers[e.curBuffer]),t.vertexAttribPointer(i.locAPos,e.enableFrontToBack?3:2,t.FLOAT,!1,0,0)),i.locATex>=0&&(t.enableVertexAttribArray(i.locATex),t.bindBuffer(t.ARRAY_BUFFER,e.texcoordBuffers[e.curBuffer]),t.vertexAttribPointer(i.locATex,2,t.FLOAT,!1,0,0))},s.prototype.doSetColor=function(){var t=this.glwrap.currentShader,e=this.mat4param;this.gl.uniform4f(t.locColorFill,e[0],e[1],e[2],e[3])},s.prototype.doSetProgramParameters=function(){var t,e,i=this.glwrap.currentShader,r=this.gl,n=this.mat4param,s=this.layoutRect,o=this.srcOriginRect;i.locSamplerBack&&this.glwrap.lastTexture1!==this.texParam&&(r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this.texParam),this.glwrap.lastTexture1=this.texParam,r.activeTexture(r.TEXTURE0));var a=n[0],h=n[1];if(!i.locPixelSize||a===i.lpPixelWidth&&h===i.lpPixelHeight||(i.lpPixelWidth=a,i.lpPixelHeight=h,r.uniform2f(i.locPixelSize,a,h)),a=n[2],h=n[3],!i.locDestStart||a===i.lpDestStartX&&h===i.lpDestStartY||(i.lpDestStartX=a,i.lpDestStartY=h,r.uniform2f(i.locDestStart,a,h)),a=n[4],h=n[5],!i.locDestEnd||a===i.lpDestEndX&&h===i.lpDestEndY||(i.lpDestEndX=a,i.lpDestEndY=h,r.uniform2f(i.locDestEnd,a,h)),a=n[6],i.locLayerScale&&a!==i.lpLayerScale&&(i.lpLayerScale=a,r.uniform1f(i.locLayerScale,a)),a=n[7],i.locLayerAngle&&a!==i.lpLayerAngle&&(i.lpLayerAngle=a,r.uniform1f(i.locLayerAngle,a)),a=n[12],h=n[13],!i.locSrcStart||a===i.lpSrcStartX&&h===i.lpSrcStartY||(i.lpSrcStartX=a,i.lpSrcStartY=h,r.uniform2f(i.locSrcStart,a,h)),a=n[14],h=n[15],!i.locSrcEnd||a===i.lpSrcEndX&&h===i.lpSrcEndY||(i.lpSrcEndX=a,i.lpSrcEndY=h,r.uniform2f(i.locSrcEnd,a,h)),a=o[0],h=o[1],!i.locSrcOriginStart||a===i.lpSrcOriginStartX&&h===i.lpSrcOriginStartY||(i.lpSrcOriginStartX=a,i.lpSrcOriginStartY=h,r.uniform2f(i.locSrcOriginStart,a,h)),a=o[2],h=o[3],!i.locSrcOriginEnd||a===i.lpSrcOriginEndX&&h===i.lpSrcOriginEndY||(i.lpSrcOriginEndX=a,i.lpSrcOriginEndY=h,r.uniform2f(i.locSrcOriginEnd,a,h)),a=s[0],h=s[1],!i.locLayoutStart||a===i.lpLayoutStartX&&h===i.lpLayoutStartY||(i.lpLayoutStartX=a,i.lpLayoutStartY=h,r.uniform2f(i.locLayoutStart,a,h)),a=s[2],h=s[3],!i.locLayoutEnd||a===i.lpLayoutEndX&&h===i.lpLayoutEndY||(i.lpLayoutEndX=a,i.lpLayoutEndY=h,r.uniform2f(i.locLayoutEnd,a,h)),a=this.startIndex,i.locSeconds&&a!==i.lpSeconds&&(i.lpSeconds=a,r.uniform1f(i.locSeconds,a)),i.parameters.length)for(t=0,e=i.parameters.length;t<e;t++)a=this.shaderParams[t],Array.isArray(a)?r.uniform3fv(i.parameters[t][1],a):a!==i.lastCustomParams[t]&&(i.lastCustomParams[t]=a,r.uniform1f(i.parameters[t][1],a))},i.prototype.pushBatch=function(){return this.batchPtr===this.batch.length&&this.batch.push(new s(0,this)),this.batch[this.batchPtr++]},i.prototype.endBatch=function(){if(0!==this.batchPtr&&!this.gl.isContextLost()){this.maybeStartTiming();var t,e,i,r=this.gl;if(this.pointPtr>0&&(r.bindBuffer(r.ARRAY_BUFFER,this.pointBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,this.pointData.subarray(0,this.pointPtr)),n&&n.locAPos>=0&&"<point>"===n.name&&r.vertexAttribPointer(n.locAPos,4,r.FLOAT,!1,0,0)),this.vertexPtr>0){var n=this.currentShader;r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffers[this.curBuffer]),r.bufferSubData(r.ARRAY_BUFFER,0,this.vertexData.subarray(0,this.vertexPtr)),n&&n.locAPos>=0&&"<point>"!==n.name&&r.vertexAttribPointer(n.locAPos,this.enableFrontToBack?3:2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this.texcoordBuffers[this.curBuffer]),r.bufferSubData(r.ARRAY_BUFFER,0,this.texcoordData.subarray(0,this.texPtr)),n&&n.locATex>=0&&"<point>"!==n.name&&r.vertexAttribPointer(n.locATex,2,r.FLOAT,!1,0,0)}for(t=0,e=this.batchPtr;t<e;t++)switch((i=this.batch[t]).type){case 1:i.doQuad();break;case 2:i.doSetTexture();break;case 3:i.doSetOpacity();break;case 4:i.doSetBlend();break;case 5:i.doUpdateModelView();break;case 6:i.doRenderToTexture();break;case 7:i.doClear();break;case 8:i.doPoints();break;case 9:i.doSetProgram();break;case 10:i.doSetProgramParameters();break;case 11:i.doSetTexture1();break;case 12:i.doSetColor();break;case 13:i.doSetDepthTestEnabled();break;case 14:i.doSetEarlyZPass()}this.batchPtr=0,this.vertexPtr=0,this.texPtr=0,this.pointPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isBatchInEarlyZPass=!1,this.curBuffer++,this.curBuffer>=4&&(this.curBuffer=0)}},i.prototype.maybeStartTiming=function(){if(!this.isTiming&&this.timerExt){this.isTiming=!0;var t={frameNumber:this.frameNumber,query:null,result:0};if(2===this.version?(t.query=this.gl.createQuery(),this.gl.beginQuery(this.timerExt.TIME_ELAPSED_EXT,t.query)):(t.query=this.timerExt.createQueryEXT(),this.timerExt.beginQueryEXT(this.timerExt.TIME_ELAPSED_EXT,t.query)),this.timerResults.push(t),this.timerResults.length>1e3){var e=this.timerResults.shift();e.query&&(2===this.version?this.gl.deleteQuery(e.query):this.timerExt.deleteQueryEXT(e.query))}}},i.prototype.maybeFinishTiming=function(){if(this.isTiming&&this.timerResults.length){this.timerResults[this.timerResults.length-1];2===this.version?this.gl.endQuery(this.timerExt.TIME_ELAPSED_EXT):this.timerExt.endQueryEXT(this.timerExt.TIME_ELAPSED_EXT),this.isTiming=!1}},i.prototype.checkForTimerResults=function(t){var e,i,r,n,s;for(e=0,i=this.timerResults.length;e<i;++e){if((r=this.timerResults[e]).frameNumber>=t)return;r.query&&(n=2===this.version?this.gl.getQueryParameter(r.query,this.gl.QUERY_RESULT_AVAILABLE):this.timerExt.getQueryObjectEXT(r.query,this.timerExt.QUERY_RESULT_AVAILABLE_EXT),s=this.gl.getParameter(this.timerExt.GPU_DISJOINT_EXT),n&&!s&&(2===this.version?r.result=this.gl.getQueryParameter(r.query,this.gl.QUERY_RESULT):r.result=this.timerExt.getQueryObjectEXT(r.query,this.timerExt.QUERY_RESULT_EXT),r.result/=1e9),(n||s)&&(2===this.version?this.gl.deleteQuery(r.query):this.timerExt.deleteQueryEXT(r.query),r.query=null))}},i.prototype.getFrameRangeTimerResults=function(t,e){if(e<=t)return-1;var i,r,n,s=0,o=0;for(i=0,r=this.timerResults.length;i<r&&!((n=this.timerResults[i]).frameNumber>=e);++i)if(n.frameNumber>=t){if(n.query)return-1;s+=n.result,o++}return o<e-t?-1:s},i.prototype.deleteTimerResultsToFrame=function(t){var e,i;for(e=0,i=this.timerResults.length;e<i;++e)if(this.timerResults[e].frameNumber>=t)return void(e>0&&this.timerResults.splice(0,e))},i.prototype.setOpacity=function(t){if(t!==this.lastOpacity&&!this.isEarlyZPass){var e=this.pushBatch();e.type=3,e.opacityParam=t,this.lastOpacity=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},i.prototype.setTexture=function(t){if(t!==this.lastTexture0){var e=this.pushBatch();e.type=2,e.texParam=t,this.lastTexture0=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},i.prototype.setBlend=function(t,e){if((t!==this.lastSrcBlend||e!==this.lastDestBlend)&&!this.isEarlyZPass){var i=this.pushBatch();i.type=4,i.startIndex=t,i.indexCount=e,this.lastSrcBlend=t,this.lastDestBlend=e,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},i.prototype.isPremultipliedAlphaBlend=function(){return this.lastSrcBlend===this.gl.ONE&&this.lastDestBlend===this.gl.ONE_MINUS_SRC_ALPHA},i.prototype.setAlphaBlend=function(){this.setBlend(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)},i.prototype.setNoPremultiplyAlphaBlend=function(){this.setBlend(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)};var o=15992;i.prototype.quad=function(t,e,i,r,n,s,a,h){this.vertexPtr>=o&&this.endBatch();var c=this.vertexPtr,l=this.texPtr,u=this.vertexData,p=this.texcoordData,d=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var f=this.pushBatch();f.type=1,f.startIndex=this.enableFrontToBack?c:c/2*3,f.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}this.enableFrontToBack?(u[c++]=t,u[c++]=e,u[c++]=d,u[c++]=i,u[c++]=r,u[c++]=d,u[c++]=n,u[c++]=s,u[c++]=d,u[c++]=a,u[c++]=h,u[c++]=d):(u[c++]=t,u[c++]=e,u[c++]=i,u[c++]=r,u[c++]=n,u[c++]=s,u[c++]=a,u[c++]=h),p[l++]=0,p[l++]=0,p[l++]=1,p[l++]=0,p[l++]=1,p[l++]=1,p[l++]=0,p[l++]=1,this.vertexPtr=c,this.texPtr=l},i.prototype.quadTex=function(t,e,i,r,n,s,a,h,c){this.vertexPtr>=o&&this.endBatch();var l=this.vertexPtr,u=this.texPtr,p=this.vertexData,d=this.texcoordData,f=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var g=this.pushBatch();g.type=1,g.startIndex=this.enableFrontToBack?l:l/2*3,g.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}var y=c.left,m=c.top,_=c.right,v=c.bottom;this.enableFrontToBack?(p[l++]=t,p[l++]=e,p[l++]=f,p[l++]=i,p[l++]=r,p[l++]=f,p[l++]=n,p[l++]=s,p[l++]=f,p[l++]=a,p[l++]=h,p[l++]=f):(p[l++]=t,p[l++]=e,p[l++]=i,p[l++]=r,p[l++]=n,p[l++]=s,p[l++]=a,p[l++]=h),d[u++]=y,d[u++]=m,d[u++]=_,d[u++]=m,d[u++]=_,d[u++]=v,d[u++]=y,d[u++]=v,this.vertexPtr=l,this.texPtr=u},i.prototype.quadTexUV=function(t,e,i,r,n,s,a,h,c,l,u,p,d,f,g,y){this.vertexPtr>=o&&this.endBatch();var m=this.vertexPtr,_=this.texPtr,v=this.vertexData,b=this.texcoordData,w=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var x=this.pushBatch();x.type=1,x.startIndex=this.enableFrontToBack?m:m/2*3,x.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}this.enableFrontToBack?(v[m++]=t,v[m++]=e,v[m++]=w,v[m++]=i,v[m++]=r,v[m++]=w,v[m++]=n,v[m++]=s,v[m++]=w,v[m++]=a,v[m++]=h,v[m++]=w):(v[m++]=t,v[m++]=e,v[m++]=i,v[m++]=r,v[m++]=n,v[m++]=s,v[m++]=a,v[m++]=h),b[_++]=c,b[_++]=l,b[_++]=u,b[_++]=p,b[_++]=d,b[_++]=f,b[_++]=g,b[_++]=y,this.vertexPtr=m,this.texPtr=_},i.prototype.convexPoly=function(t){var e,i,r,n,s,o,a,h,c=t.length/2-2,l=c-1,u=t[0],p=t[1];for(e=0;e<c;e+=2)r=t[(i=2*e)+2],n=t[i+3],s=t[i+4],o=t[i+5],e===l?this.quad(u,p,r,n,s,o,s,o):(a=t[i+6],h=t[i+7],this.quad(u,p,r,n,s,o,a,h))};i.prototype.point=function(t,e,i,r){this.pointPtr>=7996&&this.endBatch();var n=this.pointPtr,s=this.pointData;if(this.hasPointBatchTop)this.batch[this.batchPtr-1].indexCount++;else{var o=this.pushBatch();o.type=8,o.startIndex=n,o.indexCount=1,this.hasPointBatchTop=!0,this.hasQuadBatchTop=!1}s[n++]=t,s[n++]=e,s[n++]=i,s[n++]=r,this.pointPtr=n},i.prototype.switchProgram=function(t){if(this.lastProgram!==t){var e=this.shaderPrograms[t];if(!e){if(0===this.lastProgram)return;t=0,e=this.shaderPrograms[0]}var i=this.pushBatch();i.type=9,i.startIndex=t,this.lastProgram=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},i.prototype.programUsesDest=function(t){var e=this.shaderPrograms[t];return!(!e.locDestStart&&!e.locDestEnd)},i.prototype.programUsesCrossSampling=function(t){var e=this.shaderPrograms[t];return!!(e.locDestStart||e.locDestEnd||e.crossSampling)},i.prototype.programPreservesOpaqueness=function(t){return this.shaderPrograms[t].preservesOpaqueness},i.prototype.programExtendsBox=function(t){var e=this.shaderPrograms[t];return 0!==e.extendBoxHorizontal||0!==e.extendBoxVertical},i.prototype.getProgramBoxExtendHorizontal=function(t){return this.shaderPrograms[t].extendBoxHorizontal},i.prototype.getProgramBoxExtendVertical=function(t){return this.shaderPrograms[t].extendBoxVertical},i.prototype.getProgramParameterType=function(t,e){return this.shaderPrograms[t].parameters[e][2]},i.prototype.programIsAnimated=function(t){return this.shaderPrograms[t].animated},i.prototype.setProgramParameters=function(t,e,i,r,n,s,o,a,h,c,l,u,p,d,f,g,y,m,_,v,b,w,x){var S,T,C,A,O,E,P,I=this.shaderPrograms[this.lastProgram];if(I.hasAnyOptionalUniforms||x.length){if((C=this.pushBatch()).type=10,C.mat4param?mat4.set(this.matMV,C.mat4param):C.mat4param=mat4.create(),(A=C.mat4param)[0]=e,A[1]=i,A[2]=g,A[3]=y,A[4]=m,A[5]=_,A[6]=v,A[7]=b,A[12]=r,A[13]=n,A[14]=s,A[15]=o,(E=C.srcOriginRect)[0]=a,E[1]=h,E[2]=c,E[3]=l,(P=C.layoutRect)[0]=u,P[1]=f,P[2]=d,P[3]=p,C.startIndex=w,I.locSamplerBack?C.texParam=t:C.texParam=null,x.length)for((O=C.shaderParams).length=x.length,S=0,T=x.length;S<T;S++)O[S]=x[S];this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},i.prototype.clear=function(t,e,i,r){var n=this.pushBatch();n.type=7,n.startIndex=0,n.mat4param||(n.mat4param=mat4.create()),n.mat4param[0]=t,n.mat4param[1]=e,n.mat4param[2]=i,n.mat4param[3]=r,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},i.prototype.clearRect=function(t,e,i,r){if(!(i<0||r<0)){var n=this.pushBatch();n.type=7,n.startIndex=1,n.mat4param||(n.mat4param=mat4.create()),n.mat4param[0]=t,n.mat4param[1]=e,n.mat4param[2]=i,n.mat4param[3]=r,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},i.prototype.clearDepth=function(){var t=this.pushBatch();t.type=7,t.startIndex=2,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},i.prototype.setEarlyZPass=function(t){if(this.enableFrontToBack&&(t=!!t,this.isEarlyZPass!==t)){var e=this.pushBatch();e.type=14,e.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isEarlyZPass=t,this.renderToTex=null,this.isEarlyZPass?this.switchProgram(2):this.switchProgram(0)}},i.prototype.setDepthTestEnabled=function(t){if(this.enableFrontToBack){var e=this.pushBatch();e.type=13,e.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},i.prototype.fullscreenQuad=function(){mat4.set(this.lastMV,e),this.resetModelView(),this.updateModelView();var t=this.width/2,i=this.height/2;this.quad(-t,i,t,i,t,-i,-t,-i),mat4.set(e,this.matMV),this.updateModelView()},i.prototype.setColorFillMode=function(t,e,i,r){this.switchProgram(3);var n=this.pushBatch();n.type=12,n.mat4param||(n.mat4param=mat4.create()),n.mat4param[0]=t,n.mat4param[1]=e,n.mat4param[2]=i,n.mat4param[3]=r,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},i.prototype.setTextureFillMode=function(){this.switchProgram(0)},i.prototype.restoreEarlyZMode=function(){this.switchProgram(2)},i.prototype.getFrameNumber=function(){return this.frameNumber},i.prototype.present=function(){this.endBatch(),this.maybeFinishTiming(),this.gl.flush(),this.checkForTimerResults(this.frameNumber),this.frameNumber++},i.prototype.supportsGpuProfiling=function(){return!!this.timerExt};var a=[],h={};i.prototype.contextLost=function(){cr.clearArray(a),h={}};i.prototype.loadTexture=function(t,e,i,r,n,s){e=!!e,i=!!i;var o=t.src+","+e+","+i+(e?","+n:""),c=null;if(void 0!==t.src&&h.hasOwnProperty(o))return(c=h[o]).c2refcount++,c;this.endBatch();var l=this.gl,u=cr.isPOT(t.width)&&cr.isPOT(t.height);c=l.createTexture(),l.bindTexture(l.TEXTURE_2D,c),l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var p=l.RGBA,d=l.RGBA,f=l.UNSIGNED_BYTE;if(r&&!this.isIE)switch(r){case 1:p=l.RGB,d=l.RGB;break;case 2:f=l.UNSIGNED_SHORT_4_4_4_4;break;case 3:f=l.UNSIGNED_SHORT_5_5_5_1;break;case 4:p=l.RGB,d=l.RGB,f=l.UNSIGNED_SHORT_5_6_5}if(1===this.version&&!u&&e){var g=document.createElement("canvas");g.width=cr.nextHighestPowerOfTwo(t.width),g.height=cr.nextHighestPowerOfTwo(t.height);var y=g.getContext("2d");y.imageSmoothingEnabled=i,y.drawImage(t,0,0,t.width,t.height,0,0,g.width,g.height),l.texImage2D(l.TEXTURE_2D,0,p,d,f,g)}else l.texImage2D(l.TEXTURE_2D,0,p,d,f,t);return e?"repeat-x"===n?(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE)):"repeat-y"===n?(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT)):(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT)):(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE)),i?(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),(u||this.version>=2)&&this.enable_mipmaps&&!s?(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR_MIPMAP_LINEAR),l.generateMipmap(l.TEXTURE_2D)):l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR)):(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST)),l.bindTexture(l.TEXTURE_2D,null),this.lastTexture0=null,c.c2width=t.width,c.c2height=t.height,c.c2refcount=1,c.c2texkey=o,a.push(c),h[o]=c,c},i.prototype.createEmptyTexture=function(t,e,i,r,n){this.endBatch();var s=this.gl;this.isIE&&(r=!1);var o=s.createTexture();return s.bindTexture(s.TEXTURE_2D,o),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t,e,0,s.RGBA,r?s.UNSIGNED_SHORT_4_4_4_4:s.UNSIGNED_BYTE,null),n?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT)):(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE)),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,i?s.LINEAR:s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,i?s.LINEAR:s.NEAREST),s.bindTexture(s.TEXTURE_2D,null),this.lastTexture0=null,o.c2width=t,o.c2height=e,a.push(o),o},i.prototype.videoToTexture=function(t,e,i){this.endBatch();var r=this.gl;this.isIE&&(i=!1),r.bindTexture(r.TEXTURE_2D,e),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);try{r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,i?r.UNSIGNED_SHORT_4_4_4_4:r.UNSIGNED_BYTE,t)}catch(t){console&&console.error&&console.error("Error updating WebGL texture: ",t)}r.bindTexture(r.TEXTURE_2D,null),this.lastTexture0=null},i.prototype.deleteTexture=function(t){t&&(void 0!==t.c2refcount&&t.c2refcount>1?t.c2refcount--:(this.endBatch(),t===this.lastTexture0&&(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.lastTexture0=null),t===this.lastTexture1&&(this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.activeTexture(this.gl.TEXTURE0),this.lastTexture1=null),cr.arrayFindRemove(a,t),void 0!==t.c2texkey&&delete h[t.c2texkey],this.gl.deleteTexture(t)))},i.prototype.estimateVRAM=function(){var t,e,i,r=this.width*this.height*4*2;for(t=0,e=a.length;t<e;t++)r+=(i=a[t]).c2width*i.c2height*4;return r},i.prototype.textureCount=function(){return a.length},i.prototype.setRenderingToTexture=function(t){if(t!==this.renderToTex){var e=this.pushBatch();e.type=6,e.texParam=t,this.renderToTex=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},cr.GLWrap=i}(),function(){var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,e=new Audio,i={"audio/webm; codecs=opus":!!e.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!e.canPlayType("audio/ogg; codecs=opus"),"audio/webm; codecs=vorbis":!!e.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!e.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!e.canPlayType("audio/mp4"),"audio/mpeg":!!e.canPlayType("audio/mpeg")};function r(t){var e=t.canvas,i=t.projectDataUrl;if(e||(e=document.createElement("canvas"),document.body.appendChild(e)),e&&e.getContext){window.c3runtime=this,window.c3canvas=e;var r=this;if(this.exportType=t.exportType,this.isPreview="preview"===this.exportType,this.isRemotePreview=!!t.isRemotePreview,this.isCrosswalk=/crosswalk/i.test(navigator.userAgent)||/xwalk/i.test(navigator.userAgent)||!(void 0===window.c2isCrosswalk||!window.c2isCrosswalk),this.isCordova="cordova"===this.exportType,this.isPhoneGap=this.isCordova,this.isMicrosoftEdge=/edge\//i.test(navigator.userAgent),this.isIE=(/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent)||/iemobile/i.test(navigator.userAgent))&&!this.isMicrosoftEdge,this.isTizen=/tizen/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)&&!this.isTizen&&!this.isIE&&!this.isMicrosoftEdge,this.isiPhone=(/iphone/i.test(navigator.userAgent)||/ipod/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isiPad=/ipad/i.test(navigator.userAgent),this.isiOS=this.isiPhone||this.isiPad,this.isChrome=(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isAmazonWebApp=/amazonwebappplatform/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isSafari=/safari/i.test(navigator.userAgent)&&!this.isChrome&&!this.isIE&&!this.isMicrosoftEdge,this.isWindows=/windows/i.test(navigator.userAgent),this.isNWjs="nwjs"===this.exportType||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent),this.isNodeWebkit=this.isNWjs,this.isArcade="scirra-arcade"===this.exportType,this.isWindows8App=!(void 0===window.c2isWindows8||!window.c2isWindows8),this.isWindowsPhone8=!(void 0===window.c2isWindowsPhone8||!window.c2isWindowsPhone8),this.isWindowsPhone81=!(void 0===window.c2isWindowsPhone81||!window.c2isWindowsPhone81),this.isWindows10="windows-uwp"===this.exportType,this.isWinJS=this.isWindows8App||this.isWindowsPhone81||this.isWindows10,this.isBlackberry10=!(void 0===window.c2isBlackberry10||!window.c2isBlackberry10),this.isAndroidStockBrowser=this.isAndroid&&!this.isChrome&&!this.isCrosswalk&&!this.isFirefox&&!this.isAmazonWebApp,this.devicePixelRatio=1,this.isMobile=this.isCordova||this.isCrosswalk||this.isAndroid||this.isiOS||this.isWindowsPhone8||this.isWindowsPhone81||this.isBlackberry10||this.isTizen,this.isMobile||(this.isMobile=/(blackberry|bb10|playbook|palm|symbian|nokia|windows\s+ce|phone|mobile|tablet|kindle|silk)/i.test(navigator.userAgent)),this.isWKWebView=!(!this.isiOS||!this.isCordova),this.isPreview&&!this.isNWjs&&("?nw"===window.location.search||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent))&&(this.isNWjs=!0),this.isDebug=this.isPreview&&window.location.search.indexOf("debug")>-1,this.useFbInstant="undefined"!=typeof FBInstant&&!this.isPreview&&!this.isCordova,this.hasInitialized=!1,this.canvas=e,this.gl=null,this.glwrap=null,this.glUnmaskedRenderer="(unavailable)",this.enableFrontToBack=!1,this.earlyz_index=0,this.ctx=null,this.firstInFullscreen=!1,this.oldWidth=0,this.oldHeight=0,this.canvas.oncontextmenu=function(t){return t.preventDefault&&t.preventDefault(),!1},this.canvas.onselectstart=function(t){return t.preventDefault&&t.preventDefault(),!1},this.canvas.ontouchstart=function(t){return t.preventDefault&&t.preventDefault(),!1},this.isNWjs&&(window.ondragover=function(t){return t.preventDefault(),!1},window.ondrop=function(t){return t.preventDefault(),!1},window.nwgui&&window.nwgui.App.clearCache&&window.nwgui.App.clearCache()),this.isCordova&&this.isiOS){function n(t){do{if(t.parentNode&&t.hasAttribute("contenteditable"))return!0;t=t.parentNode}while(t);return!1}function s(){var t=document.activeElement;if(!t)return!1;var e=t.tagName.toLowerCase();return"textarea"===e||("input"===e?["email","number","password","search","tel","text","url"].indexOf(t.type.toLowerCase()||"text")>-1:n(t))}window.addEventListener("focusout",(function(){s()||(document.scrollingElement.scrollTop=0)}))}this.projectDataUrl=i||"",this.width=e.width,this.height=e.height,this.draw_width=this.width,this.draw_height=this.height,this.cssWidth=this.width,this.cssHeight=this.height,this.lastWindowWidth=window.innerWidth,this.lastWindowHeight=window.innerHeight,this.forceCanvasAlpha=!1,this.redraw=!0,this.isSuspended=!1,Date.now||(Date.now=function(){return+new Date}),this.plugins=[],this.types={},this.types_lowercase={},this.types_by_index=[],this.behaviors=[],this.layouts={},this.layouts_by_index=[],this.eventsheets={},this.eventsheets_by_index=[],this.wait_for_textures=[],this.triggers_to_postinit=[],this.all_global_vars=[],this.all_local_vars=[],this.solidBehavior=null,this.jumpthruBehavior=null,this.shadowcasterBehavior=null,this.deathRow={},this.hasPendingInstances=!1,this.isInClearDeathRow=!1,this.isInOnDestroy=0,this.isRunningEvents=!1,this.isEndingLayout=!1,this.createRow=[],this.isLoadingState=!1,this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null,this.lastSaveJson="",this.signalledContinuousPreview=!1,this.suspendDrawing=!1,this.fireOnCreateAfterLoad=[],this.dt=0,this.dt1=0,this.minimumFramerate=30,this.logictime=0,this.cpuutilisation=0,this.timescale=1,this.kahanTime=new cr.KahanAdder,this.wallTime=new cr.KahanAdder,this.last_tick_time=0,this.fps=0,this.last_fps_time=0,this.tickcount=0,this.tickcount_nosave=0,this.execcount=0,this.framecount=0,this.objectcount=0,this.gpuTimeStartFrame=0,this.gpuTimeEndFrame=0,this.gpuCurUtilisation=-1,this.gpuLastUtilisation=0,this.changelayout=null,this.destroycallbacks=[],this.event_stack=[],this.event_stack_index=-1,this.localvar_stack=[[]],this.localvar_stack_index=0,this.trigger_depth=0,this.pushEventStack(null),this.loop_stack=[],this.loop_stack_index=-1,this.next_uid=0,this.next_puid=0,this.layout_first_tick=!0,this.family_count=0,this.suspend_events=[],this.raf_id=-1,this.timeout_id=-1,this.isloading=!0,this.loadingprogress=0,this.stackLocalCount=0,this.audioInstance=null,this.had_a_click=!1,this.isInUserInputEvent=!1,this.objects_to_pretick=new cr.ObjectSet,this.objects_to_tick=new cr.ObjectSet,this.objects_to_tick2=new cr.ObjectSet,this.registered_collisions=[],this.temp_poly=new cr.CollisionPoly([]),this.temp_poly2=new cr.CollisionPoly([]),this.allGroups=[],this.groups_by_name={},this.cndsBySid={},this.actsBySid={},this.varsBySid={},this.blocksBySid={},this.running_layout=null,this.layer_canvas=null,this.layer_ctx=null,this.layer_tex=null,this.layout_tex=null,this.layout_canvas=null,this.layout_ctx=null,this.is_WebGL_context_lost=!1,this.uses_background_blending=!1,this.fx_tex=[null,null],this.fullscreen_scaling=0,this.files_subfolder="",this.objectsByUid={},this.loaderlogos=null,this.webFontNames=null,this.enhancedAccelerationPrecision=!0,this.snapshotCanvas=null,this.snapshotData="",this.objectRefTable=[],"html5"===this.exportType&&"file"===location.protocol.substr(0,4)&&alert("Exported games won't work until you upload them. (When running on the file: protocol, browsers block many features from working for security reasons.)"),this.useFbInstant?(FBInstant.initializeAsync().then((function(){r.requestProjectData()})).catch((function(t){console.warn("[Instant Games] Unable to load: ",t),r.requestProjectData()})),window.setTimeout((function(){r.hasInitialized||(console.warn("[Instant Games] Initialization timed out after 4 seconds. Continuing with Instant Games disabled."),r.useFbInstant=!1,r.requestProjectData())}),4e3)):this.requestProjectData()}}e=null,r.prototype.requestProjectData=function(){if(!this.hasInitialized){this.hasInitialized=!0;var t=this;if(this.isWKWebView)this.fetchLocalFileViaCordovaAsText("data.js",(function(e){t.loadProject(JSON.parse(e))}),(function(t){alert("Error fetching data.js")}));else{var e;e=this.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;var i=this.projectDataUrl||"data.js";(this.isWindows8App||this.isWindowsPhone8||this.isWindowsPhone81||this.isWindows10)&&(i="data.json"),e.open("GET",i,!0);var r=!1;if("response"in e&&"responseType"in e)try{e.responseType="json",r="json"===e.responseType}catch(t){r=!1}if(!r&&"responseType"in e)try{e.responseType="text"}catch(t){}if("overrideMimeType"in e)try{e.overrideMimeType("application/json; charset=utf-8")}catch(t){}this.isWindowsPhone8?e.onreadystatechange=function(){4===e.readyState&&t.loadProject(JSON.parse(e.responseText))}:(e.onload=function(){r?t.loadProject(e.response):t.loadProject(JSON.parse(e.responseText))},e.onerror=function(t){cr.logerror("Error requesting "+i+":"),cr.logerror(t)}),e.send()}}},r.prototype.initRendererAndLoader=function(){var t,e,i,r,n,s,o,a,h,c,l=this;this.isRetina=this.useHighDpi&&!this.isAndroidStockBrowser,0===this.fullscreen_mode&&this.isiOS&&(this.isRetina=!1);var u,p=window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio||window.msDevicePixelRatio||1;this.devicePixelRatio=this.isRetina?p:1,"object"==typeof window.StatusBar&&window.StatusBar.hide(),"object"==typeof window.AndroidFullScreen&&window.AndroidFullScreen.immersiveMode(),this.ClearDeathRow(),this.fullscreen_mode>0&&this.setSize(window.innerWidth,window.innerHeight,!0);try{this.enableWebGL&&(u={alpha:!0,depth:!1,antialias:!1,failIfMajorPerformanceCaveat:!0},this.isAndroid||(this.gl=this.canvas.getContext("webgl2",u)),this.gl||(this.gl=this.canvas.getContext("webgl",u)||this.canvas.getContext("experimental-webgl",u)))}catch(t){}if(this.gl){this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2");var d=this.gl.getExtension("WEBGL_debug_renderer_info");if(d){var f=this.gl.getParameter(d.UNMASKED_VENDOR_WEBGL),g=this.gl.getParameter(d.UNMASKED_RENDERER_WEBGL);this.glUnmaskedRenderer=g+" ["+f+"]"}for(this.enableFrontToBack&&(this.glUnmaskedRenderer+=" [front-to-back enabled]"),this.overlay_canvas=document.createElement("canvas"),this.canvas.parentNode.appendChild(this.overlay_canvas),this.overlay_canvas.oncontextmenu=function(t){return!1},this.overlay_canvas.onselectstart=function(t){return!1},this.overlay_canvas.width=Math.round(this.cssWidth*this.devicePixelRatio),this.overlay_canvas.height=Math.round(this.cssHeight*this.devicePixelRatio),this.overlay_canvas.style.width=this.cssWidth+"px",this.overlay_canvas.style.height=this.cssHeight+"px",this.overlay_canvas.style.position="absolute",this.overlay_ctx=this.overlay_canvas.getContext("2d"),this.glwrap=new cr.GLWrap(this.gl,this.isMobile,this.enableFrontToBack),this.glwrap.setSize(this.canvas.width,this.canvas.height),this.glwrap.enable_mipmaps=0!==this.downscalingQuality,this.ctx=null,this.canvas.addEventListener("webglcontextlost",(function(t){t.preventDefault(),l.onContextLost(),cr.logexport("[Construct 2] WebGL context lost"),window.cr_setSuspended(!0)}),!1),this.canvas.addEventListener("webglcontextrestored",(function(t){l.glwrap.initState(),l.glwrap.setSize(l.glwrap.width,l.glwrap.height,!0),l.layer_tex=null,l.layout_tex=null,l.fx_tex[0]=null,l.fx_tex[1]=null,l.onContextRestored(),l.redraw=!0,cr.logexport("[Construct 2] WebGL context restored"),window.cr_setSuspended(!1)}),!1),this.glwrap.supportsGpuProfiling()||(this.gpuLastUtilisation=NaN),t=0,e=this.types_by_index.length;t<e;t++)for(i=0,r=(o=this.types_by_index[t]).effect_types.length;i<r;i++)(a=o.effect_types[i]).shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(a.shaderindex);for(t=0,e=this.layouts_by_index.length;t<e;t++){for(i=0,r=(h=this.layouts_by_index[t]).effect_types.length;i<r;i++)(a=h.effect_types[i]).shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex);for(h.updateActiveEffects(),i=0,r=h.layers.length;i<r;i++){for(n=0,s=(c=h.layers[i]).effect_types.length;n<s;n++)(a=c.effect_types[n]).shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(a.shaderindex);c.updateActiveEffects()}}}else u={alpha:!0},this.ctx=this.canvas.getContext("2d",u),this.ctx.imageSmoothingEnabled=this.linearSampling,this.overlay_canvas=null,this.overlay_ctx=null,this.gpuLastUtilisation=NaN,this.wantFullscreenScalingQuality=!0,this.fullscreenScalingQuality=!0;this.tickFunc=function(t){l.tick(!1,t)},window==window.top||this.isWinJS||this.isWindowsPhone8||(document.addEventListener("mousedown",(function(){window.focus()}),!0),document.addEventListener("touchstart",(function(){window.focus()}),!0)),this.isPreview&&(window.location.search.indexOf("continuous")>-1&&(cr.logexport("Reloading for continuous preview"),this.loadFromSlot="__c2_continuouspreview",this.suspendDrawing=!0),this.pauseOnBlur&&!this.isMobile&&(window.addEventListener("focus",(function(){l.setSuspended(!1)})),window.addEventListener("blur",(function(){var t=window.parent;t&&t.document.hasFocus()||l.setSuspended(!0)})))),window.addEventListener("blur",(function(){l.onWindowBlur()}));var y=function(t){if("mousedown"===t.type&&1===t.button&&t.preventDefault(),cr.isCanvasInputEvent(t)&&document.activeElement&&document.activeElement!==document.getElementsByTagName("body")[0]&&document.activeElement.blur)try{document.activeElement.blur()}catch(t){}};"undefined"!=typeof PointerEvent?document.addEventListener("pointerdown",y):window.navigator.msPointerEnabled?document.addEventListener("MSPointerDown",y):document.addEventListener("touchstart",y),document.addEventListener("mousedown",y),0===this.fullscreen_mode&&this.isRetina&&this.devicePixelRatio>1?this.setSize(this.original_width,this.original_height,!0):this.setSize(window.innerWidth,window.innerHeight,!0),this.tryLockOrientation(),this.getready(),this.go(),this.extra={},cr.seal(this)},r.prototype.setSize=function(t,e,i){var r=0,n=0,s=0,o=0,a=0;if(this.lastWindowWidth!==t||this.lastWindowHeight!==e||i){if(this.isiPhone&&this.isCordova&&window.screen){var h=document.documentElement.style,c=document.body.style,l=window.innerWidth<window.innerHeight,u=l?window.screen.height:window.screen.width,p=l?window.screen.width:window.screen.height;u&&p&&(c.height=h.height=u+"px",c.width=h.width=p+"px")}this.lastWindowWidth=t,this.lastWindowHeight=e;var d,f,g=this.fullscreen_mode,y=(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen)&&!this.isCordova;if(y||0!==this.fullscreen_mode||i){y&&(g=this.fullscreen_scaling);var m=this.devicePixelRatio;g>=4?(5===g&&1!==m&&(t+=1,e+=1),(f=t/e)>(d=this.original_width/this.original_height)?(s=e*d,5===g?((a=s*m/this.original_width)>1?a=Math.floor(a):a<1&&(a=1/Math.ceil(1/a)),r=(t-(s=this.original_width*a/m))/2,n=(e-(o=this.original_height*a/m))/2,t=s,e=o):(r=(t-s)/2,t=s)):(o=t/d,5===g?((a=o*m/this.original_height)>1?a=Math.floor(a):a<1&&(a=1/Math.ceil(1/a)),r=(t-(s=this.original_width*a/m))/2,n=(e-(o=this.original_height*a/m))/2,t=s,e=o):(n=(e-o)/2,e=o))):y&&0===g&&(r=Math.floor((t-this.original_width)/2),n=Math.floor((e-this.original_height)/2),t=this.original_width,e=this.original_height),g<2&&(this.aspect_scale=m),this.cssWidth=Math.round(t),this.cssHeight=Math.round(e),this.width=Math.round(t*m),this.height=Math.round(e*m),this.redraw=!0,this.wantFullscreenScalingQuality||this.width<this.original_width&&this.height<this.original_height||1===g?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):(this.draw_width=this.original_width,this.draw_height=this.original_height,this.fullscreenScalingQuality=!1,2===g?(d=this.original_width/this.original_height,(f=this.lastWindowWidth/this.lastWindowHeight)<d?this.draw_width=this.draw_height*f:f>d&&(this.draw_height=this.draw_width/f)):3===g&&(d=this.original_width/this.original_height,(f=this.lastWindowWidth/this.lastWindowHeight)>d?this.draw_width=this.draw_height*f:f<d&&(this.draw_height=this.draw_width/f))),this.canvas&&(this.canvas.width=Math.round(t*m),this.canvas.height=Math.round(e*m),this.isRetina&&(this.canvas.style.width=Math.round(t)+"px",this.canvas.style.height=Math.round(e)+"px"),this.canvas.style.marginLeft=Math.floor(r)+"px",this.canvas.style.marginTop=Math.floor(n)+"px"),this.overlay_canvas&&(this.overlay_canvas.width=Math.round(t*m),this.overlay_canvas.height=Math.round(e*m),this.overlay_canvas.style.width=this.cssWidth+"px",this.overlay_canvas.style.height=this.cssHeight+"px",this.overlay_canvas.style.left=Math.floor(r)+"px",this.overlay_canvas.style.top=Math.floor(n)+"px"),this.glwrap&&this.glwrap.setSize(Math.round(t*m),Math.round(e*m)),this.ctx&&(this.ctx.imageSmoothingEnabled=this.linearSampling),this.tryLockOrientation(),this.isiPhone&&!this.isCordova&&window.scrollTo(0,0)}}},r.prototype.tryLockOrientation=function(){if(this.autoLockOrientation&&0!==this.orientations){var t="portrait";2===this.orientations&&(t="landscape");try{screen.orientation&&screen.orientation.lock?screen.orientation.lock(t).catch((function(){})):screen.lockOrientation?screen.lockOrientation(t):screen.webkitLockOrientation?screen.webkitLockOrientation(t):screen.mozLockOrientation?screen.mozLockOrientation(t):screen.msLockOrientation&&screen.msLockOrientation(t)}catch(t){console&&console.warn&&console.warn("Failed to lock orientation: ",t)}}},r.prototype.onContextLost=function(){var t,e,i;for(this.glwrap.contextLost(),this.is_WebGL_context_lost=!0,t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onLostWebGLContext&&i.onLostWebGLContext()},r.prototype.onContextRestored=function(){var t,e,i;for(this.is_WebGL_context_lost=!1,t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onRestoreWebGLContext&&i.onRestoreWebGLContext()};var n=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame;r.prototype.setSuspended=function(t){var e,i;if(t&&!this.isSuspended)for(cr.logexport("[Construct 2] Suspending"),this.isSuspended=!0,-1!==this.raf_id&&n(this.raf_id),-1!==this.timeout_id&&clearTimeout(this.timeout_id),e=0,i=this.suspend_events.length;e<i;e++)this.suspend_events[e](!0);else if(!t&&this.isSuspended){for(cr.logexport("[Construct 2] Resuming"),this.isSuspended=!1,this.last_tick_time=cr.performance_now(),this.last_fps_time=cr.performance_now(),this.framecount=0,this.logictime=0,e=0,i=this.suspend_events.length;e<i;e++)this.suspend_events[e](!1);this.tick(!1)}},r.prototype.addSuspendCallback=function(t){this.suspend_events.push(t)},r.prototype.GetObjectReference=function(t){return this.objectRefTable[t]},r.prototype.loadProject=function(t){t&&t.project||cr.logerror("Project model unavailable");var e,r,n,s,o,a,h,c,l,u,p,d,f,g,y=t.project;if(this.name=y[0],this.first_layout=y[1],this.fullscreen_mode=y[12],this.fullscreen_mode_set=y[12],this.original_width=y[10],this.original_height=y[11],this.parallax_x_origin=this.original_width/2,this.parallax_y_origin=this.original_height/2,this.uses_loader_layout=y[18],this.loaderstyle=y[19],this.iconsFolder=y[28],this.webFontNames=y[29].map((function(t){return t[0]})),0===this.loaderstyle){var m=new Image;m.crossOrigin="anonymous",this.loaderlogos={logo:m};var _=this.loaderlogos;m.addEventListener("error",(function(){_.logo=null}));var v,b=y[39];v=this.isPreview?this.getProjectFileUrl(b):this.iconsFolder+b,this.setImageSrc(m,v)}else if(4===this.loaderstyle){var w=new Image;w.src="splash-images/splash-logo.svg";var x=new Image;x.src="splash-images/splash-poweredby-512.png";var S=new Image;S.src="splash-images/splash-poweredby-256.png";var T=new Image;T.src="splash-images/splash-poweredby-128.png";var C=new Image;C.src="splash-images/splash-website-512.png";var A=new Image;A.src="splash-images/splash-website-256.png";var O=new Image;O.src="splash-images/splash-website-128.png",this.loaderlogos={logo:w,powered:[x,S,T],website:[C,A,O]}}for(this.next_uid=y[21],this.objectRefTable=cr.getObjectRefTable(),this.system=new cr.system_object(this),e=0,r=y[2].length;e<r;e++)h=y[2][e],p=this.GetObjectReference(h[0]),cr.add_common_aces(h,p.prototype),(f=new p(this)).singleglobal=h[1],f.is_world=h[2],f.is_rotatable=h[5],f.must_predraw=h[9],f.onCreate&&f.onCreate(),cr.seal(f),this.plugins.push(f);for(this.objectRefTable=cr.getObjectRefTable(),e=0,r=y[3].length;e<r;e++){for(h=y[3][e],g=this.GetObjectReference(h[1]),f=null,n=0,s=this.plugins.length;n<s;n++)if(this.plugins[n]instanceof g){f=this.plugins[n];break}var E=new f.Type(f);for(E.name=h[0],E.is_family=h[2],E.instvar_sids=h[3].slice(0),E.vars_count=h[3].length,E.behs_count=h[4],E.fx_count=h[5],E.sid=h[11],E.is_family?(E.members=[],E.family_index=this.family_count++,E.families=null):(E.members=null,E.family_index=-1,E.families=[]),E.family_var_map=null,E.family_beh_map=null,E.family_fx_map=null,E.is_contained=!1,E.container=null,h[6]?(E.texture_file=h[6][0],E.texture_filesize=h[6][1],E.texture_pixelformat=h[6][2],E.texture_data=h[6]):(E.texture_file=null,E.texture_filesize=0,E.texture_pixelformat=0,E.texture_data=null),h[7]?E.animations=h[7]:E.animations=null,E.index=e,E.instances=[],E.deadCache=[],E.solstack=[new cr.selection(E)],E.cur_sol=0,E.default_instance=null,E.default_layerindex=0,E.stale_iids=!0,E.updateIIDs=cr.type_updateIIDs,E.getFirstPicked=cr.type_getFirstPicked,E.getPairedInstance=cr.type_getPairedInstance,E.getCurrentSol=cr.type_getCurrentSol,E.pushCleanSol=cr.type_pushCleanSol,E.pushCopySol=cr.type_pushCopySol,E.popSol=cr.type_popSol,E.getBehaviorByName=cr.type_getBehaviorByName,E.getBehaviorIndexByName=cr.type_getBehaviorIndexByName,E.getEffectIndexByName=cr.type_getEffectIndexByName,E.applySolToContainer=cr.type_applySolToContainer,E.getInstanceByIID=cr.type_getInstanceByIID,E.collision_grid=new cr.SparseGrid(this.original_width,this.original_height),E.any_cell_changed=!0,E.any_instance_parallaxed=!1,E.extra={},E.toString=cr.type_toString,E.behaviors=[],n=0,s=h[8].length;n<s;n++){c=h[8][n];var P=this.GetObjectReference(c[1]),I=null;for(o=0,a=this.behaviors.length;o<a;o++)if(this.behaviors[o]instanceof P){I=this.behaviors[o];break}I||((I=new P(this)).my_types=[],I.my_instances=new cr.ObjectSet,I.onCreate&&I.onCreate(),cr.seal(I),this.behaviors.push(I),cr.behaviors.solid&&I instanceof cr.behaviors.solid&&(this.solidBehavior=I),cr.behaviors.jumpthru&&I instanceof cr.behaviors.jumpthru&&(this.jumpthruBehavior=I),cr.behaviors.shadowcaster&&I instanceof cr.behaviors.shadowcaster&&(this.shadowcasterBehavior=I)),-1===I.my_types.indexOf(E)&&I.my_types.push(E);var k=new I.Type(I,E);k.name=c[0],k.sid=c[2],k.onCreate(),cr.seal(k),E.behaviors.push(k)}for(E.global=h[9],E.isOnLoaderLayout=h[10],E.effect_types=[],n=0,s=h[12].length;n<s;n++)E.effect_types.push({id:h[12][n][0],name:h[12][n][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:n});var R=h[13];if(E.tile_poly_data=R?R[0]:null,this.uses_loader_layout&&!E.is_family&&!E.isOnLoaderLayout&&f.is_world||(E.onCreate(),cr.seal(E)),E.name&&(this.types[E.name]=E,this.types_lowercase[E.name.toLowerCase()]=E),this.types_by_index.push(E),f.singleglobal){var L=new f.Instance(E);L.uid=this.next_uid++,L.puid=this.next_puid++,L.iid=0,L.get_iid=cr.inst_get_iid,L.toString=cr.inst_toString,L.properties=h[16],L.onCreate(),cr.seal(L),E.instances.push(L),this.objectsByUid[L.uid.toString()]=L}}for(e=0,r=y[4].length;e<r;e++){var B,M=y[4][e],N=this.types_by_index[M[0]];for(n=1,s=M.length;n<s;n++)(B=this.types_by_index[M[n]]).families.push(N),N.members.push(B)}for(e=0,r=y[27].length;e<r;e++){var F=y[27][e],D=[];for(n=0,s=F.length;n<s;n++)D.push(this.types_by_index[F[n]]);for(n=0,s=D.length;n<s;n++)D[n].is_contained=!0,D[n].container=D}if(this.family_count>0)for(e=0,r=this.types_by_index.length;e<r;e++)if(!(l=this.types_by_index[e]).is_family&&l.families.length){l.family_var_map=new Array(this.family_count),l.family_beh_map=new Array(this.family_count),l.family_fx_map=new Array(this.family_count);var j=[],V=0,U=0,G=0;for(n=0,s=l.families.length;n<s;n++)for(u=l.families[n],l.family_var_map[u.family_index]=V,V+=u.vars_count,l.family_beh_map[u.family_index]=U,U+=u.behs_count,l.family_fx_map[u.family_index]=G,G+=u.fx_count,o=0,a=u.effect_types.length;o<a;o++)j.push(cr.shallowCopy({},u.effect_types[o]));for(l.effect_types=j.concat(l.effect_types),n=0,s=l.effect_types.length;n<s;n++)l.effect_types[n].index=n}for(e=0,r=y[5].length;e<r;e++){h=y[5][e];var W=new cr.layout(this,h);cr.seal(W),this.layouts[W.name]=W,this.layouts_by_index.push(W)}for(e=0,r=y[6].length;e<r;e++){h=y[6][e];var z=new cr.eventsheet(this,h);cr.seal(z),this.eventsheets[z.name]=z,this.eventsheets_by_index.push(z)}for(e=0,r=this.eventsheets_by_index.length;e<r;e++)this.eventsheets_by_index[e].postInit();for(e=0,r=this.eventsheets_by_index.length;e<r;e++)this.eventsheets_by_index[e].updateDeepIncludes();for(e=0,r=this.triggers_to_postinit.length;e<r;e++)this.triggers_to_postinit[e].postInit();for(cr.clearArray(this.triggers_to_postinit),this.audio_files_info=y[7],this.audio_files_map={},e=0,r=this.audio_files_info.length;e<r;++e)d=this.audio_files_info[e],this.audio_files_map[d[0]]=d[1];this.files_subfolder=y[8],this.pixel_rounding=y[9],this.aspect_scale=1,this.enableWebGL=y[13],this.linearSampling=y[14],this.clearBackground=y[15],this.versionstr=y[16],this.useHighDpi=y[17],this.orientations=y[20],this.autoLockOrientation=this.orientations>0,this.pauseOnBlur=y[22],this.wantFullscreenScalingQuality=y[23],this.fullscreenScalingQuality=this.wantFullscreenScalingQuality,this.downscalingQuality=y[24],this.preloadSounds=y[25],this.enableFrontToBack=y[26]&&!this.isIE,this.enhancedAccelerationPrecision=y[30],this.start_time=Date.now(),cr.clearArray(this.objectRefTable),this.preloadSounds||i["audio/webm; codecs=opus"]||!window.OpusDecoder||window.OpusDecoder.Initialise(),this.initRendererAndLoader()};var s=!1;r.prototype.waitForImageLoad=function(t,e){window.cr_remotePreviewImageFiles&&e&&"blob:"!==e.substr(0,5)&&(e=window.cr_remotePreviewImageFiles[e]),t.onerror=function(e){t.c2error=!0,s=!0,console&&console.error&&console.error("Error loading image '"+t.src+"': ",e)},t.src||("undefined"!=typeof XAPKReader?XAPKReader.get(e,(function(e){t.src=e}),(function(i){t.c2error=!0,s=!0,console&&console.error&&console.error("Error extracting image '"+e+"' from expansion file: ",i)})):(t.crossOrigin="anonymous",this.setImageSrc(t,e))),this.wait_for_textures.push(t)},r.prototype.findWaitingTexture=function(t){var e,i;for(e=0,i=this.wait_for_textures.length;e<i;e++)if(this.wait_for_textures[e].cr_src===t)return this.wait_for_textures[e];return null};var o=0,a=!1;r.prototype.getready=function(){if(this.audioInstance&&this.preloadSounds){var t,e,i,r,n,s,a=[];for(t=0,e=this.audio_files_info.length;t<e;++t)r=(i=this.audio_files_info[t])[0],s=i[2],(n=this.getPreferredAudioFile(r))&&!s&&a.push({filename:r+n[1],size:n[2],type:n[0]});o=this.audioInstance.setPreloadList(a)}},r.prototype.areAllTexturesAndSoundsLoaded=function(){var t,e,i,r=o,n=0,s=0,h=!0;for(t=0,e=this.wait_for_textures.length;t<e;t++){var c=(i=this.wait_for_textures[t]).cr_filesize;(!c||c<=0)&&(c=5e4),r+=c,i.src&&i.complete&&!i.c2error?n+=c:h=!1}return h&&this.preloadSounds&&this.audioInstance&&(a||(this.audioInstance.startPreloads(),a=!0),n+=s=this.audioInstance.getPreloadedSize(),s<o&&(h=!1)),this.progress=0==r?1:n/r,h};var h=!1;r.prototype.go=function(){if(this.ctx||this.glwrap){var e=this.ctx||this.overlay_ctx;if(this.fullscreen_mode>0){var i=window.innerWidth,r=window.innerHeight;this.lastWindowWidth===i&&this.lastWindowHeight===r||this.setSize(i,r)}this.progress=0,this.last_progress=-1;var n=this;if(this.areAllTexturesAndSoundsLoaded()&&(4!==this.loaderstyle||h))this.useFbInstant?FBInstant.startGameAsync().then((function(){n.go_loading_finished()})):this.go_loading_finished();else{this.useFbInstant&&FBInstant.setLoadingProgress(100*this.progress);var o=Date.now()-this.start_time;if(e){var a=this.width,c=this.height,l=this.devicePixelRatio;if(this.loaderstyle<3&&o>=500&&this.last_progress!=this.progress){e.clearRect(0,0,a,c);var u,p=a/2,d=c/2,f=0===this.loaderstyle&&this.loaderlogos.logo&&this.loaderlogos.logo.complete,g=40*l,y=0,m=80*l;if(f){var _=this.loaderlogos.logo;g=(m=_.width*l)/2,y=(u=_.height*l)/2,e.drawImage(_,cr.floor(p-g),cr.floor(d-y),m,u)}if(this.loaderstyle<=1)d+=y+(f?12*l:0),p-=g,p=cr.floor(p)+.5,d=cr.floor(d)+.5,e.fillStyle=s?"red":"DodgerBlue",e.fillRect(p,d,Math.floor(m*this.progress),6*l),e.strokeStyle="black",e.strokeRect(p,d,m,6*l),e.strokeStyle="white",e.strokeRect(p-1*l,d-1*l,m+2*l,8*l);else if(2===this.loaderstyle){e.font="12pt Arial",e.fillStyle=s?"#f00":"#999",e.textBaseLine="middle";var v=Math.round(100*this.progress)+"%",b=e.measureText?e.measureText(v):null,w=b?b.width:0;e.fillText(v,p-w/2,d)}this.last_progress=this.progress}else if(4===this.loaderstyle)return this.draw_c3_splash_loader(e),void(t?t((function(){n.go()})):setTimeout((function(){n.go()}),16))}setTimeout((function(){n.go()}),100)}}};var c=-1,l=!0,u=!1,p=0,d=0,f=null,g=null,y=0;function m(t,e){return e<=128?t[2]:e<=256?t[1]:t[0]}r.prototype.draw_c3_splash_loader=function(t){if(!h){var e=this.isPreview||this.useFbInstant,i=e?0:200,r=e?0:3e3,n=Math.ceil(this.width),o=Math.ceil(this.height),a=(this.devicePixelRatio,this.loaderlogos.logo),_=this.loaderlogos.powered,v=this.loaderlogos.website;if(a.complete){for(var b=0;b<3;++b)if(!_[b].complete||!v[b].complete)return;0===y&&(c=Date.now());var w,x,S=Date.now(),T=!1,C=t;l||u?(t.clearRect(0,0,n,o),function(t,e){f&&f.width===t&&f.height===e||((f=document.createElement("canvas")).width=t,f.height=e,g=f.getContext("2d"))}(n,o),C=g,T=!0,l&&1===y&&(c=Date.now())):t.globalAlpha=1,C.fillStyle="#3B4045",C.fillRect(0,0,n,o);try{this.cssHeight>256?(x=(w=1.5*cr.clamp(.22*o,105,.6*n))/8,C.drawImage(m(_,w),.5*n-w/2,.2*o-x/2,w,x),x=w=Math.min(.395*o,.95*n),C.drawImage(a,.5*n-w/2,.485*o-x/2,w,x),x=(w=1.5*cr.clamp(.22*o,105,.6*n))/8,C.drawImage(m(v,w),.5*n-w/2,.868*o-x/2,w,x),C.fillStyle="#4D565D",w=n,x=Math.max(.005*o,2),C.fillRect(0,.8*o-x/2,w,x),C.fillStyle=s?"red":"#29F3D0",w=n*this.progress,C.fillRect(.5*n-w/2,.8*o-x/2,w,x)):(x=w=.55*o,C.drawImage(a,.5*n-w/2,.45*o-x/2,w,x),C.fillStyle="#4D565D",w=n,x=Math.max(.005*o,2),C.fillRect(0,.85*o-x/2,w,x),C.fillStyle=s?"red":"#29F3D0",w=n*this.progress,C.fillRect(.5*n-w/2,.85*o-x/2,w,x)),T&&(l?t.globalAlpha=0===y?0:Math.min((S-c)/300,1):u&&(t.globalAlpha=Math.max(1-(S-d)/300,0)),t.drawImage(f,0,0,n,o))}catch(t){}l&&S-c>=300&&y>=2&&(l=!1,p=S),!l&&S-p>=r&&!u&&this.progress>=1&&(u=!0,d=S),(u&&S-d>=300+i||e&&this.progress>=1&&Date.now()-c<500)&&(h=!0,l=!1,u=!1,f=null,g=null,this.loaderlogos=null),++y}}},r.prototype.go_loading_finished=function(){if(this.webFontNames.length&&document.fonts&&document.fonts.load){var t=this;Promise.all(this.webFontNames.map((function(t){return document.fonts.load("1em '"+t+"'")}))).then((function(){t.start_first_layout()}))}else this.start_first_layout()},r.prototype.start_first_layout=function(){var t,e,i;if(this.overlay_canvas&&(this.canvas.parentNode.removeChild(this.overlay_canvas),this.overlay_ctx=null,this.overlay_canvas=null),this.start_time=Date.now(),this.last_fps_time=cr.performance_now(),this.uses_loader_layout)for(t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).is_family||i.isOnLoaderLayout||!i.plugin.is_world||(i.onCreate(),cr.seal(i));else this.isloading=!1;for(t=0,e=this.layouts_by_index.length;t<e;t++)this.layouts_by_index[t].createGlobalNonWorlds();if(this.fullscreen_mode>=2){var r=this.original_width/this.original_height,n=this.width/this.height;2!==this.fullscreen_mode&&n>r||2===this.fullscreen_mode&&n<r?this.aspect_scale=this.height/this.original_height:this.aspect_scale=this.width/this.original_width}for(t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onBeforeAppBegin&&i.onBeforeAppBegin();for(this.first_layout?this.layouts[this.first_layout].startRunning():this.layouts_by_index[0].startRunning(),this.uses_loader_layout||(this.loadingprogress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C3_RegisterSW&&window.C3_RegisterSW()),navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide(),t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onAppBegin&&i.onAppBegin();var s=function(){document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):window.cr_setSuspended(!1)};document.addEventListener("visibilitychange",s,!1),document.addEventListener("mozvisibilitychange",s,!1),document.addEventListener("webkitvisibilitychange",s,!1),document.addEventListener("msvisibilitychange",s,!1),this.isCordova&&(document.addEventListener("pause",(function(){window.cr_setSuspended(!0)})),document.addEventListener("resume",(function(){window.cr_setSuspended(!1)}))),document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):this.tick(!1)},r.prototype.tick=function(e,i,r){if(this.running_layout){var n=cr.performance_now(),s=n;if(r||!this.isSuspended||e){e||(t?this.raf_id=t(this.tickFunc):this.timeout_id=setTimeout(this.tickFunc,this.isMobile?1:16));var o=i||n,a=this.fullscreen_mode,h=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova;if(h&&this.fullscreen_scaling>0&&(a=this.fullscreen_scaling),a>0){var c=window.innerWidth,l=window.innerHeight;this.lastWindowWidth===c&&this.lastWindowHeight===l||this.setSize(c,l)}if(h?this.firstInFullscreen||(this.firstInFullscreen=!0):this.firstInFullscreen?(this.firstInFullscreen=!1,0===this.fullscreen_mode&&this.setSize(Math.round(this.oldWidth/this.devicePixelRatio),Math.round(this.oldHeight/this.devicePixelRatio),!0)):(this.oldWidth=this.width,this.oldHeight=this.height),this.isloading){var u=this.areAllTexturesAndSoundsLoaded();this.loadingprogress=this.progress,u&&(this.isloading=!1,this.progress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C3_RegisterSW&&window.C3_RegisterSW())}this.logic(o),!this.redraw||this.is_WebGL_context_lost||this.suspendDrawing||e||(this.redraw=!1,this.glwrap?this.drawGL():this.draw(),this.snapshotCanvas&&(this.canvas&&this.canvas.toDataURL&&(this.snapshotData=this.canvas.toDataURL(this.snapshotCanvas[0],this.snapshotCanvas[1]),window.cr_onSnapshot&&window.cr_onSnapshot(this.snapshotData),this.trigger(cr.system_object.prototype.cnds.OnCanvasSnapshot,null)),this.snapshotCanvas=null)),this.hit_breakpoint||(this.tickcount++,this.tickcount_nosave++,this.execcount++,this.framecount++),this.logictime+=cr.performance_now()-s}}},r.prototype.logic=function(t){var e,i,r,n,s,o,a,h;if(t-this.last_fps_time>=1e3&&(this.last_fps_time+=1e3,t-this.last_fps_time>=1e3&&(this.last_fps_time=t),this.fps=this.framecount,this.framecount=0,this.cpuutilisation=Math.min(this.logictime,1e3),this.logictime=0,this.glwrap&&0===this.gpuTimeEndFrame&&(this.gpuTimeEndFrame=this.glwrap.getFrameNumber(),this.gpuCurUtilisation=-1)),this.glwrap&&-1===this.gpuCurUtilisation&&this.glwrap.supportsGpuProfiling()&&(this.gpuCurUtilisation=this.glwrap.getFrameRangeTimerResults(this.gpuTimeStartFrame,this.gpuTimeEndFrame),-1!==this.gpuCurUtilisation&&(this.glwrap.deleteTimerResultsToFrame(this.gpuTimeEndFrame),this.gpuLastUtilisation=Math.min(this.gpuCurUtilisation,1),this.gpuTimeStartFrame=this.gpuTimeEndFrame,this.gpuTimeEndFrame=0)),0!==this.last_tick_time){var c=t-this.last_tick_time;c<0&&(c=0),this.dt1=c/1e3,this.dt1>.5?this.dt1=0:this.dt1>1/this.minimumFramerate&&(this.dt1=1/this.minimumFramerate)}this.last_tick_time=t,this.dt=this.dt1*this.timescale,this.kahanTime.add(this.dt),this.wallTime.add(this.dt1);var l=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova;if(this.fullscreen_mode>=2||l&&this.fullscreen_scaling>0){var u=this.original_width/this.original_height,p=this.width/this.height,d=this.fullscreen_mode;l&&this.fullscreen_scaling>0&&(d=this.fullscreen_scaling),this.aspect_scale=2!==d&&p>u||2===d&&p<u?this.height/this.original_height:this.width/this.original_width,this.running_layout&&(this.running_layout.scrollToX(this.running_layout.scrollX),this.running_layout.scrollToY(this.running_layout.scrollY))}else this.aspect_scale=this.isRetina?this.devicePixelRatio:1;this.ClearDeathRow(),this.isInOnDestroy++,this.system.runWaits(),this.isInOnDestroy--,this.ClearDeathRow(),this.isInOnDestroy++;var f=this.objects_to_pretick.valuesRef();for(e=0,i=f.length;e<i;e++)f[e].pretick();for(e=0,i=this.types_by_index.length;e<i;e++)if(!(a=this.types_by_index[e]).is_family&&(a.behaviors.length||a.families.length))for(r=0,n=a.instances.length;r<n;r++)for(s=0,o=(g=a.instances[r]).behavior_insts.length;s<o;s++)g.behavior_insts[s].tick();for(e=0,i=this.types_by_index.length;e<i;e++)if(!(a=this.types_by_index[e]).is_family&&(a.behaviors.length||a.families.length))for(r=0,n=a.instances.length;r<n;r++)for(s=0,o=(g=a.instances[r]).behavior_insts.length;s<o;s++)(h=g.behavior_insts[s]).posttick&&h.posttick();for(e=0,i=(f=this.objects_to_tick.valuesRef()).length;e<i;e++)f[e].tick();for(this.isInOnDestroy--,this.handleSaveLoad(),e=0;this.changelayout&&e++<10;)this.doChangeLayout(this.changelayout);for(e=0,i=this.eventsheets_by_index.length;e<i;e++)this.eventsheets_by_index[e].hasRun=!1;for(this.running_layout.event_sheet&&this.running_layout.event_sheet.run(),cr.clearArray(this.registered_collisions),this.layout_first_tick=!1,this.isInOnDestroy++,e=0,i=this.types_by_index.length;e<i;e++)if(!(a=this.types_by_index[e]).is_family&&(a.behaviors.length||a.families.length))for(r=0,n=a.instances.length;r<n;r++){var g;for(s=0,o=(g=a.instances[r]).behavior_insts.length;s<o;s++)(h=g.behavior_insts[s]).tick2&&h.tick2()}for(e=0,i=(f=this.objects_to_tick2.valuesRef()).length;e<i;e++)f[e].tick2();this.isInOnDestroy--},r.prototype.onWindowBlur=function(){var t,e,i,r,n,s,o,a,h;for(t=0,e=this.types_by_index.length;t<e;t++)if(!(o=this.types_by_index[t]).is_family)for(i=0,r=o.instances.length;i<r;i++)if((a=o.instances[i]).onWindowBlur&&a.onWindowBlur(),a.behavior_insts)for(n=0,s=a.behavior_insts.length;n<s;n++)(h=a.behavior_insts[n]).onWindowBlur&&h.onWindowBlur()},r.prototype.doChangeLayout=function(t){var e,i,r,n=this.running_layout;if(this.running_layout.stopRunning(),this.glwrap)for(e=0,i=this.types_by_index.length;e<i;e++)(r=this.types_by_index[e]).is_family||!r.unloadTextures||r.global&&0!==r.instances.length||-1!==t.initial_types.indexOf(r)||r.unloadTextures();n==t&&cr.clearArray(this.system.waits),cr.clearArray(this.registered_collisions),this.runLayoutChangeMethods(!0),t.startRunning(),this.runLayoutChangeMethods(!1),this.redraw=!0,this.layout_first_tick=!0,this.ClearDeathRow()},r.prototype.runLayoutChangeMethods=function(t){var e,i,r,n,s,o,a,h,c,l;for(e=0,i=this.behaviors.length;e<i;e++)r=this.behaviors[e],t?r.onBeforeLayoutChange&&r.onBeforeLayoutChange():r.onLayoutChange&&r.onLayoutChange();for(e=0,i=this.types_by_index.length;e<i;e++)if((n=this.types_by_index[e]).global||n.plugin.singleglobal)for(s=0,o=n.instances.length;s<o;s++)if(a=n.instances[s],t?a.onBeforeLayoutChange&&a.onBeforeLayoutChange():a.onLayoutChange&&a.onLayoutChange(),a.behavior_insts)for(h=0,c=a.behavior_insts.length;h<c;h++)l=a.behavior_insts[h],t?l.onBeforeLayoutChange&&l.onBeforeLayoutChange():l.onLayoutChange&&l.onLayoutChange()},r.prototype.pretickMe=function(t){this.objects_to_pretick.add(t)},r.prototype.unpretickMe=function(t){this.objects_to_pretick.remove(t)},r.prototype.tickMe=function(t){this.objects_to_tick.add(t)},r.prototype.untickMe=function(t){this.objects_to_tick.remove(t)},r.prototype.tick2Me=function(t){this.objects_to_tick2.add(t)},r.prototype.untick2Me=function(t){this.objects_to_tick2.remove(t)},r.prototype.getDt=function(t){return t&&-1!==t.my_timescale?this.dt1*t.my_timescale:this.dt},r.prototype.draw=function(){this.running_layout.draw(this.ctx)},r.prototype.drawGL=function(){this.enableFrontToBack&&(this.earlyz_index=1,this.running_layout.drawGL_earlyZPass(this.glwrap)),this.running_layout.drawGL(this.glwrap),this.glwrap.present()},r.prototype.addDestroyCallback=function(t){t&&this.destroycallbacks.push(t)},r.prototype.removeDestroyCallback=function(t){cr.arrayFindRemove(this.destroycallbacks,t)},r.prototype.getObjectByUID=function(t){var e=t.toString();return this.objectsByUid.hasOwnProperty(e)?this.objectsByUid[e]:null};var _=[];r.prototype.DestroyInstance=function(t){var e,i,r=t.type.name,n=null;if(this.deathRow.hasOwnProperty(r)){if((n=this.deathRow[r]).contains(t))return}else n=_.length?_.pop():new cr.ObjectSet,this.deathRow[r]=n;if(t.isDestroyed=!0,n.add(t),this.hasPendingInstances=!0,t.is_contained)for(e=0,i=t.siblings.length;e<i;e++)this.DestroyInstance(t.siblings[e]);this.isInClearDeathRow&&n.values_cache.push(t),this.isEndingLayout||(this.isInOnDestroy++,this.trigger(Object.getPrototypeOf(t.type.plugin).cnds.OnDestroyed,t),this.isInOnDestroy--)},r.prototype.ClearDeathRow=function(){if(this.hasPendingInstances){var t,e,i,r,n,s;for(this.isInClearDeathRow=!0,i=0,n=this.createRow.length;i<n;++i)for((e=(t=this.createRow[i]).type).instances.push(t),r=0,s=e.families.length;r<s;++r)e.families[r].instances.push(t),e.families[r].stale_iids=!0;cr.clearArray(this.createRow),this.IterateDeathRow(),cr.wipe(this.deathRow),this.isInClearDeathRow=!1,this.hasPendingInstances=!1}},r.prototype.IterateDeathRow=function(){for(var t in this.deathRow)this.deathRow.hasOwnProperty(t)&&this.ClearDeathRowForType(this.deathRow[t])},r.prototype.ClearDeathRowForType=function(t){var e,i,r,n,s,o,a,h,c=t.valuesRef(),l=c[0].type;for(cr.arrayRemoveAllFromObjectSet(l.instances,t),l.stale_iids=!0,0===l.instances.length&&(l.any_instance_parallaxed=!1),e=0,i=l.families.length;e<i;++e)o=l.families[e],cr.arrayRemoveAllFromObjectSet(o.instances,t),o.stale_iids=!0;for(e=0,i=this.system.waits.length;e<i;++e)if((s=this.system.waits[e]).sols.hasOwnProperty(l.index)&&cr.arrayRemoveAllFromObjectSet(s.sols[l.index].insts,t),!l.is_family)for(r=0,n=l.families.length;r<n;++r)o=l.families[r],s.sols.hasOwnProperty(o.index)&&cr.arrayRemoveAllFromObjectSet(s.sols[o.index].insts,t);var u,p=c[0].layer;if(p){if(p.useRenderCells)for(e=0,i=(a=p.instances).length;e<i;++e)h=a[e],t.contains(h)&&(h.update_bbox(),p.render_grid.update(h,h.rendercells,null),h.rendercells.set(0,0,-1,-1));cr.arrayRemoveAllFromObjectSet(p.instances,t),p.setZIndicesStaleFrom(0)}for(e=0;e<c.length;++e)this.ClearDeathRowForSingleInstance(c[e],l);(u=t).clear(),_.push(u),this.redraw=!0},r.prototype.ClearDeathRowForSingleInstance=function(t,e){var i,r,n;for(i=0,r=this.destroycallbacks.length;i<r;++i)this.destroycallbacks[i](t);t.collcells&&e.collision_grid.update(t,t.collcells,null);var s=t.layer;if(s&&s.removeFromInstanceList(t,!0),t.behavior_insts)for(i=0,r=t.behavior_insts.length;i<r;++i)(n=t.behavior_insts[i]).onDestroy&&n.onDestroy(),n.behavior.my_instances.remove(t);this.objects_to_pretick.remove(t),this.objects_to_tick.remove(t),this.objects_to_tick2.remove(t),t.onDestroy&&t.onDestroy(),this.objectsByUid.hasOwnProperty(t.uid.toString())&&delete this.objectsByUid[t.uid.toString()],this.objectcount--,e.deadCache.length<100&&e.deadCache.push(t)},r.prototype.createInstance=function(t,e,i,r){if(t.is_family){var n=cr.floor(Math.random()*t.members.length);return this.createInstance(t.members[n],e,i,r)}return t.default_instance?this.createInstanceFromInit(t.default_instance,e,!1,i,r,!1):null};var v=[];r.prototype.createInstanceFromInit=function(t,e,i,r,n,s){var o,a,h,c,l;if(!t)return null;var u=this.types_by_index[t[1]],p=u.plugin.is_world;if(this.isloading&&p&&!u.isOnLoaderLayout)return null;if(p&&!this.glwrap&&11===t[0][11])return null;var d,f=e;for(p||(e=null),u.deadCache.length?((d=u.deadCache.pop()).recycled=!0,u.plugin.Instance.call(d,u)):(d=new u.plugin.Instance(u)).recycled=!1,!i||s||this.objectsByUid.hasOwnProperty(t[2].toString())?d.uid=this.next_uid++:d.uid=t[2],this.objectsByUid[d.uid.toString()]=d,d.puid=this.next_puid++,d.iid=u.instances.length,o=0,a=this.createRow.length;o<a;++o)this.createRow[o].type===u&&d.iid++;d.get_iid=cr.inst_get_iid,d.toString=cr.inst_toString,d.isDestroyed=!1;var g,y=t[3];if(d.recycled)cr.wipe(d.extra);else{if(d.extra={},this.isPreview)for(d.instance_var_names=[],d.instance_var_names.length=y.length,o=0,a=y.length;o<a;o++)d.instance_var_names[o]=y[o][1];d.instance_vars=[],d.instance_vars.length=y.length}for(o=0,a=y.length;o<a;o++)d.instance_vars[o]=y[o][0];if(p){var m=t[0];if(d.x=cr.is_undefined(r)?m[0]:r,d.y=cr.is_undefined(n)?m[1]:n,d.z=m[2],d.width=m[3],d.height=m[4],d.depth=m[5],d.angle=m[6],d.opacity=m[7],d.hotspotX=m[8],d.hotspotY=m[9],d.blend_mode=m[10],l=m[11],!this.glwrap&&u.effect_types.length&&(d.blend_mode=l),d.compositeOp=cr.effectToCompositeOp(d.blend_mode),this.gl&&cr.setGLBlend(d,d.blend_mode,this.gl),d.recycled){for(o=0,a=m[12].length;o<a;o++)for(h=0,c=m[12][o].length;h<c;h++)d.effect_params[o][h]=m[12][o][h],Array.isArray(d.effect_params[o][h])&&(d.effect_params[o][h]=d.effect_params[o][h].slice(0));d.bbox.set(0,0,0,0),d.collcells.set(0,0,-1,-1),d.rendercells.set(0,0,-1,-1),d.bquad.set_from_rect(d.bbox),cr.clearArray(d.bbox_changed_callbacks)}else{for(d.effect_params=m[12].slice(0),o=0,a=d.effect_params.length;o<a;o++)for(d.effect_params[o]=m[12][o].slice(0),h=0,c=d.effect_params[o].length;h<c;++h)Array.isArray(d.effect_params[o][h])&&(d.effect_params[o][h]=d.effect_params[o][h].slice(0));d.active_effect_types=[],d.active_effect_flags=[],d.active_effect_flags.length=u.effect_types.length,d.bbox=new cr.rect(0,0,0,0),d.collcells=new cr.rect(0,0,-1,-1),d.rendercells=new cr.rect(0,0,-1,-1),d.bquad=new cr.quad,d.bbox_changed_callbacks=[],d.set_bbox_changed=cr.set_bbox_changed,d.add_bbox_changed_callback=cr.add_bbox_changed_callback,d.contains_pt=cr.inst_contains_pt,d.update_bbox=cr.update_bbox,d.update_render_cell=cr.update_render_cell,d.update_collision_cell=cr.update_collision_cell,d.get_zindex=cr.inst_get_zindex}for(d.tilemap_exists=!1,d.tilemap_width=0,d.tilemap_height=0,d.tilemap_data=null,m[13]&&(d.tilemap_exists=!0,d.tilemap_width=m[13][0],d.tilemap_height=m[13][1],d.tilemap_data=m[13][2]),o=0,a=u.effect_types.length;o<a;o++)d.active_effect_flags[o]=!0;d.shaders_preserve_opaqueness=!0,d.updateActiveEffects=cr.inst_updateActiveEffects,d.updateActiveEffects(),d.uses_shaders=!!d.active_effect_types.length,d.bbox_changed=!0,d.cell_changed=!0,u.any_cell_changed=!0,d.visible=!0,d.my_timescale=-1,d.layer=e,d.zindex=e.instances.length,d.earlyz_index=0,void 0===d.collision_poly&&(d.collision_poly=null),d.collisionsEnabled=!0,this.redraw=!0}for(cr.clearArray(v),o=0,a=u.families.length;o<a;o++)v.push.apply(v,u.families[o].behaviors);if(v.push.apply(v,u.behaviors),d.recycled)for(o=0,a=v.length;o<a;o++){var _=v[o];for((b=d.behavior_insts[o]).recycled=!0,_.behavior.Instance.call(b,_,d),h=0,c=(g=t[4][o]).length;h<c;h++)b.properties[h]=g[h];b.onCreate(),_.behavior.my_instances.add(d)}else for(d.behavior_insts=[],o=0,a=v.length;o<a;o++){var b;(b=new(_=v[o]).behavior.Instance(_,d)).recycled=!1,b.properties=t[4][o].slice(0),b.onCreate(),cr.seal(b),d.behavior_insts.push(b),_.behavior.my_instances.add(d)}if(g=t[5],d.recycled)for(o=0,a=g.length;o<a;o++)d.properties[o]=g[o];else d.properties=g.slice(0);if(this.createRow.push(d),this.hasPendingInstances=!0,e&&(e.appendToInstanceList(d,!0),1===e.parallaxX&&1===e.parallaxY||(u.any_instance_parallaxed=!0)),this.objectcount++,u.is_contained){if(d.is_contained=!0,d.recycled?cr.clearArray(d.siblings):d.siblings=[],!i&&!s){for(o=0,a=u.container.length;o<a;o++)if(u.container[o]!==u){if(!u.container[o].default_instance)return null;d.siblings.push(this.createInstanceFromInit(u.container[o].default_instance,f,!1,p?d.x:r,p?d.y:n,!0))}for(o=0,a=d.siblings.length;o<a;o++)for(d.siblings[o].siblings.push(d),h=0;h<a;h++)o!==h&&d.siblings[o].siblings.push(d.siblings[h])}}else d.is_contained=!1,d.siblings=null;for(d.onCreate(),d.recycled||cr.seal(d),o=0,a=d.behavior_insts.length;o<a;o++)d.behavior_insts[o].postCreate&&d.behavior_insts[o].postCreate();return d},r.prototype.getLayerByName=function(t){var e,i;for(e=0,i=this.running_layout.layers.length;e<i;e++){var r=this.running_layout.layers[e];if(cr.equals_nocase(r.name,t))return r}return null},r.prototype.getLayerByNumber=function(t){return(t=cr.floor(t))<0&&(t=0),t>=this.running_layout.layers.length&&(t=this.running_layout.layers.length-1),this.running_layout.layers[t]},r.prototype.getLayer=function(t){return cr.is_number(t)?this.getLayerByNumber(t):this.getLayerByName(t.toString())},r.prototype.clearSol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].getCurrentSol().select_all=!0},r.prototype.pushCleanSol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].pushCleanSol()},r.prototype.pushCopySol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].pushCopySol()},r.prototype.popSol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].popSol()},r.prototype.updateAllCells=function(t){if(t.any_cell_changed){var e,i,r=t.instances;for(e=0,i=r.length;e<i;++e)r[e].update_collision_cell();var n=this.createRow;for(e=0,i=n.length;e<i;++e)n[e].type===t&&n[e].update_collision_cell();t.any_cell_changed=!1}},r.prototype.getCollisionCandidates=function(t,e,i,r){var n,s,o,a=!!t&&(1!==t.parallaxX||1!==t.parallaxY);if(e.is_family)for(n=0,s=e.members.length;n<s;++n)o=e.members[n],a||o.any_instance_parallaxed?cr.appendArray(r,o.instances):(this.updateAllCells(o),o.collision_grid.queryRange(i,r));else a||e.any_instance_parallaxed?cr.appendArray(r,e.instances):(this.updateAllCells(e),e.collision_grid.queryRange(i,r))},r.prototype.getTypesCollisionCandidates=function(t,e,i,r){var n,s;for(n=0,s=e.length;n<s;++n)this.getCollisionCandidates(t,e[n],i,r)},r.prototype.getSolidCollisionCandidates=function(t,e,i){var r=this.getSolidBehavior();if(!r)return null;this.getTypesCollisionCandidates(t,r.my_types,e,i)},r.prototype.getJumpthruCollisionCandidates=function(t,e,i){var r=this.getJumpthruBehavior();if(!r)return null;this.getTypesCollisionCandidates(t,r.my_types,e,i)},r.prototype.testAndSelectCanvasPointOverlap=function(t,e,i,r){var n,s,o,a,h,c,l,u=t.getCurrentSol(),p=this.getCurrentEventStack().current_event.orblock;if(u.select_all)for(r||(u.select_all=!1,cr.clearArray(u.instances)),n=0,a=t.instances.length;n<a;n++)if((o=t.instances[n]).update_bbox(),h=o.layer.canvasToLayer(e,i,!0),c=o.layer.canvasToLayer(e,i,!1),o.contains_pt(h,c)){if(r)return!1;u.instances.push(o)}else p&&u.else_instances.push(o);else{for(s=0,n=0,a=(l=p?u.else_instances:u.instances).length;n<a;n++)if((o=l[n]).update_bbox(),h=o.layer.canvasToLayer(e,i,!0),c=o.layer.canvasToLayer(e,i,!1),o.contains_pt(h,c)){if(r)return!1;p?u.instances.push(o):(u.instances[s]=u.instances[n],s++)}r||(l.length=s)}return t.applySolToContainer(),!!r||u.hasObjects()},r.prototype.testOverlap=function(t,e){if(!(t&&e&&t!==e&&t.collisionsEnabled&&e.collisionsEnabled))return!1;t.update_bbox(),e.update_bbox();var i,r,n,s,o,a,h,c,l,u,p=t.layer,d=e.layer;if(p!==d&&(p.parallaxX!==d.parallaxX||d.parallaxY!=d.parallaxY||p.scale!==d.scale||p.angle!==d.angle||p.zoomRate!==d.zoomRate)){for(h=t.collision_poly&&!t.collision_poly.is_empty(),c=e.collision_poly&&!e.collision_poly.is_empty(),h?(t.collision_poly.cache_poly(t.width,t.height,t.angle),this.temp_poly.set_from_poly(t.collision_poly)):this.temp_poly.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),l=this.temp_poly,c?(e.collision_poly.cache_poly(e.width,e.height,e.angle),this.temp_poly2.set_from_poly(e.collision_poly)):this.temp_poly2.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),u=this.temp_poly2,i=0,r=l.pts_count;i<r;i++)s=(n=2*i)+1,o=l.pts_cache[n],a=l.pts_cache[s],l.pts_cache[n]=p.layerToCanvas(o+t.x,a+t.y,!0),l.pts_cache[s]=p.layerToCanvas(o+t.x,a+t.y,!1);for(l.update_bbox(),i=0,r=u.pts_count;i<r;i++)s=(n=2*i)+1,o=u.pts_cache[n],a=u.pts_cache[s],u.pts_cache[n]=d.layerToCanvas(o+e.x,a+e.y,!0),u.pts_cache[s]=d.layerToCanvas(o+e.x,a+e.y,!1);return u.update_bbox(),l.intersects_poly(u,0,0)}return!!t.bbox.intersects_rect(e.bbox)&&(!!t.bquad.intersects_quad(e.bquad)&&((!t.tilemap_exists||!e.tilemap_exists)&&(t.tilemap_exists?this.testTilemapOverlap(t,e):e.tilemap_exists?this.testTilemapOverlap(e,t):(h=t.collision_poly&&!t.collision_poly.is_empty(),c=e.collision_poly&&!e.collision_poly.is_empty(),!h&&!c||(h?(t.collision_poly.cache_poly(t.width,t.height,t.angle),l=t.collision_poly):(this.temp_poly.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),l=this.temp_poly),c?(e.collision_poly.cache_poly(e.width,e.height,e.angle),u=e.collision_poly):(this.temp_poly.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),u=this.temp_poly),l.intersects_poly(u,e.x-t.x,e.y-t.y))))))};var b=new cr.quad,w=new cr.rect(0,0,0,0),x=[];r.prototype.testTilemapOverlap=function(t,e){var i,r,n,s,o=e.bbox,a=t.x,h=t.y;t.getCollisionRectCandidates(o,x);var c=x,l=e.collision_poly&&!e.collision_poly.is_empty();for(i=0,r=c.length;i<r;++i)if(s=(n=c[i]).rc,o.intersects_rect_off(s,a,h)&&(b.set_from_rect(s),b.offset(a,h),b.intersects_quad(e.bquad)))if(l){if(e.collision_poly.cache_poly(e.width,e.height,e.angle),n.poly){if(n.poly.intersects_poly(e.collision_poly,e.x-(a+s.left),e.y-(h+s.top)))return cr.clearArray(x),!0}else if(this.temp_poly.set_from_quad(b,0,0,s.right-s.left,s.bottom-s.top),this.temp_poly.intersects_poly(e.collision_poly,e.x,e.y))return cr.clearArray(x),!0}else{if(!n.poly)return cr.clearArray(x),!0;if(this.temp_poly.set_from_quad(e.bquad,0,0,e.width,e.height),n.poly.intersects_poly(this.temp_poly,-(a+s.left),-(h+s.top)))return cr.clearArray(x),!0}return cr.clearArray(x),!1},r.prototype.testRectOverlap=function(t,e){if(!e||!e.collisionsEnabled)return!1;e.update_bbox();e.layer;if(!e.bbox.intersects_rect(t))return!1;if(e.tilemap_exists){e.getCollisionRectCandidates(t,x);var i,r,n,s,o=x,a=e.x,h=e.y;for(i=0,r=o.length;i<r;++i)if(s=(n=o[i]).rc,t.intersects_rect_off(s,a,h)){if(!n.poly)return cr.clearArray(x),!0;if(this.temp_poly.set_from_rect(t,0,0),n.poly.intersects_poly(this.temp_poly,-(a+s.left),-(h+s.top)))return cr.clearArray(x),!0}return cr.clearArray(x),!1}return b.set_from_rect(t),!!e.bquad.intersects_quad(b)&&(!(e.collision_poly&&!e.collision_poly.is_empty())||(e.collision_poly.cache_poly(e.width,e.height,e.angle),b.offset(-t.left,-t.top),this.temp_poly.set_from_quad(b,0,0,1,1),e.collision_poly.intersects_poly(this.temp_poly,t.left-e.x,t.top-e.y)))},r.prototype.testSegmentOverlap=function(t,e,i,r,n){if(!n||!n.collisionsEnabled)return!1;n.update_bbox();n.layer;if(w.set(cr.min(t,i),cr.min(e,r),cr.max(t,i),cr.max(e,r)),!n.bbox.intersects_rect(w))return!1;if(n.tilemap_exists){n.getCollisionRectCandidates(w,x);var s,o,a,h,c=x,l=n.x,u=n.y;for(s=0,o=c.length;s<o;++s)if(h=(a=c[s]).rc,w.intersects_rect_off(h,l,u)&&(b.set_from_rect(h),b.offset(l,u),b.intersects_segment(t,e,i,r))){if(!a.poly)return cr.clearArray(x),!0;if(a.poly.intersects_segment(l+h.left,u+h.top,t,e,i,r))return cr.clearArray(x),!0}return cr.clearArray(x),!1}return!!n.bquad.intersects_segment(t,e,i,r)&&(!(n.collision_poly&&!n.collision_poly.is_empty())||(n.collision_poly.cache_poly(n.width,n.height,n.angle),n.collision_poly.intersects_segment(n.x,n.y,t,e,i,r)))},r.prototype.typeHasBehavior=function(t,e){if(!e)return!1;var i,r,n,s,o;for(i=0,r=t.behaviors.length;i<r;i++)if(t.behaviors[i].behavior instanceof e)return!0;if(!t.is_family)for(i=0,r=t.families.length;i<r;i++)for(n=0,s=(o=t.families[i]).behaviors.length;n<s;n++)if(o.behaviors[n].behavior instanceof e)return!0;return!1},r.prototype.typeHasNoSaveBehavior=function(t){return this.typeHasBehavior(t,cr.behaviors.NoSave)},r.prototype.typeHasPersistBehavior=function(t){return this.typeHasBehavior(t,cr.behaviors.Persist)},r.prototype.getSolidBehavior=function(){return this.solidBehavior},r.prototype.getJumpthruBehavior=function(){return this.jumpthruBehavior};var S=[];r.prototype.testOverlapSolid=function(t){var e,i,r;for(t.update_bbox(),this.getSolidCollisionCandidates(t.layer,t.bbox,S),e=0,i=S.length;e<i;++e)if((r=S[e]).extra.solidEnabled&&this.testOverlap(t,r))return cr.clearArray(S),r;return cr.clearArray(S),null},r.prototype.testRectOverlapSolid=function(t){var e,i,r;for(this.getSolidCollisionCandidates(null,t,S),e=0,i=S.length;e<i;++e)if((r=S[e]).extra.solidEnabled&&this.testRectOverlap(t,r))return cr.clearArray(S),r;return cr.clearArray(S),null};var T=[];r.prototype.testOverlapJumpThru=function(t,e){var i,r,n,s=null;for(e&&(s=T,cr.clearArray(s)),t.update_bbox(),this.getJumpthruCollisionCandidates(t.layer,t.bbox,S),i=0,r=S.length;i<r;++i)if((n=S[i]).extra.jumpthruEnabled&&this.testOverlap(t,n)){if(!e)return cr.clearArray(S),n;s.push(n)}return cr.clearArray(S),s},r.prototype.pushOutSolid=function(t,e,i,r,n,s){var o,a=r||50,h=t.x,c=t.y,l=null,u=null;for(o=0;o<a;o++)if(t.x=h+e*o,t.y=c+i*o,t.set_bbox_changed(),!this.testOverlap(t,l)&&((l=this.testOverlapSolid(t))&&(u=l),!l&&(n&&(l=s?this.testOverlap(t,s)?s:null:this.testOverlapJumpThru(t))&&(u=l),!l)))return u&&this.pushInFractional(t,e,i,u,16),!0;return t.x=h,t.y=c,t.set_bbox_changed(),!1},r.prototype.pushOutSolidAxis=function(t,e,i,r){r=r||50;var n,s,o,a=t.x,h=t.y,c=null,l=null;for(n=0;n<r;++n)for(s=0;s<2;++s)if(o=2*s-1,t.x=a+e*n*o,t.y=h+i*n*o,t.set_bbox_changed(),!this.testOverlap(t,c)){if(!(c=this.testOverlapSolid(t)))return l&&this.pushInFractional(t,e*o,i*o,l,16),!0;l=c}return t.x=a,t.y=h,t.set_bbox_changed(),!1},r.prototype.pushOut=function(t,e,i,r,n){var s,o=r||50,a=t.x,h=t.y;for(s=0;s<o;s++)if(t.x=a+e*s,t.y=h+i*s,t.set_bbox_changed(),!this.testOverlap(t,n))return!0;return t.x=a,t.y=h,t.set_bbox_changed(),!1},r.prototype.pushInFractional=function(t,e,i,r,n){for(var s,o=2,a=!1,h=!1,c=t.x,l=t.y;o<=n;)s=1/o,o*=2,t.x+=e*s*(a?1:-1),t.y+=i*s*(a?1:-1),t.set_bbox_changed(),this.testOverlap(t,r)?(a=!0,h=!0):(a=!1,h=!1,c=t.x,l=t.y);h&&(t.x=c,t.y=l,t.set_bbox_changed())},r.prototype.pushOutSolidNearest=function(t,e){var i=cr.is_undefined(e)?100:e,r=0,n=t.x,s=t.y,o=0,a=0,h=0,c=this.testOverlapSolid(t);if(!c)return!0;for(;r<=i;){switch(o){case 0:a=0,h=-1,r++;break;case 1:a=1,h=-1;break;case 2:a=1,h=0;break;case 3:a=1,h=1;break;case 4:a=0,h=1;break;case 5:a=-1,h=1;break;case 6:a=-1,h=0;break;case 7:a=-1,h=-1}if(o=(o+1)%8,t.x=cr.floor(n+a*r),t.y=cr.floor(s+h*r),t.set_bbox_changed(),!this.testOverlap(t,c)&&!(c=this.testOverlapSolid(t)))return!0}return t.x=n,t.y=s,t.set_bbox_changed(),!1},r.prototype.registerCollision=function(t,e){t.collisionsEnabled&&e.collisionsEnabled&&this.registered_collisions.push([t,e])},r.prototype.addRegisteredCollisionCandidates=function(t,e,i){var r,n,s,o;for(r=0,n=this.registered_collisions.length;r<n;++r){if(o=null,(s=this.registered_collisions[r])[0]===t)o=s[1];else{if(s[1]!==t)continue;o=s[0]}if(e.is_family){if(-1===e.members.indexOf(e))continue}else if(o.type!==e)continue;-1===i.indexOf(o)&&i.push(o)}},r.prototype.checkRegisteredCollision=function(t,e){var i,r,n;for(i=0,r=this.registered_collisions.length;i<r;i++)if((n=this.registered_collisions[i])[0]===t&&n[1]===e||n[0]===e&&n[1]===t)return!0;return!1},r.prototype.calculateSolidBounceAngle=function(t,e,i,r){var n=t.x,s=t.y,o=cr.max(10,cr.distanceTo(e,i,n,s)),a=cr.angleTo(e,i,n,s),h=r||this.testOverlapSolid(t);if(!h)return cr.clamp_angle(a+cr.PI);var c,l,u,p,d=h,f=cr.to_radians(5);for(c=1;c<36;c++)if(l=a-c*f,t.x=e+Math.cos(l)*o,t.y=i+Math.sin(l)*o,t.set_bbox_changed(),!this.testOverlap(t,d)&&!(d=r?null:this.testOverlapSolid(t))){u=l;break}36===c&&(u=cr.clamp_angle(a+cr.PI));d=h;for(c=1;c<36;c++)if(l=a+c*f,t.x=e+Math.cos(l)*o,t.y=i+Math.sin(l)*o,t.set_bbox_changed(),!this.testOverlap(t,d)&&!(d=r?null:this.testOverlapSolid(t))){p=l;break}if(36===c&&(p=cr.clamp_angle(a+cr.PI)),t.x=n,t.y=s,t.set_bbox_changed(),p===u)return p;var g,y=cr.angleDiff(p,u)/2;g=cr.angleClockwise(p,u)?cr.clamp_angle(u+y+cr.PI):cr.clamp_angle(p+y);var m=Math.cos(a),_=Math.sin(a),v=Math.cos(g),b=Math.sin(g),w=m*v+_*b,x=m-2*w*v,S=_-2*w*b;return cr.angleTo(0,0,x,S)};var C=-1;function A(){var t=window.cordova&&window.cordova.plugins&&window.cordova.plugins.permissions;return"object"!=typeof t&&Promise.reject("Permission API is not loaded"),Promise.resolve(t)}function O(){try{return!!window.indexedDB}catch(t){return!1}}function E(t){t.target.result.createObjectStore("saves",{keyPath:"slot"})}function P(){cr.logexport("Reloading for continuous preview"),window.location.search.indexOf("continuous")>-1?window.location.reload(!0):window.location=window.location+"?continuous"}function I(t){var e,i={};for(e in t)if(t.hasOwnProperty(e)){if(t[e]instanceof cr.ObjectSet)continue;if(t[e]&&void 0!==t[e].c2userdata)continue;if("spriteCreatedDestroyCallback"===e)continue;i[e]=t[e]}return i}r.prototype.trigger=function(t,e,i){if(!this.running_layout)return!1;var r=this.running_layout.event_sheet;if(!r)return!1;var n,s,o,a=!1;C++;var h=r.deep_includes;for(s=0,o=h.length;s<o;++s)n=this.triggerOnSheet(t,e,h[s],i),a=a||n;return n=this.triggerOnSheet(t,e,r,i),C--,a=a||n},r.prototype.triggerOnSheet=function(t,e,i,r){var n,s,o,a,h=!1;if(e)for(o=this.triggerOnSheetForTypeName(t,e,e.type.name,i,r),h=h||o,n=0,s=(a=e.type.families).length;n<s;++n)o=this.triggerOnSheetForTypeName(t,e,a[n].name,i,r),h=h||o;else o=this.triggerOnSheetForTypeName(t,e,"system",i,r),h=h||o;return h},r.prototype.triggerOnSheetForTypeName=function(t,e,i,r,n){var s,o,a,h,c=!1,l=!1,u=void 0!==n,p=(u?r.fasttriggers:r.triggers)[i];if(!p)return c;var d,f=null;for(s=0,o=p.length;s<o;++s)if(p[s].method==t){f=p[s].evs;break}if(!f)return c;if(!(d=u?f[n]:f))return null;for(s=0,o=d.length;s<o;s++)a=d[s][0],h=d[s][1],l=this.executeSingleTrigger(e,i,a,h),c=c||l;return c},r.prototype.executeSingleTrigger=function(t,e,i,r){var n,s,o=!1;this.trigger_depth++;var a=this.getCurrentEventStack().current_event;a&&this.pushCleanSol(a.solModifiersIncludingParents);var h=this.trigger_depth>1;this.pushCleanSol(i.solModifiersIncludingParents),h&&this.pushLocalVarStack();var c=this.pushEventStack(i);if(c.current_event=i,t){var l=this.types[e].getCurrentSol();l.select_all=!1,cr.clearArray(l.instances),l.instances[0]=t,this.types[e].applySolToContainer()}var u=!0;if(i.parent){for(var p=c.temp_parents_arr,d=i.parent;d;)p.push(d),d=d.parent;for(p.reverse(),n=0,s=p.length;n<s;n++)if(!p[n].run_pretrigger()){u=!1;break}}return u&&(this.execcount++,i.orblock?i.run_orblocktrigger(r):i.run(),o=o||c.last_event_true),this.popEventStack(),h&&this.popLocalVarStack(),this.popSol(i.solModifiersIncludingParents),a&&this.popSol(a.solModifiersIncludingParents),this.hasPendingInstances&&0===this.isInOnDestroy&&0===C&&!this.isRunningEvents&&this.ClearDeathRow(),this.trigger_depth--,o},r.prototype.getCurrentCondition=function(){var t=this.getCurrentEventStack();return t.current_event.conditions[t.cndindex]},r.prototype.getCurrentConditionObjectType=function(){return this.getCurrentCondition().type},r.prototype.isCurrentConditionFirst=function(){return 0===this.getCurrentEventStack().cndindex},r.prototype.getCurrentAction=function(){var t=this.getCurrentEventStack();return t.current_event.actions[t.actindex]},r.prototype.pushLocalVarStack=function(){this.localvar_stack_index++,this.localvar_stack_index>=this.localvar_stack.length&&this.localvar_stack.push([])},r.prototype.popLocalVarStack=function(){this.localvar_stack_index--},r.prototype.getCurrentLocalVarStack=function(){return this.localvar_stack[this.localvar_stack_index]},r.prototype.pushEventStack=function(t){this.event_stack_index++,this.event_stack_index>=this.event_stack.length&&this.event_stack.push(new cr.eventStackFrame);var e=this.getCurrentEventStack();return e.reset(t),e},r.prototype.popEventStack=function(){this.event_stack_index--},r.prototype.getCurrentEventStack=function(){return this.event_stack[this.event_stack_index]},r.prototype.pushLoopStack=function(t){this.loop_stack_index++,this.loop_stack_index>=this.loop_stack.length&&this.loop_stack.push(cr.seal({name:t,index:0,stopped:!1}));var e=this.getCurrentLoop();return e.name=t,e.index=0,e.stopped=!1,e},r.prototype.popLoopStack=function(){this.loop_stack_index--},r.prototype.getCurrentLoop=function(){return this.loop_stack[this.loop_stack_index]},r.prototype.getEventVariableByName=function(t,e){for(var i,r,n,s,o,a;e;){for(i=0,r=e.subevents.length;i<r;i++)if((a=e.subevents[i])instanceof cr.eventvariable&&cr.equals_nocase(t,a.name))return a;e=e.parent}for(i=0,r=this.eventsheets_by_index.length;i<r;i++)for(n=0,s=(o=this.eventsheets_by_index[i]).events.length;n<s;n++)if((a=o.events[n])instanceof cr.eventvariable&&cr.equals_nocase(t,a.name))return a;return null},r.prototype.getLayoutBySid=function(t){var e,i;for(e=0,i=this.layouts_by_index.length;e<i;e++)if(this.layouts_by_index[e].sid===t)return this.layouts_by_index[e];return null},r.prototype.getObjectTypeBySid=function(t){var e,i;for(e=0,i=this.types_by_index.length;e<i;e++)if(this.types_by_index[e].sid===t)return this.types_by_index[e];return null},r.prototype.getGroupBySid=function(t){var e,i;for(e=0,i=this.allGroups.length;e<i;e++)if(this.allGroups[e].sid===t)return this.allGroups[e];return null},r.prototype.requirePermissions=function(t){return this.getPermissions(t).then((function(t){if(!1===t)return Promise.reject("Permission not granted")}))},r.prototype.getPermissions=function(t){return this.isCordova&&this.isAndroid?t.reduce((function(t,e){return t.then((function(t){return!1!==t&&function(t){return A().then((function(e){return new Promise((function(i,r){e.checkPermission(e[t],(function(t){i(t.hasPermission)}),r)}))}))}(e).then((function(t){return!!t||function(t){return A().then((function(e){return new Promise((function(i,r){e.requestPermission(e[t],(function(t){i(t.hasPermission)}),r)}))}))}(e)}))}))}),Promise.resolve(!0)):Promise.resolve(!0)},r.prototype.doCanvasSnapshot=function(t,e){this.snapshotCanvas=[t,e],this.redraw=!0},r.prototype.signalContinuousPreview=function(){this.signalledContinuousPreview=!0},r.prototype.handleSaveLoad=function(){var t=this,e=this.saveToSlot,i=this.lastSaveJson,r=this.loadFromSlot,n=!1;if(this.signalledContinuousPreview&&(n=!0,e="__c2_continuouspreview",this.signalledContinuousPreview=!1),e.length){if(this.ClearDeathRow(),i=this.saveToJSONString(),O())!function(t,e,i,r){try{var n=indexedDB.open("_C2SaveStates");n.onupgradeneeded=E,n.onerror=r,n.onsuccess=function(n){var s=n.target.result;s.onerror=r,s.transaction(["saves"],"readwrite").objectStore("saves").put({slot:t,data:e}).onsuccess=i}}catch(t){r(t)}}(e,i,(function(){cr.logexport("Saved state to IndexedDB storage ("+i.length+" bytes)"),t.lastSaveJson=i,t.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),t.lastSaveJson="",i="",n&&P()}),(function(r){try{localStorage.setItem("__c2save_"+e,i),cr.logexport("Saved state to WebStorage ("+i.length+" bytes)"),t.lastSaveJson=i,t.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),t.lastSaveJson="",i="",n&&P()}catch(e){cr.logexport("Failed to save game state: "+r+"; "+e),t.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}}));else try{localStorage.setItem("__c2save_"+e,i),cr.logexport("Saved state to WebStorage ("+i.length+" bytes)"),t.lastSaveJson=i,this.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),t.lastSaveJson="",i="",n&&P()}catch(e){cr.logexport("Error saving to WebStorage: "+e),t.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null}if(r.length){if(O())!function(t,e,i){try{var r=indexedDB.open("_C2SaveStates");r.onupgradeneeded=E,r.onerror=i,r.onsuccess=function(r){var n=r.target.result;n.onerror=i;var s=n.transaction(["saves"]).objectStore("saves").get(t);s.onsuccess=function(t){s.result?e(s.result.data):e(null)}}}catch(t){i(t)}}(r,(function(e){e?(t.loadFromJson=e,cr.logexport("Loaded state from IndexedDB storage ("+t.loadFromJson.length+" bytes)")):(t.loadFromJson=localStorage.getItem("__c2save_"+r)||"",cr.logexport("Loaded state from WebStorage ("+t.loadFromJson.length+" bytes)")),t.suspendDrawing=!1,t.loadFromJson||(t.loadFromJson=null,t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}),(function(e){t.loadFromJson=localStorage.getItem("__c2save_"+r)||"",cr.logexport("Loaded state from WebStorage ("+t.loadFromJson.length+" bytes)"),t.suspendDrawing=!1,t.loadFromJson||(t.loadFromJson=null,t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}));else{try{this.loadFromJson=localStorage.getItem("__c2save_"+r)||"",cr.logexport("Loaded state from WebStorage ("+this.loadFromJson.length+" bytes)")}catch(t){this.loadFromJson=null}this.suspendDrawing=!1,t.loadFromJson||(t.loadFromJson=null,t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}this.loadFromSlot="",this.saveToSlot=""}null!==this.loadFromJson&&(this.ClearDeathRow(),this.loadFromJSONString(this.loadFromJson)?(this.lastSaveJson=this.loadFromJson,this.trigger(cr.system_object.prototype.cnds.OnLoadComplete,null),this.lastSaveJson=""):t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null),this.loadFromJson=null)},r.prototype.saveToJSONString=function(){var t,e,i,r,n,s,o,a,h,c,l,u,p={c2save:!0,version:1,rt:{time:this.kahanTime.sum,walltime:this.wallTime.sum,timescale:this.timescale,tickcount:this.tickcount,execcount:this.execcount,next_uid:this.next_uid,running_layout:this.running_layout.sid,start_time_offset:Date.now()-this.start_time},types:{},layouts:{},events:{groups:{},cnds:{},acts:{},vars:{}}};for(t=0,e=this.types_by_index.length;t<e;t++)if(!(n=this.types_by_index[t]).is_family&&!this.typeHasNoSaveBehavior(n)){for(o={instances:[]},cr.hasAnyOwnProperty(n.extra)&&(o.ex=I(n.extra)),i=0,r=n.instances.length;i<r;i++)o.instances.push(this.saveInstanceToJSON(n.instances[i]));p.types[n.sid.toString()]=o}for(t=0,e=this.layouts_by_index.length;t<e;t++)s=this.layouts_by_index[t],p.layouts[s.sid.toString()]=s.saveToJSON();var d=p.events.groups;for(t=0,e=this.allGroups.length;t<e;t++)d[(a=this.allGroups[t]).sid.toString()]=this.groups_by_name[a.group_name].group_active;var f=p.events.cnds;for(u in this.cndsBySid)this.cndsBySid.hasOwnProperty(u)&&(h=this.cndsBySid[u],cr.hasAnyOwnProperty(h.extra)&&(f[u]={ex:I(h.extra)}));var g=p.events.acts;for(u in this.actsBySid)this.actsBySid.hasOwnProperty(u)&&(c=this.actsBySid[u],cr.hasAnyOwnProperty(c.extra)&&(g[u]={ex:I(c.extra)}));var y=p.events.vars;for(u in this.varsBySid)this.varsBySid.hasOwnProperty(u)&&((l=this.varsBySid[u]).is_constant||l.parent&&!l.is_static||(y[u]=l.data));return p.system=this.system.saveToJSON(),JSON.stringify(p)},r.prototype.refreshUidMap=function(){var t,e,i,r,n,s;for(this.objectsByUid={},t=0,e=this.types_by_index.length;t<e;t++)if(!(i=this.types_by_index[t]).is_family)for(r=0,n=i.instances.length;r<n;r++)s=i.instances[r],this.objectsByUid[s.uid.toString()]=s},r.prototype.loadFromJSONString=function(t){var e;try{e=JSON.parse(t)}catch(t){return!1}if(!e.c2save)return!1;if(e.version>1)return!1;this.isLoadingState=!0;var i=e.rt;this.kahanTime.reset(),this.kahanTime.sum=i.time,this.wallTime.reset(),this.wallTime.sum=i.walltime||0,this.timescale=i.timescale,this.tickcount=i.tickcount,this.execcount=i.execcount,this.start_time=Date.now()-i.start_time_offset;var r,n,s,o,a,h,c,l,u,p,d,f,g,y,m,_,v,b=i.running_layout;if(b!==this.running_layout.sid){var w=this.getLayoutBySid(b);if(!w)return;this.doChangeLayout(w)}var x=e.types;for(c in x)if(x.hasOwnProperty(c)){if(!(l=this.getObjectTypeBySid(parseInt(c,10)))||l.is_family||this.typeHasNoSaveBehavior(l))continue;for(x[c].ex?l.extra=x[c].ex:cr.wipe(l.extra),u=l.instances,p=x[c].instances,r=0,n=cr.min(u.length,p.length);r<n;r++)this.loadInstanceFromJSON(u[r],p[r]);for(r=p.length,n=u.length;r<n;r++)this.DestroyInstance(u[r]);for(r=u.length,n=p.length;r<n;r++)y=null,l.plugin.is_world&&!(y=this.running_layout.getLayerBySid(p[r].w.l))||(d=this.createInstanceFromInit(l.default_instance,y,!1,0,0,!0),this.loadInstanceFromJSON(d,p[r]));l.stale_iids=!0}this.ClearDeathRow(),this.refreshUidMap();var S=e.layouts;for(c in S)if(S.hasOwnProperty(c)){if(!(g=this.getLayoutBySid(parseInt(c,10))))continue;g.loadFromJSON(S[c])}var T=e.events.groups;for(c in T)T.hasOwnProperty(c)&&(m=this.getGroupBySid(parseInt(c,10)))&&this.groups_by_name[m.group_name]&&this.groups_by_name[m.group_name].setGroupActive(T[c]);var C=e.events.cnds;for(c in this.cndsBySid)this.cndsBySid.hasOwnProperty(c)&&(C.hasOwnProperty(c)?this.cndsBySid[c].extra=C[c].ex:this.cndsBySid[c].extra={});var A=e.events.acts;for(c in this.actsBySid)this.actsBySid.hasOwnProperty(c)&&(A.hasOwnProperty(c)?this.actsBySid[c].extra=A[c].ex:this.actsBySid[c].extra={});var O=e.events.vars;for(c in O)O.hasOwnProperty(c)&&this.varsBySid.hasOwnProperty(c)&&(this.varsBySid[c].data=O[c]);for(this.next_uid=i.next_uid,this.isLoadingState=!1,r=0,n=this.fireOnCreateAfterLoad.length;r<n;++r)d=this.fireOnCreateAfterLoad[r],this.trigger(Object.getPrototypeOf(d.type.plugin).cnds.OnCreated,d);for(cr.clearArray(this.fireOnCreateAfterLoad),this.system.loadFromJSON(e.system),r=0,n=this.types_by_index.length;r<n;r++)if(!(l=this.types_by_index[r]).is_family&&!this.typeHasNoSaveBehavior(l))for(s=0,o=l.instances.length;s<o;s++){if(d=l.instances[s],l.is_contained)for(_=d.get_iid(),cr.clearArray(d.siblings),a=0,h=l.container.length;a<h;a++)l!==(v=l.container[a])&&d.siblings.push(v.instances[_]);if(d.afterLoad&&d.afterLoad(),d.behavior_insts)for(a=0,h=d.behavior_insts.length;a<h;a++)(f=d.behavior_insts[a]).afterLoad&&f.afterLoad()}return this.redraw=!0,!0},r.prototype.saveInstanceToJSON=function(t,e){var i,r,n,s,o,a=t.type,h=a.plugin,c={};if(e?c.c2=!0:c.uid=t.uid,cr.hasAnyOwnProperty(t.extra)&&(c.ex=I(t.extra)),t.instance_vars&&t.instance_vars.length)for(c.ivs={},i=0,r=t.instance_vars.length;i<r;i++)c.ivs[t.type.instvar_sids[i].toString()]=t.instance_vars[i];if(h.is_world){if(n={x:t.x,y:t.y,w:t.width,h:t.height,l:t.layer.sid,zi:t.get_zindex()},0!==t.angle&&(n.a=t.angle),1!==t.opacity&&(n.o=t.opacity),.5!==t.hotspotX&&(n.hX=t.hotspotX),.5!==t.hotspotY&&(n.hY=t.hotspotY),0!==t.blend_mode&&(n.bm=t.blend_mode),t.visible||(n.v=t.visible),t.collisionsEnabled||(n.ce=t.collisionsEnabled),-1!==t.my_timescale&&(n.mts=t.my_timescale),a.effect_types.length)for(n.fx=[],i=0,r=a.effect_types.length;i<r;i++)o=a.effect_types[i],n.fx.push({name:o.name,active:t.active_effect_flags[o.index],params:t.effect_params[o.index]});c.w=n}if(t.behavior_insts&&t.behavior_insts.length)for(c.behs={},i=0,r=t.behavior_insts.length;i<r;i++)(s=t.behavior_insts[i]).saveToJSON&&(c.behs[s.type.sid.toString()]=s.saveToJSON());return t.saveToJSON&&(c.data=t.saveToJSON()),c},r.prototype.getInstanceVarIndexBySid=function(t,e){var i,r;for(i=0,r=t.instvar_sids.length;i<r;i++)if(t.instvar_sids[i]===e)return i;return-1},r.prototype.getBehaviorIndexBySid=function(t,e){var i,r;for(i=0,r=t.behavior_insts.length;i<r;i++)if(t.behavior_insts[i].type.sid===e)return i;return-1},r.prototype.loadInstanceFromJSON=function(t,e,i){var r,n,s,o,a,h,c,l,u,p,d,f=t.type,g=f.plugin;if(i){if(!e.c2)return}else t.uid=e.uid;if(e.ex?t.extra=e.ex:cr.wipe(t.extra),a=e.ivs)for(r in a)if(a.hasOwnProperty(r)){if((o=this.getInstanceVarIndexBySid(f,parseInt(r,10)))<0||o>=t.instance_vars.length)continue;null===(p=a[r])&&(p=NaN),t.instance_vars[o]=p}if(g.is_world){if(h=e.w,t.layer.sid!==h.l&&(d=t.layer,t.layer=this.running_layout.getLayerBySid(h.l),t.layer?(d.removeFromInstanceList(t,!0),t.layer.appendToInstanceList(t,!0),t.set_bbox_changed(),t.layer.setZIndicesStaleFrom(0)):(t.layer=d,i||this.DestroyInstance(t))),t.x=h.x,t.y=h.y,t.width=h.w,t.height=h.h,t.zindex=h.zi,t.angle=h.hasOwnProperty("a")?h.a:0,t.opacity=h.hasOwnProperty("o")?h.o:1,t.hotspotX=h.hasOwnProperty("hX")?h.hX:.5,t.hotspotY=h.hasOwnProperty("hY")?h.hY:.5,t.visible=!h.hasOwnProperty("v")||h.v,t.collisionsEnabled=!h.hasOwnProperty("ce")||h.ce,t.my_timescale=h.hasOwnProperty("mts")?h.mts:-1,t.blend_mode=h.hasOwnProperty("bm")?h.bm:0,t.compositeOp=cr.effectToCompositeOp(t.blend_mode),this.gl&&cr.setGLBlend(t,t.blend_mode,this.gl),t.set_bbox_changed(),h.hasOwnProperty("fx"))for(n=0,s=h.fx.length;n<s;n++)(c=f.getEffectIndexByName(h.fx[n].name))<0||(t.active_effect_flags[c]=h.fx[n].active,t.effect_params[c]=h.fx[n].params);t.updateActiveEffects()}if(l=e.behs)for(r in l)if(l.hasOwnProperty(r)){if((u=this.getBehaviorIndexBySid(t,parseInt(r,10)))<0)continue;t.behavior_insts[u].loadFromJSON(l[r])}e.data&&t.loadFromJSON(e.data)},r.prototype.getProjectFileUrl=function(t){return this.isPreview?window.cr_previewProjectFiles.hasOwnProperty(t.toLowerCase())?window.cr_previewProjectFiles[t.toLowerCase()]:t:this.files_subfolder+t},r.prototype.getProjectFileBlob=function(t){return this.isPreview&&window.cr_previewProjectFileBlobs&&window.cr_previewProjectFiles.hasOwnProperty(t.toLowerCase())?window.cr_previewProjectFileBlobs[t.toLowerCase()]:null},r.prototype.getLocalFileUrl=function(t){return this.isPreview&&window.cr_previewProjectFiles.hasOwnProperty(t.toLowerCase())?window.cr_previewProjectFiles[t.toLowerCase()]:t},r.prototype.fetchLocalFileViaCordova=function(t,e,i){var r=window.cordova.file.applicationDirectory+"www/"+t;window.resolveLocalFileSystemURL(r,(function(t){t.file(e,i)}),i)},r.prototype.fetchLocalFileViaCordovaAsText=function(t,e,i){this.fetchLocalFileViaCordova(t,(function(t){var r=new FileReader;r.onload=function(t){e(t.target.result)},r.onerror=i,r.readAsText(t)}),i)};var k=[],R=0;r.prototype.maybeStartNextArrayBufferRead=function(){if(k.length&&!(R>=8)){R++;var t=k.shift();this.doFetchLocalFileViaCordovaAsArrayBuffer(t.filename,t.successCallback,t.errorCallback)}},r.prototype.fetchLocalFileViaCordovaAsArrayBuffer=function(t,e,i){var r=this;k.push({filename:t,successCallback:function(t){R--,r.maybeStartNextArrayBufferRead(),e(t)},errorCallback:function(t){R--,r.maybeStartNextArrayBufferRead(),i(t)}}),this.maybeStartNextArrayBufferRead()},r.prototype.doFetchLocalFileViaCordovaAsArrayBuffer=function(t,e,i){this.fetchLocalFileViaCordova(t,(function(t){var i=new FileReader;i.onload=function(t){e(t.target.result)},i.readAsArrayBuffer(t)}),i)},r.prototype.fetchLocalFileViaCordovaAsURL=function(t,e,i){var r="",n=t.toLowerCase(),s=n.substr(n.length-4),o=n.substr(n.length-5);".mp4"===s?r="video/mp4":".webm"===o?r="video/webm":".m4a"===s?r="audio/mp4":".mp3"===s&&(r="audio/mpeg"),this.fetchLocalFileViaCordovaAsArrayBuffer(t,(function(t){var i=new Blob([t],{type:r}),n=URL.createObjectURL(i);e(n)}),i)},r.prototype.isAbsoluteUrl=function(t){return/^(?:[a-z]+:)?\/\//.test(t)||"data:"===t.substr(0,5)||"blob:"===t.substr(0,5)},r.prototype.setImageSrc=function(t,e){this.isWKWebView&&!this.isAbsoluteUrl(e)?this.fetchLocalFileViaCordovaAsURL(e,(function(e){t.src=e}),(function(t){alert("Failed to load image: "+t)})):this.isPreview&&!this.isAbsoluteUrl(e)?t.src=this.getLocalFileUrl(e):(this.isAbsoluteUrl(e)||(e=e.toLowerCase()),t.src=e)},r.prototype.getPreferredAudioFile=function(t){var e=t.toLowerCase();if(!this.audio_files_map.hasOwnProperty(e))return null;var r,n,s,o,a=this.audio_files_map[e],h=null;for(r=0,n=a.length;r<n;++r)if(o=(s=a[r])[0],h||"audio/webm; codecs=opus"!==o||(h=s),i[o])return s;return h},r.prototype.getProjectAudioFileUrl=function(t){var e=t.toLowerCase(),i=this.getPreferredAudioFile(t);if(!i)return null;var r=e+i[1];return{url:this.getProjectFileUrl(r),type:i[0]}},r.prototype.getStatusInfo=function(){return{fps:this.fps,cpu:this.cpuutilisation/1e3,gpu:this.gpuLastUtilisation,layout:this.running_layout?this.running_layout.name:"",renderer:this.glUnmaskedRenderer}},r.prototype.accelerate=function(t,e,i,r,n){if(this.enhancedAccelerationPrecision){var s=e*n,o=i*n;return cr.clamp(t*n+.5*r*n*n,s,o)}return t*n},cr.runtime=r,cr.createRuntime=function(t){return new r(t)},window.cr_createRuntime=cr.createRuntime}(),window.cr_getSnapshot=function(t,e){var i=window.c3runtime;i&&i.doCanvasSnapshot(t,e)},window.cr_sizeCanvas=function(t,e){if(0!==t&&0!==e){var i=window.c3runtime;i&&i.setSize(t,e)}},window.cr_setSuspended=function(t){var e=window.c3runtime;e&&e.setSuspended(t)},function(){function t(t,e){return t.zindex-e.zindex}function e(t,e){this.layout=t,this.runtime=t.runtime,this.instances=[],this.scale=1,this.angle=0,this.disableAngle=!1,this.tmprect=new cr.rect(0,0,0,0),this.tmpquad=new cr.quad,this.viewLeft=0,this.viewRight=0,this.viewTop=0,this.viewBottom=0,this.zindices_stale=!1,this.zindices_stale_from=-1,this.clear_earlyz_index=0,this.name=e[0],this.index=e[1],this.sid=e[2],this.visible=e[3],this.background_color=e[4],this.transparent=e[5],this.parallaxX=e[6],this.parallaxY=e[7],this.opacity=e[8],this.forceOwnTexture=e[9],this.useRenderCells=e[10],this.zoomRate=e[11],this.blend_mode=e[12],this.effect_fallback=e[13],this.compositeOp="source-over",this.srcBlend=0,this.destBlend=0,this.render_grid=null,this.last_render_list=r(),this.render_list_stale=!0,this.last_render_cells=new cr.rect(0,0,-1,-1),this.cur_render_cells=new cr.rect(0,0,-1,-1),this.useRenderCells&&(this.render_grid=new cr.RenderGrid(this.runtime.original_width,this.runtime.original_height)),this.render_offscreen=!1;var i,n,s=e[14];for(this.startup_initial_instances=[],this.initial_instances=[],this.created_globals=[],i=0,n=s.length;i<n;i++){var o=s[i],a=this.runtime.types_by_index[o[1]];a.default_instance||(a.default_instance=o,a.default_layerindex=this.index),this.initial_instances.push(o),-1===this.layout.initial_types.indexOf(a)&&this.layout.initial_types.push(a)}for(cr.shallowAssignArray(this.startup_initial_instances,this.initial_instances),this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],i=0,n=e[15].length;i<n;i++)this.effect_types.push({id:e[15][i][0],name:e[15][i][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:i}),this.effect_params.push(e[15][i][2].slice(0));this.updateActiveEffects(),this.rcTexBounce=new cr.rect(0,0,1,1),this.rcTexDest=new cr.rect(0,0,1,1),this.rcTexOrigin=new cr.rect(0,0,1,1)}e.prototype.updateActiveEffects=function(){var t,e,i;for(cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0,t=0,e=this.effect_types.length;t<e;t++)(i=this.effect_types[t]).active&&(this.active_effect_types.push(i),i.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))},e.prototype.getEffectByName=function(t){var e,i,r;for(e=0,i=this.effect_types.length;e<i;e++)if((r=this.effect_types[e]).name===t)return r;return null},e.prototype.createInitialInstances=function(t){var e,i,r,n,s,o,a;for(e=0,i=0,r=this.initial_instances.length;e<r;e++){if(s=this.initial_instances[e],o=this.runtime.types_by_index[s[1]],a=!0,!this.runtime.typeHasPersistBehavior(o)||this.layout.first_visit){if(!(n=this.runtime.createInstanceFromInit(s,this,!0)))continue;t.push(n),n.type.global&&(a=!1,this.created_globals.push(n.uid))}a&&(this.initial_instances[i]=this.initial_instances[e],i++)}this.initial_instances.length=i,this.runtime.ClearDeathRow(),!this.runtime.glwrap&&this.effect_types.length&&(this.blend_mode=this.effect_fallback),this.compositeOp=cr.effectToCompositeOp(this.blend_mode),this.runtime.gl&&cr.setGLBlend(this,this.blend_mode,this.runtime.gl),this.render_list_stale=!0},e.prototype.recreateInitialObjects=function(t,e){var i,r,n,s,o,a,h,c,l,u,p,d=this.runtime.types_by_index,f=t.is_family,g=t.members;for(i=0,r=this.initial_instances.length;i<r;++i)if(a=(o=(n=this.initial_instances[i])[0])[0],h=o[1],e.contains_pt(a,h)){if((s=d[n[1]])!==t){if(!f)continue;if(g.indexOf(s)<0)continue}if(c=this.runtime.createInstanceFromInit(n,this,!1),this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(s.plugin).cnds.OnCreated,c),c.is_contained)for(l=0,u=c.siblings.length;l<u;l++)p=c.siblings[i],this.runtime.trigger(Object.getPrototypeOf(p.type.plugin).cnds.OnCreated,p);this.runtime.isInOnDestroy--}},e.prototype.removeFromInstanceList=function(t,e){var i=cr.fastIndexOf(this.instances,t);i<0||(e&&this.useRenderCells&&t.rendercells&&t.rendercells.right>=t.rendercells.left&&(t.update_bbox(),this.render_grid.update(t,t.rendercells,null),t.rendercells.set(0,0,-1,-1)),i===this.instances.length-1?this.instances.pop():(cr.arrayRemove(this.instances,i),this.setZIndicesStaleFrom(i)),this.render_list_stale=!0)},e.prototype.appendToInstanceList=function(t,e){t.zindex=this.instances.length,this.instances.push(t),e&&this.useRenderCells&&t.rendercells&&t.set_bbox_changed(),this.render_list_stale=!0},e.prototype.prependToInstanceList=function(t,e){this.instances.unshift(t),this.setZIndicesStaleFrom(0),e&&this.useRenderCells&&t.rendercells&&t.set_bbox_changed()},e.prototype.moveInstanceAdjacent=function(t,e,i){var r=t.get_zindex(),n=e.get_zindex();cr.arrayRemove(this.instances,r),r<n&&n--,i&&n++,n===this.instances.length?this.instances.push(t):this.instances.splice(n,0,t),this.setZIndicesStaleFrom(r<n?r:n)},e.prototype.setZIndicesStaleFrom=function(t){(-1===this.zindices_stale_from||t<this.zindices_stale_from)&&(this.zindices_stale_from=t),this.zindices_stale=!0,this.render_list_stale=!0},e.prototype.updateZIndices=function(){if(this.zindices_stale){var t,e,i;if(-1===this.zindices_stale_from&&(this.zindices_stale_from=0),this.useRenderCells)for(t=this.zindices_stale_from,e=this.instances.length;t<e;++t)(i=this.instances[t]).zindex=t,this.render_grid.markRangeChanged(i.rendercells);else for(t=this.zindices_stale_from,e=this.instances.length;t<e;++t)this.instances[t].zindex=t;this.zindices_stale=!1,this.zindices_stale_from=-1}},e.prototype.getScale=function(t){return this.getNormalScale()*(this.runtime.fullscreenScalingQuality||t?this.runtime.aspect_scale:1)},e.prototype.getNormalScale=function(){return(this.scale*this.layout.scale-1)*this.zoomRate+1},e.prototype.getAngle=function(){return this.disableAngle?0:cr.clamp_angle(this.layout.angle+this.angle)};var i=[];function r(){return i.length?i.pop():[]}function n(t){cr.clearArray(t),i.push(t)}function s(t,e,i){var r,n,s=0,o=0,a=0,h=t.length,c=e.length;for(i.length=h+c;s<h&&o<c;++a)r=t[s],n=e[o],r.zindex<n.zindex?(i[a]=r,++s):(i[a]=n,++o);for(;s<h;++s,++a)i[a]=t[s];for(;o<c;++o,++a)i[a]=e[o]}var o=[];function a(t,e){var i,a,h,c,l;for(i=0,a=t.length;i<a-1;i+=2)s(h=t[i],c=t[i+1],l=r()),e||(n(h),n(c)),o.push(l);a%2==1&&(e?(h=r(),cr.shallowAssignArray(h,t[a-1]),o.push(h)):o.push(t[a-1])),cr.shallowAssignArray(t,o),cr.clearArray(o)}var h=[];e.prototype.getRenderCellInstancesToDraw=function(){if(this.updateZIndices(),this.render_grid.queryRange(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,h),!h.length)return r();if(1===h.length){var t=r();return cr.shallowAssignArray(t,h[0]),cr.clearArray(h),t}var e=function(t){for(var e=!0;t.length>1;)a(t,e),e=!1;return t[0]}(h);return cr.clearArray(h),e},e.prototype.draw=function(t){this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0!==this.blend_mode;var e=this.runtime.canvas,i=t,r=!1;this.render_offscreen&&(this.runtime.layer_canvas||(this.runtime.layer_canvas=document.createElement("canvas"),(e=this.runtime.layer_canvas).width=this.runtime.draw_width,e.height=this.runtime.draw_height,this.runtime.layer_ctx=e.getContext("2d"),r=!0),e=this.runtime.layer_canvas,i=this.runtime.layer_ctx,e.width!==this.runtime.draw_width&&(e.width=this.runtime.draw_width,r=!0),e.height!==this.runtime.draw_height&&(e.height=this.runtime.draw_height,r=!0),r&&(i.imageSmoothingEnabled=this.runtime.linearSampling),this.transparent&&i.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),i.globalAlpha=1,i.globalCompositeOperation="source-over",this.transparent||(i.fillStyle="rgb("+this.background_color[0]+","+this.background_color[1]+","+this.background_color[2]+")",i.fillRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),i.save(),this.disableAngle=!0;var s=this.canvasToLayer(0,0,!0,!0),o=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(s=Math.round(s),o=Math.round(o)),this.rotateViewport(s,o,i);var a,h=this.getScale();i.scale(h,h),i.translate(-s,-o),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(n(this.last_render_list),a=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):a=this.last_render_list):a=this.instances;var c,l,u,p=null;for(c=0,l=a.length;c<l;++c)(u=a[c])!==p&&(this.drawInstance(u,i),p=u);this.useRenderCells&&(this.last_render_list=a),i.restore(),this.render_offscreen&&(t.globalCompositeOperation=this.compositeOp,t.globalAlpha=this.opacity,t.drawImage(e,0,0))},e.prototype.drawInstance=function(t,e){if(t.visible&&0!==t.width&&0!==t.height){t.update_bbox();var i=t.bbox;i.right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(e.globalCompositeOperation=t.compositeOp,t.draw(e))}},e.prototype.updateViewport=function(t){this.disableAngle=!0;var e=this.canvasToLayer(0,0,!0,!0),i=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i)),this.rotateViewport(e,i,t)},e.prototype.rotateViewport=function(t,e,i){var r=this.getScale();this.viewLeft=t,this.viewTop=e,this.viewRight=t+this.runtime.draw_width*(1/r),this.viewBottom=e+this.runtime.draw_height*(1/r);var n=this.getAngle();0!==n&&(i&&(i.translate(this.runtime.draw_width/2,this.runtime.draw_height/2),i.rotate(-n),i.translate(this.runtime.draw_width/-2,this.runtime.draw_height/-2)),this.tmprect.set(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom),this.tmprect.offset((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),this.tmpquad.set_from_rotated_rect(this.tmprect,n),this.tmpquad.bounding_box(this.tmprect),this.tmprect.offset((this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2),this.viewLeft=this.tmprect.left,this.viewTop=this.tmprect.top,this.viewRight=this.tmprect.right,this.viewBottom=this.tmprect.bottom)},e.prototype.drawGL_earlyZPass=function(t){this.runtime.draw_width,this.runtime.draw_height;this.render_offscreen=this.forceOwnTexture,this.render_offscreen&&(this.runtime.layer_tex||(this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layer_tex.c2width===this.runtime.draw_width&&this.runtime.layer_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layer_tex)),this.disableAngle=!0;var e=this.canvasToLayer(0,0,!0,!0),i=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i)),this.rotateViewport(e,i,null);var r,s=this.getScale();t.resetModelView(),t.scale(s,s),t.rotateZ(-this.getAngle()),t.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),t.updateModelView(),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(n(this.last_render_list),r=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):r=this.last_render_list):r=this.instances;var o,a,h=null;for(o=r.length-1;o>=0;--o)(a=r[o])!==h&&(this.drawInstanceGL_earlyZPass(r[o],t),h=a);this.useRenderCells&&(this.last_render_list=r),this.transparent||(this.clear_earlyz_index=this.runtime.earlyz_index++,t.setEarlyZIndex(this.clear_earlyz_index),t.setColorFillMode(1,1,1,1),t.fullscreenQuad(),t.restoreEarlyZMode())},e.prototype.drawGL=function(t){var e=0,i=0;this.render_offscreen=this.forceOwnTexture||1!==this.opacity||this.active_effect_types.length>0||0!==this.blend_mode,this.render_offscreen&&(this.runtime.layer_tex||(this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layer_tex.c2width===this.runtime.draw_width&&this.runtime.layer_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layer_tex),this.transparent&&t.clear(0,0,0,0)),this.transparent||(this.runtime.enableFrontToBack?(t.setEarlyZIndex(this.clear_earlyz_index),t.setColorFillMode(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1),t.fullscreenQuad(),t.setTextureFillMode()):t.clear(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1)),this.disableAngle=!0;var r=this.canvasToLayer(0,0,!0,!0),s=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(r=Math.round(r),s=Math.round(s)),this.rotateViewport(r,s,null);var o,a=this.getScale();t.resetModelView(),t.scale(a,a),t.rotateZ(-this.getAngle()),t.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),t.updateModelView(),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(n(this.last_render_list),o=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):o=this.last_render_list):o=this.instances;var h,c,l,u=null;if(this.getNormalScale()>2220446049250313e-31)for(h=0,c=o.length;h<c;++h)(l=o[h])!==u&&(this.drawInstanceGL(o[h],t),u=l);if(this.useRenderCells&&(this.last_render_list=o),this.render_offscreen)if(e=this.active_effect_types.length?this.active_effect_types[0].shaderindex:0,i=this.active_effect_types.length?this.active_effect_types[0].index:0,0===this.active_effect_types.length||1===this.active_effect_types.length&&!t.programUsesCrossSampling(e)&&1===this.opacity){1===this.active_effect_types.length?(t.switchProgram(e),t.setProgramParameters(this.layout.getRenderTarget(),1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,0,0,1,1,this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,0,0,1,1,a,this.getAngle(),this.runtime.kahanTime.sum,this.effect_params[i]),t.programIsAnimated(e)&&(this.runtime.redraw=!0)):t.switchProgram(0),t.setRenderingToTexture(this.layout.getRenderTarget()),t.setOpacity(this.opacity),t.setTexture(this.runtime.layer_tex),t.setBlend(this.srcBlend,this.destBlend),t.resetModelView(),t.updateModelView();var p=this.runtime.draw_width/2,d=this.runtime.draw_height/2;t.quad(-p,d,p,d,p,-d,-p,-d),t.setTexture(null)}else this.layout.renderEffectChain(t,this,null,this.layout.getRenderTarget())},e.prototype.drawInstanceGL=function(t,e){if(t.visible&&0!==t.width&&0!==t.height){t.update_bbox();var i=t.bbox;i.right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(e.setEarlyZIndex(t.earlyz_index),t.uses_shaders?this.drawInstanceWithShadersGL(t,e):(e.switchProgram(0),e.setBlend(t.srcBlend,t.destBlend),t.drawGL(e)))}},e.prototype.drawInstanceGL_earlyZPass=function(t,e){if(t.visible&&0!==t.width&&0!==t.height){t.update_bbox();var i=t.bbox;i.right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(t.earlyz_index=this.runtime.earlyz_index++,0===t.blend_mode&&1===t.opacity&&t.shaders_preserve_opaqueness&&t.drawGL_earlyZPass&&(e.setEarlyZIndex(t.earlyz_index),t.drawGL_earlyZPass(e)))}},e.prototype.drawInstanceWithShadersGL=function(t,e){var i=t.active_effect_types[0].shaderindex,r=t.active_effect_types[0].index,n=this.getScale(),s=this.runtime.draw_width,o=this.runtime.draw_height;if(1!==t.active_effect_types.length||e.programUsesCrossSampling(i)||e.programExtendsBox(i)||(t.angle||t.layer.getAngle())&&e.programUsesDest(i)||1!==t.opacity||t.type.plugin.must_predraw)this.layout.renderEffectChain(e,this,t,this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget()),e.resetModelView(),e.scale(n,n),e.rotateZ(-this.getAngle()),e.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),e.updateModelView();else{e.switchProgram(i),e.setBlend(t.srcBlend,t.destBlend),e.programIsAnimated(i)&&(this.runtime.redraw=!0);var a=0,h=0,c=0,l=0;if(e.programUsesDest(i)){var u=t.bbox;a=this.layerToCanvas(u.left,u.top,!0,!0)/s,h=1-this.layerToCanvas(u.left,u.top,!1,!0)/o,c=this.layerToCanvas(u.right,u.bottom,!0,!0)/s,l=1-this.layerToCanvas(u.right,u.bottom,!1,!0)/o}var p=0,d=0,f=1,g=1,y=1/t.width,m=1/t.height;t.curFrame&&t.curFrame.sheetTex&&(p=t.curFrame.sheetTex.left,d=t.curFrame.sheetTex.top,f=t.curFrame.sheetTex.right,g=t.curFrame.sheetTex.bottom,t.curFrame.texture_img&&(y=1/t.curFrame.texture_img.width,m=1/t.curFrame.texture_img.height)),e.setProgramParameters(this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget(),y,m,p,d,f,g,p,d,f,g,t.bbox.left,t.bbox.top,t.bbox.right,t.bbox.bottom,a,h,c,l,n,this.getAngle(),this.runtime.kahanTime.sum,t.effect_params[r]),t.drawGL(e)}},e.prototype.canvasToLayer=function(t,e,i,r){var n=this.runtime.devicePixelRatio;this.runtime.isRetina&&(t*=n,e*=n);var s=this.runtime.parallax_x_origin,o=this.runtime.parallax_y_origin,a=(this.layout.scrollX-s)*this.parallaxX+s,h=(this.layout.scrollY-o)*this.parallaxY+o,c=a,l=h,u=1/this.getScale(!r);r?(c-=this.runtime.draw_width*u/2,l-=this.runtime.draw_height*u/2):(c-=this.runtime.width*u/2,l-=this.runtime.height*u/2),c+=t*u,l+=e*u;var p=this.getAngle();if(0!==p){c-=a,l-=h;var d=Math.cos(p),f=Math.sin(p),g=c*d-l*f;l=l*d+c*f,c=g,c+=a,l+=h}return i?c:l},e.prototype.layerToCanvas=function(t,e,i,r){var n=this.runtime.parallax_x_origin,s=this.runtime.parallax_y_origin,o=(this.layout.scrollX-n)*this.parallaxX+n,a=(this.layout.scrollY-s)*this.parallaxY+s,h=o,c=a,l=this.getAngle();if(0!==l){t-=o,e-=a;var u=Math.cos(-l),p=Math.sin(-l),d=t*u-e*p;e=e*u+t*p,t=d,t+=o,e+=a}var f=1/this.getScale(!r);r?(h-=this.runtime.draw_width*f/2,c-=this.runtime.draw_height*f/2):(h-=this.runtime.width*f/2,c-=this.runtime.height*f/2),h=(t-h)/f,c=(e-c)/f;var g=this.runtime.devicePixelRatio;return this.runtime.isRetina&&!r&&(h/=g,c/=g),i?h:c},e.prototype.rotatePt=function(t,e,i){if(0===this.getAngle())return i?t:e;var r=this.layerToCanvas(t,e,!0),n=this.layerToCanvas(t,e,!1);this.disableAngle=!0;var s=this.canvasToLayer(r,n,!0),o=this.canvasToLayer(r,n,!0);return this.disableAngle=!1,i?s:o},e.prototype.saveToJSON=function(){var t,e,i,r={s:this.scale,a:this.angle,vl:this.viewLeft,vt:this.viewTop,vr:this.viewRight,vb:this.viewBottom,v:this.visible,bc:this.background_color,t:this.transparent,px:this.parallaxX,py:this.parallaxY,o:this.opacity,zr:this.zoomRate,fx:[],cg:this.created_globals,instances:[]};for(t=0,e=this.effect_types.length;t<e;t++)i=this.effect_types[t],r.fx.push({name:i.name,active:i.active,params:this.effect_params[i.index]});return r},e.prototype.loadFromJSON=function(e){var i,r,n,s;this.scale=e.s,this.angle=e.a,this.viewLeft=e.vl,this.viewTop=e.vt,this.viewRight=e.vr,this.viewBottom=e.vb,this.visible=e.v,this.background_color=e.bc,this.transparent=e.t,this.parallaxX=e.px,this.parallaxY=e.py,this.opacity=e.o,this.zoomRate=e.zr,this.created_globals=e.cg||[],cr.shallowAssignArray(this.initial_instances,this.startup_initial_instances);var o=new cr.ObjectSet;for(i=0,n=this.created_globals.length;i<n;++i)o.add(this.created_globals[i]);for(i=0,r=0,n=this.initial_instances.length;i<n;++i)o.contains(this.initial_instances[i][2])||(this.initial_instances[r]=this.initial_instances[i],++r);cr.truncateArray(this.initial_instances,r);var a=e.fx;for(i=0,n=a.length;i<n;i++)(s=this.getEffectByName(a[i].name))&&(s.active=a[i].active,this.effect_params[s.index]=a[i].params);this.updateActiveEffects(),this.instances.sort(t),this.zindices_stale=!0},cr.layer=e}(),function(){function t(t,e){this.runtime=t,this.event_sheet=null,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,this.scale=1,this.angle=0,this.first_visit=!0,this.name=e[0],this.originalWidth=e[1],this.originalHeight=e[2],this.width=e[1],this.height=e[2],this.unbounded_scrolling=e[3],this.sheetname=e[4],this.sid=e[5];var i,r,n=e[6];for(this.layers=[],this.initial_types=[],i=0,r=n.length;i<r;i++){var s=new cr.layer(this,n[i]);s.number=i,cr.seal(s),this.layers.push(s)}var o=e[7];for(this.initial_nonworld=[],i=0,r=o.length;i<r;i++){var a=o[i],h=this.runtime.types_by_index[a[1]];h.default_instance||(h.default_instance=a),this.initial_nonworld.push(a),-1===this.initial_types.indexOf(h)&&this.initial_types.push(h)}for(this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],i=0,r=e[8].length;i<r;i++)this.effect_types.push({id:e[8][i][0],name:e[8][i][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:i}),this.effect_params.push(e[8][i][2].slice(0));this.updateActiveEffects(),this.rcTexBounce=new cr.rect(0,0,1,1),this.rcTexDest=new cr.rect(0,0,1,1),this.rcTexOrigin=new cr.rect(0,0,1,1),this.viewRect=new cr.rect(0,0,0,0),this.persist_data={}}t.prototype.saveObjectToPersist=function(t){var e=t.type.sid.toString();this.persist_data.hasOwnProperty(e)||(this.persist_data[e]=[]),this.persist_data[e].push(this.runtime.saveInstanceToJSON(t))},t.prototype.hasOpaqueBottomLayer=function(){var t=this.layers[0];return!t.transparent&&1===t.opacity&&!t.forceOwnTexture&&t.visible},t.prototype.updateActiveEffects=function(){var t,e,i;for(cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0,t=0,e=this.effect_types.length;t<e;t++)(i=this.effect_types[t]).active&&(this.active_effect_types.push(i),i.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))},t.prototype.getEffectByName=function(t){var e,i,r;for(e=0,i=this.effect_types.length;e<i;e++)if((r=this.effect_types[e]).name===t)return r;return null};var e=[];function i(t,e){return t.zindex-e.zindex}var r=!0;t.prototype.startRunning=function(){var t,n,s,o,a,h,c,l,u,p,d,f;for(this.sheetname&&(this.event_sheet=this.runtime.eventsheets[this.sheetname],this.event_sheet.updateDeepIncludes()),this.runtime.running_layout=this,this.width=this.originalWidth,this.height=this.originalHeight,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,t=0,s=this.runtime.types_by_index.length;t<s;t++)if(!(a=this.runtime.types_by_index[t]).is_family)for(n=0,o=(h=a.instances).length;n<o;n++)if((l=h[n]).layer){var g=l.layer.number;g>=this.layers.length&&(g=this.layers.length-1),l.layer=this.layers[g],-1===l.layer.instances.indexOf(l)&&l.layer.instances.push(l),l.layer.zindices_stale=!0}if(!r)for(t=0,s=this.layers.length;t<s;++t)this.layers[t].instances.sort(i);for(cr.clearArray(e),this.boundScrolling(),t=0,s=this.layers.length;t<s;t++)(f=this.layers[t]).createInitialInstances(e),f.updateViewport(null);var y=!1;if(!this.first_visit){for(p in this.persist_data)if(this.persist_data.hasOwnProperty(p)){if(!(a=this.runtime.getObjectTypeBySid(parseInt(p,10)))||a.is_family||!this.runtime.typeHasPersistBehavior(a))continue;for(t=0,s=(d=this.persist_data[p]).length;t<s;t++)f=null,a.plugin.is_world&&!(f=this.getLayerBySid(d[t].w.l))||(l=this.runtime.createInstanceFromInit(a.default_instance,f,!1,0,0,!0),this.runtime.loadInstanceFromJSON(l,d[t]),y=!0,e.push(l));cr.clearArray(d)}for(t=0,s=this.layers.length;t<s;t++)this.layers[t].instances.sort(i),this.layers[t].zindices_stale=!0}for(y&&(this.runtime.ClearDeathRow(),this.runtime.refreshUidMap()),this.createAndLinkContainerInstances(e),t=0,s=this.initial_nonworld.length;t<s;t++)c=this.initial_nonworld[t],(a=this.runtime.types_by_index[c[1]]).is_contained||(l=this.runtime.createInstanceFromInit(this.initial_nonworld[t],null,!0));if(this.runtime.changelayout=null,this.runtime.ClearDeathRow(),this.runtime.ctx)for(t=0,s=this.runtime.types_by_index.length;t<s;t++)!(u=this.runtime.types_by_index[t]).is_family&&u.instances.length&&u.preloadCanvas2D&&u.preloadCanvas2D(this.runtime.ctx);if(this.runtime.isLoadingState)cr.shallowAssignArray(this.runtime.fireOnCreateAfterLoad,e);else for(t=0,s=e.length;t<s;t++)l=e[t],this.runtime.trigger(Object.getPrototypeOf(l.type.plugin).cnds.OnCreated,l);cr.clearArray(e),this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutStart,null),this.first_visit=!1},t.prototype.createAndLinkContainerInstances=function(t){var e,i,r,n,s,o,a;for(e=0;e<t.length;e++)if((i=t[e]).type.is_contained)for(r=i.get_iid(),n=0,s=i.type.container.length;n<s;n++)o=i.type.container[n],i.type!==o&&(o.instances.length>r?i.siblings.push(o.instances[r]):o.default_instance&&(a=this.runtime.createInstanceFromInit(o.default_instance,i.layer,!0,i.x,i.y,!0),this.runtime.ClearDeathRow(),o.updateIIDs(),i.siblings.push(a),t.push(a)))},t.prototype.createGlobalNonWorlds=function(){var t,e,i,r,n,s=[];for(t=0,e=0,i=this.initial_nonworld.length;t<i;t++)r=this.initial_nonworld[t],(n=this.runtime.types_by_index[r[1]]).global?n.is_contained&&n.container.some((function(t){return t.plugin.is_world}))||s.push(this.runtime.createInstanceFromInit(r,null,!0)):(this.initial_nonworld[e]=r,e++);cr.truncateArray(this.initial_nonworld,e),this.runtime.ClearDeathRow(),this.createAndLinkContainerInstances(s)},t.prototype.stopRunning=function(){var t,e,i,n,s,o,a;if(this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutEnd,null),this.runtime.isEndingLayout=!0,cr.clearArray(this.runtime.system.waits),!this.first_visit)for(t=0,e=this.layers.length;t<e;t++)for(this.layers[t].updateZIndices(),i=0,n=(s=this.layers[t].instances).length;i<n;i++)(o=s[i]).type.global||this.runtime.typeHasPersistBehavior(o.type)&&this.saveObjectToPersist(o);for(t=0,e=this.layers.length;t<e;t++){for(i=0,n=(s=this.layers[t].instances).length;i<n;i++)(o=s[i]).type.global||this.runtime.DestroyInstance(o);this.runtime.ClearDeathRow(),cr.clearArray(s),this.layers[t].zindices_stale=!0}for(t=0,e=this.runtime.types_by_index.length;t<e;t++)if(!((a=this.runtime.types_by_index[t]).global||a.plugin.is_world||a.plugin.singleglobal||a.is_family)){for(i=0,n=a.instances.length;i<n;i++)this.runtime.DestroyInstance(a.instances[i]);this.runtime.ClearDeathRow()}r=!1,this.runtime.isEndingLayout=!1};var n=new cr.rect(0,0,0,0);t.prototype.recreateInitialObjects=function(t,e,i,r,s){var o,a;for(n.set(e,i,r,s),o=0,a=this.layers.length;o<a;o++)this.layers[o].recreateInitialObjects(t,n)},t.prototype.draw=function(t){var e,i,r,n,s=t,o=!1,a=!this.runtime.fullscreenScalingQuality;for(a&&(this.runtime.layout_canvas||(this.runtime.layout_canvas=document.createElement("canvas"),(e=this.runtime.layout_canvas).width=this.runtime.draw_width,e.height=this.runtime.draw_height,this.runtime.layout_ctx=e.getContext("2d"),o=!0),e=this.runtime.layout_canvas,s=this.runtime.layout_ctx,e.width!==this.runtime.draw_width&&(e.width=this.runtime.draw_width,o=!0),e.height!==this.runtime.draw_height&&(e.height=this.runtime.draw_height,o=!0),o&&(s.imageSmoothingEnabled=this.runtime.linearSampling)),s.globalAlpha=1,s.globalCompositeOperation="source-over",this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&s.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height),i=0,r=this.layers.length;i<r;i++)(n=this.layers[i]).visible&&n.opacity>0&&11!==n.blend_mode&&(n.instances.length||!n.transparent)?n.draw(s):n.updateViewport(null);a&&t.drawImage(e,0,0,this.runtime.width,this.runtime.height)},t.prototype.drawGL_earlyZPass=function(t){var e,i;for(t.setEarlyZPass(!0),this.runtime.layout_tex||(this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layout_tex.c2width===this.runtime.draw_width&&this.runtime.layout_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layout_tex),this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.draw_width,this.runtime.draw_height),e=this.layers.length-1;e>=0;--e)(i=this.layers[e]).visible&&1===i.opacity&&i.shaders_preserve_opaqueness&&0===i.blend_mode&&(i.instances.length||!i.transparent)?i.drawGL_earlyZPass(t):i.updateViewport(null);t.setEarlyZPass(!1)},t.prototype.drawGL=function(t){var e,i,r,n=this.active_effect_types.length>0||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack;for(n?(this.runtime.layout_tex||(this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layout_tex.c2width===this.runtime.draw_width&&this.runtime.layout_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layout_tex),this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.draw_width,this.runtime.draw_height)):this.runtime.layout_tex&&(t.setRenderingToTexture(null),t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=null),this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&t.clear(0,0,0,0),e=0,i=this.layers.length;e<i;e++)(r=this.layers[e]).visible&&r.opacity>0&&(r.instances.length||!r.transparent)?r.drawGL(t):r.updateViewport(null);if(n)if(0===this.active_effect_types.length||1===this.active_effect_types.length&&this.runtime.fullscreenScalingQuality){if(1===this.active_effect_types.length){var s=this.active_effect_types[0].index,o=this.calculateViewRect();t.switchProgram(this.active_effect_types[0].shaderindex),t.setProgramParameters(null,1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,0,0,1,1,o.left,o.top,o.right,o.bottom,0,0,1,1,this.scale,this.angle,this.runtime.kahanTime.sum,this.effect_params[s]),t.programIsAnimated(this.active_effect_types[0].shaderindex)&&(this.runtime.redraw=!0)}else t.switchProgram(0);this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.width,this.runtime.height),t.setRenderingToTexture(null),t.setDepthTestEnabled(!1),t.setOpacity(1),t.setTexture(this.runtime.layout_tex),t.setAlphaBlend(),t.resetModelView(),t.updateModelView();var a=this.runtime.width/2,h=this.runtime.height/2;t.quad(-a,h,a,h,a,-h,-a,-h),t.setTexture(null),t.setDepthTestEnabled(!0)}else this.renderEffectChain(t,null,null,null)},t.prototype.getRenderTarget=function(){return this.active_effect_types.length>0||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack?this.runtime.layout_tex:null},t.prototype.getMinLayerScale=function(){var t,e,i,r=this.layers[0].getScale();for(t=1,e=this.layers.length;t<e;t++)0===(i=this.layers[t]).parallaxX&&0===i.parallaxY||i.getScale()<r&&(r=i.getScale());return r},t.prototype.scrollToX=function(t){if(!this.unbounded_scrolling){var e=this.runtime.draw_width*(1/this.getMinLayerScale())/2;t>this.width-e&&(t=this.width-e),t<e&&(t=e)}this.scrollX!==t&&(this.scrollX=t,this.runtime.redraw=!0)},t.prototype.scrollToY=function(t){if(!this.unbounded_scrolling){var e=this.runtime.draw_height*(1/this.getMinLayerScale())/2;t>this.height-e&&(t=this.height-e),t<e&&(t=e)}this.scrollY!==t&&(this.scrollY=t,this.runtime.redraw=!0)},t.prototype.boundScrolling=function(){this.scrollToX(this.scrollX),this.scrollToY(this.scrollY)},t.prototype.calculateViewRect=function(){var t=this.scrollX,e=this.scrollY,i=1/(this.scale*this.runtime.aspect_scale);return t-=this.runtime.width*i/2,e-=this.runtime.height*i/2,this.viewRect.set(t,e,t+this.runtime.draw_width*i,e+this.runtime.draw_height*i),this.viewRect},t.prototype.renderEffectChain=function(t,e,i,r){var n=i?i.active_effect_types:e?e.active_effect_types:this.active_effect_types,s=1,o=0,a=0,h=0,c=this.runtime.draw_width,l=this.runtime.draw_height;if(i)s=i.layer.getScale(),o=i.layer.getAngle(),a=i.layer.viewLeft,h=i.layer.viewTop,c=i.layer.viewRight,l=i.layer.viewBottom;else if(e)s=e.getScale(),o=e.getAngle(),a=e.viewLeft,h=e.viewTop,c=e.viewRight,l=e.viewBottom;else{s=this.scale,o=this.angle;var u=this.calculateViewRect();a=u.left,h=u.top,c=u.right,l=u.bottom}var p,d,f,g,y,m=this.runtime.fx_tex,_=0,v=1,b=this.runtime.draw_width,w=this.runtime.draw_height,x=b/2,S=w/2,T=e?e.rcTexBounce:this.rcTexBounce,C=e?e.rcTexDest:this.rcTexDest,A=e?e.rcTexOrigin:this.rcTexOrigin,O=0,E=0,P=0,I=0,k=b,R=b,L=w,B=w,M=0,N=0,F=i?i.layer.getAngle():0;if(i){for(p=0,d=n.length;p<d;p++)M+=t.getProgramBoxExtendHorizontal(n[p].shaderindex),N+=t.getProgramBoxExtendVertical(n[p].shaderindex);var D=i.bbox;if(O=e.layerToCanvas(D.left,D.top,!0,!0),P=e.layerToCanvas(D.left,D.top,!1,!0),k=e.layerToCanvas(D.right,D.bottom,!0,!0),L=e.layerToCanvas(D.right,D.bottom,!1,!0),0!==F){var j=e.layerToCanvas(D.right,D.top,!0,!0),V=e.layerToCanvas(D.right,D.top,!1,!0),U=e.layerToCanvas(D.left,D.bottom,!0,!0),G=e.layerToCanvas(D.left,D.bottom,!1,!0);f=Math.min(O,k,j,U),k=Math.max(O,k,j,U),O=f,f=Math.min(P,L,V,G),L=Math.max(P,L,V,G),P=f}A.left=O/b,A.top=1-P/w,A.right=k/b,A.bottom=1-L/w,O-=M,P-=N,k+=M,L+=N,C.left=O/b,C.top=1-P/w,C.right=k/b,C.bottom=1-L/w,E=O=cr.floor(O),I=P=cr.floor(P),R=k=cr.ceil(k),B=L=cr.ceil(L),O<0&&(O=0),P<0&&(P=0),k>b&&(k=b),L>w&&(L=w),(E-=M)<0&&(E=0),(I-=N)<0&&(I=0),(R+=M)>b&&(R=b),(B+=N)>w&&(B=w),T.left=O/b,T.top=1-P/w,T.right=k/b,T.bottom=1-L/w}else T.left=C.left=A.left=0,T.top=C.top=A.top=0,T.right=C.right=A.right=1,T.bottom=C.bottom=C.bottom=1;var W=i&&(t.programUsesDest(n[0].shaderindex)||0!==M||0!==N||1!==i.opacity||i.type.plugin.must_predraw)||e&&!i&&1!==e.opacity;t.setAlphaBlend(),W&&(m[_]||(m[_]=t.createEmptyTexture(b,w,this.runtime.linearSampling)),m[_].c2width===b&&m[_].c2height===w||(t.deleteTexture(m[_]),m[_]=t.createEmptyTexture(b,w,this.runtime.linearSampling)),t.switchProgram(0),t.setRenderingToTexture(m[_]),g=w-I-(y=B-I),t.clearRect(E,g,R-E,y),i?i.drawGL(t):(t.setTexture(this.runtime.layer_tex),t.setOpacity(e.opacity),t.resetModelView(),t.translate(-x,-S),t.updateModelView(),t.quadTex(O,L,k,L,k,P,O,P,T)),C.left=C.top=0,C.right=C.bottom=1,i&&(f=T.top,T.top=T.bottom,T.bottom=f),_=1,v=0),t.setOpacity(1);var z=n.length-1,X=t.programUsesCrossSampling(n[z].shaderindex)||!e&&!i&&!this.runtime.fullscreenScalingQuality,q=0;for(p=0,d=n.length;p<d;p++){if(m[_]||(m[_]=t.createEmptyTexture(b,w,this.runtime.linearSampling)),m[_].c2width===b&&m[_].c2height===w||(t.deleteTexture(m[_]),m[_]=t.createEmptyTexture(b,w,this.runtime.linearSampling)),t.switchProgram(n[p].shaderindex),q=n[p].index,t.programIsAnimated(n[p].shaderindex)&&(this.runtime.redraw=!0),0!=p||W)t.setProgramParameters(r,1/b,1/w,0,0,1,1,A.left,A.top,A.right,A.bottom,a,h,c,l,C.left,C.top,C.right,C.bottom,s,o,this.runtime.kahanTime.sum,i?i.effect_params[q]:e?e.effect_params[q]:this.effect_params[q]),t.setTexture(null),p!==z||X?(t.setRenderingToTexture(m[_]),g=w-I-(y=B-I),t.clearRect(E,g,R-E,y)):(i?t.setBlend(i.srcBlend,i.destBlend):e&&t.setBlend(e.srcBlend,e.destBlend),t.setRenderingToTexture(r)),t.setTexture(m[v]),t.resetModelView(),t.translate(-x,-S),t.updateModelView(),t.quadTex(O,L,k,L,k,P,O,P,T),p!==z||X||t.setTexture(null);else{if(t.setRenderingToTexture(m[_]),g=w-I-(y=B-I),t.clearRect(E,g,R-E,y),i){var Y=0,J=0,H=1,K=1,Z=1/i.width,Q=1/i.height;i.curFrame&&i.curFrame.sheetTex&&(Y=i.curFrame.sheetTex.left,J=i.curFrame.sheetTex.top,H=i.curFrame.sheetTex.right,K=i.curFrame.sheetTex.bottom,i.curFrame.texture_img&&(Z=1/i.curFrame.texture_img.width,Q=1/i.curFrame.texture_img.height)),t.setProgramParameters(r,Z,Q,Y,J,H,K,Y,J,H,K,i.bbox.left,i.bbox.top,i.bbox.right,i.bbox.bottom,C.left,C.top,C.right,C.bottom,s,o,this.runtime.kahanTime.sum,i.effect_params[q]),i.drawGL(t)}else t.setProgramParameters(r,1/b,1/w,0,0,1,1,0,0,1,1,a,h,c,l,0,0,1,1,s,o,this.runtime.kahanTime.sum,e?e.effect_params[q]:this.effect_params[q]),t.setTexture(e?this.runtime.layer_tex:this.runtime.layout_tex),t.resetModelView(),t.translate(-x,-S),t.updateModelView(),t.quadTex(O,L,k,L,k,P,O,P,T);C.left=C.top=0,C.right=C.bottom=1,i&&!X&&(f=L,L=P,P=f)}v=0===(_=0===_?1:0)?1:0}X&&(t.switchProgram(0),i?t.setBlend(i.srcBlend,i.destBlend):e?t.setBlend(e.srcBlend,e.destBlend):this.runtime.fullscreenScalingQuality||(t.setSize(this.runtime.width,this.runtime.height),x=this.runtime.width/2,S=this.runtime.height/2,O=0,P=0,k=this.runtime.width,L=this.runtime.height),t.setRenderingToTexture(r),t.setTexture(m[v]),t.resetModelView(),t.translate(-x,-S),t.updateModelView(),i&&1===n.length&&!W?t.quadTex(O,P,k,P,k,L,O,L,T):t.quadTex(O,L,k,L,k,P,O,P,T),t.setTexture(null))},t.prototype.getLayerBySid=function(t){var e,i;for(e=0,i=this.layers.length;e<i;e++)if(this.layers[e].sid===t)return this.layers[e];return null},t.prototype.saveToJSON=function(){var t,e,i,r,n={sx:this.scrollX,sy:this.scrollY,s:this.scale,a:this.angle,w:this.width,h:this.height,fv:this.first_visit,persist:this.persist_data,fx:[],layers:{}};for(t=0,e=this.effect_types.length;t<e;t++)r=this.effect_types[t],n.fx.push({name:r.name,active:r.active,params:this.effect_params[r.index]});for(t=0,e=this.layers.length;t<e;t++)i=this.layers[t],n.layers[i.sid.toString()]=i.saveToJSON();return n},t.prototype.loadFromJSON=function(t){var e,i,r,n,s;this.scrollX=t.sx,this.scrollY=t.sy,this.scale=t.s,this.angle=t.a,this.width=t.w,this.height=t.h,this.persist_data=t.persist,void 0!==t.fv&&(this.first_visit=t.fv);var o=t.fx;for(e=0,i=o.length;e<i;e++)(r=this.getEffectByName(o[e].name))&&(r.active=o[e].active,this.effect_params[r.index]=o[e].params);this.updateActiveEffects();var a=t.layers;for(n in a)if(a.hasOwnProperty(n)){if(!(s=this.getLayerBySid(parseInt(n,10))))continue;s.loadFromJSON(a[n])}},cr.layout=t}(),function(){var t=[];function e(t,e){var i,r=t.length;switch(r){case 0:return!0;case 1:return t[0]===e[0];case 2:return t[0]===e[0]&&t[1]===e[1];default:for(i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}}function i(t,e){return t.index-e.index}function r(r){var n,s,o,a,h;for(2===r.length?r[0].index>r[1].index&&(a=r[0],r[0]=r[1],r[1]=a):r.length>2&&r.sort(i),r.length>=t.length&&(t.length=r.length+1),t[r.length]||(t[r.length]=[]),n=0,s=(h=t[r.length]).length;n<s;n++)if(e(r,o=h[n]))return o;return h.push(r),r}function n(t,e){this.runtime=t,this.triggers={},this.fasttriggers={},this.hasRun=!1,this.includes=new cr.ObjectSet,this.deep_includes=[],this.already_included_sheets=[],this.name=e[0];var i,r,n=e[1];for(this.events=[],i=0,r=n.length;i<r;i++)this.init_event(n[i],null,this.events)}function s(t){this.type=t,this.instances=[],this.else_instances=[],this.select_all=!0}function o(t,e,i){var r,n;this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.solModifiersIncludingParents=[],this.solWriterAfterCnds=!1,this.group=!1,this.initially_activated=!1,this.toplevelevent=!1,this.toplevelgroup=!1,this.has_else_block=!1,this.conditions=[],this.actions=[],this.subevents=[],this.group_name="",this.group=!1,this.initially_activated=!1,this.group_active=!1,this.contained_includes=null,3===i[0]&&(this.group_name=i[1][1].toLowerCase(),this.group=!0,this.initially_activated=!!i[1][0],this.contained_includes=[],this.group_active=this.initially_activated,this.runtime.allGroups.push(this),this.runtime.groups_by_name[this.group_name]=this),this.orblock=i[2],this.sid=i[4],this.group||(this.runtime.blocksBySid[this.sid.toString()]=this);var s=i[6];for(r=0,n=s.length;r<n;r++){var o=new cr.condition(this,s[r]);o.index=r,cr.seal(o),this.conditions.push(o),this.addSolModifier(o.type)}var a=i[7];for(r=0,n=a.length;r<n;r++){var h=new cr.action(this,a[r]);h.index=r,cr.seal(h),this.actions.push(h)}if(9===i.length){var c=i[8];for(r=0,n=c.length;r<n;r++)this.sheet.init_event(c[r],this,this.subevents)}this.is_else_block=!1,this.conditions.length&&(this.is_else_block=null==this.conditions[0].type&&this.conditions[0].func==cr.system_object.prototype.cnds.Else)}function a(t,e){var i,r,n;if(t&&(-1===e.indexOf(t)&&e.push(t),t.is_contained))for(i=0,r=t.container.length;i<r;i++)t!==(n=t.container[i])&&-1===e.indexOf(n)&&e.push(n)}function h(t,e){if(this.block=t,this.sheet=t.sheet,this.runtime=t.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(e[1]),this.trigger=e[3]>0,this.fasttrigger=2===e[3],this.looping=e[4],this.inverted=e[5],this.isstatic=e[6],this.sid=e[7],this.runtime.cndsBySid[this.sid.toString()]=this,-1===e[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[e[0]],this.isstatic?this.run=this.run_static:this.run=this.run_object,e[2]?(this.behaviortype=this.type.getBehaviorByName(e[2]),this.beh_index=this.type.getBehaviorIndexByName(e[2])):(this.behaviortype=null,this.beh_index=-1),this.block.parent&&this.block.parent.setSolWriterAfterCnds()),this.fasttrigger&&(this.run=this.run_true),10===e.length){var i,r,n=e[9];for(i=0,r=n.length;i<r;i++){var s=new cr.parameter(this,n[i]);cr.seal(s),this.parameters.push(s)}this.results.length=n.length}}function c(t,e){if(this.block=t,this.sheet=t.sheet,this.runtime=t.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(e[1]),-1===e[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[e[0]],this.run=this.run_object,e[2]?(this.behaviortype=this.type.getBehaviorByName(e[2]),this.beh_index=this.type.getBehaviorIndexByName(e[2])):(this.behaviortype=null,this.beh_index=-1)),this.sid=e[3],this.runtime.actsBySid[this.sid.toString()]=this,7===e.length){var i,r,n=e[6];for(i=0,r=n.length;i<r;i++){var s=new cr.parameter(this,n[i]);cr.seal(s),this.parameters.push(s)}this.results.length=n.length}}n.prototype.toString=function(){return this.name},n.prototype.init_event=function(t,e,i){switch(t[0]){case 0:case 3:var r,n,s=new cr.eventblock(this,e,t);if(cr.seal(s),s.orblock)for(i.push(s),r=0,n=s.conditions.length;r<n;r++)s.conditions[r].trigger&&this.init_trigger(s,r);else s.is_trigger()?this.init_trigger(s,0):i.push(s);break;case 1:var o=new cr.eventvariable(this,e,t);cr.seal(o),i.push(o);break;case 2:var a=new cr.eventinclude(this,e,t);cr.seal(a),i.push(a)}},n.prototype.postInit=function(){var t,e;for(t=0,e=this.events.length;t<e;t++)this.events[t].postInit(t<e-1&&this.events[t+1].is_else_block)},n.prototype.updateDeepIncludes=function(){cr.clearArray(this.deep_includes),cr.clearArray(this.already_included_sheets),this.addDeepIncludes(this),cr.clearArray(this.already_included_sheets)},n.prototype.addDeepIncludes=function(t){var e,i,r,n,s=t.deep_includes,o=t.already_included_sheets,a=this.includes.valuesRef();for(e=0,i=a.length;e<i;++e)n=(r=a[e]).include_sheet,!r.isActive()||t===n||o.indexOf(n)>-1||(o.push(n),n.addDeepIncludes(t),s.push(n))},n.prototype.run=function(t){var e,i;for(this.runtime.resuming_breakpoint||(this.hasRun=!0,t||(this.runtime.isRunningEvents=!0)),e=0,i=this.events.length;e<i;e++){var r=this.events[e];r.run(),this.runtime.clearSol(r.solModifiers),this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()}t||(this.runtime.isRunningEvents=!1)},n.prototype.init_trigger=function(t,e){t.orblock||this.runtime.triggers_to_postinit.push(t);var i,r=t.conditions[e];i=r.type?r.type.name:"system";var n=r.fasttrigger,s=n?this.fasttriggers:this.triggers;s[i]||(s[i]=[]);var o=s[i],a=r.func;if(n){if(!r.parameters.length)return;var h,c=r.parameters[0];if(1!==c.type||2!==c.expression.type)return;var l,u,p=c.expression.value.toLowerCase();for(l=0,u=o.length;l<u;l++)if(o[l].method==a)return void((h=o[l].evs)[p]?h[p].push([t,e]):h[p]=[[t,e]]);(h={})[p]=[[t,e]],o.push({method:a,evs:h})}else{for(l=0,u=o.length;l<u;l++)if(o[l].method==a)return void o[l].evs.push([t,e]);!function(t){return!(!cr.plugins_.Sprite||t!==cr.plugins_.Sprite.prototype.cnds.OnFrameChanged)}(a)?o.push({method:a,evs:[[t,e]]}):o.unshift({method:a,evs:[[t,e]]})}},cr.eventsheet=n,s.prototype.hasObjects=function(){return this.select_all?this.type.instances.length:this.instances.length},s.prototype.getObjects=function(){return this.select_all?this.type.instances:this.instances},s.prototype.pick_one=function(t){if(t)if(t.runtime.getCurrentEventStack().current_event.orblock){this.select_all&&(cr.clearArray(this.instances),cr.shallowAssignArray(this.else_instances,t.type.instances),this.select_all=!1);var e=this.else_instances.indexOf(t);-1!==e&&(this.instances.push(this.else_instances[e]),this.else_instances.splice(e,1))}else this.select_all=!1,cr.clearArray(this.instances),this.instances[0]=t},cr.selection=s,o.prototype.postInit=function(t){var e=this.parent;if(this.group)for(this.toplevelgroup=!0;e;){if(!e.group){this.toplevelgroup=!1;break}e=e.parent}this.toplevelevent=!this.is_trigger()&&(!this.parent||this.parent.group&&this.parent.toplevelgroup),this.has_else_block=!!t;var i,n,s=this.runtime.types_by_index;if(this.solModifiers===s)this.solModifiersIncludingParents=s;else{for(this.solModifiersIncludingParents=this.solModifiers.slice(0),e=this.parent;e;){for(i=0,n=e.solModifiers.length;i<n;i++)this.addParentSolModifier(e.solModifiers[i]);e=e.parent}this.solModifiers=r(this.solModifiers),this.solModifiersIncludingParents=r(this.solModifiersIncludingParents)}for(i=0,n=this.conditions.length;i<n;i++)this.conditions[i].postInit();for(i=0,n=this.actions.length;i<n;i++)this.actions[i].postInit();for(i=0,n=this.subevents.length;i<n;i++)this.subevents[i].postInit(i<n-1&&this.subevents[i+1].is_else_block)},o.prototype.setGroupActive=function(t){if(this.group_active!==!!t){var e,i;for(this.group_active=!!t,e=0,i=this.contained_includes.length;e<i;++e)this.contained_includes[e].updateActive();i>0&&this.runtime.running_layout.event_sheet&&this.runtime.running_layout.event_sheet.updateDeepIncludes()}},o.prototype.addSolModifier=function(t){a(t,this.solModifiers)},o.prototype.addParentSolModifier=function(t){a(t,this.solModifiersIncludingParents)},o.prototype.setAllSolModifiers=function(){this.solModifiers=this.runtime.types_by_index},o.prototype.setSolWriterAfterCnds=function(){this.solWriterAfterCnds=!0,this.parent&&this.parent.setSolWriterAfterCnds()},o.prototype.is_trigger=function(){return!!this.conditions.length&&this.conditions[0].trigger},o.prototype.run=function(){var t,e,i=!1,r=this.runtime,n=this.runtime.getCurrentEventStack();n.current_event=this;var s=this.conditions;if(this.is_else_block||(n.else_branch_ran=!1),this.orblock){for(0===s.length&&(i=!0),n.cndindex=0,t=s.length;n.cndindex<t;n.cndindex++)(e=s[n.cndindex]).trigger||e.run()&&(i=!0);n.last_event_true=i,i&&this.run_actions_and_subevents()}else{for(n.cndindex=0,t=s.length;n.cndindex<t;n.cndindex++)if(!s[n.cndindex].run())return n.last_event_true=!1,void(this.toplevelevent&&r.hasPendingInstances&&r.ClearDeathRow());n.last_event_true=!0,this.run_actions_and_subevents()}this.end_run(n)},o.prototype.end_run=function(t){t.last_event_true&&this.has_else_block&&(t.else_branch_ran=!0),this.toplevelevent&&this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()},o.prototype.run_orblocktrigger=function(t){this.runtime.getCurrentEventStack().current_event=this,this.conditions[t].run()&&(this.run_actions_and_subevents(),this.runtime.getCurrentEventStack().last_event_true=!0)},o.prototype.run_actions_and_subevents=function(){var t,e=this.runtime.getCurrentEventStack();for(e.actindex=0,t=this.actions.length;e.actindex<t;e.actindex++)if(this.actions[e.actindex].run())return;this.run_subevents()},o.prototype.resume_actions_and_subevents=function(){var t,e=this.runtime.getCurrentEventStack();for(t=this.actions.length;e.actindex<t;e.actindex++)if(this.actions[e.actindex].run())return;this.run_subevents()},o.prototype.run_subevents=function(){if(this.subevents.length){var t,e,i,r,n=this.subevents.length-1;if(this.runtime.pushEventStack(this),this.solWriterAfterCnds)for(t=0,e=this.subevents.length;t<e;t++)i=this.subevents[t],(r=!this.toplevelgroup||!this.group&&t<n)&&this.runtime.pushCopySol(i.solModifiers),i.run(),r?this.runtime.popSol(i.solModifiers):this.runtime.clearSol(i.solModifiers);else for(t=0,e=this.subevents.length;t<e;t++)this.subevents[t].run();this.runtime.popEventStack()}},o.prototype.run_pretrigger=function(){var t=this.runtime.getCurrentEventStack();t.current_event=this;var e,i=!1;for(t.cndindex=0,e=this.conditions.length;t.cndindex<e;t.cndindex++)if(this.conditions[t.cndindex].run())i=!0;else if(!this.orblock)return!1;return!this.orblock||i},o.prototype.retrigger=function(){this.runtime.execcount++;var t,e=this.runtime.getCurrentEventStack().cndindex,i=this.runtime.pushEventStack(this);if(!this.orblock)for(i.cndindex=e+1,t=this.conditions.length;i.cndindex<t;i.cndindex++)if(!this.conditions[i.cndindex].run())return this.runtime.popEventStack(),!1;return this.run_actions_and_subevents(),this.runtime.popEventStack(),!0},o.prototype.isFirstConditionOfType=function(t){var e=t.index;if(0===e)return!0;for(--e;e>=0;--e)if(this.conditions[e].type===t.type)return!1;return!0},cr.eventblock=o,h.prototype.postInit=function(){var t,e,i;for(t=0,e=this.parameters.length;t<e;t++)(i=this.parameters[t]).postInit(),i.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},h.prototype.run_true=function(){return!0},h.prototype.run_system=function(){var t,e;for(t=0,e=this.parameters.length;t<e;t++)this.results[t]=this.parameters[t].get();return cr.xor(this.func.apply(this.runtime.system,this.results),this.inverted)},h.prototype.run_static=function(){var t,e;for(t=0,e=this.parameters.length;t<e;t++)this.results[t]=this.parameters[t].get();var i=this.func.apply(this.behaviortype?this.behaviortype:this.type,this.results);return this.type.applySolToContainer(),i},h.prototype.run_object=function(){var t,e,i,r,n,s,o,a,h,c,l,u,p=this.type,d=p.getCurrentSol(),f=this.block.orblock&&!this.trigger,g=0,y=p.is_contained,m=p.is_family,_=p.family_index,v=this.beh_index,b=v>-1,w=this.anyParamVariesPerInstance,x=this.parameters,S=this.results,T=this.inverted,C=this.func;if(w)for(e=0,n=x.length;e<n;++e)(s=x[e]).variesPerInstance||(S[e]=s.get(0));else for(e=0,n=x.length;e<n;++e)S[e]=x[e].get(0);if(d.select_all){for(cr.clearArray(d.instances),cr.clearArray(d.else_instances),t=0,r=(l=p.instances).length;t<r;++t){if(a=l[t],w)for(e=0,n=x.length;e<n;++e)(s=x[e]).variesPerInstance&&(S[e]=s.get(t));b?(g=0,m&&(g=a.type.family_beh_map[_]),o=C.apply(a.behavior_insts[v+g],S)):o=C.apply(a,S),cr.xor(o,T)?d.instances.push(a):f&&d.else_instances.push(a)}return p.finish&&p.finish(!0),d.select_all=!1,p.applySolToContainer(),d.hasObjects()}i=0;var A=f&&!this.block.isFirstConditionOfType(this),O=!1;for(t=0,r=(l=A?d.else_instances:d.instances).length;t<r;++t){if(a=l[t],w)for(e=0,n=x.length;e<n;++e)(s=x[e]).variesPerInstance&&(S[e]=s.get(t));if(b?(g=0,m&&(g=a.type.family_beh_map[_]),o=C.apply(a.behavior_insts[v+g],S)):o=C.apply(a,S),cr.xor(o,T))if(O=!0,A){if(d.instances.push(a),y)for(e=0,n=a.siblings.length;e<n;e++)(h=a.siblings[e]).type.getCurrentSol().instances.push(h)}else{if(l[i]=a,y)for(e=0,n=a.siblings.length;e<n;e++)(h=a.siblings[e]).type.getCurrentSol().instances[i]=h;i++}else if(A){if(l[i]=a,y)for(e=0,n=a.siblings.length;e<n;e++)(h=a.siblings[e]).type.getCurrentSol().else_instances[i]=h;i++}else if(f&&(d.else_instances.push(a),y))for(e=0,n=a.siblings.length;e<n;e++)(h=a.siblings[e]).type.getCurrentSol().else_instances.push(h)}if(cr.truncateArray(l,i),y)for(t=0,r=(u=p.container).length;t<r;t++)c=u[t].getCurrentSol(),A?cr.truncateArray(c.else_instances,i):cr.truncateArray(c.instances,i);var E=O;if(A&&!O)for(t=0,r=d.instances.length;t<r;t++){if(a=d.instances[t],w)for(e=0,n=x.length;e<n;e++)(s=x[e]).variesPerInstance&&(S[e]=s.get(t));if(o=b?C.apply(a.behavior_insts[v],S):C.apply(a,S),cr.xor(o,T)){O=!0;break}}return p.finish&&p.finish(E||f),f?O:d.hasObjects()},cr.condition=h,c.prototype.postInit=function(){var t,e,i;for(t=0,e=this.parameters.length;t<e;t++)(i=this.parameters[t]).postInit(),i.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},c.prototype.run_system=function(){var t,e,i=this.runtime,r=this.parameters,n=this.results;for(t=0,e=r.length;t<e;++t)n[t]=r[t].get();return this.func.apply(i.system,n)},c.prototype.run_object=function(){var t,e,i,r,n,s,o,a=this.type,h=this.beh_index,c=a.family_index,l=this.anyParamVariesPerInstance,u=this.parameters,p=this.results,d=this.func,f=a.getCurrentSol().getObjects(),g=a.is_family,y=h>-1;if(l)for(e=0,r=u.length;e<r;++e)(n=u[e]).variesPerInstance||(p[e]=n.get(0));else for(e=0,r=u.length;e<r;++e)p[e]=u[e].get(0);for(t=0,i=f.length;t<i;++t){if(s=f[t],l)for(e=0,r=u.length;e<r;++e)(n=u[e]).variesPerInstance&&(p[e]=n.get(t));y?(o=0,g&&(o=s.type.family_beh_map[c]),d.apply(s.behavior_insts[h+o],p)):d.apply(s,p)}return!1},cr.action=c;var l=[],u=-1;function p(){return u++,l.length===u&&l.push(new cr.expvalue),l[u]}function d(){u--}function f(t,e){var i,r,n;switch(this.owner=t,this.block=t.block,this.sheet=t.sheet,this.runtime=t.runtime,this.type=e[0],this.expression=null,this.solindex=0,this.get=null,this.combosel=0,this.layout=null,this.key=0,this.object=null,this.index=0,this.varname=null,this.eventvar=null,this.fileinfo=null,this.subparams=null,this.variadicret=null,this.subparams=null,this.variadicret=null,this.variesPerInstance=!1,this.type){case 0:case 7:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_exp;break;case 1:case 14:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_exp_str,14===this.type&&(this.block.setAllSolModifiers(),this.owner instanceof cr.action&&this.block.setSolWriterAfterCnds());break;case 5:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_layer;break;case 3:case 8:this.combosel=e[1],this.get=this.get_combosel;break;case 16:this.combosel=e[1]?1:0,this.get=this.get_boolean;break;case 6:this.layout=this.runtime.layouts[e[1]],this.get=this.get_layout;break;case 9:this.key=e[1],this.get=this.get_key;break;case 4:this.object=this.runtime.types_by_index[e[1]],this.get=this.get_object,this.block.addSolModifier(this.object),this.owner instanceof cr.action?this.block.setSolWriterAfterCnds():this.block.parent&&this.block.parent.setSolWriterAfterCnds();break;case 10:this.index=e[1],t.type&&t.type.is_family?(this.get=this.get_familyvar,this.variesPerInstance=!0):this.get=this.get_instvar;break;case 11:this.varname=e[1],this.eventvar=null,this.get=this.get_eventvar;break;case 2:case 12:this.fileinfo=e[1],this.get=this.get_audiofile;break;case 13:for(this.get=this.get_variadic,this.subparams=[],this.variadicret=[],i=1,r=e.length;i<r;i++)n=new cr.parameter(this.owner,e[i]),cr.seal(n),this.subparams.push(n),this.variadicret.push(0)}}function g(t,e,i){this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.name=i[1],this.vartype=i[2],this.initial=i[3],this.is_static=!!i[4],this.is_constant=!!i[5],this.sid=i[6],this.runtime.varsBySid[this.sid.toString()]=this,this.data=this.initial,this.parent?(this.is_static||this.is_constant?this.localIndex=-1:this.localIndex=this.runtime.stackLocalCount++,this.runtime.all_local_vars.push(this)):(this.localIndex=-1,this.runtime.all_global_vars.push(this))}function y(t,e,i){this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.include_sheet=null,this.include_sheet_name=i[1],this.active=!0}function m(){this.temp_parents_arr=[],this.reset(null),cr.seal(this)}f.prototype.postInit=function(){var t,e;if(11===this.type)this.eventvar=this.runtime.getEventVariableByName(this.varname,this.block.parent);else if(13===this.type)for(t=0,e=this.subparams.length;t<e;t++)this.subparams[t].postInit();this.expression&&this.expression.postInit()},f.prototype.maybeVaryForType=function(t){this.variesPerInstance||t&&(t.plugin.singleglobal||(this.variesPerInstance=!0))},f.prototype.setVaries=function(){this.variesPerInstance=!0},f.prototype.get_exp=function(t){this.solindex=t||0;var e=p();return this.expression.get(e),d(),e.data},f.prototype.get_exp_str=function(t){this.solindex=t||0;var e=p();return this.expression.get(e),d(),cr.is_string(e.data)?e.data:""},f.prototype.get_object=function(){return this.object},f.prototype.get_combosel=function(){return this.combosel},f.prototype.get_boolean=function(){return!!this.combosel},f.prototype.get_layer=function(t){this.solindex=t||0;var e=p();return this.expression.get(e),d(),e.is_number()?this.runtime.getLayerByNumber(e.data):this.runtime.getLayerByName(e.data)},f.prototype.get_layout=function(){return this.layout},f.prototype.get_key=function(){return this.key},f.prototype.get_instvar=function(){return this.index},f.prototype.get_familyvar=function(t){var e=t||0,i=this.owner.type,r=null,n=i.getCurrentSol(),s=n.getObjects();if(s.length)r=s[e%s.length].type;else if(n.else_instances.length)r=n.else_instances[e%n.else_instances.length].type;else{if(!i.instances.length)return 0;r=i.instances[e%i.instances.length].type}return this.index+r.family_var_map[i.family_index]},f.prototype.get_eventvar=function(){return this.eventvar},f.prototype.get_audiofile=function(){return this.fileinfo},f.prototype.get_variadic=function(){var t,e;for(t=0,e=this.subparams.length;t<e;t++)this.variadicret[t]=this.subparams[t].get();return this.variadicret},cr.parameter=f,g.prototype.postInit=function(){this.solModifiers=r(this.solModifiers)},g.prototype.setValue=function(t){var e=this.runtime.getCurrentLocalVarStack();this.parent&&!this.is_static&&e?(this.localIndex>=e.length&&(e.length=this.localIndex+1),e[this.localIndex]=t):this.data=t},g.prototype.getValue=function(){var t=this.runtime.getCurrentLocalVarStack();return!this.parent||this.is_static||!t||this.is_constant?this.data:this.localIndex>=t.length||void 0===t[this.localIndex]?this.initial:t[this.localIndex]},g.prototype.run=function(){!this.parent||this.is_static||this.is_constant||this.setValue(this.initial)},cr.eventvariable=g,y.prototype.toString=function(){return"include:"+this.include_sheet.toString()},y.prototype.postInit=function(){this.include_sheet=this.runtime.eventsheets[this.include_sheet_name],this.sheet.includes.add(this),this.solModifiers=r(this.solModifiers);for(var t=this.parent;t;)t.group&&t.contained_includes.push(this),t=t.parent;this.updateActive()},y.prototype.run=function(){this.parent&&this.runtime.pushCleanSol(this.runtime.types_by_index),this.include_sheet.hasRun||this.include_sheet.run(!0),this.parent&&this.runtime.popSol(this.runtime.types_by_index)},y.prototype.updateActive=function(){for(var t=this.parent;t;){if(t.group&&!t.group_active)return void(this.active=!1);t=t.parent}this.active=!0},y.prototype.isActive=function(){return this.active},cr.eventinclude=y,m.prototype.reset=function(t){this.current_event=t,this.cndindex=0,this.actindex=0,cr.clearArray(this.temp_parents_arr),this.last_event_true=!1,this.else_branch_ran=!1,this.any_true_state=!1},m.prototype.isModifierAfterCnds=function(){return!!this.current_event.solWriterAfterCnds||this.cndindex<this.current_event.conditions.length-1&&!!this.current_event.solModifiers.length},cr.eventStackFrame=m}(),function(){function t(t,e){this.owner=t,this.runtime=t.runtime,this.type=e[0],this.get=[this.eval_int,this.eval_float,this.eval_string,this.eval_unaryminus,this.eval_add,this.eval_subtract,this.eval_multiply,this.eval_divide,this.eval_mod,this.eval_power,this.eval_and,this.eval_or,this.eval_equal,this.eval_notequal,this.eval_less,this.eval_lessequal,this.eval_greater,this.eval_greaterequal,this.eval_conditional,this.eval_system_exp,this.eval_object_exp,this.eval_instvar_exp,this.eval_behavior_exp,this.eval_eventvar_exp][this.type];var i,r,n=null;switch(this.value=null,this.first=null,this.second=null,this.third=null,this.func=null,this.results=null,this.parameters=null,this.object_type=null,this.beh_index=-1,this.instance_expr=null,this.varindex=-1,this.behavior_type=null,this.varname=null,this.eventvar=null,this.return_string=!1,this.type){case 0:case 1:case 2:this.value=e[1];break;case 3:this.first=new cr.expNode(t,e[1]);break;case 18:this.first=new cr.expNode(t,e[1]),this.second=new cr.expNode(t,e[2]),this.third=new cr.expNode(t,e[3]);break;case 19:this.func=this.runtime.GetObjectReference(e[1]),this.func!==cr.system_object.prototype.exps.random&&this.func!==cr.system_object.prototype.exps.choose||this.owner.setVaries(),this.results=[],this.parameters=[],3===e.length?(n=e[2],this.results.length=n.length+1):this.results.length=1;break;case 20:this.object_type=this.runtime.types_by_index[e[1]],this.beh_index=-1,this.func=this.runtime.GetObjectReference(e[2]),this.return_string=e[3],cr.plugins_.Function&&this.func===cr.plugins_.Function.prototype.exps.Call&&this.owner.setVaries(),e[4]?this.instance_expr=new cr.expNode(t,e[4]):this.instance_expr=null,this.results=[],this.parameters=[],6===e.length?(n=e[5],this.results.length=n.length+1):this.results.length=1;break;case 21:this.object_type=this.runtime.types_by_index[e[1]],this.return_string=e[2],e[3]?this.instance_expr=new cr.expNode(t,e[3]):this.instance_expr=null,this.varindex=e[4];break;case 22:this.object_type=this.runtime.types_by_index[e[1]],this.behavior_type=this.object_type.getBehaviorByName(e[2]),this.beh_index=this.object_type.getBehaviorIndexByName(e[2]),this.func=this.runtime.GetObjectReference(e[3]),this.return_string=e[4],e[5]?this.instance_expr=new cr.expNode(t,e[5]):this.instance_expr=null,this.results=[],this.parameters=[],7===e.length?(n=e[6],this.results.length=n.length+1):this.results.length=1;break;case 23:this.varname=e[1],this.eventvar=null}if(this.owner.maybeVaryForType(this.object_type),this.type>=4&&this.type<=17&&(this.first=new cr.expNode(t,e[1]),this.second=new cr.expNode(t,e[2])),n)for(i=0,r=n.length;i<r;i++)this.parameters.push(new cr.expNode(t,n[i]));cr.seal(this)}t.prototype.postInit=function(){var t,e;if(23===this.type&&(this.eventvar=this.owner.runtime.getEventVariableByName(this.varname,this.owner.block.parent)),this.first&&this.first.postInit(),this.second&&this.second.postInit(),this.third&&this.third.postInit(),this.instance_expr&&this.instance_expr.postInit(),this.parameters)for(t=0,e=this.parameters.length;t<e;t++)this.parameters[t].postInit()};var e=[],i=-1;function r(){return++i,e.length===i&&e.push(new cr.expvalue),e[i]}function n(){--i}function s(t,e,i){var r,n;for(r=0,n=t.length;r<n;++r)t[r].get(i),e[r+1]=i.data}function o(t,e){this.type=t||cr.exptype.Integer,this.data=e||0,this.object_class=null,this.type==cr.exptype.Integer&&(this.data=Math.floor(this.data)),cr.seal(this)}t.prototype.eval_system_exp=function(t){var e=this.parameters,i=this.results;i[0]=t,s(e,i,r()),n(),this.func.apply(this.runtime.system,i)},t.prototype.eval_object_exp=function(t){var e=this.object_type,i=this.results,o=this.parameters,a=this.instance_expr,h=this.func,c=this.owner.solindex,l=e.getCurrentSol(),u=l.getObjects();if(!u.length){if(!l.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));u=l.else_instances}i[0]=t,t.object_class=e;var p=r();s(o,i,p),a&&(a.get(p),p.is_number()&&(c=p.data,u=e.instances)),n();var d=u.length;(c>=d||c<=-d)&&(c%=d),c<0&&(c+=d);h.apply(u[c],i)},t.prototype.eval_behavior_exp=function(t){var e=this.object_type,i=this.results,o=this.parameters,a=this.instance_expr,h=this.beh_index,c=this.func,l=this.owner.solindex,u=e.getCurrentSol(),p=u.getObjects();if(!p.length){if(!u.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));p=u.else_instances}i[0]=t,t.object_class=e;var d=r();s(o,i,d),a&&(a.get(d),d.is_number()&&(l=d.data,p=e.instances)),n();var f=p.length;(l>=f||l<=-f)&&(l%=f),l<0&&(l+=f);var g=p[l],y=0;e.is_family&&(y=g.type.family_beh_map[e.family_index]);c.apply(g.behavior_insts[h+y],i)},t.prototype.eval_instvar_exp=function(t){var e,i=this.instance_expr,s=this.object_type,o=this.varindex,a=this.owner.solindex,h=s.getCurrentSol(),c=h.getObjects();if(!c.length){if(!h.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));c=h.else_instances}if(i){var l=r();if(i.get(l),l.is_number()){a=l.data;var u=s.instances;0!==u.length&&(a%=u.length)<0&&(a+=u.length);var p=(e=s.getInstanceByIID(a)).instance_vars[o];return cr.is_string(p)?t.set_string(p):t.set_float(p),void n()}n()}var d=c.length;(a>=d||a<=-d)&&(a%=d),a<0&&(a+=d),e=c[a];var f=0;s.is_family&&(f=e.type.family_var_map[s.family_index]);p=e.instance_vars[o+f];cr.is_string(p)?t.set_string(p):t.set_float(p)},t.prototype.eval_int=function(t){t.type=cr.exptype.Integer,t.data=this.value},t.prototype.eval_float=function(t){t.type=cr.exptype.Float,t.data=this.value},t.prototype.eval_string=function(t){t.type=cr.exptype.String,t.data=this.value},t.prototype.eval_unaryminus=function(t){this.first.get(t),t.is_number()&&(t.data=-t.data)},t.prototype.eval_add=function(t){this.first.get(t);var e=r();this.second.get(e),t.is_number()&&e.is_number()&&(t.data+=e.data,e.is_float()&&t.make_float()),n()},t.prototype.eval_subtract=function(t){this.first.get(t);var e=r();this.second.get(e),t.is_number()&&e.is_number()&&(t.data-=e.data,e.is_float()&&t.make_float()),n()},t.prototype.eval_multiply=function(t){this.first.get(t);var e=r();this.second.get(e),t.is_number()&&e.is_number()&&(t.data*=e.data,e.is_float()&&t.make_float()),n()},t.prototype.eval_divide=function(t){this.first.get(t);var e=r();this.second.get(e),t.is_number()&&e.is_number()&&(t.data/=e.data,t.make_float()),n()},t.prototype.eval_mod=function(t){this.first.get(t);var e=r();this.second.get(e),t.is_number()&&e.is_number()&&(t.data%=e.data,e.is_float()&&t.make_float()),n()},t.prototype.eval_power=function(t){this.first.get(t);var e=r();this.second.get(e),t.is_number()&&e.is_number()&&(t.data=Math.pow(t.data,e.data),e.is_float()&&t.make_float()),n()},t.prototype.eval_and=function(t){this.first.get(t);var e=r();this.second.get(e),e.is_string()||t.is_string()?this.eval_and_stringconcat(t,e):this.eval_and_logical(t,e),n()},t.prototype.eval_and_stringconcat=function(t,e){t.is_string()&&e.is_string()?this.eval_and_stringconcat_str_str(t,e):this.eval_and_stringconcat_num(t,e)},t.prototype.eval_and_stringconcat_str_str=function(t,e){t.data+=e.data},t.prototype.eval_and_stringconcat_num=function(t,e){t.is_string()?t.data+=(Math.round(1e10*e.data)/1e10).toString():t.set_string(t.data.toString()+e.data)},t.prototype.eval_and_logical=function(t,e){t.set_int(t.data&&e.data?1:0)},t.prototype.eval_or=function(t){this.first.get(t);var e=r();this.second.get(e),t.is_number()&&e.is_number()&&(t.data||e.data?t.set_int(1):t.set_int(0)),n()},t.prototype.eval_conditional=function(t){this.first.get(t),t.data?this.second.get(t):this.third.get(t)},t.prototype.eval_equal=function(t){this.first.get(t);var e=r();this.second.get(e),t.set_int(t.data===e.data?1:0),n()},t.prototype.eval_notequal=function(t){this.first.get(t);var e=r();this.second.get(e),t.set_int(t.data!==e.data?1:0),n()},t.prototype.eval_less=function(t){this.first.get(t);var e=r();this.second.get(e),t.set_int(t.data<e.data?1:0),n()},t.prototype.eval_lessequal=function(t){this.first.get(t);var e=r();this.second.get(e),t.set_int(t.data<=e.data?1:0),n()},t.prototype.eval_greater=function(t){this.first.get(t);var e=r();this.second.get(e),t.set_int(t.data>e.data?1:0),n()},t.prototype.eval_greaterequal=function(t){this.first.get(t);var e=r();this.second.get(e),t.set_int(t.data>=e.data?1:0),n()},t.prototype.eval_eventvar_exp=function(t){var e=this.eventvar.getValue();"number"==typeof e?t.set_float(e):"boolean"==typeof e?t.set_int(e?1:0):t.set_string(e)},cr.expNode=t,o.prototype.is_int=function(){return this.type===cr.exptype.Integer},o.prototype.is_float=function(){return this.type===cr.exptype.Float},o.prototype.is_number=function(){return this.type===cr.exptype.Integer||this.type===cr.exptype.Float},o.prototype.is_string=function(){return this.type===cr.exptype.String},o.prototype.make_int=function(){this.is_int()||(this.is_float()?this.data=Math.floor(this.data):this.is_string()&&(this.data=parseInt(this.data,10)),this.type=cr.exptype.Integer)},o.prototype.make_float=function(){this.is_float()||(this.is_string()&&(this.data=parseFloat(this.data)),this.type=cr.exptype.Float)},o.prototype.make_string=function(){this.is_string()||(this.data=this.data.toString(),this.type=cr.exptype.String)},o.prototype.set_int=function(t){this.type=cr.exptype.Integer,this.data=Math.floor(t)},o.prototype.set_float=function(t){this.type=cr.exptype.Float,this.data=t},o.prototype.set_string=function(t){this.type=cr.exptype.String,this.data=t},o.prototype.set_any=function(t){cr.is_number(t)?(this.type=cr.exptype.Float,this.data=t):cr.is_string(t)?(this.type=cr.exptype.String,this.data=t.toString()):(this.type=cr.exptype.Integer,this.data=0)},cr.expvalue=o,cr.exptype={Integer:0,Float:1,String:2}}(),cr.system_object=function(t){this.runtime=t,this.waits=[]},cr.system_object.prototype.saveToJSON=function(){var t,e,i,r,n,s,o,a,h={};h.waits=[];var c,l=h.waits;for(t=0,e=this.waits.length;t<e;t++){for(c={t:(s=this.waits[t]).time,st:s.signaltag,s:s.signalled,ev:s.ev.sid,sm:[],sols:{}},s.ev.actions[s.actindex]&&(c.act=s.ev.actions[s.actindex].sid),i=0,r=s.solModifiers.length;i<r;i++)c.sm.push(s.solModifiers[i].sid);for(n in s.sols)if(s.sols.hasOwnProperty(n)){for(o=this.runtime.types_by_index[parseInt(n,10)],a={sa:s.sols[n].sa,insts:[]},i=0,r=s.sols[n].insts.length;i<r;i++)a.insts.push(s.sols[n].insts[i].uid);c.sols[o.sid.toString()]=a}l.push(c)}return h},cr.system_object.prototype.loadFromJSON=function(t){var e,i,r,n,s,o,a,h,c,l,u,p,d,f=t.waits;for(cr.clearArray(this.waits),e=0,i=f.length;e<i;e++)if(o=f[e],h=this.runtime.blocksBySid[o.ev.toString()]){for(c=-1,r=0,n=h.actions.length;r<n;r++)if(h.actions[r].sid===o.act){c=r;break}if(-1!==c){for((a={}).sols={},a.solModifiers=[],a.deleteme=!1,a.time=o.t,a.signaltag=o.st||"",a.signalled=!!o.s,a.ev=h,a.actindex=c,r=0,n=o.sm.length;r<n;r++)(l=this.runtime.getObjectTypeBySid(o.sm[r]))&&a.solModifiers.push(l);for(s in o.sols)if(o.sols.hasOwnProperty(s)){if(!(l=this.runtime.getObjectTypeBySid(parseInt(s,10))))continue;for(p={sa:(u=o.sols[s]).sa,insts:[]},r=0,n=u.insts.length;r<n;r++)(d=this.runtime.getObjectByUID(u.insts[r]))&&p.insts.push(d);a.sols[l.index.toString()]=p}this.waits.push(a)}}},function(){var t=cr.system_object.prototype;function e(){}e.prototype.EveryTick=function(){return!0},e.prototype.OnLayoutStart=function(){return!0},e.prototype.OnLayoutEnd=function(){return!0},e.prototype.Compare=function(t,e,i){return cr.do_cmp(t,e,i)},e.prototype.CompareTime=function(t,e){var i=this.runtime.kahanTime.sum;if(0===t){var r=this.runtime.getCurrentCondition();return!r.extra.CompareTime_executed&&i>=e&&(r.extra.CompareTime_executed=!0,!0)}return cr.do_cmp(i,t,e)},e.prototype.LayerVisible=function(t){return!!t&&t.visible},e.prototype.LayerEmpty=function(t){return!!t&&!t.instances.length},e.prototype.LayerCmpOpacity=function(t,e,i){return!!t&&cr.do_cmp(100*t.opacity,e,i)},e.prototype.Repeat=function(t){var e,i=this.runtime.getCurrentEventStack(),r=i.current_event,n=i.isModifierAfterCnds(),s=this.runtime.pushLoopStack();if(n)for(e=0;e<t&&!s.stopped;e++)this.runtime.pushCopySol(r.solModifiers),s.index=e,r.retrigger(),this.runtime.popSol(r.solModifiers);else for(e=0;e<t&&!s.stopped;e++)s.index=e,r.retrigger();return this.runtime.popLoopStack(),!1},e.prototype.While=function(t){var e,i=this.runtime.getCurrentEventStack(),r=i.current_event,n=i.isModifierAfterCnds(),s=this.runtime.pushLoopStack();if(n)for(e=0;!s.stopped;e++)this.runtime.pushCopySol(r.solModifiers),s.index=e,r.retrigger()||(s.stopped=!0),this.runtime.popSol(r.solModifiers);else for(e=0;!s.stopped;e++)s.index=e,r.retrigger()||(s.stopped=!0);return this.runtime.popLoopStack(),!1},e.prototype.For=function(t,e,i){var r,n=this.runtime.getCurrentEventStack(),s=n.current_event,o=n.isModifierAfterCnds(),a=this.runtime.pushLoopStack(t);if(i<e)if(o)for(r=e;r>=i&&!a.stopped;--r)this.runtime.pushCopySol(s.solModifiers),a.index=r,s.retrigger(),this.runtime.popSol(s.solModifiers);else for(r=e;r>=i&&!a.stopped;--r)a.index=r,s.retrigger();else if(o)for(r=e;r<=i&&!a.stopped;++r)this.runtime.pushCopySol(s.solModifiers),a.index=r,s.retrigger(),this.runtime.popSol(s.solModifiers);else for(r=e;r<=i&&!a.stopped;++r)a.index=r,s.retrigger();return this.runtime.popLoopStack(),!1};var i=[],r=-1;function n(t,e){var i=t.extra.c2_feo_val,r=e.extra.c2_feo_val;return cr.is_number(i)&&cr.is_number(r)?i-r:(i=""+i)<(r=""+r)?-1:i>r?1:0}e.prototype.ForEach=function(t){var e=t.getCurrentSol();r++,i.length===r&&i.push([]);var n=i[r];cr.shallowAssignArray(n,e.getObjects());var s,o,a,h,c,l,u,p=this.runtime.getCurrentEventStack(),d=p.current_event,f=p.isModifierAfterCnds(),g=this.runtime.pushLoopStack(),y=t.is_contained;if(f)for(s=0,o=n.length;s<o&&!g.stopped;s++){if(this.runtime.pushCopySol(d.solModifiers),c=n[s],(e=t.getCurrentSol()).select_all=!1,cr.clearArray(e.instances),e.instances[0]=c,y)for(a=0,h=c.siblings.length;a<h;a++)(u=(l=c.siblings[a]).type.getCurrentSol()).select_all=!1,cr.clearArray(u.instances),u.instances[0]=l;g.index=s,d.retrigger(),this.runtime.popSol(d.solModifiers)}else for(e.select_all=!1,cr.clearArray(e.instances),s=0,o=n.length;s<o&&!g.stopped;s++){if(c=n[s],e.instances[0]=c,y)for(a=0,h=c.siblings.length;a<h;a++)(u=(l=c.siblings[a]).type.getCurrentSol()).select_all=!1,cr.clearArray(u.instances),u.instances[0]=l;g.index=s,d.retrigger()}return cr.clearArray(n),this.runtime.popLoopStack(),r--,!1},e.prototype.ForEachOrdered=function(t,e,s){var o=t.getCurrentSol();r++,i.length===r&&i.push([]);var a=i[r];cr.shallowAssignArray(a,o.getObjects());var h,c,l,u,p,d,f,g=this.runtime.getCurrentEventStack(),y=g.current_event,m=this.runtime.getCurrentCondition(),_=g.isModifierAfterCnds(),v=this.runtime.pushLoopStack();for(h=0,c=a.length;h<c;h++)a[h].extra.c2_feo_val=m.parameters[1].get(h);a.sort(n),1===s&&a.reverse();var b=t.is_contained;if(_)for(h=0,c=a.length;h<c&&!v.stopped;h++){if(this.runtime.pushCopySol(y.solModifiers),p=a[h],(o=t.getCurrentSol()).select_all=!1,cr.clearArray(o.instances),o.instances[0]=p,b)for(l=0,u=p.siblings.length;l<u;l++)(f=(d=p.siblings[l]).type.getCurrentSol()).select_all=!1,cr.clearArray(f.instances),f.instances[0]=d;v.index=h,y.retrigger(),this.runtime.popSol(y.solModifiers)}else for(o.select_all=!1,cr.clearArray(o.instances),h=0,c=a.length;h<c&&!v.stopped;h++){if(p=a[h],o.instances[0]=p,b)for(l=0,u=p.siblings.length;l<u;l++)(f=(d=p.siblings[l]).type.getCurrentSol()).select_all=!1,cr.clearArray(f.instances),f.instances[0]=d;v.index=h,y.retrigger()}return cr.clearArray(a),this.runtime.popLoopStack(),r--,!1},e.prototype.PickByComparison=function(t,e,n,s){var o,a,h,c;if(t){r++,i.length===r&&i.push([]);var l=i[r],u=t.getCurrentSol();cr.shallowAssignArray(l,u.getObjects()),u.select_all&&cr.clearArray(u.else_instances);var p=this.runtime.getCurrentCondition();for(o=0,h=0,a=l.length;o<a;o++)c=l[o],l[h]=c,e=p.parameters[1].get(o),s=p.parameters[3].get(o),cr.do_cmp(e,n,s)?h++:u.else_instances.push(c);return cr.truncateArray(l,h),u.select_all=!1,cr.shallowAssignArray(u.instances,l),cr.clearArray(l),r--,t.applySolToContainer(),!!u.instances.length}},e.prototype.PickByEvaluate=function(t,e){var n,s,o,a;if(t){r++,i.length===r&&i.push([]);var h=i[r],c=t.getCurrentSol();cr.shallowAssignArray(h,c.getObjects()),c.select_all&&cr.clearArray(c.else_instances);var l=this.runtime.getCurrentCondition();for(n=0,o=0,s=h.length;n<s;n++)a=h[n],h[o]=a,l.parameters[1].get(n)?o++:c.else_instances.push(a);return cr.truncateArray(h,o),c.select_all=!1,cr.shallowAssignArray(c.instances,h),cr.clearArray(h),r--,t.applySolToContainer(),!!c.instances.length}},e.prototype.TriggerOnce=function(){var t=this.runtime.getCurrentCondition().extra;void 0===t.TriggerOnce_lastTick&&(t.TriggerOnce_lastTick=-1);var e=t.TriggerOnce_lastTick,i=this.runtime.tickcount;return t.TriggerOnce_lastTick=i,this.runtime.layout_first_tick||e!==i-1},e.prototype.Every=function(t){var e=this.runtime.getCurrentCondition(),i=e.extra.Every_lastTime||0,r=this.runtime.kahanTime.sum;void 0===e.extra.Every_seconds&&(e.extra.Every_seconds=t);var n=e.extra.Every_seconds;return r>=i+n?(e.extra.Every_lastTime=i+n,r>=e.extra.Every_lastTime+.04&&(e.extra.Every_lastTime=r),e.extra.Every_seconds=t,!0):(r<i-.1&&(e.extra.Every_lastTime=r),!1)},e.prototype.PickNth=function(t,e){if(!t)return!1;var i=t.getCurrentSol(),r=i.getObjects();if((e=cr.floor(e))<0||e>=r.length)return!1;var n=r[e];return i.pick_one(n),t.applySolToContainer(),!0},e.prototype.PickRandom=function(t){if(!t)return!1;var e=t.getCurrentSol(),i=e.getObjects(),r=cr.floor(Math.random()*i.length);if(r>=i.length)return!1;var n=i[r];return e.pick_one(n),t.applySolToContainer(),!0},e.prototype.CompareVar=function(t,e,i){return cr.do_cmp(t.getValue(),e,i)},e.prototype.CompareBoolVar=function(t){return t.getValue()},e.prototype.IsGroupActive=function(t){var e=this.runtime.groups_by_name[t.toLowerCase()];return e&&e.group_active},e.prototype.IsPreview=function(){return this.runtime.isPreview},e.prototype.PickAll=function(t){return!!t&&(!!t.instances.length&&(t.getCurrentSol().select_all=!0,t.applySolToContainer(),!0))},e.prototype.IsMobile=function(){return this.runtime.isMobile},e.prototype.CompareBetween=function(t,e,i){return t>=e&&t<=i},e.prototype.Else=function(){var t=this.runtime.getCurrentEventStack();return!t.else_branch_ran&&!t.last_event_true},e.prototype.OnLoadFinished=function(){return!0},e.prototype.OnCanvasSnapshot=function(){return!0},e.prototype.EffectsSupported=function(){return!!this.runtime.glwrap},e.prototype.OnSaveComplete=function(){return!0},e.prototype.OnSaveFailed=function(){return!0},e.prototype.OnLoadComplete=function(){return!0},e.prototype.OnLoadFailed=function(){return!0},e.prototype.ObjectUIDExists=function(t){return!!this.runtime.getObjectByUID(t)},e.prototype.IsOnPlatform=function(t){var e=this.runtime;switch(t){case 0:return!(e.isNodeWebkit||e.isCordova||e.isWinJS||e.isWindowsPhone8||e.isBlackberry10||e.isAmazonWebApp);case 1:return e.isiOS;case 2:return e.isAndroid;case 3:return e.isWindows8App;case 4:return e.isWindowsPhone8;case 5:return e.isBlackberry10;case 6:return e.isTizen;case 7:default:return!1;case 8:return e.isCordova;case 9:return e.isArcade;case 10:return e.isNodeWebkit;case 11:return e.isCrosswalk;case 12:return e.isAmazonWebApp;case 13:return e.isWindows10}};var s=null,o="",a="";function h(t,e){return s&&t===o&&e===a||(s=new RegExp(t,e),o=t,a=e),s.lastIndex=0,s}e.prototype.RegexTest=function(t,e,i){return h(e,i).test(t)};var c=[];function l(){}e.prototype.PickOverlappingPoint=function(t,e,i){if(!t)return!1;var r,n,s,o=t.getCurrentSol(),a=o.getObjects(),h=this.runtime.getCurrentEventStack().current_event.orblock,l=this.runtime.getCurrentCondition();for(o.select_all?(cr.shallowAssignArray(c,a),cr.clearArray(o.else_instances),o.select_all=!1,cr.clearArray(o.instances)):h?(cr.shallowAssignArray(c,o.else_instances),cr.clearArray(o.else_instances)):(cr.shallowAssignArray(c,a),cr.clearArray(o.instances)),r=0,n=c.length;r<n;++r)(s=c[r]).update_bbox(),cr.xor(s.contains_pt(e,i),l.inverted)?o.instances.push(s):o.else_instances.push(s);return t.applySolToContainer(),cr.xor(!!o.instances.length,l.inverted)},e.prototype.PickLastCreated=function(t){if(!t)return!1;var e,i,r=this.runtime.createRow,n=null,s=t.is_family;for(e=r.length-1;e>=0;--e)if(i=r[e],s){if(i.type.families.indexOf(t)>=0){n=i;break}}else if(i.type===t){n=i;break}return!n&&t.instances.length&&(n=t.instances[t.instances.length-1]),!!n&&(t.getCurrentSol().pick_one(n),t.applySolToContainer(),!0)},e.prototype.IsNaN=function(t){return!!isNaN(t)},e.prototype.AngleWithin=function(t,e,i){return cr.angleDiff(cr.to_radians(t),cr.to_radians(i))<=cr.to_radians(e)},e.prototype.IsClockwiseFrom=function(t,e){return cr.angleClockwise(cr.to_radians(t),cr.to_radians(e))},e.prototype.IsBetweenAngles=function(t,e,i){var r=cr.to_clamped_radians(t),n=cr.to_clamped_radians(e),s=cr.to_clamped_radians(i);return!cr.angleClockwise(s,n)?!(!cr.angleClockwise(r,n)&&cr.angleClockwise(r,s)):cr.angleClockwise(r,n)&&!cr.angleClockwise(r,s)},e.prototype.IsValueType=function(t,e){return"number"==typeof t?0===e:1===e},t.cnds=new e,l.prototype.GoToLayout=function(t){this.runtime.isloading||this.runtime.changelayout||(this.runtime.changelayout=t)},l.prototype.NextPrevLayout=function(t){if(!this.runtime.isloading&&!this.runtime.changelayout){var e=this.runtime.layouts_by_index.indexOf(this.runtime.running_layout);if((!t||0!==e)&&(t||e!==this.runtime.layouts_by_index.length-1)){var i=this.runtime.layouts_by_index[e+(t?-1:1)];this.runtime.changelayout=i}}},l.prototype.CreateObject=function(t,e,i,r){if(e&&t){var n=this.runtime.createInstance(t,e,i,r);if(n){var s,o,a;if(this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(t.plugin).cnds.OnCreated,n),n.is_contained)for(s=0,o=n.siblings.length;s<o;s++)a=n.siblings[s],this.runtime.trigger(Object.getPrototypeOf(a.type.plugin).cnds.OnCreated,a);this.runtime.isInOnDestroy--;var h=t.getCurrentSol();if(h.select_all=!1,cr.clearArray(h.instances),h.instances[0]=n,n.is_contained)for(s=0,o=n.siblings.length;s<o;s++)(h=(a=n.siblings[s]).type.getCurrentSol()).select_all=!1,cr.clearArray(h.instances),h.instances[0]=a}}},l.prototype.CreateObjectByName=function(t,e,i,r){if(e&&t){var n=this.runtime.types_lowercase[t.toLowerCase()];n&&l.prototype.CreateObject.call(this,n,e,i,r)}},l.prototype.SetLayerVisible=function(t,e){t&&t.visible!==e&&(t.visible=e,this.runtime.redraw=!0)},l.prototype.SetLayerOpacity=function(t,e){t&&(e=cr.clamp(e/100,0,1),t.opacity!==e&&(t.opacity=e,this.runtime.redraw=!0))},l.prototype.SetLayerScaleRate=function(t,e){t&&t.zoomRate!==e&&(t.zoomRate=e,this.runtime.redraw=!0)},l.prototype.SetLayerForceOwnTexture=function(t,e){t&&(e=!!e,t.forceOwnTexture!==e&&(t.forceOwnTexture=e,this.runtime.redraw=!0))},l.prototype.SetLayoutScale=function(t){this.runtime.running_layout&&this.runtime.running_layout.scale!==t&&(this.runtime.running_layout.scale=t,this.runtime.running_layout.boundScrolling(),this.runtime.redraw=!0)},l.prototype.ScrollX=function(t){this.runtime.running_layout.scrollToX(t)},l.prototype.ScrollY=function(t){this.runtime.running_layout.scrollToY(t)},l.prototype.Scroll=function(t,e){this.runtime.running_layout.scrollToX(t),this.runtime.running_layout.scrollToY(e)},l.prototype.ScrollToObject=function(t){var e=t.getFirstPicked();e&&(this.runtime.running_layout.scrollToX(e.x),this.runtime.running_layout.scrollToY(e.y))},l.prototype.SetVar=function(t,e){0===t.vartype?cr.is_number(e)?t.setValue(e):t.setValue(parseFloat(e)):1===t.vartype&&t.setValue(e.toString())},l.prototype.AddVar=function(t,e){0===t.vartype?cr.is_number(e)?t.setValue(t.getValue()+e):t.setValue(t.getValue()+parseFloat(e)):1===t.vartype&&t.setValue(t.getValue()+e.toString())},l.prototype.SubVar=function(t,e){0===t.vartype&&(cr.is_number(e)?t.setValue(t.getValue()-e):t.setValue(t.getValue()-parseFloat(e)))},l.prototype.SetBoolVar=function(t,e){t.setValue(0!==e)},l.prototype.ToggleBoolVar=function(t){t.setValue(!t.getValue())},l.prototype.SetGroupActive=function(t,e){var i=this.runtime.groups_by_name[t.toLowerCase()];if(i)switch(e){case 0:i.setGroupActive(!1);break;case 1:i.setGroupActive(!0);break;case 2:i.setGroupActive(!i.group_active)}},l.prototype.SetTimescale=function(t){var e=t;e<0&&(e=0),this.runtime.timescale=e},l.prototype.SetObjectTimescale=function(t,e){var i=e;if(i<0&&(i=0),t){var r,n,s=t.getCurrentSol().getObjects();for(r=0,n=s.length;r<n;r++)s[r].my_timescale=i}},l.prototype.RestoreObjectTimescale=function(t){if(!t)return!1;var e,i,r=t.getCurrentSol().getObjects();for(e=0,i=r.length;e<i;e++)r[e].my_timescale=-1};var u=[];function p(){var t;return u.length?t=u.pop():((t={}).sols={},t.solModifiers=[]),t.deleteme=!1,t}function d(t){cr.wipe(t.sols),cr.clearArray(t.solModifiers),u.push(t)}var f=[];function g(){var t;return f.length?t=f.pop():(t={}).insts=[],t.sa=!1,t}function y(t){cr.clearArray(t.insts),f.push(t)}function m(t,e){var i=t[0]-e[0];return 0!==i?i:t[1]-e[1]}function _(t,e){return t[1]-e[1]}function v(){}l.prototype.Wait=function(t){if(!(t<0)){var e,i,r,n,s,o=this.runtime.getCurrentEventStack(),a=p();for(a.time=this.runtime.kahanTime.sum+t,a.signaltag="",a.signalled=!1,a.ev=o.current_event,a.actindex=o.actindex+1,e=0,i=this.runtime.types_by_index.length;e<i;e++)(r=(n=this.runtime.types_by_index[e]).getCurrentSol()).select_all&&-1===o.current_event.solModifiers.indexOf(n)||(a.solModifiers.push(n),(s=g()).sa=r.select_all,cr.shallowAssignArray(s.insts,r.instances),a.sols[e.toString()]=s);return this.waits.push(a),!0}},l.prototype.WaitForSignal=function(t){var e,i,r,n,s,o=this.runtime.getCurrentEventStack(),a=p();for(a.time=-1,a.signaltag=t.toLowerCase(),a.signalled=!1,a.ev=o.current_event,a.actindex=o.actindex+1,e=0,i=this.runtime.types_by_index.length;e<i;e++)(r=(n=this.runtime.types_by_index[e]).getCurrentSol()).select_all&&-1===o.current_event.solModifiers.indexOf(n)||(a.solModifiers.push(n),(s=g()).sa=r.select_all,cr.shallowAssignArray(s.insts,r.instances),a.sols[e.toString()]=s);return this.waits.push(a),!0},l.prototype.Signal=function(t){var e,i,r,n=t.toLowerCase();for(e=0,i=this.waits.length;e<i;++e)-1===(r=this.waits[e]).time&&r.signaltag===n&&(r.signalled=!0)},l.prototype.SetLayerScale=function(t,e){t&&t.scale!==e&&(t.scale=e,this.runtime.redraw=!0)},l.prototype.ResetGlobals=function(){var t,e,i;for(t=0,e=this.runtime.all_global_vars.length;t<e;t++)(i=this.runtime.all_global_vars[t]).data=i.initial},l.prototype.SetLayoutAngle=function(t){t=cr.to_radians(t),t=cr.clamp_angle(t),this.runtime.running_layout&&this.runtime.running_layout.angle!==t&&(this.runtime.running_layout.angle=t,this.runtime.redraw=!0)},l.prototype.SetLayerAngle=function(t,e){t&&(e=cr.to_radians(e),e=cr.clamp_angle(e),t.angle!==e&&(t.angle=e,this.runtime.redraw=!0))},l.prototype.SetLayerParallax=function(t,e,i){if(t&&(t.parallaxX!==e/100||t.parallaxY!==i/100)){if(t.parallaxX=e/100,t.parallaxY=i/100,1!==t.parallaxX||1!==t.parallaxY){var r,n,s=t.instances;for(r=0,n=s.length;r<n;++r)s[r].type.any_instance_parallaxed=!0}this.runtime.redraw=!0}},l.prototype.SetLayerBackground=function(t,e){if(t){var i=cr.clamp(Math.floor(255*cr.GetRValue(e)),0,255),r=cr.clamp(Math.floor(255*cr.GetGValue(e)),0,255),n=cr.clamp(Math.floor(255*cr.GetBValue(e)),0,255);t.background_color[0]===i&&t.background_color[1]===r&&t.background_color[2]===n||(t.background_color[0]=i,t.background_color[1]=r,t.background_color[2]=n,this.runtime.redraw=!0)}},l.prototype.SetLayerTransparent=function(t,e){t&&!!e!=!!t.transparent&&(t.transparent=!!e,this.runtime.redraw=!0)},l.prototype.SetLayerBlendMode=function(t,e){t&&t.blend_mode!==e&&(t.blend_mode=e,t.compositeOp=cr.effectToCompositeOp(t.blend_mode),this.runtime.gl&&cr.setGLBlend(t,t.blend_mode,this.runtime.gl),this.runtime.redraw=!0)},l.prototype.StopLoop=function(){this.runtime.loop_stack_index<0||(this.runtime.getCurrentLoop().stopped=!0)},l.prototype.GoToLayoutByName=function(t){var e;if(!this.runtime.isloading&&!this.runtime.changelayout)for(e in this.runtime.layouts)if(this.runtime.layouts.hasOwnProperty(e)&&cr.equals_nocase(e,t))return void(this.runtime.changelayout=this.runtime.layouts[e])},l.prototype.RestartLayout=function(t){var e,i,r;if(!this.runtime.isloading&&(!this.runtime.changelayout&&this.runtime.running_layout))for(this.runtime.changelayout=this.runtime.running_layout,e=0,i=this.runtime.allGroups.length;e<i;e++)(r=this.runtime.allGroups[e]).setGroupActive(r.initially_activated)},l.prototype.SnapshotCanvas=function(t,e){this.runtime.doCanvasSnapshot(0===t?"image/png":"image/jpeg",e/100)},l.prototype.SetCanvasSize=function(t,e){if(!(t<=0||e<=0)){var i=this.runtime.fullscreen_mode;(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen)&&this.runtime.fullscreen_scaling>0&&(i=this.runtime.fullscreen_scaling),0===i?this.runtime.setSize(t,e,!0):(this.runtime.original_width=t,this.runtime.original_height=e,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))}},l.prototype.SetLayoutEffectEnabled=function(t,e){if(this.runtime.running_layout&&this.runtime.glwrap){var i=this.runtime.running_layout.getEffectByName(e);if(i){var r=1===t;i.active!=r&&(i.active=r,this.runtime.running_layout.updateActiveEffects(),this.runtime.redraw=!0)}}},l.prototype.SetLayerEffectEnabled=function(t,e,i){if(t&&this.runtime.glwrap){var r=t.getEffectByName(i);if(r){var n=1===e;r.active!=n&&(r.active=n,t.updateActiveEffects(),this.runtime.redraw=!0)}}},l.prototype.SetLayoutEffectParam=function(t,e,i){if(this.runtime.running_layout&&this.runtime.glwrap){var r=this.runtime.running_layout.getEffectByName(t);if(r){var n=this.runtime.running_layout.effect_params[r.index];if(!((e=Math.floor(e))<0||e>=n.length)){var s=this.runtime.glwrap.getProgramParameterType(r.shaderindex,e);1===s?i/=100:2===s&&(i=[cr.GetRValue(i),cr.GetGValue(i),cr.GetBValue(i)]),n[e]!==i&&(n[e]=i,r.active&&(this.runtime.redraw=!0))}}}},l.prototype.SetLayerEffectParam=function(t,e,i,r){if(t&&this.runtime.glwrap){var n=t.getEffectByName(e);if(n){var s=t.effect_params[n.index];if(!((i=Math.floor(i))<0||i>=s.length)){var o=this.runtime.glwrap.getProgramParameterType(n.shaderindex,i);1===o?r/=100:2===o&&(r=[cr.GetRValue(r),cr.GetGValue(r),cr.GetBValue(r)]),s[i]!==r&&(s[i]=r,n.active&&(this.runtime.redraw=!0))}}}},l.prototype.SaveState=function(t){this.runtime.saveToSlot=t},l.prototype.LoadState=function(t){this.runtime.loadFromSlot=t},l.prototype.LoadStateJSON=function(t){this.runtime.loadFromJson=t},l.prototype.SetHalfFramerateMode=function(t){this.runtime.halfFramerateMode=0!==t},l.prototype.SetFullscreenQuality=function(t){(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||0!==this.runtime.fullscreen_mode)&&(this.runtime.wantFullscreenScalingQuality=0!==t,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))},l.prototype.ResetPersisted=function(){var t,e;for(t=0,e=this.runtime.layouts_by_index.length;t<e;++t)this.runtime.layouts_by_index[t].persist_data={},this.runtime.layouts_by_index[t].first_visit=!0},l.prototype.RecreateInitialObjects=function(t,e,i,r,n){t&&this.runtime.running_layout.recreateInitialObjects(t,e,i,r,n)},l.prototype.SetPixelRounding=function(t){this.runtime.pixel_rounding=0!==t,this.runtime.redraw=!0},l.prototype.SetMinimumFramerate=function(t){t<1&&(t=1),t>120&&(t=120),this.runtime.minimumFramerate=t},l.prototype.SortZOrderByInstVar=function(t,e){if(t){var i,r,n,s,o,a,h=t.getCurrentSol().getObjects(),c=[],l=[],u=this.runtime.running_layout,p=t.is_family,d=t.family_index,f=!1;for(i=0,r=h.length;i<r;++i)(n=h[i]).layer&&(s=p?n.instance_vars[e+n.type.family_var_map[d]]:n.instance_vars[e],c.push([n.layer.index,n.get_zindex()]),l.push([n,s]));if(c.length){for(c.sort(m),l.sort(_),i=0,r=c.length;i<r;++i)n=l[i][0],o=u.layers[c[i][0]],a=c[i][1],o.instances[a]!==n&&(o.instances[a]=n,n.layer=o,o.setZIndicesStaleFrom(a),f=!0);f&&(this.runtime.redraw=!0)}}},t.acts=new l,v.prototype.int=function(t,e){cr.is_string(e)?(t.set_int(parseInt(e,10)),isNaN(t.data)&&(t.data=0)):t.set_int(e)},v.prototype.float=function(t,e){cr.is_string(e)?(t.set_float(parseFloat(e)),isNaN(t.data)&&(t.data=0)):t.set_float(e)},v.prototype.str=function(t,e){cr.is_string(e)?t.set_string(e):t.set_string(e.toString())},v.prototype.len=function(t,e){t.set_int(e.length||0)},v.prototype.random=function(t,e,i){void 0===i?t.set_float(Math.random()*e):t.set_float(Math.random()*(i-e)+e)},v.prototype.sqrt=function(t,e){t.set_float(Math.sqrt(e))},v.prototype.abs=function(t,e){t.set_float(Math.abs(e))},v.prototype.round=function(t,e){t.set_int(Math.round(e))},v.prototype.floor=function(t,e){t.set_int(Math.floor(e))},v.prototype.ceil=function(t,e){t.set_int(Math.ceil(e))},v.prototype.sign=function(t,e){t.set_float(Math.sign(e))},v.prototype.sin=function(t,e){t.set_float(Math.sin(cr.to_radians(e)))},v.prototype.cos=function(t,e){t.set_float(Math.cos(cr.to_radians(e)))},v.prototype.tan=function(t,e){t.set_float(Math.tan(cr.to_radians(e)))},v.prototype.asin=function(t,e){t.set_float(cr.to_degrees(Math.asin(e)))},v.prototype.acos=function(t,e){t.set_float(cr.to_degrees(Math.acos(e)))},v.prototype.atan=function(t,e){t.set_float(cr.to_degrees(Math.atan(e)))},v.prototype.exp=function(t,e){t.set_float(Math.exp(e))},v.prototype.ln=function(t,e){t.set_float(Math.log(e))},v.prototype.log10=function(t,e){t.set_float(Math.log(e)/Math.LN10)},v.prototype.max=function(t){var e,i,r,n=arguments[1];for("number"!=typeof n&&(n=0),e=2,i=arguments.length;e<i;e++)"number"==typeof(r=arguments[e])&&n<r&&(n=r);t.set_float(n)},v.prototype.min=function(t){var e,i,r,n=arguments[1];for("number"!=typeof n&&(n=0),e=2,i=arguments.length;e<i;e++)"number"==typeof(r=arguments[e])&&n>r&&(n=r);t.set_float(n)},v.prototype.dt=function(t){t.set_float(this.runtime.dt)},v.prototype.timescale=function(t){t.set_float(this.runtime.timescale)},v.prototype.wallclocktime=function(t){t.set_float((Date.now()-this.runtime.start_time)/1e3)},v.prototype.unixtime=function(t){t.set_float(Date.now())},v.prototype.time=function(t){t.set_float(this.runtime.kahanTime.sum)},v.prototype.tickcount=function(t){t.set_int(this.runtime.tickcount)},v.prototype.objectcount=function(t){t.set_int(this.runtime.objectcount)},v.prototype.fps=function(t){t.set_int(this.runtime.fps)},v.prototype.loopindex=function(t,e){var i,r;if(this.runtime.loop_stack.length)if(e){for(r=this.runtime.loop_stack_index;r>=0;--r)if((i=this.runtime.loop_stack[r]).name===e)return void t.set_int(i.index);t.set_int(0)}else i=this.runtime.getCurrentLoop(),t.set_int(i?i.index:-1);else t.set_int(0)},v.prototype.distance=function(t,e,i,r,n){t.set_float(cr.distanceTo(e,i,r,n))},v.prototype.angle=function(t,e,i,r,n){t.set_float(cr.to_degrees(cr.angleTo(e,i,r,n)))},v.prototype.scrollx=function(t){t.set_float(this.runtime.running_layout.scrollX)},v.prototype.scrolly=function(t){t.set_float(this.runtime.running_layout.scrollY)},v.prototype.newline=function(t){t.set_string("\n")},v.prototype.lerp=function(t,e,i,r){t.set_float(cr.lerp(e,i,r))},v.prototype.qarp=function(t,e,i,r,n){t.set_float(cr.qarp(e,i,r,n))},v.prototype.cubic=function(t,e,i,r,n,s){t.set_float(cr.cubic(e,i,r,n,s))},v.prototype.cosp=function(t,e,i,r){t.set_float(cr.cosp(e,i,r))},v.prototype.windowwidth=function(t){t.set_int(this.runtime.width)},v.prototype.windowheight=function(t){t.set_int(this.runtime.height)},v.prototype.uppercase=function(t,e){t.set_string(cr.is_string(e)?e.toUpperCase():"")},v.prototype.lowercase=function(t,e){t.set_string(cr.is_string(e)?e.toLowerCase():"")},v.prototype.clamp=function(t,e,i,r){e<i?t.set_float(i):e>r?t.set_float(r):t.set_float(e)},v.prototype.layerscale=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(i.scale):t.set_float(0)},v.prototype.layeropacity=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(100*i.opacity):t.set_float(0)},v.prototype.layerscalerate=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(i.zoomRate):t.set_float(0)},v.prototype.layerparallaxx=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(100*i.parallaxX):t.set_float(0)},v.prototype.layerparallaxy=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(100*i.parallaxY):t.set_float(0)},v.prototype.layerindex=function(t,e){var i=this.runtime.getLayer(e);i?t.set_int(i.index):t.set_int(-1)},v.prototype.layoutscale=function(t){this.runtime.running_layout?t.set_float(this.runtime.running_layout.scale):t.set_float(0)},v.prototype.layoutangle=function(t){t.set_float(cr.to_degrees(this.runtime.running_layout.angle))},v.prototype.layerangle=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(cr.to_degrees(i.angle)):t.set_float(0)},v.prototype.layoutwidth=function(t){t.set_int(this.runtime.running_layout.width)},v.prototype.layoutheight=function(t){t.set_int(this.runtime.running_layout.height)},v.prototype.find=function(t,e,i){cr.is_string(e)&&cr.is_string(i)?t.set_int(e.search(new RegExp(cr.regexp_escape(i),"i"))):t.set_int(-1)},v.prototype.findcase=function(t,e,i){cr.is_string(e)&&cr.is_string(i)?t.set_int(e.search(new RegExp(cr.regexp_escape(i),""))):t.set_int(-1)},v.prototype.left=function(t,e,i){t.set_string(cr.is_string(e)?e.substr(0,i):"")},v.prototype.right=function(t,e,i){t.set_string(cr.is_string(e)?e.substr(e.length-i):"")},v.prototype.mid=function(t,e,i,r){t.set_string(cr.is_string(e)?e.substr(i,r):"")},v.prototype.tokenat=function(t,e,i,r){if(cr.is_string(e)&&cr.is_string(r)){var n=e.split(r),s=cr.floor(i);s<0||s>=n.length?t.set_string(""):t.set_string(n[s])}else t.set_string("")},v.prototype.tokencount=function(t,e,i){cr.is_string(e)&&e.length?t.set_int(e.split(i).length):t.set_int(0)},v.prototype.replace=function(t,e,i,r){cr.is_string(e)&&cr.is_string(i)&&cr.is_string(r)?t.set_string(e.replace(new RegExp(cr.regexp_escape(i),"gi"),r)):t.set_string(cr.is_string(e)?e:"")},v.prototype.trim=function(t,e){t.set_string(cr.is_string(e)?e.trim():"")},v.prototype.pi=function(t){t.set_float(cr.PI)},v.prototype.layoutname=function(t){this.runtime.running_layout?t.set_string(this.runtime.running_layout.name):t.set_string("")},v.prototype.renderer=function(t){t.set_string(this.runtime.gl?"webgl":"canvas2d")},v.prototype.rendererdetail=function(t){t.set_string(this.runtime.glUnmaskedRenderer)},v.prototype.anglediff=function(t,e,i){t.set_float(cr.to_degrees(cr.angleDiff(cr.to_radians(e),cr.to_radians(i))))},v.prototype.choose=function(t){var e=cr.floor(Math.random()*(arguments.length-1));t.set_any(arguments[e+1])},v.prototype.rgb=function(t,e,i,r){t.set_int(cr.RGB(e,i,r))},v.prototype.rgbex=function(t,e,i,r){t.set_float(cr.RGBEx(e/100,i/100,r/100))},v.prototype.projectversion=function(t){t.set_string(this.runtime.versionstr)},v.prototype.projectname=function(t){t.set_string(this.runtime.name)},v.prototype.anglelerp=function(t,e,i,r){e=cr.to_radians(e),i=cr.to_radians(i);var n=cr.angleDiff(e,i);cr.angleClockwise(i,e)?t.set_float(cr.to_clamped_degrees(e+n*r)):t.set_float(cr.to_clamped_degrees(e-n*r))},v.prototype.anglerotate=function(t,e,i,r){e=cr.to_radians(e),i=cr.to_radians(i),r=cr.to_radians(r),t.set_float(cr.to_clamped_degrees(cr.angleRotate(e,i,r)))},v.prototype.zeropad=function(t,e,i){var r=e<0?"-":"";e<0&&(e=-e);for(var n=i-e.toString().length,s=0;s<n;s++)r+="0";t.set_string(r+e.toString())},v.prototype.cpuutilisation=function(t){t.set_float(this.runtime.cpuutilisation/1e3)},v.prototype.gpuutilisation=function(t){t.set_float(this.runtime.gpuLastUtilisation)},v.prototype.viewportleft=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewLeft:0)},v.prototype.viewporttop=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewTop:0)},v.prototype.viewportright=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewRight:0)},v.prototype.viewportbottom=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewBottom:0)},v.prototype.loadingprogress=function(t){t.set_float(this.runtime.loadingprogress)},v.prototype.unlerp=function(t,e,i,r){t.set_float(cr.unlerp(e,i,r))},v.prototype.canvassnapshot=function(t){t.set_string(this.runtime.snapshotData)},v.prototype.urlencode=function(t,e){t.set_string(encodeURIComponent(e))},v.prototype.urldecode=function(t,e){t.set_string(decodeURIComponent(e))},v.prototype.canvastolayerx=function(t,e,i,r){var n=this.runtime.getLayer(e);t.set_float(n?n.canvasToLayer(i,r,!0):0)},v.prototype.canvastolayery=function(t,e,i,r){var n=this.runtime.getLayer(e);t.set_float(n?n.canvasToLayer(i,r,!1):0)},v.prototype.layertocanvasx=function(t,e,i,r){var n=this.runtime.getLayer(e);t.set_float(n?n.layerToCanvas(i,r,!0):0)},v.prototype.layertocanvasy=function(t,e,i,r){var n=this.runtime.getLayer(e);t.set_float(n?n.layerToCanvas(i,r,!1):0)},v.prototype.savestatejson=function(t){t.set_string(this.runtime.lastSaveJson)},v.prototype.imagememoryusage=function(t){this.runtime.glwrap?t.set_float(Math.round(100*this.runtime.glwrap.estimateVRAM()/1048576)/100):t.set_float(0)},v.prototype.regexsearch=function(t,e,i,r){var n=h(i,r);t.set_int(e?e.search(n):-1)},v.prototype.regexreplace=function(t,e,i,r,n){var s=h(i,r);t.set_string(e?e.replace(s,n):"")};var b=[],w="",x="",S="";function T(t,e,i){if(t!==w||e!==x||i!==S){var r=h(e,i);b=t.match(r),w=t,x=e,S=i}}v.prototype.regexmatchcount=function(t,e,i,r){h(i,r);T(e.toString(),i,r),t.set_int(b?b.length:0)},v.prototype.regexmatchat=function(t,e,i,r,n){n=Math.floor(n);h(i,r);T(e.toString(),i,r),!b||n<0||n>=b.length?t.set_string(""):t.set_string(b[n])},v.prototype.infinity=function(t){t.set_float(1/0)},v.prototype.setbit=function(t,e,i,r){e|=0,i|=0,r=0!==r?1:0,t.set_int(e&~(1<<i)|r<<i)},v.prototype.togglebit=function(t,e,i){e|=0,i|=0,t.set_int(e^1<<i)},v.prototype.getbit=function(t,e,i){e|=0,i|=0,t.set_int(e&1<<i?1:0)},v.prototype.originalwindowwidth=function(t){t.set_int(this.runtime.original_width)},v.prototype.originalwindowheight=function(t){t.set_int(this.runtime.original_height)},v.prototype.originalviewportwidth=function(t){t.set_int(this.runtime.original_width)},v.prototype.originalviewportheight=function(t){t.set_int(this.runtime.original_height)},t.exps=new v,t.runWaits=function(){var t,e,i,r,n,s,o,a=this.runtime.getCurrentEventStack();for(t=0,i=this.waits.length;t<i;t++){if(-1===(r=this.waits[t]).time){if(!r.signalled)continue}else if(r.time>this.runtime.kahanTime.sum)continue;for(n in a.current_event=r.ev,a.actindex=r.actindex,a.cndindex=0,r.sols)r.sols.hasOwnProperty(n)&&(s=this.runtime.types_by_index[parseInt(n,10)].getCurrentSol(),o=r.sols[n],s.select_all=o.sa,cr.shallowAssignArray(s.instances,o.insts),y(o));r.ev.resume_actions_and_subevents(),this.runtime.clearSol(r.solModifiers),r.deleteme=!0}for(t=0,e=0,i=this.waits.length;t<i;t++)r=this.waits[t],this.waits[e]=r,r.deleteme?d(r):e++;cr.truncateArray(this.waits,e)}}(),function(){cr.add_common_aces=function(t,e){var i=t[1],r=t[3],n=t[4],s=t[5],o=t[6],a=t[7],h=t[8],c=t[10],l=t[11],u=t[12];e.cnds||(e.cnds={}),e.acts||(e.acts={}),e.exps||(e.exps={});var p=e.cnds,d=e.acts,f=e.exps;r&&(p.CompareX=function(t,e){return cr.do_cmp(this.x,t,e)},p.CompareY=function(t,e){return cr.do_cmp(this.y,t,e)},p.IsOnScreen=function(){var t=this.layer;this.update_bbox();var e=this.bbox;return!(e.right<t.viewLeft||e.bottom<t.viewTop||e.left>t.viewRight||e.top>t.viewBottom)},p.IsOutsideLayout=function(){this.update_bbox();var t=this.bbox,e=this.runtime.running_layout;return t.right<0||t.bottom<0||t.left>e.width||t.top>e.height},p.PickDistance=function(t,e,i){var r=this.getCurrentSol(),n=r.getObjects();if(!n.length)return!1;var s,o,a,h=n[0],c=h,l=cr.distanceTo(h.x,h.y,e,i);for(s=1,o=n.length;s<o;s++)h=n[s],a=cr.distanceTo(h.x,h.y,e,i),(0===t&&a<l||1===t&&a>l)&&(l=a,c=h);return r.pick_one(c),!0},d.SetX=function(t){this.x!==t&&(this.x=t,this.set_bbox_changed())},d.SetY=function(t){this.y!==t&&(this.y=t,this.set_bbox_changed())},d.SetPos=function(t,e){this.x===t&&this.y===e||(this.x=t,this.y=e,this.set_bbox_changed())},d.SetPosToObject=function(t,e){var i,r,n=t.getPairedInstance(this);n&&(n.getImagePoint?(i=n.getImagePoint(e,!0),r=n.getImagePoint(e,!1)):(i=n.x,r=n.y),this.x===i&&this.y===r||(this.x=i,this.y=r,this.set_bbox_changed()))},d.MoveForward=function(t){0!==t&&(this.x+=Math.cos(this.angle)*t,this.y+=Math.sin(this.angle)*t,this.set_bbox_changed())},d.MoveAtAngle=function(t,e){0!==e&&(this.x+=Math.cos(cr.to_radians(t))*e,this.y+=Math.sin(cr.to_radians(t))*e,this.set_bbox_changed())},f.X=function(t){t.set_float(this.x)},f.Y=function(t){t.set_float(this.y)},f.dt=function(t){t.set_float(this.runtime.getDt(this))}),n&&(p.CompareWidth=function(t,e){return cr.do_cmp(this.width,t,e)},p.CompareHeight=function(t,e){return cr.do_cmp(this.height,t,e)},d.SetWidth=function(t){this.width!==t&&(this.width=t,this.set_bbox_changed())},d.SetHeight=function(t){this.height!==t&&(this.height=t,this.set_bbox_changed())},d.SetSize=function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.set_bbox_changed())},f.Width=function(t){t.set_float(this.width)},f.Height=function(t){t.set_float(this.height)},f.BBoxLeft=function(t){this.update_bbox(),t.set_float(this.bbox.left)},f.BBoxTop=function(t){this.update_bbox(),t.set_float(this.bbox.top)},f.BBoxRight=function(t){this.update_bbox(),t.set_float(this.bbox.right)},f.BBoxBottom=function(t){this.update_bbox(),t.set_float(this.bbox.bottom)}),s&&(p.AngleWithin=function(t,e){return cr.angleDiff(this.angle,cr.to_radians(e))<=cr.to_radians(t)},p.IsClockwiseFrom=function(t){return cr.angleClockwise(this.angle,cr.to_radians(t))},p.IsBetweenAngles=function(t,e){var i=cr.to_clamped_radians(t),r=cr.to_clamped_radians(e),n=cr.clamp_angle(this.angle);return!cr.angleClockwise(r,i)?!(!cr.angleClockwise(n,i)&&cr.angleClockwise(n,r)):cr.angleClockwise(n,i)&&!cr.angleClockwise(n,r)},d.SetAngle=function(t){var e=cr.to_radians(cr.clamp_angle_degrees(t));isNaN(e)||this.angle!==e&&(this.angle=e,this.set_bbox_changed())},d.RotateClockwise=function(t){0===t||isNaN(t)||(this.angle+=cr.to_radians(t),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},d.RotateCounterclockwise=function(t){0===t||isNaN(t)||(this.angle-=cr.to_radians(t),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},d.RotateTowardAngle=function(t,e){var i=cr.angleRotate(this.angle,cr.to_radians(e),cr.to_radians(t));isNaN(i)||this.angle!==i&&(this.angle=i,this.set_bbox_changed())},d.RotateTowardPosition=function(t,e,i){var r=e-this.x,n=i-this.y,s=Math.atan2(n,r),o=cr.angleRotate(this.angle,s,cr.to_radians(t));isNaN(o)||this.angle!==o&&(this.angle=o,this.set_bbox_changed())},d.SetTowardPosition=function(t,e){var i=t-this.x,r=e-this.y,n=Math.atan2(r,i);isNaN(n)||this.angle!==n&&(this.angle=n,this.set_bbox_changed())},f.Angle=function(t){t.set_float(cr.to_clamped_degrees(this.angle))}),i||(p.CompareInstanceVar=function(t,e,i){return cr.do_cmp(this.instance_vars[t],e,i)},p.IsBoolInstanceVarSet=function(t){return this.instance_vars[t]},p.PickInstVarHiLow=function(t,e){var i=this.getCurrentSol(),r=i.getObjects();if(!r.length)return!1;var n,s,o,a=r[0],h=a,c=a.instance_vars[e];for(n=1,s=r.length;n<s;n++)o=(a=r[n]).instance_vars[e],(0===t&&o<c||1===t&&o>c)&&(c=o,h=a);return i.pick_one(h),!0},p.PickByUID=function(t){var e,i,r,n,s,o,a;if(this.runtime.getCurrentCondition().inverted){if((a=this.getCurrentSol()).select_all){for(a.select_all=!1,cr.clearArray(a.instances),cr.clearArray(a.else_instances),e=0,i=(o=this.instances).length;e<i;e++)(n=o[e]).uid===t?a.else_instances.push(n):a.instances.push(n);return this.applySolToContainer(),!!a.instances.length}for(e=0,r=0,i=a.instances.length;e<i;e++)n=a.instances[e],a.instances[r]=n,n.uid===t?a.else_instances.push(n):r++;return cr.truncateArray(a.instances,r),this.applySolToContainer(),!!a.instances.length}if(!(n=this.runtime.getObjectByUID(t)))return!1;if(!(a=this.getCurrentSol()).select_all&&-1===a.instances.indexOf(n))return!1;if(this.is_family){for(e=0,i=(s=n.type.families).length;e<i;e++)if(s[e]===this)return a.pick_one(n),this.applySolToContainer(),!0}else if(n.type===this)return a.pick_one(n),this.applySolToContainer(),!0;return!1},p.OnCreated=function(){return!0},p.OnDestroyed=function(){return!0},d.SetInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])?cr.is_number(e)?i[t]=e:i[t]=parseFloat(e):cr.is_string(i[t])&&(cr.is_string(e)?i[t]=e:i[t]=e.toString())},d.AddInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])?cr.is_number(e)?i[t]+=e:i[t]+=parseFloat(e):cr.is_string(i[t])&&(cr.is_string(e)?i[t]+=e:i[t]+=e.toString())},d.SubInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])&&(cr.is_number(e)?i[t]-=e:i[t]-=parseFloat(e))},d.SetBoolInstanceVar=function(t,e){this.instance_vars[t]=e?1:0},d.ToggleBoolInstanceVar=function(t){this.instance_vars[t]=1-this.instance_vars[t]},d.Destroy=function(){this.runtime.DestroyInstance(this)},d.LoadFromJsonString||(d.LoadFromJsonString=function(t){var e,i,r,n;try{e=JSON.parse(t)}catch(t){return}if(this.runtime.loadInstanceFromJSON(this,e,!0),this.afterLoad&&this.afterLoad(),this.behavior_insts)for(i=0,r=this.behavior_insts.length;i<r;++i)(n=this.behavior_insts[i]).afterLoad&&n.afterLoad()}),f.Count=function(t){var e,i,r,n=t.object_class.instances.length;for(e=0,i=this.runtime.createRow.length;e<i;e++)r=this.runtime.createRow[e],t.object_class.is_family?r.type.families.indexOf(t.object_class)>=0&&n++:r.type===t.object_class&&n++;t.set_int(n)},f.PickedCount=function(t){t.set_int(t.object_class.getCurrentSol().getObjects().length)},f.UID=function(t){t.set_int(this.uid)},f.IID=function(t){t.set_int(this.get_iid())},f.AsJSON||(f.AsJSON=function(t){t.set_string(JSON.stringify(this.runtime.saveInstanceToJSON(this,!0)))})),o&&(p.IsVisible=function(){return this.visible},d.SetVisible=function(t){(t=2===t?!this.visible:0!==t)!==this.visible&&(this.visible=t,this.runtime.redraw=!0)},p.CompareOpacity=function(t,e){return cr.do_cmp(cr.round6dp(100*this.opacity),t,e)},d.SetOpacity=function(t){var e=t/100;e<0?e=0:e>1&&(e=1),e!==this.opacity&&(this.opacity=e,this.runtime.redraw=!0)},f.Opacity=function(t){t.set_float(cr.round6dp(100*this.opacity))}),a&&(p.IsOnLayer=function(t){return!!t&&this.layer===t},p.PickTopBottom=function(t){var e=this.getCurrentSol(),i=e.getObjects();if(!i.length)return!1;var r,n,s=i[0],o=s;for(r=1,n=i.length;r<n;r++)s=i[r],0===t?(s.layer.index>o.layer.index||s.layer.index===o.layer.index&&s.get_zindex()>o.get_zindex())&&(o=s):(s.layer.index<o.layer.index||s.layer.index===o.layer.index&&s.get_zindex()<o.get_zindex())&&(o=s);return e.pick_one(o),!0},d.MoveToTop=function(){var t=this.layer,e=t.instances;e.length&&e[e.length-1]===this||(t.removeFromInstanceList(this,!1),t.appendToInstanceList(this,!1),this.runtime.redraw=!0)},d.MoveToBottom=function(){var t=this.layer,e=t.instances;e.length&&e[0]===this||(t.removeFromInstanceList(this,!1),t.prependToInstanceList(this,!1),this.runtime.redraw=!0)},d.MoveToLayer=function(t){t&&t!=this.layer&&(this.layer.removeFromInstanceList(this,!0),this.layer=t,t.appendToInstanceList(this,!0),this.runtime.redraw=!0)},d.ZMoveToObject=function(t,e){var i=0===t;if(e){var r=e.getFirstPicked(this);r&&r.uid!==this.uid&&(this.layer.index!==r.layer.index&&(this.layer.removeFromInstanceList(this,!0),this.layer=r.layer,r.layer.appendToInstanceList(this,!0)),this.layer.moveInstanceAdjacent(this,r,i),this.runtime.redraw=!0)}},f.LayerNumber=function(t){t.set_int(this.layer.number)},f.LayerName=function(t){t.set_string(this.layer.name)},f.ZIndex=function(t){t.set_int(this.get_zindex())}),h&&(d.SetEffectEnabled=function(t,e){if(this.runtime.glwrap){var i=this.type.getEffectIndexByName(e);if(!(i<0)){var r=1===t;this.active_effect_flags[i]!==r&&(this.active_effect_flags[i]=r,this.updateActiveEffects(),this.runtime.redraw=!0)}}},d.SetEffectParam=function(t,e,i){if(this.runtime.glwrap){var r=this.type.getEffectIndexByName(t);if(!(r<0)){var n,s,o,a=this.type.effect_types[r],h=this.effect_params[r];if(!((e=Math.floor(e))<0||e>=h.length)){var c=this.runtime.glwrap.getProgramParameterType(a.shaderindex,e);if(1===c&&(i/=100),2===c){n=cr.GetRValue(i),s=cr.GetGValue(i),o=cr.GetBValue(i);var l=h[e];if(l[0]===n&&l[1]===s&&l[2]===o)return;l[0]=n,l[1]=s,l[2]=o,a.active&&(this.runtime.redraw=!0)}else{if(h[e]===i)return;h[e]=i,a.active&&(this.runtime.redraw=!0)}}}}}),c&&(d.SetVisible=function(t){this.visible=0!==t},d.SetCSSStyle=function(t,e){this.elem.style[cr.cssToCamelCase(t)]=e}),l&&(d.SetFocus=function(){(this.inputElem||this.elem).focus()},d.SetBlur=function(){(this.inputElem||this.elem).blur()}),u&&(d.SetEnabled=function(t){(this.inputElem||this.elem).disabled=0===t})},cr.set_bbox_changed=function(){this.bbox_changed=!0,this.cell_changed=!0,this.type.any_cell_changed=!0,this.runtime.redraw=!0;var t,e,i=this.bbox_changed_callbacks;for(t=0,e=i.length;t<e;++t)i[t](this);this.layer.useRenderCells&&this.update_bbox()},cr.add_bbox_changed_callback=function(t){t&&this.bbox_changed_callbacks.push(t)},cr.update_bbox=function(){if(this.bbox_changed){var t=this.bbox,e=this.bquad;t.set(this.x,this.y,this.x+this.width,this.y+this.height),t.offset(-this.hotspotX*this.width,-this.hotspotY*this.height),this.angle?(t.offset(-this.x,-this.y),e.set_from_rotated_rect(t,this.angle),e.offset(this.x,this.y),e.bounding_box(t)):e.set_from_rect(t),t.normalize(),this.bbox_changed=!1,this.update_render_cell()}};var t=new cr.rect(0,0,0,0);cr.update_render_cell=function(){if(this.layer.useRenderCells){var e=this.layer.render_grid,i=this.bbox;t.set(e.XToCell(i.left),e.YToCell(i.top),e.XToCell(i.right),e.YToCell(i.bottom)),this.rendercells.equals(t)||(this.rendercells.right<this.rendercells.left?e.update(this,null,t):e.update(this,this.rendercells,t),this.rendercells.copy(t),this.layer.render_list_stale=!0)}},cr.update_collision_cell=function(){if(this.cell_changed&&this.collisionsEnabled){this.update_bbox();var e=this.type.collision_grid,i=this.bbox;t.set(e.XToCell(i.left),e.YToCell(i.top),e.XToCell(i.right),e.YToCell(i.bottom)),this.collcells.equals(t)||(this.collcells.right<this.collcells.left?e.update(this,null,t):e.update(this,this.collcells,t),this.collcells.copy(t),this.cell_changed=!1)}},cr.inst_contains_pt=function(t,e){return!!this.bbox.contains_pt(t,e)&&(!!this.bquad.contains_pt(t,e)&&(this.tilemap_exists?this.testPointOverlapTile(t,e):!(this.collision_poly&&!this.collision_poly.is_empty())||(this.collision_poly.cache_poly(this.width,this.height,this.angle),this.collision_poly.contains_pt(t-this.x,e-this.y))))},cr.inst_get_iid=function(){return this.type.updateIIDs(),this.iid},cr.inst_get_zindex=function(){return this.layer.updateZIndices(),this.zindex},cr.inst_updateActiveEffects=function(){var t,e,i;cr.clearArray(this.active_effect_types);var r=!0;for(t=0,e=this.active_effect_flags.length;t<e;t++)this.active_effect_flags[t]&&(i=this.type.effect_types[t],this.active_effect_types.push(i),i.preservesOpaqueness||(r=!1));this.uses_shaders=!!this.active_effect_types.length,this.shaders_preserve_opaqueness=r},cr.inst_toString=function(){return"Inst"+this.puid},cr.type_getFirstPicked=function(t){var e,i,r;if(t&&t.is_contained&&t.type!=this)for(e=0,i=t.siblings.length;e<i;e++)if((r=t.siblings[e]).type==this)return r;var n=this.getCurrentSol().getObjects();return n.length?n[0]:null},cr.type_getPairedInstance=function(t){var e=this.getCurrentSol().getObjects();return e.length?e[t.get_iid()%e.length]:null},cr.type_updateIIDs=function(){if(this.stale_iids&&!this.is_family){var t,e;for(t=0,e=this.instances.length;t<e;t++)this.instances[t].iid=t;var i=t,r=this.runtime.createRow;for(t=0,e=r.length;t<e;++t)r[t].type===this&&(r[t].iid=i++);this.stale_iids=!1}},cr.type_getInstanceByIID=function(t){if(t<this.instances.length)return this.instances[t];t-=this.instances.length;var e,i,r=this.runtime.createRow;for(e=0,i=r.length;e<i;++e)if(r[e].type===this){if(0===t)return r[e];--t}return null},cr.type_getCurrentSol=function(){return this.solstack[this.cur_sol]},cr.type_pushCleanSol=function(){this.cur_sol++,this.cur_sol===this.solstack.length?this.solstack.push(new cr.selection(this)):(this.solstack[this.cur_sol].select_all=!0,cr.clearArray(this.solstack[this.cur_sol].else_instances))},cr.type_pushCopySol=function(){this.cur_sol++,this.cur_sol===this.solstack.length&&this.solstack.push(new cr.selection(this));var t=this.solstack[this.cur_sol],e=this.solstack[this.cur_sol-1];e.select_all?t.select_all=!0:(t.select_all=!1,cr.shallowAssignArray(t.instances,e.instances)),cr.clearArray(t.else_instances)},cr.type_popSol=function(){this.cur_sol--},cr.type_getBehaviorByName=function(t){var e,i,r,n,s,o=0;if(!this.is_family)for(e=0,i=this.families.length;e<i;e++)for(r=0,n=(s=this.families[e]).behaviors.length;r<n;r++){if(t===s.behaviors[r].name)return this.extra.lastBehIndex=o,s.behaviors[r];o++}for(e=0,i=this.behaviors.length;e<i;e++){if(t===this.behaviors[e].name)return this.extra.lastBehIndex=o,this.behaviors[e];o++}return null},cr.type_getBehaviorIndexByName=function(t){return this.getBehaviorByName(t)?this.extra.lastBehIndex:-1},cr.type_getEffectIndexByName=function(t){var e,i;for(e=0,i=this.effect_types.length;e<i;e++)if(this.effect_types[e].name===t)return e;return-1},cr.type_applySolToContainer=function(){if(this.is_contained&&!this.is_family){var t,e,i,r,n,s,o;this.updateIIDs();var a=(s=this.getCurrentSol()).select_all,h=this.runtime.getCurrentEventStack(),c=h&&h.current_event&&h.current_event.orblock;for(t=0,e=this.container.length;t<e;t++)if((n=this.container[t])!==this&&(n.updateIIDs(),(o=n.getCurrentSol()).select_all=a,!a)){for(cr.clearArray(o.instances),i=0,r=s.instances.length;i<r;++i)o.instances[i]=n.getInstanceByIID(s.instances[i].iid);if(c)for(cr.clearArray(o.else_instances),i=0,r=s.else_instances.length;i<r;++i)o.else_instances[i]=n.getInstanceByIID(s.else_instances[i].iid)}}},cr.type_toString=function(){return"Type"+this.sid},cr.do_cmp=function(t,e,i){if(void 0===t||void 0===i)return!1;switch(e){case 0:return t===i;case 1:return t!==i;case 2:return t<i;case 3:return t<=i;case 4:return t>i;case 5:return t>=i;default:return!1}}}(),cr.shaders={},cr.plugins_.Sprite=function(t){this.runtime=t},function(){var t=cr.plugins_.Sprite.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime};var e=t.Type.prototype;function i(){if(0===this.datauri.length){var t=document.createElement("canvas");t.width=this.width,t.height=this.height;var e=t.getContext("2d");this.spritesheeted?e.drawImage(this.texture_img,this.offx,this.offy,this.width,this.height,0,0,this.width,this.height):e.drawImage(this.texture_img,0,0,this.width,this.height),this.datauri=t.toDataURL("image/png")}return this.datauri}e.onCreate=function(){var t,e,r,n,s,o,a,h,c,l;if(!this.is_family)for(this.all_frames=[],this.has_loaded_textures=!1,t=0,e=this.animations.length;t<e;t++){for(s=this.animations[t],(a={}).name=s[0],a.speed=s[1],a.loop=s[2],a.repeatcount=s[3],a.repeatto=s[4],a.pingpong=s[5],a.sid=s[6],a.frames=[],r=0,n=s[7].length;r<n;r++)o=s[7][r],(h={}).texture_file=o[0],h.texture_filesize=o[1],h.offx=o[2],h.offy=o[3],h.width=o[4],h.height=o[5],h.duration=o[6],h.hotspotX=o[7],h.hotspotY=o[8],h.image_points=o[9],h.poly_pts=o[10],h.pixelformat=o[11],h.spritesheeted=0!==h.width,h.datauri="",h.getDataUri=i,(l={}).left=0,l.top=0,l.right=1,l.bottom=1,h.sheetTex=l,h.webGL_texture=null,(c=this.runtime.findWaitingTexture(o[0]))?h.texture_img=c:(h.texture_img=new Image,h.texture_img.cr_src=o[0],h.texture_img.cr_filesize=o[1],h.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(h.texture_img,o[0])),cr.seal(h),a.frames.push(h),this.all_frames.push(h);cr.seal(a),this.animations[t]=a}},e.updateAllCurrentTexture=function(){var t,e,i;for(t=0,e=this.instances.length;t<e;t++)(i=this.instances[t]).curWebGLTexture=i.curFrame.webGL_texture},e.onLostWebGLContext=function(){if(!this.is_family){var t,e,i;for(t=0,e=this.all_frames.length;t<e;++t)(i=this.all_frames[t]).texture_img.c2webGL_texture=null,i.webGL_texture=null;this.has_loaded_textures=!1,this.updateAllCurrentTexture()}},e.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){var t,e,i;for(t=0,e=this.all_frames.length;t<e;++t)(i=this.all_frames[t]).webGL_texture=this.runtime.glwrap.loadTexture(i.texture_img,!1,this.runtime.linearSampling,i.pixelformat);this.updateAllCurrentTexture()}},e.loadTextures=function(){if(!this.is_family&&!this.has_loaded_textures&&this.runtime.glwrap){var t,e,i;for(t=0,e=this.all_frames.length;t<e;++t)(i=this.all_frames[t]).webGL_texture=this.runtime.glwrap.loadTexture(i.texture_img,!1,this.runtime.linearSampling,i.pixelformat);this.has_loaded_textures=!0}},e.unloadTextures=function(){if(!this.is_family&&!this.instances.length&&this.has_loaded_textures){var t,e,i;for(t=0,e=this.all_frames.length;t<e;++t)i=this.all_frames[t],this.runtime.glwrap.deleteTexture(i.webGL_texture),i.webGL_texture=null;this.has_loaded_textures=!1}};var r=[];e.preloadCanvas2D=function(t){var e,i,n;for(cr.clearArray(r),e=0,i=this.all_frames.length;e<i;++e)n=this.all_frames[e].texture_img,-1===r.indexOf(n)&&(t.drawImage(n,0,0),r.push(n))},t.Instance=function(t){this.type=t,this.runtime=t.runtime;var e=this.type.animations[0].frames[0].poly_pts;this.recycled?this.collision_poly.set_pts(e):this.collision_poly=new cr.CollisionPoly(e)};var n=t.Instance.prototype;function s(){}n.onCreate=function(){this.visible=this.properties[0],this.isTicking=!1,this.inAnimTrigger=!1,this.collisionsEnabled=this.properties[3],this.cur_animation=this.getAnimationByName(this.properties[1])||this.type.animations[0],this.cur_frame=this.properties[2],this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);var t,e,i,r,n,s,o,a,h=this.cur_animation.frames[this.cur_frame];for(this.collision_poly.set_pts(h.poly_pts),this.hotspotX=h.hotspotX,this.hotspotY=h.hotspotY,this.animForwards=this.cur_animation.speed>=0,this.cur_anim_speed=Math.abs(this.cur_animation.speed),this.cur_anim_repeatto=this.cur_animation.repeatto,1===this.type.animations.length&&1===this.type.animations[0].frames.length||0===this.cur_anim_speed||(this.runtime.tickMe(this),this.isTicking=!0),this.recycled?this.animTimer.reset():this.animTimer=new cr.KahanAdder,this.frameStart=this.getNowTime(),this.animPlaying=!0,this.animRepeats=0,this.animTriggerName="",this.changeAnimName="",this.changeAnimFrom=0,this.changeAnimFrame=-1,this.type.loadTextures(),t=0,e=this.type.animations.length;t<e;t++)for(i=0,r=(n=this.type.animations[t]).frames.length;i<r;i++)0===(s=n.frames[i]).width&&(s.width=s.texture_img.width,s.height=s.texture_img.height),s.spritesheeted&&(a=s.texture_img,(o=s.sheetTex).left=s.offx/a.width,o.top=s.offy/a.height,o.right=(s.offx+s.width)/a.width,o.bottom=(s.offy+s.height)/a.height,0===s.offx&&0===s.offy&&s.width===a.width&&s.height===a.height&&(s.spritesheeted=!1));this.curFrame=this.cur_animation.frames[this.cur_frame],this.curWebGLTexture=this.curFrame.webGL_texture},n.saveToJSON=function(){var t={a:this.cur_animation.sid,f:this.cur_frame,cas:this.cur_anim_speed,fs:this.frameStart,ar:this.animRepeats,at:this.animTimer.sum,rt:this.cur_anim_repeatto};return this.animPlaying||(t.ap=this.animPlaying),this.animForwards||(t.af=this.animForwards),t},n.loadFromJSON=function(t){var e=this.getAnimationBySid(t.a);e&&(this.cur_animation=e),this.cur_frame=t.f,this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),this.cur_anim_speed=t.cas,this.frameStart=t.fs,this.animRepeats=t.ar,this.animTimer.reset(),this.animTimer.sum=t.at,this.animPlaying=!t.hasOwnProperty("ap")||t.ap,this.animForwards=!t.hasOwnProperty("af")||t.af,t.hasOwnProperty("rt")?this.cur_anim_repeatto=t.rt:this.cur_anim_repeatto=this.cur_animation.repeatto,this.curFrame=this.cur_animation.frames[this.cur_frame],this.curWebGLTexture=this.curFrame.webGL_texture,this.collision_poly.set_pts(this.curFrame.poly_pts),this.hotspotX=this.curFrame.hotspotX,this.hotspotY=this.curFrame.hotspotY},n.animationFinish=function(t){this.cur_frame=t?0:this.cur_animation.frames.length-1,this.animPlaying=!1,this.animTriggerName=this.cur_animation.name,this.inAnimTrigger=!0,this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished,this),this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnimFinished,this),this.inAnimTrigger=!1,this.animRepeats=0},n.getNowTime=function(){return this.animTimer.sum},n.tick=function(){this.animTimer.add(this.runtime.getDt(this)),this.changeAnimName.length&&this.doChangeAnim(),this.changeAnimFrame>=0&&this.doChangeAnimFrame();var t,e=this.getNowTime(),i=this.cur_animation,r=i.frames[this.cur_frame],n=r.duration/this.cur_anim_speed;this.animPlaying&&e>=this.frameStart+n&&(this.animForwards?this.cur_frame++:this.cur_frame--,this.frameStart+=n,this.cur_frame>=i.frames.length&&(i.pingpong?(this.animForwards=!1,this.cur_frame=i.frames.length-2):i.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=i.repeatcount?this.animationFinish(!1):this.cur_frame=this.cur_anim_repeatto)),this.cur_frame<0&&(i.pingpong?(this.cur_frame=1,this.animForwards=!0,i.loop||(this.animRepeats++,this.animRepeats>=i.repeatcount&&this.animationFinish(!0))):i.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=i.repeatcount?this.animationFinish(!0):this.cur_frame=this.cur_anim_repeatto)),this.cur_frame<0?this.cur_frame=0:this.cur_frame>=i.frames.length&&(this.cur_frame=i.frames.length-1),e>this.frameStart+i.frames[this.cur_frame].duration/this.cur_anim_speed&&(this.frameStart=e),t=i.frames[this.cur_frame],this.OnFrameChanged(r,t),this.runtime.redraw=!0)},n.getAnimationByName=function(t){var e,i,r;for(e=0,i=this.type.animations.length;e<i;e++)if(r=this.type.animations[e],cr.equals_nocase(r.name,t))return r;return null},n.getAnimationBySid=function(t){var e,i,r;for(e=0,i=this.type.animations.length;e<i;e++)if((r=this.type.animations[e]).sid===t)return r;return null},n.doChangeAnim=function(){var t=this.cur_animation.frames[this.cur_frame],e=this.getAnimationByName(this.changeAnimName);this.changeAnimName="",e&&(cr.equals_nocase(e.name,this.cur_animation.name)&&this.animPlaying||(this.cur_animation=e,this.animForwards=e.speed>=0,this.cur_anim_speed=Math.abs(e.speed),this.cur_anim_repeatto=e.repeatto,this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),1===this.changeAnimFrom&&(this.cur_frame=0),this.animPlaying=!0,this.frameStart=this.getNowTime(),this.OnFrameChanged(t,this.cur_animation.frames[this.cur_frame]),this.runtime.redraw=!0))},n.doChangeAnimFrame=function(){var t=this.cur_animation.frames[this.cur_frame],e=this.cur_frame;this.cur_frame=cr.floor(this.changeAnimFrame),this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),e!==this.cur_frame&&(this.OnFrameChanged(t,this.cur_animation.frames[this.cur_frame]),this.frameStart=this.getNowTime(),this.runtime.redraw=!0),this.changeAnimFrame=-1},n.OnFrameChanged=function(t,e){var i,r,n,s=t.width,o=t.height,a=e.width,h=e.height;for(s!=a&&(this.width*=a/s),o!=h&&(this.height*=h/o),this.hotspotX=e.hotspotX,this.hotspotY=e.hotspotY,this.collision_poly.set_pts(e.poly_pts),this.set_bbox_changed(),this.curFrame=e,this.curWebGLTexture=e.webGL_texture,i=0,r=this.behavior_insts.length;i<r;i++)(n=this.behavior_insts[i]).onSpriteFrameChanged&&n.onSpriteFrameChanged(t,e);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnFrameChanged,this)},n.draw=function(t){t.globalAlpha=this.opacity;var e=this.curFrame,i=e.spritesheeted,r=e.texture_img,n=this.x,s=this.y,o=this.width,a=this.height;if(0===this.angle&&o>=0&&a>=0)n-=this.hotspotX*o,s-=this.hotspotY*a,this.runtime.pixel_rounding&&(n=Math.round(n),s=Math.round(s)),i?t.drawImage(r,e.offx,e.offy,e.width,e.height,n,s,o,a):t.drawImage(r,n,s,o,a);else{this.runtime.pixel_rounding&&(n=Math.round(n),s=Math.round(s)),t.save();var h=o>0?1:-1,c=a>0?1:-1;t.translate(n,s),1===h&&1===c||t.scale(h,c),t.rotate(this.angle*h*c);var l=0-this.hotspotX*cr.abs(o),u=0-this.hotspotY*cr.abs(a);i?t.drawImage(r,e.offx,e.offy,e.width,e.height,l,u,cr.abs(o),cr.abs(a)):t.drawImage(r,l,u,cr.abs(o),cr.abs(a)),t.restore()}},n.drawGL_earlyZPass=function(t){this.drawGL(t)},n.drawGL=function(t){t.setTexture(this.curWebGLTexture),t.setOpacity(this.opacity);var e=this.curFrame,i=this.bquad;if(this.runtime.pixel_rounding){var r=Math.round(this.x)-this.x,n=Math.round(this.y)-this.y;e.spritesheeted?t.quadTex(i.tlx+r,i.tly+n,i.trx+r,i.try_+n,i.brx+r,i.bry+n,i.blx+r,i.bly+n,e.sheetTex):t.quad(i.tlx+r,i.tly+n,i.trx+r,i.try_+n,i.brx+r,i.bry+n,i.blx+r,i.bly+n)}else e.spritesheeted?t.quadTex(i.tlx,i.tly,i.trx,i.try_,i.brx,i.bry,i.blx,i.bly,e.sheetTex):t.quad(i.tlx,i.tly,i.trx,i.try_,i.brx,i.bry,i.blx,i.bly)},n.getImagePointIndexByName=function(t){var e,i,r=this.curFrame;for(e=0,i=r.image_points.length;e<i;e++)if(cr.equals_nocase(t,r.image_points[e][0]))return e;return-1},n.getImagePoint=function(t,e){var i,r=this.curFrame,n=r.image_points;if(i=cr.is_string(t)?this.getImagePointIndexByName(t):t-1,(i=cr.floor(i))<0||i>=n.length)return e?this.x:this.y;var s=(n[i][1]-r.hotspotX)*this.width,o=n[i][2];o=(o-r.hotspotY)*this.height;var a=Math.cos(this.angle),h=Math.sin(this.angle),c=s*a-o*h;return o=o*a+s*h,s=c,s+=this.x,o+=this.y,e?s:o};var o=[];function a(t){t[0]=0,t[1]=0,t[2]=0,o.push(t)}function h(t,e){return t<e?t+","+e:e+","+t}function c(t,e,i,r){var n=e.uid,s=i.uid,a=h(n,s);if(t.hasOwnProperty(a))t[a][2]=r;else{var c=o.length?o.pop():[0,0,0];c[0]=n,c[1]=s,c[2]=r,t[a]=c}}function l(t,e,i){var r=h(e.uid,i.uid);t.hasOwnProperty(r)&&(a(t[r]),delete t[r])}var u=-2;function p(t,e,i){var r=h(e.uid,i.uid);return t.hasOwnProperty(r)?(u=t[r][2],!0):(u=-2,!1)}var d=[];s.prototype.OnCollision=function(t){if(!t)return!1;var e=this.runtime,i=e.getCurrentCondition(),r=i.type,n=null;i.extra.collmemory?n=i.extra.collmemory:(n={},i.extra.collmemory=n),i.extra.spriteCreatedDestroyCallback||(i.extra.spriteCreatedDestroyCallback=!0,e.addDestroyCallback((function(t){!function(t,e){var i,r,n=e.uid;for(i in t)t.hasOwnProperty(i)&&((r=t[i])[0]!==n&&r[1]!==n||(a(t[i]),delete t[i]))}(i.extra.collmemory,t)})));var s,o,h,f,g,y,m,_,v=r.getCurrentSol(),b=t.getCurrentSol(),w=v.getObjects(),x=this.runtime.tickcount,S=x-1,T=e.getCurrentEventStack().current_event;T.orblock;for(o=0;o<w.length;o++){for(h=w[o],b.select_all?(h.update_bbox(),this.runtime.getCollisionCandidates(h.layer,t,h.bbox,d),s=d,this.runtime.addRegisteredCollisionCandidates(h,t,s)):s=b.getObjects(),f=0;f<s.length;f++)g=s[f],e.testOverlap(h,g)||e.checkRegisteredCollision(h,g)?(_=!p(n,h,g)||u<S,c(n,h,g,x),_&&(e.pushCopySol(T.solModifiers),y=r.getCurrentSol(),m=t.getCurrentSol(),y.select_all=!1,m.select_all=!1,r===t?(y.instances.length=2,y.instances[0]=h,y.instances[1]=g,r.applySolToContainer()):(y.instances.length=1,m.instances.length=1,y.instances[0]=h,m.instances[0]=g,r.applySolToContainer(),t.applySolToContainer()),T.retrigger(),e.popSol(T.solModifiers))):l(n,h,g);cr.clearArray(d)}return!1};var f=null,g=new cr.ObjectSet,y=!1,m=[],_=new cr.rect(0,0,0,0);function v(t,e,i){if(!t)return!1;var r,n,s,o,a,h,c=0!==e||0!==i,l=!1,u=this.runtime.getCurrentCondition(),p=u.type,d=u.inverted,v=t.getCurrentSol(),b=this.runtime.getCurrentEventStack().current_event.orblock;for(v.select_all?(this.update_bbox(),_.copy(this.bbox),_.offset(e,i),this.runtime.getCollisionCandidates(this.layer,t,_,m),h=m):h=b?this.runtime.isCurrentConditionFirst()&&!v.else_instances.length&&v.instances.length?v.instances:v.else_instances:v.instances,f=t,y=p!==t&&!d,c&&(r=this.x,n=this.y,this.x+=e,this.y+=i,this.set_bbox_changed()),s=0,o=h.length;s<o;s++)if(a=h[s],this.runtime.testOverlap(this,a)){if(l=!0,d)break;p!==t&&g.add(a)}return c&&(this.x=r,this.y=n,this.set_bbox_changed()),cr.clearArray(m),l}function b(){}function w(){}e.finish=function(t){if(y){if(t){var e,i,r,n=this.runtime.getCurrentEventStack().current_event.orblock,s=f.getCurrentSol(),o=g.valuesRef();if(s.select_all){for(s.select_all=!1,cr.clearArray(s.instances),e=0,i=o.length;e<i;++e)s.instances[e]=o[e];if(n)for(cr.clearArray(s.else_instances),e=0,i=f.instances.length;e<i;++e)r=f.instances[e],g.contains(r)||s.else_instances.push(r)}else if(n){var a=s.instances.length;for(e=0,i=o.length;e<i;++e)s.instances[a+e]=o[e],cr.arrayFindRemove(s.else_instances,o[e])}else cr.shallowAssignArray(s.instances,o);f.applySolToContainer()}g.clear(),y=!1}},s.prototype.IsOverlapping=function(t){return v.call(this,t,0,0)},s.prototype.IsOverlappingOffset=function(t,e,i){return v.call(this,t,e,i)},s.prototype.IsAnimPlaying=function(t){return this.changeAnimName.length?cr.equals_nocase(this.changeAnimName,t):cr.equals_nocase(this.cur_animation.name,t)},s.prototype.CompareFrame=function(t,e){return cr.do_cmp(this.cur_frame,t,e)},s.prototype.CompareAnimSpeed=function(t,e){var i=this.animForwards?this.cur_anim_speed:-this.cur_anim_speed;return cr.do_cmp(i,t,e)},s.prototype.OnAnimFinished=function(t){return cr.equals_nocase(this.animTriggerName,t)},s.prototype.OnAnyAnimFinished=function(){return!0},s.prototype.OnFrameChanged=function(){return!0},s.prototype.IsMirrored=function(){return this.width<0},s.prototype.IsFlipped=function(){return this.height<0},s.prototype.OnURLLoaded=function(){return!0},s.prototype.IsCollisionEnabled=function(){return this.collisionsEnabled},t.cnds=new s,b.prototype.Spawn=function(t,e,i){if(t&&e){var r=this.runtime.createInstance(t,e,this.getImagePoint(i,!0),this.getImagePoint(i,!1));if(r){var n,s,o;if(void 0!==r.angle&&(r.angle=this.angle,r.set_bbox_changed()),this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(t.plugin).cnds.OnCreated,r),r.is_contained)for(n=0,s=r.siblings.length;n<s;n++)o=r.siblings[n],this.runtime.trigger(Object.getPrototypeOf(o.type.plugin).cnds.OnCreated,o);this.runtime.isInOnDestroy--;var a,h=this.runtime.getCurrentAction(),c=!1;if((cr.is_undefined(h.extra.Spawn_LastExec)||h.extra.Spawn_LastExec<this.runtime.execcount)&&(c=!0,h.extra.Spawn_LastExec=this.runtime.execcount),t!=this.type&&((a=t.getCurrentSol()).select_all=!1,c?(cr.clearArray(a.instances),a.instances[0]=r):a.instances.push(r),r.is_contained))for(n=0,s=r.siblings.length;n<s;n++)(a=(o=r.siblings[n]).type.getCurrentSol()).select_all=!1,c?(cr.clearArray(a.instances),a.instances[0]=o):a.instances.push(o)}}},b.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},b.prototype.StopAnim=function(){this.animPlaying=!1},b.prototype.StartAnim=function(t){this.animPlaying=!0,this.frameStart=this.getNowTime(),1===t&&0!==this.cur_frame&&(this.changeAnimFrame=0,this.inAnimTrigger||this.doChangeAnimFrame()),this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)},b.prototype.SetAnim=function(t,e){this.changeAnimName=t,this.changeAnimFrom=e,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0),this.inAnimTrigger||this.doChangeAnim()},b.prototype.SetAnimFrame=function(t){this.changeAnimFrame=t,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0),this.inAnimTrigger||this.doChangeAnimFrame()},b.prototype.SetAnimSpeed=function(t){this.cur_anim_speed=cr.abs(t),this.animForwards=t>=0,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)},b.prototype.SetAnimRepeatToFrame=function(t){(t=Math.floor(t))<0&&(t=0),t>=this.cur_animation.frames.length&&(t=this.cur_animation.frames.length-1),this.cur_anim_repeatto=t},b.prototype.SetMirrored=function(t){var e=cr.abs(this.width)*(0===t?-1:1);this.width!==e&&(this.width=e,this.set_bbox_changed())},b.prototype.SetFlipped=function(t){var e=cr.abs(this.height)*(0===t?-1:1);this.height!==e&&(this.height=e,this.set_bbox_changed())},b.prototype.SetScale=function(t){var e=this.curFrame,i=this.width<0?-1:1,r=this.height<0?-1:1,n=e.width*t*i,s=e.height*t*r;this.width===n&&this.height===s||(this.width=n,this.height=s,this.set_bbox_changed())},b.prototype.LoadURL=function(t,e,i){var r=new Image,n=this,s=this.curFrame;r.onload=function(){if(s.texture_img.src===r.src)return n.runtime.glwrap&&n.curFrame===s&&(n.curWebGLTexture=s.webGL_texture),0===e&&(n.width=r.width,n.height=r.height,n.set_bbox_changed()),n.runtime.redraw=!0,void n.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,n);s.texture_img=r,s.offx=0,s.offy=0,s.width=r.width,s.height=r.height,s.spritesheeted=!1,s.datauri="",s.pixelformat=0,n.runtime.glwrap&&(s.webGL_texture&&n.runtime.glwrap.deleteTexture(s.webGL_texture),s.webGL_texture=n.runtime.glwrap.loadTexture(r,!1,n.runtime.linearSampling),n.curFrame===s&&(n.curWebGLTexture=s.webGL_texture),n.type.updateAllCurrentTexture()),0===e&&(n.width=r.width,n.height=r.height,n.set_bbox_changed()),n.runtime.redraw=!0,n.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,n)},"data:"!==t.substr(0,5)&&0===i&&(r.crossOrigin="anonymous"),this.runtime.setImageSrc(r,t)},b.prototype.SetCollisions=function(t){this.collisionsEnabled!==(0!==t)&&(this.collisionsEnabled=0!==t,this.collisionsEnabled?this.set_bbox_changed():(this.collcells.right>=this.collcells.left&&this.type.collision_grid.update(this,this.collcells,null),this.collcells.set(0,0,-1,-1)))},t.acts=new b,w.prototype.AnimationFrame=function(t){t.set_int(this.cur_frame)},w.prototype.AnimationFrameCount=function(t){t.set_int(this.cur_animation.frames.length)},w.prototype.AnimationName=function(t){t.set_string(this.cur_animation.name)},w.prototype.AnimationSpeed=function(t){t.set_float(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed)},w.prototype.ImagePointX=function(t,e){t.set_float(this.getImagePoint(e,!0))},w.prototype.ImagePointY=function(t,e){t.set_float(this.getImagePoint(e,!1))},w.prototype.ImagePointCount=function(t){t.set_int(this.curFrame.image_points.length)},w.prototype.ImageWidth=function(t){t.set_float(this.curFrame.width)},w.prototype.ImageHeight=function(t){t.set_float(this.curFrame.height)},t.exps=new w}(),void 0===window)var window=void 0===window?"undefined"==typeof global?"undefined"==typeof self?this:self:global:window;globalThis.__CONSTRUCT2_RUNTIME2__=!1,globalThis.__CONSTRUCT3_RUNTIME2__=!0,globalThis.__CONSTRUCT3_RUNTIME3__=!1,globalThis.__DEBUG__=!1,cr.plugins_.ValerypopoffJSPlugin=function(t){this.runtime=t},function(){var pluginProto=cr.plugins_.ValerypopoffJSPlugin.prototype;pluginProto.Type=function(t){this.plugin=t,this.runtime=t.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){},pluginProto.Instance=function(t){this.type=t,this.runtime=t.runtime};var instanceProto=pluginProto.Instance.prototype;instanceProto.onCreate=function(){function t(t,e){if(void 0!==document){var i=document.createElement("script");i.setAttribute("type","text/javascript"),i.setAttribute("src",e),i.onreadystatechange=function(){"complete"==this.readyState&&t.sciptsToLoad--},i.onload=function(){t.sciptsToLoad--},i.onerror=function(){t.ShowError({debug_caller:"Including '"+e+"' script to the page",caller_name:"Including '"+e+"' script to the page",error_message:"Probably file not found"})},document.getElementsByTagName("head")[0].appendChild(i)}else t.ShowError({debug_caller:"Including '"+e+"' script to the page",caller_name:"Including '"+e+"' script to the page",error_message:"'document' is not defined. You're probably launching the game in a Worker. Workers are not supported yet. Export project with 'Use worker' option unchecked in the 'Advanced' section of the 'Project properties' panel."})}if(this.returnValue=void 0,this.sciptsToLoad=0,this.Aliases={},this.construct_compare_function_prefix="ConstructCompare_",this.AliasDotpartsCache={count:0,max_count:4096,Dotparts:{},AliasNames:{},AliasTrailers:{},IsAlias:{}},this.NonAliasDotpartsCache={count:0,max_count:2048,Dotparts:{}},""!=this.properties[0]){var e=[];e=__CONSTRUCT2_RUNTIME2__?this.properties[0].split(";"):this.properties[0].split(/[;\n\r]/);for(var i=0;i<e.length;i++)if(e[i]=e[i].trim(),0!=e[i].length&&(this.sciptsToLoad++,__CONSTRUCT2_RUNTIME2__&&t(this,e[i]),__CONSTRUCT3_RUNTIME2__&&t(this,this.runtime.getLocalFileUrl(e[i])),__CONSTRUCT3_RUNTIME3__)){var r=this;void 0!==r._runtime.GetAssetManager().LoadProjectFileUrl?r._runtime.GetAssetManager().LoadProjectFileUrl(e[i]).then((function(e){t(r,e)}),(function(t){r.ShowError({debug_caller:"Including '"+e[i]+"' script to the page",caller_name:"Including '"+e[i]+"' script to the page",error_message:t.message})})).catch((function(t){r.ShowError({debug_caller:"Including '"+e[i]+"' script to the page",caller_name:"Including '"+e[i]+"' script to the page",error_message:t.message})})):t(r,r._runtime.GetAssetManager().GetLocalFileUrl(e[i]))}}},instanceProto.saveToJSON=function(){return{}},instanceProto.loadFromJSON=function(t){},globalThis.IsValidIdentifier=function(t){return/^[$A-Z_][0-9A-Z_$]*$/i.test(t)},globalThis.DotStringToDotArray=function(t){for(var e=[],i=0,r=0,n=0,s=t.length;n<s;n++)"["!=t[n]?"]"!=t[n]?"."==t[n]&&i==r&&e.push(n):r++:i++;var o=[],a=e.length-1;return e.forEach((function(i,r,n){var s=e[r-1],h=t.substring(s+1,i);""!=h&&o.push(h),r==a&&""!=(h=t.substring(i+1))&&o.push(h)})),0==o.length&&o.push(t),o.forEach((function(t,e,i){"["==t[0]&&(i[e]=DotStringToDotArray(t.substring(1,t.length-1)))})),o},globalThis.HashtagParamsToCode=function(t,e){return t=t.replace(/#[0-9]+/g,(function(t){var i=e[t.substr(1)];return"string"==typeof i?"'"+i+"'":i}))},globalThis.MakeCallString=function(t,e){var i=t+"(";if(e)for(var r=0,n=e.length;r<n;++r)"string"==typeof e[r]?i=i+"'"+e[r]+"'":i+=e[r],r!=e.length-1&&(i+=",");return i+=")"};var InstanceFunctionsObject={Value(t,e){var i=e[0];e.splice(0,1);var r=this.ParseJS(i,!0,t);if(!r.error){var n=void 0;try{n=r.end}catch(e){var s={debug_caller:"Value",caller_name:t,"show-alias-expression":r.alias_found,alias_expression:r.trimmed_code,error_message:e.message};return this.ShowError(s),void ret.set_any(void 0)}return"function"==typeof r.end&&(n=this.CallJSfunction(i,e,!1,t,r)),n}ret.set_any(void 0)},CallJSfunction:function(t,e,i,r,n){if(void 0===i&&(i=!0),void 0===r&&(r="'Call function' action"),void 0===n)var s=this.ParseJS(t,!0,r);else s=n;if(!s.error){if(t.indexOf("(")>=0||t.indexOf(")")>=0){var o={debug_caller:"CallJSfunction",caller_name:r,error_message:"'"+s.trimmed_code+"' must be a function name, not a function call. Remove parentheses."};return s.alias_found&&(o["show-alias-expression"]=!0,o.alias_expression=s.trimmed_code),void this.ShowError(o)}var a=void 0;try{a=s.end.apply(s.context,e)}catch(i){i instanceof TypeError&&i.message.indexOf("apply")>=0&&i.message.indexOf("undefined")>=0&&(i.message=t+" is undefined");o={debug_caller:"CallJSfunction",caller_name:r,error_message:i.message};return s.alias_found?(o["show-alias-expression"]=!0,o.alias_expression=MakeCallString(s.trimmed_code,e),o["show-code"]=!0,o.code=MakeCallString(this.Aliases[s.alias_name].js+s.alias_trailer,e)):(o["show-code"]=!0,o.code=MakeCallString(s.trimmed_code,e)),void this.ShowError(o)}return i&&(this.returnValue=a),a}},CallAlias:function(t,e,i,r){void 0===i&&(i=!0),void 0===r&&(r="'Call alias' action");var n=this.ParseJS(t,!0,r);if(!n.error)return this.CallJSfunction(this.Aliases[n.alias_name].js+n.alias_trailer,e,i,r,n)},ShowError:function(t){var e="ValerypopoffJS plugin: Error in "+t.caller_name+"\n";e+="--------------------- \n",__DEBUG__&&(e+="DEBUG CALLER: "+t.debug_caller+"\n",e+="--------------------- \n"),t["show-alias-expression"]&&(e+="Alias expression: "+t.alias_expression+"\n",e+="--------------------- \n"),t["show-code"]&&(e+="JS code: "+t.code+"\n",e+="--------------------- \n"),e+=t.error_message,console.error(e)},Resolve:function(t,e,i,r,n){for(var s=window,o=s,a="",h=0,c=t.length;h<c;h++){if("object"==typeof(a=t[h])){var l=this.Resolve(a,e,i,r,n);if(l.error)return{error:!0};a=l.end;try{o=o[a]}catch(t){var u={debug_caller:"Resolve",caller_name:e,error_message:t.message,"show-code":!0,code:i};return r&&(u["show-alias-expression"]=!0,u.code=this.Aliases[r].js+n,u.alias_expression=i),this.ShowError(u),{error:!0}}}else try{s==window?IsValidIdentifier(a)?o=o[a]:("'"==a[0]&&(a=a.substring(1,a.length-1)),o=a):o=o[a]}catch(t){u={debug_caller:"Resolve",caller_name:e,error_message:t.message,"show-code":!0,code:i};return r&&(u["show-alias-expression"]=!0,u.code=this.Aliases[r].js+n,u.alias_expression=i),this.ShowError(u),{error:!0}}h<c-1&&(s=o)}return{error:!1,context:s,end:o,endname:a}},ParseJS:function(t,e,i){var r=!1,n=void 0,s=void 0,o=[],a=void 0,h=t.trim().replace(/\s*([\.\[\]])\s*/g,"$1");if((a=this.AliasDotpartsCache).Dotparts[h])o=a.Dotparts[h],a.IsAlias[h]&&(r=!0,n=a.AliasNames[h],s=a.AliasTrailers[h]);else{if(n=h.split(/[\.\[]/)[0],s=h.substring(n.length),this.Aliases[n]?(r=!0,o=s?DotStringToDotArray(this.Aliases[n].dotstring+s.split("[").join(".[")):DotStringToDotArray(this.Aliases[n].dotstring)):(n=void 0,s=void 0,o=DotStringToDotArray(h.split("[").join(".["))),a.count>=a.max_count)for(var c in a.Dotparts)if(delete a.Dotparts[c],a.IsAlias[c]&&(delete a.AliasNames[c],delete a.AliasTrailers[c],delete a.IsAlias[c]),a.count--,a.count<=a.max_count)break;a.Dotparts[h]=o,r&&(a.AliasNames[h]=n,a.AliasTrailers[h]=s,a.IsAlias[h]=!0),a.count++}var l=this.Resolve(o,i,h,n,s);return{error:l.error,end:l.end,endname:l.endname,context:l.context,trimmed_code:h,alias_found:r,alias_name:n,alias_trailer:s}}};for(var k in InstanceFunctionsObject)instanceProto[k]=InstanceFunctionsObject[k];function Cnds(){}var CndsObject={C2CompareFunctionReturnValue:function(t,e,i,r){switch(e){case 2:e=4;break;case 3:e=5;break;case 4:e=2;break;case 5:e=3}return this.CNDS.CompareFunctionReturnValue.call(this,i,r,e,t)},C2CompareAliasCallReturnValue:function(t,e,i,r){switch(e){case 2:e=4;break;case 3:e=5;break;case 4:e=2;break;case 5:e=3}return this.CNDS.CompareAliasCallReturnValue.call(this,i,r,e,t)},C2CompareExecReturnWithParams:function(t,e,i,r){switch(e){case 2:e=4;break;case 3:e=5;break;case 4:e=2;break;case 5:e=3}return this.CNDS.CompareExecReturnWithParams.call(this,i,r,e,t)},C2CompareValue:function(t,e,i,r){switch(e){case 2:e=4;break;case 3:e=5;break;case 4:e=2;break;case 5:e=3}return this.CNDS.CompareValue.call(this,i,r,e,t)},CompareExecReturnWithParams:function(code_,params_,cmp_,value_){var ret=void 0,caller_name_="'Compare JS code Completion value' condition";params_.length&&(code_=HashtagParamsToCode(code_,params_));try{ret=eval(code_)}catch(t){var info={debug_caller:"CompareExecReturnWithParams",caller_name:caller_name_,error_message:t.message,"show-code":!0,code:code_};return void this.ShowError(info)}return"boolean"==typeof ret&&(ret=ret?1:0),cr.do_cmp(ret,cmp_,value_)},CompareExecReturnWithParamsNonvar:function(code_,param1,param2,param3,param4,param5,cmp_,value_){var ret=void 0,caller_name_="'Compare JS code Completion value' condition",params_=[param1,param2,param3,param4,param5];params_.length&&(code_=HashtagParamsToCode(code_,params_));try{ret=eval(code_)}catch(t){var info={debug_caller:"CompareExecReturnWithParams",caller_name:caller_name_,error_message:t.message,"show-code":!0,code:code_};return void this.ShowError(info)}return"boolean"==typeof ret&&(ret=ret?1:0),cr.do_cmp(ret,cmp_,value_)},CompareFunctionReturnValue:function(t,e,i,r){var n=void 0;return"boolean"==typeof(n=this.CallJSfunction(t,e,!1,"'Compare Function return value' condition"))&&(n=n?1:0),cr.do_cmp(n,i,r)},CompareStoredReturnValue:function(t,e){var i=this.returnValue;return"boolean"==typeof i&&(i=i?1:0),cr.do_cmp(i,t,e)},AllScriptsLoaded:function(){return this.sciptsToLoad<=0},CompareValue:function(t,e,i,r){var n=void 0;return"boolean"==typeof(n=this.Value("'Compare Value' condition",[].concat(t,e)))&&(n=n?1:0),cr.do_cmp(n,i,r)},CompareValueNonvar:function(t,e,i,r,n,s,o,a){var h=void 0;return"boolean"==typeof(h=this.Value("'Compare Value' condition",[].concat(t,[e,i,r,n,s])))&&(h=h?1:0),cr.do_cmp(h,o,a)},CompareAliasValue:function(t,e,i){var r="'Compare alias' condition",n=this.ParseJS(t,!0,"'Set alias' action");if(n.alias_found){if(!n.error){var s=n.context[this.construct_compare_function_prefix+n.endname];if(!s||"object"!=typeof n.context){var o=n.end;return"boolean"==typeof o&&(o=o?1:0),cr.do_cmp(o,e,i)}try{return s.call(n.context,e,i)}catch(t){a={debug_caller:"CompareAliasValue",caller_name:r,"show-alias-expression":!0,alias_expression:n.trimmed_code,error_message:"Error in user defined '"+this.construct_compare_function_prefix+n.endname+"' function: "+t.message};return void this.ShowError(a)}}}else{var a={debug_caller:"CompareAliasValue",caller_name:r,error_message:"No such alias '"+t+"'"};this.ShowError(a)}},CompareAliasCallReturnValue:function(t,e,i,r){var n=void 0;return"boolean"==typeof(n=this.CallAlias(t,e,!1,"'Compare Alias Call return value' condition"))&&(n=n?1:0),cr.do_cmp(n,i,r)}};for(var k in CndsObject)Cnds.prototype[k]=CndsObject[k];function Acts(){}pluginProto.cnds=new Cnds;var ActsObject={ExecuteJSWithParams:function(code,params_){var caller_name_="'Execute JS code' action";this.returnValue=void 0,code=code.replace(/#[0-9]+/g,(function(t){var e=params_[t.substr(1)];return"string"==typeof e?"'"+e+"'":e}));try{this.returnValue=eval(code)}catch(t){return void this.ShowError({debug_caller:"ExecuteJSWithParams",caller_name:caller_name_,"show-code":!0,code:code,error_message:t.message})}},ExecuteJSWithParamsNonvar:function(code,param1,param2,param3,param4,param5){var caller_name_="'Execute JS code' action";this.returnValue=void 0;var params_=[param1,param2,param3,param4,param5];code=code.replace(/#[0-9]+/g,(function(t){var e=params_[t.substr(1)];return"string"==typeof e?"'"+e+"'":e}));try{this.returnValue=eval(code)}catch(t){return void this.ShowError({debug_caller:"ExecuteJSWithParams",caller_name:caller_name_,"show-code":!0,code:code,error_message:t.message})}},CallJSfunction:function(t,e,i,r,n){this.CallJSfunction(t,e,i,r,n)},SetValue:function(t,e){var i="'Set value' action",r=this.ParseJS(t,!0,i);if(!r.error)try{r.context[r.endname]=e}catch(o){var n=t+"=";"string"==typeof e?n=n+"'"+e+"'":n+=e;var s={debug_caller:"SetValue",caller_name:i,"show-alias-expression":r.alias_found,alias_expression:r.trimmed_code,"show-code":!0,code:n,error_message:o.message};return void this.ShowError(s)}},Call:function(t,e,i,r){this.CallJSfunction(t,e,!0,"'Call' action")},CallNonvar:function(t,e,i,r,n,s,o,a){this.CallJSfunction(t,[e,i,r,n,s],!0,"'Call' action")},InitAlias:function(t,e){var i="'Init alias' action";if(t=t.trim(),0!=(e=e.trim()).length)if(t.indexOf(".")>=0||t.indexOf("[")>=0||t.indexOf("]")>=0){n={debug_caller:"InitAlias",caller_name:i,error_message:"Alias name must not contain '.', '[' or ']' signs: '"+t+"'"};this.ShowError(n)}else if(null==this.Aliases[t]){var r=new Object;r.js=e,r.dotstring=e.split("[").join(".["),this.Aliases[t]=r}else{n={debug_caller:"InitAlias",caller_name:i,error_message:"Alias '"+t+"' already exists"};this.ShowError(n)}else{var n={debug_caller:"InitAlias",caller_name:i,error_message:"Javascript string of alias '"+t+"' must not be empty."};this.ShowError(n)}},SetAlias:function(t,e){var i="'Set alias' action",r=this.ParseJS(t,!0,"'Set alias' action");if(r.alias_found){if(!r.error)try{r.context[r.endname]=e}catch(o){var n=t+"=";"string"==typeof e?n=n+"'"+e+"'":n+=e;s={debug_caller:"SetAlias",caller_name:i,"show-alias-expression":!0,alias_expression:r.trimmed_code,"show-code":!0,code:n,error_message:o.message};return void this.ShowError(s)}}else{var s={debug_caller:"SetAlias",caller_name:i,error_message:"No such alias '"+r.trimmed_code+"'"};this.ShowError(s)}},CallAlias:function(t,e,i,r){this.CallAlias(t,e,i,r)}};for(var k in ActsObject)Acts.prototype[k]=ActsObject[k];function Exps(){}pluginProto.acts=new Acts;var ExpsObject={JSCodeValue:function(){var params_=Array.prototype.slice.call(arguments),ret;if(__CONSTRUCT3_RUNTIME3__)ret={set_int:function(){},set_float:function(){},set_string:function(){},set_any:function(){}};else{ret=params_[0];for(var i=0;i<params_.length-1;i++)params_[i]=params_[i+1];params_.pop()}var code_=params_[0],caller_name_="'JSCodeValue' expression",jscode=code_;params_.splice(0,1),params_.length&&(jscode=HashtagParamsToCode(jscode,params_));var jsret=void 0;try{jsret=eval(jscode)}catch(t){return this.ShowError({debug_caller:"JSCodeValue",caller_name:caller_name_,"show-code":!0,code:jscode,error_message:t.message}),void ret.set_any(void 0)}if("boolean"==typeof jsret){if(ret.set_any(jsret?1:0),__CONSTRUCT3_RUNTIME3__)return jsret?1:0}else if(ret.set_any(jsret),__CONSTRUCT3_RUNTIME3__)return jsret},StoredReturnValue:function(){var t,e=Array.prototype.slice.call(arguments);if(__CONSTRUCT3_RUNTIME3__)t={set_int:function(){},set_float:function(){},set_string:function(){},set_any:function(){}};else{t=e[0];for(var i=0;i<e.length-1;i++)e[i]=e[i+1];e.pop()}if("boolean"==typeof this.returnValue){if(t.set_any(this.returnValue?1:0),__CONSTRUCT3_RUNTIME3__)return this.returnValue?1:0}else if(t.set_any(this.returnValue),__CONSTRUCT3_RUNTIME3__)return this.returnValue},FunctionReturnValue:function(){var t,e=Array.prototype.slice.call(arguments);if(__CONSTRUCT3_RUNTIME3__)t={set_int:function(){},set_float:function(){},set_string:function(){},set_any:function(){}};else{t=e[0];for(var i=0;i<e.length-1;i++)e[i]=e[i+1];e.pop()}var r=e[0],n="'FunctionReturnValue' expression",s=this.ParseJS(r,!1,n);if(e.splice(0,1),s.error)t.set_any(void 0);else{var o;if("boolean"==typeof(o=this.CallJSfunction(r,e,!1,n,s))){if(t.set_any(o?1:0),__CONSTRUCT3_RUNTIME3__)return o?1:0}else if(t.set_any(o),__CONSTRUCT3_RUNTIME3__)return o}},Value:function(){var t,e=Array.prototype.slice.call(arguments);if(__CONSTRUCT3_RUNTIME3__)t={set_int:function(){},set_float:function(){},set_string:function(){},set_any:function(){}};else{t=e[0];for(var i=0;i<e.length-1;i++)e[i]=e[i+1];e.pop()}var r=this.Value("'Value' expression",e);if("boolean"==typeof r){if(t.set_any(r?1:0),__CONSTRUCT3_RUNTIME3__)return r?1:0}else if(t.set_any(r),__CONSTRUCT3_RUNTIME3__)return r},AliasValue:function(){var t,e=Array.prototype.slice.call(arguments);if(__CONSTRUCT3_RUNTIME3__)t={set_int:function(){},set_float:function(){},set_string:function(){},set_any:function(){}};else{t=e[0];for(var i=0;i<e.length-1;i++)e[i]=e[i+1];e.pop()}var r=e[0],n="'AliasValue' expression",s=this.ParseJS(r,!0,n);if(!s.alias_found){var o={debug_caller:"AliasValue",caller_name:n,error_message:"No such alias '"+s.trimmed_code+"'"};return this.ShowError(o),void t.set_any(void 0)}if(s.error)t.set_any(void 0);else{var a=void 0;try{a=s.end}catch(e){o={debug_caller:"AliasValue",caller_name:n,"show-alias-expression":!0,alias_expression:s.trimmed_code,error_message:e.message};return this.ShowError(o),void t.set_any(void 0)}if("boolean"==typeof a){if(t.set_any(a?1:0),__CONSTRUCT3_RUNTIME3__)return a?1:0}else if(t.set_any(a),__CONSTRUCT3_RUNTIME3__)return a}},AliasCallReturnValue:function(){var t,e=Array.prototype.slice.call(arguments);if(__CONSTRUCT3_RUNTIME3__)t={set_int:function(){},set_float:function(){},set_string:function(){},set_any:function(){}};else{t=e[0];for(var i=0;i<e.length-1;i++)e[i]=e[i+1];e.pop()}var r=e[0],n="'AliasCallValue' expression",s=this.ParseJS(r,!0,n);if(e.splice(0,1),!s.alias_found){var o={debug_caller:"AliasCallValue",caller_name:n,error_message:"No such alias '"+s.trimmed_code+"'"};return this.ShowError(o),void t.set_any(void 0)}if(s.error)t.set_any(void 0);else{var a;if("boolean"==typeof(a=this.CallJSfunction(r,e,!1,n,s))){if(t.set_any(a?1:0),__CONSTRUCT3_RUNTIME3__)return a?1:0}else if(t.set_any(a),__CONSTRUCT3_RUNTIME3__)return a}}};for(var k in ExpsObject)Exps.prototype[k]=ExpsObject[k];pluginProto.exps=new Exps,instanceProto.EXPS=pluginProto.exps,instanceProto.CNDS=pluginProto.cnds,instanceProto.ACTS=pluginProto.acts}(),cr.plugins_.Touch=function(t){this.runtime=t},function(){var t=cr.plugins_.Touch.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime,this.touches=[],this.mouseDown=!1};var e=t.Instance.prototype;e.findTouch=function(t){var e,i;for(e=0,i=this.touches.length;e<i;e++)if(this.touches[e].id===t)return e;return-1};var i=0,r=0,n=0;function s(t){i=t.x,r=t.y,n=t.z}var o=[];function a(t,e,i,r){var n;return(n=o.length?o.pop():new c).init(t,e,i,r),n}function h(t){o.length<100&&o.push(t)}function c(){this.starttime=0,this.time=0,this.lasttime=0,this.startx=0,this.starty=0,this.x=0,this.y=0,this.lastx=0,this.lasty=0,this.id=0,this.startindex=0,this.triggeredHold=!1,this.tooFarForHold=!1}c.prototype.init=function(t,e,i,r){var n=cr.performance_now();this.time=n,this.lasttime=n,this.starttime=n,this.startx=t,this.starty=e,this.x=t,this.y=e,this.lastx=t,this.lasty=e,this.width=0,this.height=0,this.pressure=0,this.id=i,this.startindex=r,this.triggeredHold=!1,this.tooFarForHold=!1},c.prototype.update=function(t,e,i,r,n,s){this.lasttime=this.time,this.time=t,this.lastx=this.x,this.lasty=this.y,this.x=e,this.y=i,this.width=r,this.height=n,this.pressure=s,!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)>=15&&(this.tooFarForHold=!0)},c.prototype.maybeTriggerHold=function(t,e){this.triggeredHold||cr.performance_now()-this.starttime>=500&&!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)<15&&(this.triggeredHold=!0,t.trigger_index=this.startindex,t.trigger_id=this.id,t.getTouchIndex=e,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGesture,t),t.curTouchX=this.x,t.curTouchY=this.y,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGestureObject,t),t.getTouchIndex=0)};var l=-1e3,u=-1e3,p=-1e4;c.prototype.maybeTriggerTap=function(t,e){if(!this.triggeredHold){var i=cr.performance_now();i-this.starttime<=333&&!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)<15&&(t.trigger_index=this.startindex,t.trigger_id=this.id,t.getTouchIndex=e,i-p<=666&&cr.distanceTo(l,u,this.x,this.y)<25?(t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGesture,t),t.curTouchX=this.x,t.curTouchY=this.y,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGestureObject,t),l=-1e3,u=-1e3,p=-1e4):(t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGesture,t),t.curTouchX=this.x,t.curTouchY=this.y,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGestureObject,t),l=this.x,u=this.y,p=i),t.getTouchIndex=0)}},e.onCreate=function(){this,this.isWindows8=!(void 0===window.c2isWindows8||!window.c2isWindows8),this.orient_alpha=0,this.orient_beta=0,this.orient_gamma=0,this.acc_g_x=0,this.acc_g_y=0,this.acc_g_z=0,this.acc_x=0,this.acc_y=0,this.acc_z=0,this.curTouchX=0,this.curTouchY=0,this.trigger_index=0,this.trigger_id=0,this.trigger_permission=0,this.getTouchIndex=0,this.useMouseInput=this.properties[0];var t=this.runtime.fullscreen_mode>0?document:this.runtime.canvas,e=document,i=this;if("undefined"!=typeof PointerEvent?(t.addEventListener("pointerdown",(function(t){i.onPointerStart(t)}),!1),t.addEventListener("pointermove",(function(t){i.onPointerMove(t)}),!1),e.addEventListener("pointerup",(function(t){i.onPointerEnd(t,!1)}),!1),e.addEventListener("pointercancel",(function(t){i.onPointerEnd(t,!0)}),!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",(function(t){t.preventDefault()}),!1),document.addEventListener("MSGestureHold",(function(t){t.preventDefault()}),!1),this.runtime.canvas.addEventListener("gesturehold",(function(t){t.preventDefault()}),!1),document.addEventListener("gesturehold",(function(t){t.preventDefault()}),!1))):window.navigator.msPointerEnabled?(t.addEventListener("MSPointerDown",(function(t){i.onPointerStart(t)}),!1),t.addEventListener("MSPointerMove",(function(t){i.onPointerMove(t)}),!1),e.addEventListener("MSPointerUp",(function(t){i.onPointerEnd(t,!1)}),!1),e.addEventListener("MSPointerCancel",(function(t){i.onPointerEnd(t,!0)}),!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",(function(t){t.preventDefault()}),!1),document.addEventListener("MSGestureHold",(function(t){t.preventDefault()}),!1))):(t.addEventListener("touchstart",(function(t){i.onTouchStart(t)}),!1),t.addEventListener("touchmove",(function(t){i.onTouchMove(t)}),!1),e.addEventListener("touchend",(function(t){i.onTouchEnd(t,!1)}),!1),e.addEventListener("touchcancel",(function(t){i.onTouchEnd(t,!0)}),!1)),this.isWindows8){var r=function(t){var e=t.reading;i.acc_x=e.accelerationX,i.acc_y=e.accelerationY,i.acc_z=e.accelerationZ},n=function(t){var e=t.reading;i.orient_alpha=e.yawDegrees,i.orient_beta=e.pitchDegrees,i.orient_gamma=e.rollDegrees},o=Windows.Devices.Sensors.Accelerometer.getDefault();o&&(o.reportInterval=Math.max(o.minimumReportInterval,16),o.addEventListener("readingchanged",r));var a=Windows.Devices.Sensors.Inclinometer.getDefault();a&&(a.reportInterval=Math.max(a.minimumReportInterval,16),a.addEventListener("readingchanged",n)),document.addEventListener("visibilitychange",(function(t){document.hidden||document.msHidden?(o&&o.removeEventListener("readingchanged",r),a&&a.removeEventListener("readingchanged",n)):(o&&o.addEventListener("readingchanged",r),a&&a.addEventListener("readingchanged",n))}),!1)}else window.addEventListener("deviceorientation",(function(t){i.orient_alpha=t.alpha||0,i.orient_beta=t.beta||0,i.orient_gamma=t.gamma||0}),!1),window.addEventListener("devicemotion",(function(t){t.accelerationIncludingGravity&&(i.acc_g_x=t.accelerationIncludingGravity.x||0,i.acc_g_y=t.accelerationIncludingGravity.y||0,i.acc_g_z=t.accelerationIncludingGravity.z||0),t.acceleration&&(i.acc_x=t.acceleration.x||0,i.acc_y=t.acceleration.y||0,i.acc_z=t.acceleration.z||0)}),!1);this.useMouseInput&&(document.addEventListener("mousemove",(function(t){i.onMouseMove(t)})),document.addEventListener("mousedown",(function(t){i.onMouseDown(t)})),document.addEventListener("mouseup",(function(t){i.onMouseUp(t)}))),!this.runtime.isiOS&&this.runtime.isCordova&&navigator.accelerometer&&navigator.accelerometer.watchAcceleration&&navigator.accelerometer.watchAcceleration(s,null,{frequency:40}),this.runtime.tick2Me(this)},e.onPointerMove=function(t){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType){t.preventDefault&&t.preventDefault();var e=this.findTouch(t.pointerId),i=cr.performance_now();if(e>=0){var r=this.runtime.canvas.offsetLeft,n=this.runtime.canvas.offsetTop,s=this.touches[e];if(i-s.time<2)return;s.update(i,t.pageX-r,t.pageY-n,t.width||0,t.height||0,t.pressure||0)}}},e.onPointerStart=function(t){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType&&-1===this.findTouch(t.pointerId)){t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault();var e=this.runtime.canvas.offsetLeft,i=this.runtime.canvas.offsetTop,r=t.pageX-e,n=t.pageY-i;cr.performance_now();this.trigger_index=this.touches.length,this.trigger_id=t.pointerId,this.touches.push(a(r,n,t.pointerId,this.trigger_index)),this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this),this.curTouchX=r,this.curTouchY=n,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this),this.runtime.isInUserInputEvent=!1}},e.onPointerEnd=function(t,e){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType){t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault();var i=this.findTouch(t.pointerId);this.trigger_index=i>=0?this.touches[i].startindex:-1,this.trigger_id=i>=0?this.touches[i].id:-1,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),i>=0&&(e||this.touches[i].maybeTriggerTap(this,i),h(this.touches[i]),this.touches.splice(i,1)),this.runtime.isInUserInputEvent=!1}},e.onTouchMove=function(t){t.preventDefault&&t.preventDefault();var e,i,r,n,s=cr.performance_now();for(e=0,i=t.changedTouches.length;e<i;e++){r=t.changedTouches[e];var o=this.findTouch(r.identifier);if(o>=0){var a=this.runtime.canvas.offsetLeft,h=this.runtime.canvas.offsetTop;if(s-(n=this.touches[o]).time<2)continue;var c=2*(r.radiusX||r.webkitRadiusX||r.mozRadiusX||r.msRadiusX||0),l=2*(r.radiusY||r.webkitRadiusY||r.mozRadiusY||r.msRadiusY||0),u=r.force||r.webkitForce||r.mozForce||r.msForce||0;n.update(s,r.pageX-a,r.pageY-h,c,l,u)}}},e.onTouchStart=function(t){t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault();var e,i,r,n=this.runtime.canvas.offsetLeft,s=this.runtime.canvas.offsetTop;cr.performance_now();for(this.runtime.isInUserInputEvent=!0,e=0,i=t.changedTouches.length;e<i;e++)if(r=t.changedTouches[e],-1===this.findTouch(r.identifier)){var o=r.pageX-n,h=r.pageY-s;this.trigger_index=this.touches.length,this.trigger_id=r.identifier,this.touches.push(a(o,h,r.identifier,this.trigger_index)),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this),this.curTouchX=o,this.curTouchY=h,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this)}this.runtime.isInUserInputEvent=!1},e.onTouchEnd=function(t,e){var i,r,n,s;for(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),this.runtime.isInUserInputEvent=!0,i=0,r=t.changedTouches.length;i<r;i++)n=t.changedTouches[i],(s=this.findTouch(n.identifier))>=0&&(this.trigger_index=this.touches[s].startindex,this.trigger_id=this.touches[s].id,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),e||this.touches[s].maybeTriggerTap(this,s),h(this.touches[s]),this.touches.splice(s,1));this.runtime.isInUserInputEvent=!1},e.getAlpha=function(){return this.runtime.isCordova&&0===this.orient_alpha&&0!==n?90*n:this.orient_alpha},e.getBeta=function(){return this.runtime.isCordova&&0===this.orient_beta&&0!==r?90*r:this.orient_beta},e.getGamma=function(){return this.runtime.isCordova&&0===this.orient_gamma&&0!==i?90*i:this.orient_gamma};function d(t){return t.sourceCapabilities&&t.sourceCapabilities.firesTouchEvents||t.originalEvent&&t.originalEvent.sourceCapabilities&&t.originalEvent.sourceCapabilities.firesTouchEvents}function f(){}e.onMouseDown=function(t){if(!d(t)){var e={changedTouches:[{pageX:t.pageX,pageY:t.pageY,identifier:0}]};this.onTouchStart(e),this.mouseDown=!0}},e.onMouseMove=function(t){if(this.mouseDown&&!d(t)){var e={changedTouches:[{pageX:t.pageX,pageY:t.pageY,identifier:0}]};this.onTouchMove(e)}},e.onMouseUp=function(t){if(t.preventDefault&&this.runtime.had_a_click&&!this.runtime.isMobile&&t.preventDefault(),this.runtime.had_a_click=!0,!d(t)){var e={changedTouches:[{pageX:t.pageX,pageY:t.pageY,identifier:0}]};this.onTouchEnd(e),this.mouseDown=!1}},e.isClientPosOverCanvas=function(t,e){return t>=0&&e>=0&&t<this.runtime.width&&e<this.runtime.height},e.tick2=function(){var t,e,i,r=cr.performance_now();for(t=0,e=this.touches.length;t<e;++t)(i=this.touches[t]).time<=r-50&&(i.lasttime=r),i.maybeTriggerHold(this,t)},f.prototype.OnTouchStart=function(){return!0},f.prototype.OnTouchEnd=function(){return!0},f.prototype.IsInTouch=function(){return this.touches.length},f.prototype.OnTouchObject=function(t){return!!t&&(!!this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1))};var g=[];function y(){}function m(){}f.prototype.IsTouchingObject=function(t){if(!t)return!1;var e,i,r,n,s,o,a=t.getCurrentSol(),h=a.getObjects();for(r=0,n=h.length;r<n;r++){var c=h[r];for(c.update_bbox(),s=0,o=this.touches.length;s<o;s++){var l=this.touches[s];if(this.isClientPosOverCanvas(l.x,l.y)&&(e=c.layer.canvasToLayer(l.x,l.y,!0),i=c.layer.canvasToLayer(l.x,l.y,!1),c.contains_pt(e,i))){g.push(c);break}}}return!!g.length&&(a.select_all=!1,cr.shallowAssignArray(a.instances,g),t.applySolToContainer(),cr.clearArray(g),!0)},f.prototype.CompareTouchSpeed=function(t,e,i){if((t=Math.floor(t))<0||t>=this.touches.length)return!1;var r=this.touches[t],n=cr.distanceTo(r.x,r.y,r.lastx,r.lasty),s=(r.time-r.lasttime)/1e3,o=0;return s>0&&(o=n/s),cr.do_cmp(o,e,i)},f.prototype.OrientationSupported=function(){return void 0!==window.DeviceOrientationEvent},f.prototype.MotionSupported=function(){return void 0!==window.DeviceMotionEvent},f.prototype.CompareOrientation=function(t,e,i){var r=0;return r=0===t?this.getAlpha():1===t?this.getBeta():this.getGamma(),cr.do_cmp(r,e,i)},f.prototype.CompareAcceleration=function(t,e,i){var r=0;return 0===t?r=this.acc_g_x:1===t?r=this.acc_g_y:2===t?r=this.acc_g_z:3===t?r=this.acc_x:4===t?r=this.acc_y:5===t&&(r=this.acc_z),cr.do_cmp(r,e,i)},f.prototype.OnNthTouchStart=function(t){return(t=Math.floor(t))===this.trigger_index},f.prototype.OnNthTouchEnd=function(t){return(t=Math.floor(t))===this.trigger_index},f.prototype.HasNthTouch=function(t){return t=Math.floor(t),this.touches.length>=t+1},f.prototype.OnHoldGesture=function(){return!0},f.prototype.OnTapGesture=function(){return!0},f.prototype.OnDoubleTapGesture=function(){return!0},f.prototype.OnHoldGestureObject=function(t){return!!t&&(!!this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1))},f.prototype.OnTapGestureObject=function(t){return!!t&&(!!this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1))},f.prototype.OnDoubleTapGestureObject=function(t){return!!t&&(!!this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1))},f.prototype.OnPermissionGranted=function(t){return this.trigger_permission===t},f.prototype.OnPermissionDenied=function(t){return this.trigger_permission===t},t.cnds=new f,y.prototype.RequestPermission=function(t){var e=this,i=Promise.resolve(!0);0===t?window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission&&(i=window.DeviceOrientationEvent.requestPermission().then((function(t){return"granted"===t}))):window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission&&(i=window.DeviceMotionEvent.requestPermission().then((function(t){return"granted"===t}))),i.then((function(i){e.trigger_permission=t,i?e.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnPermissionGranted,e):e.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnPermissionDenied,e)}))},t.acts=new y,m.prototype.TouchCount=function(t){t.set_int(this.touches.length)},m.prototype.X=function(t,e){var i,r,n,s,o,a=this.getTouchIndex;a<0||a>=this.touches.length?t.set_float(0):cr.is_undefined(e)?(r=(i=this.runtime.getLayerByNumber(0)).scale,n=i.zoomRate,s=i.parallaxX,o=i.angle,i.scale=1,i.zoomRate=1,i.parallaxX=1,i.angle=0,t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!0)),i.scale=r,i.zoomRate=n,i.parallaxX=s,i.angle=o):(i=cr.is_number(e)?this.runtime.getLayerByNumber(e):this.runtime.getLayerByName(e))?t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!0)):t.set_float(0)},m.prototype.XAt=function(t,e,i){var r,n,s,o,a;(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):cr.is_undefined(i)?(n=(r=this.runtime.getLayerByNumber(0)).scale,s=r.zoomRate,o=r.parallaxX,a=r.angle,r.scale=1,r.zoomRate=1,r.parallaxX=1,r.angle=0,t.set_float(r.canvasToLayer(this.touches[e].x,this.touches[e].y,!0)),r.scale=n,r.zoomRate=s,r.parallaxX=o,r.angle=a):(r=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(r.canvasToLayer(this.touches[e].x,this.touches[e].y,!0)):t.set_float(0)},m.prototype.XForID=function(t,e,i){var r=this.findTouch(e);if(r<0)t.set_float(0);else{var n,s,o,a,h,c=this.touches[r];cr.is_undefined(i)?(s=(n=this.runtime.getLayerByNumber(0)).scale,o=n.zoomRate,a=n.parallaxX,h=n.angle,n.scale=1,n.zoomRate=1,n.parallaxX=1,n.angle=0,t.set_float(n.canvasToLayer(c.x,c.y,!0)),n.scale=s,n.zoomRate=o,n.parallaxX=a,n.angle=h):(n=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(n.canvasToLayer(c.x,c.y,!0)):t.set_float(0)}},m.prototype.Y=function(t,e){var i,r,n,s,o,a=this.getTouchIndex;a<0||a>=this.touches.length?t.set_float(0):cr.is_undefined(e)?(r=(i=this.runtime.getLayerByNumber(0)).scale,n=i.zoomRate,s=i.parallaxY,o=i.angle,i.scale=1,i.zoomRate=1,i.parallaxY=1,i.angle=0,t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!1)),i.scale=r,i.zoomRate=n,i.parallaxY=s,i.angle=o):(i=cr.is_number(e)?this.runtime.getLayerByNumber(e):this.runtime.getLayerByName(e))?t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!1)):t.set_float(0)},m.prototype.YAt=function(t,e,i){var r,n,s,o,a;(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):cr.is_undefined(i)?(n=(r=this.runtime.getLayerByNumber(0)).scale,s=r.zoomRate,o=r.parallaxY,a=r.angle,r.scale=1,r.zoomRate=1,r.parallaxY=1,r.angle=0,t.set_float(r.canvasToLayer(this.touches[e].x,this.touches[e].y,!1)),r.scale=n,r.zoomRate=s,r.parallaxY=o,r.angle=a):(r=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(r.canvasToLayer(this.touches[e].x,this.touches[e].y,!1)):t.set_float(0)},m.prototype.YForID=function(t,e,i){var r=this.findTouch(e);if(r<0)t.set_float(0);else{var n,s,o,a,h,c=this.touches[r];cr.is_undefined(i)?(s=(n=this.runtime.getLayerByNumber(0)).scale,o=n.zoomRate,a=n.parallaxY,h=n.angle,n.scale=1,n.zoomRate=1,n.parallaxY=1,n.angle=0,t.set_float(n.canvasToLayer(c.x,c.y,!1)),n.scale=s,n.zoomRate=o,n.parallaxY=a,n.angle=h):(n=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(n.canvasToLayer(c.x,c.y,!1)):t.set_float(0)}},m.prototype.AbsoluteX=function(t){this.touches.length?t.set_float(this.touches[0].x):t.set_float(0)},m.prototype.AbsoluteXAt=function(t,e){(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):t.set_float(this.touches[e].x)},m.prototype.AbsoluteXForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var r=this.touches[i];t.set_float(r.x)}},m.prototype.AbsoluteY=function(t){this.touches.length?t.set_float(this.touches[0].y):t.set_float(0)},m.prototype.AbsoluteYAt=function(t,e){(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):t.set_float(this.touches[e].y)},m.prototype.AbsoluteYForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var r=this.touches[i];t.set_float(r.y)}},m.prototype.SpeedAt=function(t,e){if((e=Math.floor(e))<0||e>=this.touches.length)t.set_float(0);else{var i=this.touches[e],r=cr.distanceTo(i.x,i.y,i.lastx,i.lasty),n=(i.time-i.lasttime)/1e3;n<=0?t.set_float(0):t.set_float(r/n)}},m.prototype.SpeedForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var r=this.touches[i],n=cr.distanceTo(r.x,r.y,r.lastx,r.lasty),s=(r.time-r.lasttime)/1e3;s<=0?t.set_float(0):t.set_float(n/s)}},m.prototype.AngleAt=function(t,e){if((e=Math.floor(e))<0||e>=this.touches.length)t.set_float(0);else{var i=this.touches[e];t.set_float(cr.to_degrees(cr.angleTo(i.lastx,i.lasty,i.x,i.y)))}},m.prototype.AngleForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var r=this.touches[i];t.set_float(cr.to_degrees(cr.angleTo(r.lastx,r.lasty,r.x,r.y)))}},m.prototype.Alpha=function(t){t.set_float(this.getAlpha())},m.prototype.Beta=function(t){t.set_float(this.getBeta())},m.prototype.Gamma=function(t){t.set_float(this.getGamma())},m.prototype.AccelerationXWithG=function(t){t.set_float(this.acc_g_x)},m.prototype.AccelerationYWithG=function(t){t.set_float(this.acc_g_y)},m.prototype.AccelerationZWithG=function(t){t.set_float(this.acc_g_z)},m.prototype.AccelerationX=function(t){t.set_float(this.acc_x)},m.prototype.AccelerationY=function(t){t.set_float(this.acc_y)},m.prototype.AccelerationZ=function(t){t.set_float(this.acc_z)},m.prototype.TouchIndex=function(t){t.set_int(this.trigger_index)},m.prototype.TouchID=function(t){t.set_float(this.trigger_id)},m.prototype.WidthForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var r=this.touches[i];t.set_float(r.width)}},m.prototype.HeightForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var r=this.touches[i];t.set_float(r.height)}},m.prototype.PressureForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var r=this.touches[i];t.set_float(r.pressure)}},t.exps=new m}(),cr.plugins_.Particles=function(t){this.runtime=t},function(){var t=cr.plugins_.Particles.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime};var e=t.Type.prototype;function i(t){this.owner=t,this.active=!1,this.x=0,this.y=0,this.speed=0,this.angle=0,this.opacity=1,this.grow=0,this.size=0,this.gs=0,this.age=0,cr.seal(this)}e.onCreate=function(){this.is_family||(this.texture_img=this.runtime.findWaitingTexture(this.texture_file),this.texture_img||(this.texture_img=new Image,this.texture_img.cr_src=this.texture_file,this.texture_img.cr_filesize=this.texture_filesize,this.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,this.texture_file)),this.spriteX=this.texture_data[3],this.spriteY=this.texture_data[4],this.spriteWidth=this.texture_data[5],this.spriteHeight=this.texture_data[6])},e.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)},e.createParticleTexture=function(){var t=document.createElement("canvas"),e=this.spriteWidth,i=this.spriteHeight;t.width=e,t.height=i,t.getContext("2d").drawImage(this.texture_img,this.spriteX,this.spriteY,e,i,0,0,e,i),this.webGL_texture=this.runtime.glwrap.loadTexture(t,!0,this.runtime.linearSampling,this.texture_pixelformat)},e.onRestoreWebGLContext=function(){!this.is_family&&this.instances.length&&(this.webGL_texture||this.createParticleTexture())},e.loadTextures=function(){this.is_family||this.webGL_texture||!this.runtime.glwrap||this.createParticleTexture()},e.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},e.preloadCanvas2D=function(t){t.drawImage(this.texture_img,0,0)},i.prototype.init=function(){var t=this.owner;this.x=t.x-t.xrandom/2+Math.random()*t.xrandom,this.y=t.y-t.yrandom/2+Math.random()*t.yrandom,this.speed=t.initspeed-t.speedrandom/2+Math.random()*t.speedrandom,this.angle=t.angle-t.spraycone/2+Math.random()*t.spraycone,this.opacity=t.initopacity,this.size=t.initsize-t.sizerandom/2+Math.random()*t.sizerandom,this.grow=t.growrate-t.growrandom/2+Math.random()*t.growrandom,this.gs=0,this.age=0},i.prototype.tick=function(t){var e=this.owner;this.x+=Math.cos(this.angle)*this.speed*t,this.y+=Math.sin(this.angle)*this.speed*t,this.y+=this.gs*t,this.speed+=e.acc*t,this.size+=this.grow*t,this.gs+=e.g*t,this.age+=t,this.size<1?this.active=!1:(0!==e.lifeanglerandom&&(this.angle+=Math.random()*e.lifeanglerandom*t-e.lifeanglerandom*t/2),0!==e.lifespeedrandom&&(this.speed+=Math.random()*e.lifespeedrandom*t-e.lifespeedrandom*t/2),0!==e.lifeopacityrandom&&(this.opacity+=Math.random()*e.lifeopacityrandom*t-e.lifeopacityrandom*t/2,this.opacity<0?this.opacity=0:this.opacity>1&&(this.opacity=1)),e.destroymode<=1&&this.age>=e.timeout&&(this.active=!1),2===e.destroymode&&this.speed<=0&&(this.active=!1))},i.prototype.draw=function(t){var e=this.owner.opacity*this.opacity;if(0!==e){0===this.owner.destroymode&&(e*=1-this.age/this.owner.timeout),t.globalAlpha=e;var i=this.x-this.size/2,r=this.y-this.size/2;this.owner.runtime.pixel_rounding&&(i=i+.5|0,r=r+.5|0);var n=this.owner.type;t.drawImage(n.texture_img,n.spriteX,n.spriteY,n.spriteWidth,n.spriteHeight,i,r,this.size,this.size)}},i.prototype.drawGL=function(t){var e=this.owner.opacity*this.opacity;0===this.owner.destroymode&&(e*=1-this.age/this.owner.timeout);var i=this.size,r=i*this.owner.particlescale,n=this.x-i/2,s=this.y-i/2;this.owner.runtime.pixel_rounding&&(n=n+.5|0,s=s+.5|0),r<1||0===e||(r<t.minPointSize||r>t.maxPointSize?(t.setOpacity(e),t.quad(n,s,n+i,s,n+i,s+i,n,s+i)):t.point(this.x,this.y,r,e))},i.prototype.left=function(){return this.x-this.size/2},i.prototype.right=function(){return this.x+this.size/2},i.prototype.top=function(){return this.y-this.size/2},i.prototype.bottom=function(){return this.y+this.size/2},t.Instance=function(t){this.type=t,this.runtime=t.runtime};var r=t.Instance.prototype,n=[];function s(){}function o(){}function a(){}r.onCreate=function(){var t=this.properties;if(this.rate=t[0],this.spraycone=cr.to_radians(t[1]),this.spraytype=t[2],this.spraying=!0,this.initspeed=t[4],this.initsize=t[5],this.initopacity=t[6]/100,this.growrate=t[7],this.xrandom=t[8],this.yrandom=t[9],this.speedrandom=t[10],this.sizerandom=t[11],this.growrandom=t[12],this.acc=t[13],this.g=t[14],this.lifeanglerandom=t[15],this.lifespeedrandom=t[16],this.lifeopacityrandom=t[17],this.destroymode=t[18],this.timeout=t[19],this.particleCreateCounter=0,this.particlescale=1,this.particleBoxLeft=this.x,this.particleBoxTop=this.y,this.particleBoxRight=this.x,this.particleBoxBottom=this.y,this.add_bbox_changed_callback((function(t){t.bbox.set(t.particleBoxLeft,t.particleBoxTop,t.particleBoxRight,t.particleBoxBottom),t.bquad.set_from_rect(t.bbox),t.bbox_changed=!1,t.update_collision_cell(),t.update_render_cell()})),this.recycled||(this.particles=[]),this.runtime.tickMe(this),this.type.loadTextures(),1===this.spraytype)for(var e=0;e<this.rate;e++)this.allocateParticle().opacity=0;this.first_tick=!0},r.saveToJSON=function(){var t,e,i,r={r:this.rate,sc:this.spraycone,st:this.spraytype,s:this.spraying,isp:this.initspeed,isz:this.initsize,io:this.initopacity,gr:this.growrate,xr:this.xrandom,yr:this.yrandom,spr:this.speedrandom,szr:this.sizerandom,grnd:this.growrandom,acc:this.acc,g:this.g,lar:this.lifeanglerandom,lsr:this.lifespeedrandom,lor:this.lifeopacityrandom,dm:this.destroymode,to:this.timeout,pcc:this.particleCreateCounter,ft:this.first_tick,p:[]},n=r.p;for(t=0,e=this.particles.length;t<e;t++)i=this.particles[t],n.push([i.x,i.y,i.speed,i.angle,i.opacity,i.grow,i.size,i.gs,i.age]);return r},r.loadFromJSON=function(t){var e,i,r,s;this.rate=t.r,this.spraycone=t.sc,this.spraytype=t.st,this.spraying=t.s,this.initspeed=t.isp,this.initsize=t.isz,this.initopacity=t.io,this.growrate=t.gr,this.xrandom=t.xr,this.yrandom=t.yr,this.speedrandom=t.spr,this.sizerandom=t.szr,this.growrandom=t.grnd,this.acc=t.acc,this.g=t.g,this.lifeanglerandom=t.lar,this.lifespeedrandom=t.lsr,this.lifeopacityrandom=t.lor,this.destroymode=t.dm,this.timeout=t.to,this.particleCreateCounter=t.pcc,this.first_tick=t.ft,n.push.apply(n,this.particles),cr.clearArray(this.particles);var o=t.p;for(e=0,i=o.length;e<i;e++)r=this.allocateParticle(),s=o[e],r.x=s[0],r.y=s[1],r.speed=s[2],r.angle=s[3],r.opacity=s[4],r.grow=s[5],r.size=s[6],r.gs=s[7],r.age=s[8]},r.onDestroy=function(){n.push.apply(n,this.particles),cr.clearArray(this.particles)},r.allocateParticle=function(){var t;return n.length?(t=n.pop()).owner=this:t=new i(this),this.particles.push(t),t.active=!0,t},r.tick=function(){var t,e,i,r,s,o=this.runtime.getDt(this);if(0===this.spraytype&&this.spraying)for(this.particleCreateCounter+=o*this.rate,r=cr.floor(this.particleCreateCounter),this.particleCreateCounter-=r,t=0;t<r;t++)(i=this.allocateParticle()).init();for(this.particleBoxLeft=this.x,this.particleBoxTop=this.y,this.particleBoxRight=this.x,this.particleBoxBottom=this.y,t=0,s=0,e=this.particles.length;t<e;t++)i=this.particles[t],this.particles[s]=i,this.runtime.redraw=!0,1===this.spraytype&&this.first_tick&&i.init(),i.tick(o),i.active?(i.left()<this.particleBoxLeft&&(this.particleBoxLeft=i.left()),i.right()>this.particleBoxRight&&(this.particleBoxRight=i.right()),i.top()<this.particleBoxTop&&(this.particleBoxTop=i.top()),i.bottom()>this.particleBoxBottom&&(this.particleBoxBottom=i.bottom()),s++):n.push(i);cr.truncateArray(this.particles,s),this.set_bbox_changed(),this.first_tick=!1,1===this.spraytype&&0===this.particles.length&&this.runtime.DestroyInstance(this)},r.draw=function(t){var e,i,r,n=this.layer;for(e=0,i=this.particles.length;e<i;e++)(r=this.particles[e]).right()>=n.viewLeft&&r.bottom()>=n.viewTop&&r.left()<=n.viewRight&&r.top()<=n.viewBottom&&r.draw(t)},r.drawGL=function(t){this.particlescale=this.layer.getScale(),t.setTexture(this.type.webGL_texture);var e,i,r,n=this.layer;for(e=0,i=this.particles.length;e<i;e++)(r=this.particles[e]).right()>=n.viewLeft&&r.bottom()>=n.viewTop&&r.left()<=n.viewRight&&r.top()<=n.viewBottom&&r.drawGL(t)},s.prototype.IsSpraying=function(){return this.spraying},t.cnds=new s,o.prototype.SetSpraying=function(t){this.spraying=0!==t},o.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},o.prototype.SetRate=function(t){var e,i;if(this.rate=t,1===this.spraytype&&this.first_tick)if(t<this.particles.length)for(e=this.particles.length-t,i=0;i<e;i++)n.push(this.particles.pop());else if(t>this.particles.length)for(e=t-this.particles.length,i=0;i<e;i++)this.allocateParticle().opacity=0},o.prototype.SetSprayCone=function(t){this.spraycone=cr.to_radians(t)},o.prototype.SetInitSpeed=function(t){this.initspeed=t},o.prototype.SetInitSize=function(t){this.initsize=t},o.prototype.SetInitOpacity=function(t){this.initopacity=t/100},o.prototype.SetGrowRate=function(t){this.growrate=t},o.prototype.SetXRandomiser=function(t){this.xrandom=t},o.prototype.SetYRandomiser=function(t){this.yrandom=t},o.prototype.SetSpeedRandomiser=function(t){this.speedrandom=t},o.prototype.SetSizeRandomiser=function(t){this.sizerandom=t},o.prototype.SetGrowRateRandomiser=function(t){this.growrandom=t},o.prototype.SetParticleAcc=function(t){this.acc=t},o.prototype.SetGravity=function(t){this.g=t},o.prototype.SetAngleRandomiser=function(t){this.lifeanglerandom=t},o.prototype.SetLifeSpeedRandomiser=function(t){this.lifespeedrandom=t},o.prototype.SetOpacityRandomiser=function(t){this.lifeopacityrandom=t},o.prototype.SetTimeout=function(t){this.timeout=t},t.acts=new o,a.prototype.ParticleCount=function(t){t.set_int(this.particles.length)},a.prototype.Rate=function(t){t.set_float(this.rate)},a.prototype.SprayCone=function(t){t.set_float(cr.to_degrees(this.spraycone))},a.prototype.InitSpeed=function(t){t.set_float(this.initspeed)},a.prototype.InitSize=function(t){t.set_float(this.initsize)},a.prototype.InitOpacity=function(t){t.set_float(100*this.initopacity)},a.prototype.InitGrowRate=function(t){t.set_float(this.growrate)},a.prototype.XRandom=function(t){t.set_float(this.xrandom)},a.prototype.YRandom=function(t){t.set_float(this.yrandom)},a.prototype.InitSpeedRandom=function(t){t.set_float(this.speedrandom)},a.prototype.InitSizeRandom=function(t){t.set_float(this.sizerandom)},a.prototype.InitGrowRandom=function(t){t.set_float(this.growrandom)},a.prototype.ParticleAcceleration=function(t){t.set_float(this.acc)},a.prototype.Gravity=function(t){t.set_float(this.g)},a.prototype.ParticleAngleRandom=function(t){t.set_float(this.lifeanglerandom)},a.prototype.ParticleSpeedRandom=function(t){t.set_float(this.lifespeedrandom)},a.prototype.ParticleOpacityRandom=function(t){t.set_float(this.lifeopacityrandom)},a.prototype.Timeout=function(t){t.set_float(this.timeout)},t.exps=new a}(),cr.plugins_.Arr=function(t){this.runtime=t},function(){var t=cr.plugins_.Arr.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime};var e=t.Instance.prototype,i=[];function r(){return i.length?i.pop():[]}function n(t){var e,r;for(e=0,r=t.length;e<r;e++)Array.isArray(t[e])&&n(t[e]);cr.clearArray(t),i.push(t)}function s(){}function o(){}function a(t,e){if(cr.is_number(t)&&cr.is_number(e))return t-e;var i=""+t,r=""+e;return i<r?-1:i>r?1:0}function h(){}Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),e.onCreate=function(){this.cx=this.properties[0],this.cy=this.properties[1],this.cz=this.properties[2],this.recycled||(this.arr=r());var t,e,i,n=this.arr;for(n.length=this.cx,t=0;t<this.cx;t++)for(n[t]||(n[t]=r()),n[t].length=this.cy,e=0;e<this.cy;e++)for(n[t][e]||(n[t][e]=r()),n[t][e].length=this.cz,i=0;i<this.cz;i++)n[t][e][i]=0;this.forX=[],this.forY=[],this.forZ=[],this.forDepth=-1},e.onDestroy=function(){var t;for(t=0;t<this.cx;t++)n(this.arr[t]);cr.clearArray(this.arr)},e.at=function(t,e,i){return t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),isNaN(t)||t<0||t>this.cx-1||isNaN(e)||e<0||e>this.cy-1||isNaN(i)||i<0||i>this.cz-1?0:this.arr[t][e][i]},e.set=function(t,e,i,r){t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),isNaN(t)||t<0||t>this.cx-1||isNaN(e)||e<0||e>this.cy-1||isNaN(i)||i<0||i>this.cz-1||(this.arr[t][e][i]=r)},e.getAsJSON=function(){return JSON.stringify({c2array:!0,size:[this.cx,this.cy,this.cz],data:this.arr})},e.saveToJSON=function(){return{size:[this.cx,this.cy,this.cz],data:this.arr}},e.loadFromJSON=function(t){var e=t.size;this.cx=e[0],this.cy=e[1],this.cz=e[2],this.arr=t.data},e.setSize=function(t,e,i){if(t<0&&(t=0),e<0&&(e=0),i<0&&(i=0),this.cx!==t||this.cy!==e||this.cz!==i){var n,s,o;this.cx=t,this.cy=e,this.cz=i;var a=this.arr;for(a.length=t,n=0;n<this.cx;n++)for(cr.is_undefined(a[n])&&(a[n]=r()),a[n].length=e,s=0;s<this.cy;s++)for(cr.is_undefined(a[n][s])&&(a[n][s]=r()),a[n][s].length=i,o=0;o<this.cz;o++)cr.is_undefined(a[n][s][o])&&(a[n][s][o]=0)}},e.getForX=function(){return this.forDepth>=0&&this.forDepth<this.forX.length?this.forX[this.forDepth]:0},e.getForY=function(){return this.forDepth>=0&&this.forDepth<this.forY.length?this.forY[this.forDepth]:0},e.getForZ=function(){return this.forDepth>=0&&this.forDepth<this.forZ.length?this.forZ[this.forDepth]:0},s.prototype.CompareX=function(t,e,i){return cr.do_cmp(this.at(t,0,0),e,i)},s.prototype.CompareXY=function(t,e,i,r){return cr.do_cmp(this.at(t,e,0),i,r)},s.prototype.CompareXYZ=function(t,e,i,r,n){return cr.do_cmp(this.at(t,e,i),r,n)},e.doForEachTrigger=function(t){this.runtime.pushCopySol(t.solModifiers),t.retrigger(),this.runtime.popSol(t.solModifiers)},s.prototype.ArrForEach=function(t){var e=this.runtime.getCurrentEventStack().current_event;this.forDepth++;var i=this.forDepth;switch(i===this.forX.length?(this.forX.push(0),this.forY.push(0),this.forZ.push(0)):(this.forX[i]=0,this.forY[i]=0,this.forZ[i]=0),t){case 0:for(this.forX[i]=0;this.forX[i]<this.cx;this.forX[i]++)for(this.forY[i]=0;this.forY[i]<this.cy;this.forY[i]++)for(this.forZ[i]=0;this.forZ[i]<this.cz;this.forZ[i]++)this.doForEachTrigger(e);break;case 1:for(this.forX[i]=0;this.forX[i]<this.cx;this.forX[i]++)for(this.forY[i]=0;this.forY[i]<this.cy;this.forY[i]++)this.doForEachTrigger(e);break;case 2:for(this.forX[i]=0;this.forX[i]<this.cx;this.forX[i]++)this.doForEachTrigger(e)}return this.forDepth--,!1},s.prototype.CompareCurrent=function(t,e){return cr.do_cmp(this.at(this.getForX(),this.getForY(),this.getForZ()),t,e)},s.prototype.Contains=function(t){var e,i,r;for(e=0;e<this.cx;e++)for(i=0;i<this.cy;i++)for(r=0;r<this.cz;r++)if(this.arr[e][i][r]===t)return!0;return!1},s.prototype.IsEmpty=function(){return 0===this.cx||0===this.cy||0===this.cz},s.prototype.CompareSize=function(t,e,i){var r=0;switch(t){case 0:r=this.cx;break;case 1:r=this.cy;break;case 2:r=this.cz}return cr.do_cmp(r,e,i)},t.cnds=new s,o.prototype.Clear=function(t){var e,i,r;for(e=0;e<this.cx;e++)for(i=0;i<this.cy;i++)for(r=0;r<this.cz;r++)this.arr[e][i][r]=t},o.prototype.SetSize=function(t,e,i){this.setSize(t,e,i)},o.prototype.SetX=function(t,e){this.set(t,0,0,e)},o.prototype.SetXY=function(t,e,i){this.set(t,e,0,i)},o.prototype.SetXYZ=function(t,e,i,r){this.set(t,e,i,r)},o.prototype.Push=function(t,e,i){var n=0,s=0,o=0,a=this.arr;switch(i){case 0:for(0===t?(n=a.length,a.push(r())):(n=0,a.unshift(r())),a[n].length=this.cy;s<this.cy;s++)for(a[n][s]=r(),a[n][s].length=this.cz,o=0;o<this.cz;o++)a[n][s][o]=e;this.cx++;break;case 1:for(;n<this.cx;n++)for(0===t?(s=a[n].length,a[n].push(r())):(s=0,a[n].unshift(r())),a[n][s].length=this.cz,o=0;o<this.cz;o++)a[n][s][o]=e;this.cy++;break;case 2:for(;n<this.cx;n++)for(s=0;s<this.cy;s++)0===t?a[n][s].push(e):a[n][s].unshift(e);this.cz++}},o.prototype.Pop=function(t,e){var i=0,r=0,s=this.arr;switch(e){case 0:if(0===this.cx)break;n(0===t?s.pop():s.shift()),this.cx--;break;case 1:if(0===this.cy)break;for(;i<this.cx;i++)n(0===t?s[i].pop():s[i].shift());this.cy--;break;case 2:if(0===this.cz)break;for(;i<this.cx;i++)for(r=0;r<this.cy;r++)0===t?s[i][r].pop():s[i][r].shift();this.cz--}},o.prototype.Reverse=function(t){var e=0,i=0,r=this.arr;if(0!==this.cx&&0!==this.cy&&0!==this.cz)switch(t){case 0:r.reverse();break;case 1:for(;e<this.cx;e++)r[e].reverse();break;case 2:for(;e<this.cx;e++)for(i=0;i<this.cy;i++)r[e][i].reverse()}},o.prototype.Sort=function(t){var e=0,i=0,r=this.arr;if(0!==this.cx&&0!==this.cy&&0!==this.cz)switch(t){case 0:r.sort((function(t,e){return a(t[0][0],e[0][0])}));break;case 1:for(;e<this.cx;e++)r[e].sort((function(t,e){return a(t[0],e[0])}));break;case 2:for(;e<this.cx;e++)for(i=0;i<this.cy;i++)r[e][i].sort(a)}},o.prototype.Delete=function(t,e){var i=0,r=0;t=Math.floor(t);var s=this.arr;if(!(t<0))switch(e){case 0:if(t>=this.cx)break;n(s[t]),s.splice(t,1),this.cx--;break;case 1:if(t>=this.cy)break;for(;i<this.cx;i++)n(s[i][t]),s[i].splice(t,1);this.cy--;break;case 2:if(t>=this.cz)break;for(;i<this.cx;i++)for(r=0;r<this.cy;r++)s[i][r].splice(t,1);this.cz--}},o.prototype.Insert=function(t,e,i){var n=0,s=0,o=0;e=Math.floor(e);var a=this.arr;if(!(e<0))switch(i){case 0:if(e>this.cx)return;for(n=e,a.splice(n,0,r()),a[n].length=this.cy;s<this.cy;s++)for(a[n][s]=r(),a[n][s].length=this.cz,o=0;o<this.cz;o++)a[n][s][o]=t;this.cx++;break;case 1:if(e>this.cy)return;for(;n<this.cx;n++)for(s=e,a[n].splice(s,0,r()),a[n][s].length=this.cz,o=0;o<this.cz;o++)a[n][s][o]=t;this.cy++;break;case 2:if(e>this.cz)return;for(;n<this.cx;n++)for(s=0;s<this.cy;s++)a[n][s].splice(e,0,t);this.cz++}},o.prototype.JSONLoad=function(t){var e;try{e=JSON.parse(t)}catch(t){return}if(e.c2array){var i=e.size;this.cx=i[0],this.cy=i[1],this.cz=i[2],this.arr=e.data}},o.prototype.JSONDownload=function(t){var e=document.createElement("a");if(void 0===e.download){var i="data:text/html,"+encodeURIComponent("<p><a download='"+t+"' href=\"data:application/json,"+encodeURIComponent(this.getAsJSON())+'">Download link</a></p>');window.open(i)}else{var r=document.getElementsByTagName("body")[0];e.textContent=t,e.href="data:application/json,"+encodeURIComponent(this.getAsJSON()),e.download=t,r.appendChild(e),e.click(),r.removeChild(e)}},t.acts=new o,h.prototype.At=function(t,e,i,r){var n=i||0,s=r||0;t.set_any(this.at(e,n,s))},h.prototype.Width=function(t){t.set_int(this.cx)},h.prototype.Height=function(t){t.set_int(this.cy)},h.prototype.Depth=function(t){t.set_int(this.cz)},h.prototype.CurX=function(t){t.set_int(this.getForX())},h.prototype.CurY=function(t){t.set_int(this.getForY())},h.prototype.CurZ=function(t){t.set_int(this.getForZ())},h.prototype.CurValue=function(t){t.set_any(this.at(this.getForX(),this.getForY(),this.getForZ()))},h.prototype.Front=function(t){t.set_any(this.at(0,0,0))},h.prototype.Back=function(t){t.set_any(this.at(this.cx-1,0,0))},h.prototype.IndexOf=function(t,e){for(var i=0;i<this.cx;i++)if(this.arr[i][0][0]===e)return void t.set_int(i);t.set_int(-1)},h.prototype.LastIndexOf=function(t,e){for(var i=this.cx-1;i>=0;i--)if(this.arr[i][0][0]===e)return void t.set_int(i);t.set_int(-1)},h.prototype.AsJSON=function(t){t.set_string(this.getAsJSON())},t.exps=new h}(),cr.plugins_.Spritefont2=function(t){this.runtime=t},function(){var t=cr.plugins_.Spritefont2.prototype;t.onCreate=function(){},t.Type=function(t){this.plugin=t,this.runtime=t.runtime};var e=t.Type.prototype;e.onCreate=function(){this.is_family||(this.texture_img=this.runtime.findWaitingTexture(this.texture_file),this.texture_img||(this.texture_img=new Image,this.texture_img.cr_src=this.texture_file,this.texture_img.cr_filesize=this.texture_filesize,this.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,this.texture_file)),this.spriteX=this.texture_data[3],this.spriteY=this.texture_data[4],this.spriteWidth=this.texture_data[5],this.spriteHeight=this.texture_data[6],this.webGL_texture=null)},e.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)},e.onRestoreWebGLContext=function(){var t,e;if(!this.is_family&&this.instances.length)for(this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!1,this.runtime.linearSampling,this.texture_pixelformat)),t=0,e=this.instances.length;t<e;t++)this.instances[t].webGL_texture=this.webGL_texture},e.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},e.preloadCanvas2D=function(t){t.drawImage(this.texture_img,0,0)},t.Instance=function(t){this.type=t,this.runtime=t.runtime};var i=t.Instance.prototype;function r(t){return t.replace(/\s\s*$/,"")}i.onDestroy=function(){var t;u(this.lines),t=this.clipList,a(d,t,!1),function(t){a(f,t,!1)}(this.clipUV),cr.wipe(this.characterWidthList)},i.onCreate=function(){this.texture_img=this.type.texture_img,this.text=this.properties[0],this.characterWidth=this.properties[2],this.characterHeight=this.properties[3],this.characterSet=this.properties[4];var t=this.properties[5];this.characterScale=this.properties[6],this.characterSpacing=this.properties[7],this.lineHeight=this.properties[8],this.halign=this.properties[9]/2,this.valign=this.properties[10]/2,this.wrapbyword=0===this.properties[11],this.visible=this.properties[12],this.textWidth=0,this.textHeight=0,this.recycled?(cr.clearArray(this.lines),cr.wipe(this.clipList),cr.wipe(this.clipUV),cr.wipe(this.characterWidthList)):(this.lines=[],this.clipList={},this.clipUV={},this.characterWidthList={}),this.text_changed=!0,this.lastwrapwidth=this.width,this.runtime.glwrap&&(this.type.webGL_texture||(this.type.webGL_texture=this.runtime.glwrap.loadTexture(this.type.texture_img,!1,this.runtime.linearSampling,this.type.texture_pixelformat)),this.webGL_texture=this.type.webGL_texture),this.LoadCharacterSpacingData(t),this.SplitSheet()},i.saveToJSON=function(){var t={t:this.text,csc:this.characterScale,csp:this.characterSpacing,lh:this.lineHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick,ha:this.halign,va:this.valign,cw:{}};for(var e in this.characterWidthList)t.cw[e]=this.characterWidthList[e];return t},i.loadFromJSON=function(t){for(var e in this.text=t.t,this.characterScale=t.csc,this.characterSpacing=t.csp,this.lineHeight=t.lh,this.textWidth=t.tw,this.textHeight=t.th,this.last_render_tick=t.lrt,t.hasOwnProperty("ha")&&(this.halign=t.ha),t.hasOwnProperty("va")&&(this.valign=t.va),t.cw)this.characterWidthList[e]=t.cw[e];this.text_changed=!0,this.lastwrapwidth=this.width};var n=1e3;function s(t,e){return t.length?t.pop():new e}function o(t,e){t.length<n&&t.push(e)}function a(t,e,i){if(i){var r,n;for(r=0,n=e.length;r<n;r++)o(t,e[r]);cr.clearArray(e)}else{var s;for(s in e)Object.prototype.hasOwnProperty.call(e,s)&&(o(t,e[s]),delete e[s])}}function h(t,e,i){var n,s=t.lines;i=r(i),e>=s.length&&s.push(l()),(n=s[e]).text=i,n.width=t.measureWidth(i),t.textWidth=cr.max(t.textWidth,n.width)}var c=[];function l(){return s(c,Object)}function u(t){a(c,t,!0)}function p(t,e,i,r,n,o){void 0===t[e]&&(t[e]=s(d,Object)),t[e].x=i,t[e].y=r,t[e].w=n,t[e].h=o}var d=[];var f=[];i.SplitSheet=function(){this.texture_img;for(var t,e,i,r,n,o,a=this.texture_img.width,h=this.texture_img.height,c=this.type.spriteWidth,l=this.type.spriteHeight,u=this.type.spriteX,d=this.type.spriteY,g=this.characterWidth,y=this.characterHeight,m=u/a,_=d/h,v=g/a,b=y/h,w=this.characterSet,x=Math.floor(c/g),S=Math.floor(l/y),T=0;T<w.length&&!(T>=x*S);T++){var C=T%x,A=Math.floor(T/x),O=w.charAt(T);this.runtime.glwrap?(t=this.clipUV,i=C*v+m,r=A*b+_,n=(C+1)*v+m,o=(A+1)*b+_,void 0===t[e=O]&&(t[e]=s(f,cr.rect)),t[e].left=i,t[e].top=r,t[e].right=n,t[e].bottom=o):p(this.clipList,O,C*g+u,A*y+d,g,y)}};var g=[];t.TokeniseWords=function(t){cr.clearArray(g);for(var e,i="",r=0;r<t.length;)if("\n"===(e=t.charAt(r)))i.length&&(g.push(i),i=""),g.push("\n"),++r;else if(" "===e||"\t"===e||"-"===e){do{i+=t.charAt(r),r++}while(r<t.length&&(" "===t.charAt(r)||"\t"===t.charAt(r)));g.push(i),i=""}else r<t.length&&(i+=e,r++);i.length&&g.push(i)},t.WordWrap=function(t){var e=t.text,i=t.lines;if(e&&e.length){var r=t.width;if(r<=2)u(i);else{var n=t.characterWidth,s=t.characterScale,o=t.characterSpacing;if(e.length*(n*s+o)-o<=r&&-1===e.indexOf("\n")){var a=t.measureWidth(e);if(a<=r)return u(i),i.push(l()),i[0].text=e,i[0].width=a,t.textWidth=a,void(t.textHeight=t.characterHeight*s+t.lineHeight)}t.wrapbyword;this.WrapText(t),t.textHeight=i.length*(t.characterHeight*s+t.lineHeight)}}else u(i)},t.WrapText=function(t){var e,i=t.wrapbyword,n=t.text,s=t.lines,a=t.width;i?(this.TokeniseWords(n),e=g):e=n;var l,u,p,d="",f=0,y=!1;for(u=0;u<e.length;u++)"\n"!==e[u]?(y=!1,l=d,d+=e[u],t.measureWidth(r(d))>a&&(""===l?(h(t,f,d),d="",y=!0):(h(t,f,l),d=e[u]),f++,i||" "!==d||(d=""))):(!0===y?y=!1:(h(t,f,d),f++),d="");for(r(d).length&&(h(t,f,d),f++),u=f;u<s.length;u++)p=s[u],o(c,p);s.length=f},i.measureWidth=function(t){for(var e=this.characterSpacing,i=t.length,r=0,n=0;n<i;n++)r+=this.getCharacterWidth(t.charAt(n))*this.characterScale+e;return r-=r>0?e:0},i.getCharacterWidth=function(t){var e=this.characterWidthList;return void 0!==e[t]?e[t]:this.characterWidth},i.rebuildText=function(){(this.text_changed||this.width!==this.lastwrapwidth)&&(this.textWidth=0,this.textHeight=0,this.type.plugin.WordWrap(this),this.text_changed=!1,this.lastwrapwidth=this.width)};var y=1e-5;i.draw=function(t,e){var i=this.texture_img;if(""!==this.text&&null!=i){if(this.rebuildText(),this.height<this.characterHeight*this.characterScale+this.lineHeight)return;t.globalAlpha=this.opacity;var r=this.x,n=this.y;this.runtime.pixel_rounding&&(r=Math.round(r),n=Math.round(n));var s=this.layer.viewLeft,o=this.layer.viewTop,a=this.layer.viewRight,h=this.layer.viewBottom;t.save(),t.translate(r,n),t.rotate(this.angle);for(var c,l,u,p,d=this.angle,f=this.halign,g=this.valign,m=this.characterScale,_=this.characterHeight*m,v=this.lineHeight,b=this.characterSpacing,w=this.lines,x=this.textHeight,S=g*cr.max(0,this.height-x),T=-this.hotspotX*this.width,C=-this.hotspotY*this.height,A=C+=S,O=0;O<w.length;O++){var E=w[O].text,P=w[O].width;if(l=T+f*cr.max(0,this.width-P),A+=v,0===d&&n+A+_<o)A+=_;else{for(var I=0;I<E.length;I++){var k=E.charAt(I);c=this.getCharacterWidth(k);var R=this.clipList[k];if(0===d&&r+l+c*m+b<s)l+=c*m+b;else{if(l+c*m>this.width+y)break;if(void 0!==R&&(u=l,p=A,0===d&&1===m&&(u=Math.round(u),p=Math.round(p)),t.drawImage(this.texture_img,R.x,R.y,R.w,R.h,u,p,R.w*m,R.h*m)),l+=c*m+b,0===d&&r+l>a)break}}if(A+=_,0===d&&(A+_+v>this.height||n+A>h))break}}t.restore()}};var m=new cr.quad;function _(t,e,i){var r;r=t.tlx*e-t.tly*i,t.tly=t.tly*e+t.tlx*i,t.tlx=r,r=t.trx*e-t.try_*i,t.try_=t.try_*e+t.trx*i,t.trx=r,r=t.blx*e-t.bly*i,t.bly=t.bly*e+t.blx*i,t.blx=r,r=t.brx*e-t.bry*i,t.bry=t.bry*e+t.brx*i,t.brx=r}function v(){}function b(){}function w(){}i.drawGL=function(t){if(t.setTexture(this.webGL_texture),t.setOpacity(this.opacity),this.text&&(this.rebuildText(),!(this.height<this.characterHeight*this.characterScale+this.lineHeight))){this.update_bbox();var e=this.bquad,i=0,r=0;this.runtime.pixel_rounding&&(i=Math.round(this.x)-this.x,r=Math.round(this.y)-this.y);var n,s,o,a=this.layer.viewLeft,h=this.layer.viewTop,c=this.layer.viewRight,l=this.layer.viewBottom,u=this.angle,p=this.halign,d=this.valign,f=this.characterScale,g=this.characterHeight*f,v=this.lineHeight,b=this.characterSpacing,w=this.lines,x=this.textHeight;0!==u&&(s=Math.cos(u),o=Math.sin(u));for(var S,T,C,A=d*cr.max(0,this.height-x),O=e.tlx+i,E=e.tly+r,P=A,I=0;I<w.length;I++){var k=w[I].text,R=w[I].width;if(S=p*cr.max(0,this.width-R),P+=v,0===u&&E+P+g<h)P+=g;else{for(var L=0;L<k.length;L++){var B=k.charAt(L);n=this.getCharacterWidth(B);var M=this.clipUV[B];if(0===u&&O+S+n*f+b<a)S+=n*f+b;else{if(S+n*f>this.width+y)break;if(void 0!==M){var N=this.characterWidth*f,F=this.characterHeight*f;T=S,C=P,0===u&&1===f&&(T=Math.round(T),C=Math.round(C)),m.tlx=T,m.tly=C,m.trx=T+N,m.try_=C,m.blx=T,m.bly=C+F,m.brx=T+N,m.bry=C+F,0!==u&&_(m,s,o),m.offset(O,E),t.quadTex(m.tlx,m.tly,m.trx,m.try_,m.brx,m.bry,m.blx,m.bly,M)}if(S+=n*f+b,0===u&&O+S>c)break}}if(P+=g,0===u&&(P+g+v>this.height||E+P>l))break}}}},v.prototype.CompareText=function(t,e){return e?this.text==t:cr.equals_nocase(this.text,t)},t.cnds=new v,b.prototype.SetText=function(t){cr.is_number(t)&&t<1e9&&(t=Math.round(1e10*t)/1e10);var e=t.toString();this.text!==e&&(this.text=e,this.text_changed=!0,this.runtime.redraw=!0)},b.prototype.AppendText=function(t){cr.is_number(t)&&(t=Math.round(1e10*t)/1e10);var e=t.toString();e&&(this.text+=e,this.text_changed=!0,this.runtime.redraw=!0)},b.prototype.SetScale=function(t){t!==this.characterScale&&(this.characterScale=t,this.text_changed=!0,this.runtime.redraw=!0)},b.prototype.SetCharacterSpacing=function(t){t!==this.CharacterSpacing&&(this.characterSpacing=t,this.text_changed=!0,this.runtime.redraw=!0)},b.prototype.SetLineHeight=function(t){t!==this.lineHeight&&(this.lineHeight=t,this.text_changed=!0,this.runtime.redraw=!0)},i.SetCharWidth=function(t,e){var i=parseInt(e,10);this.characterWidthList[t]!==i&&(this.characterWidthList[t]=i,this.text_changed=!0,this.runtime.redraw=!0)},i.LoadCharacterSpacingData=function(t){var e,i,r,n,s,o,a,h;if(t){try{e=JSON.parse(t)}catch(t){return}if(Array.isArray(e))for(i=0,r=e.length;i<r;++i)if(n=e[i],Array.isArray(n)&&2===n.length&&"number"==typeof n[0]&&"string"==typeof n[1])for(s=n[0],a=0,h=(o=n[1]).length;a<h;++a)this.SetCharWidth(o.charAt(a),s)}},b.prototype.SetCharacterWidth=function(t,e){if(""!==t)for(var i=0;i<t.length;i++)this.SetCharWidth(t.charAt(i),e)},b.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},b.prototype.SetHAlign=function(t){this.halign=t/2,this.text_changed=!0,this.runtime.redraw=!0},b.prototype.SetVAlign=function(t){this.valign=t/2,this.text_changed=!0,this.runtime.redraw=!0},t.acts=new b,w.prototype.CharacterWidth=function(t,e){t.set_int(this.getCharacterWidth(e))},w.prototype.CharacterHeight=function(t){t.set_int(this.characterHeight)},w.prototype.CharacterScale=function(t){t.set_float(this.characterScale)},w.prototype.CharacterSpacing=function(t){t.set_int(this.characterSpacing)},w.prototype.LineHeight=function(t){t.set_int(this.lineHeight)},w.prototype.Text=function(t){t.set_string(this.text)},w.prototype.TextWidth=function(t){this.rebuildText(),t.set_float(this.textWidth)},w.prototype.TextHeight=function(t){this.rebuildText(),t.set_float(this.textHeight)},t.exps=new w}(),cr.plugins_.TiledBg=function(t){this.runtime=t},function(){var t=cr.plugins_.TiledBg.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime};var e=t.Type.prototype;e.onCreate=function(){this.is_family||(this.texture_img=this.runtime.findWaitingTexture(this.texture_file),this.texture_img||(this.texture_img=new Image,this.texture_img.cr_src=this.texture_file,this.texture_img.cr_filesize=this.texture_filesize,this.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,this.texture_file)),this.pattern=null,this.webGL_texture=null)},e.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)},e.onRestoreWebGLContext=function(){var t,e;if(!this.is_family&&this.instances.length)for(this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat)),t=0,e=this.instances.length;t<e;t++)this.instances[t].webGL_texture=this.webGL_texture},e.loadTextures=function(){this.is_family||this.webGL_texture||!this.runtime.glwrap||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat))},e.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},e.preloadCanvas2D=function(t){t.drawImage(this.texture_img,0,0)},t.Instance=function(t){this.type=t,this.runtime=t.runtime};var i=t.Instance.prototype;function r(){}function n(){}function s(){}i.onCreate=function(){this.visible=this.properties[0],this.rcTex=new cr.rect(0,0,0,0),this.has_own_texture=!1,this.texture_img=this.type.texture_img,this.runtime.glwrap?(this.type.loadTextures(),this.webGL_texture=this.type.webGL_texture):(this.type.pattern||(this.type.pattern=this.runtime.ctx.createPattern(this.type.texture_img,"repeat")),this.pattern=this.type.pattern)},i.afterLoad=function(){this.has_own_texture=!1,this.texture_img=this.type.texture_img},i.onDestroy=function(){this.runtime.glwrap&&this.has_own_texture&&this.webGL_texture&&(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},i.draw=function(t){t.globalAlpha=this.opacity,t.save(),t.fillStyle=this.pattern;var e=this.x,i=this.y;this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i));var r=-this.hotspotX*this.width,n=-this.hotspotY*this.height,s=r%this.texture_img.width,o=n%this.texture_img.height;s<0&&(s+=this.texture_img.width),o<0&&(o+=this.texture_img.height),t.translate(e,i),t.rotate(this.angle),t.translate(s,o),t.fillRect(r-s,n-o,this.width,this.height),t.restore()},i.drawGL_earlyZPass=function(t){this.drawGL(t)},i.drawGL=function(t){t.setTexture(this.webGL_texture),t.setOpacity(this.opacity);var e=this.rcTex;e.right=this.width/this.texture_img.width,e.bottom=this.height/this.texture_img.height;var i=this.bquad;if(this.runtime.pixel_rounding){var r=Math.round(this.x)-this.x,n=Math.round(this.y)-this.y;t.quadTex(i.tlx+r,i.tly+n,i.trx+r,i.try_+n,i.brx+r,i.bry+n,i.blx+r,i.bly+n,e)}else t.quadTex(i.tlx,i.tly,i.trx,i.try_,i.brx,i.bry,i.blx,i.bly,e)},r.prototype.OnURLLoaded=function(){return!0},t.cnds=new r,n.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},n.prototype.LoadURL=function(t,e){var i=new Image,r=this;i.onload=function(){r.texture_img=i,r.runtime.glwrap?(r.has_own_texture&&r.webGL_texture&&r.runtime.glwrap.deleteTexture(r.webGL_texture),r.webGL_texture=r.runtime.glwrap.loadTexture(i,!0,r.runtime.linearSampling)):r.pattern=r.runtime.ctx.createPattern(i,"repeat"),r.has_own_texture=!0,r.runtime.redraw=!0,r.runtime.trigger(cr.plugins_.TiledBg.prototype.cnds.OnURLLoaded,r)},"data:"!==t.substr(0,5)&&0===e&&(i.crossOrigin="anonymous"),this.runtime.setImageSrc(i,t)},t.acts=new n,s.prototype.ImageWidth=function(t){t.set_float(this.texture_img.width)},s.prototype.ImageHeight=function(t){t.set_float(this.texture_img.height)},t.exps=new s}(),cr.plugins_.Audio=function(t){this.runtime=t},function(){var t=cr.plugins_.Audio.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){};var e=null,i=null,r="",n="",s=0,o=null,a=[],h=[],c=null,l=0,u=!1,p=1,d=0,f=0,g=!1,y=!!(new Audio).canPlayType("audio/webm; codecs=opus"),m=1,_=1,v=10,b=1e4,w=1,x=null,S="",T=!1,C=[],A=!1,O=!1,E=!1;function P(t){-1===C.indexOf(t)&&C.push(t)}function I(t){var i,r=t.instanceObject;try{i=r.play()}catch(e){return void P(t)}i?i.catch((function(e){P(t)})):T&&!e.isInUserInputEvent&&P(t)}function k(){var t,e,i,r;E||g||!o||(!function(){"suspended"===o.state&&o.resume&&o.resume();if(!o.createBuffer)return;var t=o.createBuffer(1,220,22050),e=o.createBufferSource();e.buffer=t,e.connect(o.destination),j(e)}(),"running"===o.state&&(E=!0));var n=C.slice(0);if(cr.clearArray(C),!u)for(t=0,e=n.length;t<e;++t)(i=n[t]).stopped||i.is_paused||(r=i.instanceObject.play())&&r.catch((function(t){P(i)}))}function R(t){var e=B(t);return isFinite(e)||(e=0),e<0&&(e=0),e>1&&(e=1),e}function L(t){return t<0&&(t=0),t>1&&(t=1),function(t){return Math.log(t)/Math.log(10)*20}(t)}function B(t){return Math.pow(10,t/20)}document.addEventListener("pointerup",k,!0),document.addEventListener("touchend",k,!0),document.addEventListener("click",k,!0),document.addEventListener("keydown",k,!0),document.addEventListener("gamepadconnected",k,!0);var M={};function N(t){return t=t.toLowerCase(),M.hasOwnProperty(t)&&M[t].length?M[t][0].getInputNode():o.destination}function F(){return o.createGain?o.createGain():o.createGainNode()}function D(t){return o.createDelay?o.createDelay(t):o.createDelayNode(t)}function j(t,e){t.start?t.start(e||0):t.noteOn(e||0)}function V(t,e,i,r){t.start?t.start(r||0,e):t.noteGrainOn(r||0,e,i-e)}function U(t){try{t.stop?t.stop(0):t.noteOff(0)}catch(t){}}function G(t,e,i,r){if(t)if(t.cancelScheduledValues(0),0!==r){var n=o.currentTime;switch(r+=n,i){case 0:t.setValueAtTime(e,r);break;case 1:t.setValueAtTime(t.value,n),t.linearRampToValueAtTime(e,r);break;case 2:t.setValueAtTime(t.value,n),t.exponentialRampToValueAtTime(e,r)}}else t.value=e}var W=["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"];function z(t,e,i,r,n,s){this.type="filter",this.params=[t,e,i,r,n,s],this.inputNode=F(),this.wetNode=F(),this.wetNode.gain.value=s,this.dryNode=F(),this.dryNode.gain.value=1-s,this.filterNode=o.createBiquadFilter(),"number"==typeof this.filterNode.type?this.filterNode.type=t:this.filterNode.type=W[t],this.filterNode.frequency.value=e,this.filterNode.detune&&(this.filterNode.detune.value=i),this.filterNode.Q.value=r,this.filterNode.gain.value=n,this.inputNode.connect(this.filterNode),this.inputNode.connect(this.dryNode),this.filterNode.connect(this.wetNode)}function X(t,e,i){this.type="delay",this.params=[t,e,i],this.inputNode=F(),this.wetNode=F(),this.wetNode.gain.value=i,this.dryNode=F(),this.dryNode.gain.value=1-i,this.mainNode=F(),this.delayNode=D(t),this.delayNode.delayTime.value=t,this.delayGainNode=F(),this.delayGainNode.gain.value=e,this.inputNode.connect(this.mainNode),this.inputNode.connect(this.dryNode),this.mainNode.connect(this.wetNode),this.mainNode.connect(this.delayNode),this.delayNode.connect(this.delayGainNode),this.delayGainNode.connect(this.mainNode)}function q(t,e,i,r){this.type="convolve",this.params=[e,i,r],this.inputNode=F(),this.wetNode=F(),this.wetNode.gain.value=i,this.dryNode=F(),this.dryNode.gain.value=1-i,this.convolveNode=o.createConvolver(),t&&(this.convolveNode.normalize=e,this.convolveNode.buffer=t),this.inputNode.connect(this.convolveNode),this.inputNode.connect(this.dryNode),this.convolveNode.connect(this.wetNode)}function Y(t,e,i,r,n){this.type="flanger",this.params=[t,e,i,r,n],this.inputNode=F(),this.dryNode=F(),this.dryNode.gain.value=1-n/2,this.wetNode=F(),this.wetNode.gain.value=n/2,this.feedbackNode=F(),this.feedbackNode.gain.value=r,this.delayNode=D(t+e),this.delayNode.delayTime.value=t,this.oscNode=o.createOscillator(),this.oscNode.frequency.value=i,this.oscGainNode=F(),this.oscGainNode.gain.value=e,this.inputNode.connect(this.delayNode),this.inputNode.connect(this.dryNode),this.delayNode.connect(this.wetNode),this.delayNode.connect(this.feedbackNode),this.feedbackNode.connect(this.delayNode),this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.delayNode.delayTime),j(this.oscNode)}function J(t,e,i,r,n,s){this.type="phaser",this.params=[t,e,i,r,n,s],this.inputNode=F(),this.dryNode=F(),this.dryNode.gain.value=1-s/2,this.wetNode=F(),this.wetNode.gain.value=s/2,this.filterNode=o.createBiquadFilter(),"number"==typeof this.filterNode.type?this.filterNode.type=7:this.filterNode.type="allpass",this.filterNode.frequency.value=t,this.filterNode.detune&&(this.filterNode.detune.value=e),this.filterNode.Q.value=i,this.oscNode=o.createOscillator(),this.oscNode.frequency.value=n,this.oscGainNode=F(),this.oscGainNode.gain.value=r,this.inputNode.connect(this.filterNode),this.inputNode.connect(this.dryNode),this.filterNode.connect(this.wetNode),this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.filterNode.frequency),j(this.oscNode)}function H(t){this.type="gain",this.params=[t],this.node=F(),this.node.gain.value=t}function K(t,e){this.type="tremolo",this.params=[t,e],this.node=F(),this.node.gain.value=1-e/2,this.oscNode=o.createOscillator(),this.oscNode.frequency.value=t,this.oscGainNode=F(),this.oscGainNode.gain.value=e/2,this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.node.gain),j(this.oscNode)}function Z(t,e){this.type="ringmod",this.params=[t,e],this.inputNode=F(),this.wetNode=F(),this.wetNode.gain.value=e,this.dryNode=F(),this.dryNode.gain.value=1-e,this.ringNode=F(),this.ringNode.gain.value=0,this.oscNode=o.createOscillator(),this.oscNode.frequency.value=t,this.oscNode.connect(this.ringNode.gain),j(this.oscNode),this.inputNode.connect(this.ringNode),this.inputNode.connect(this.dryNode),this.ringNode.connect(this.wetNode)}function Q(t,e,i,r,n){this.type="distortion",this.params=[t,e,i,r,n],this.inputNode=F(),this.preGain=F(),this.postGain=F(),this.setDrive(i,B(r)),this.wetNode=F(),this.wetNode.gain.value=n,this.dryNode=F(),this.dryNode.gain.value=1-n,this.waveShaper=o.createWaveShaper(),this.curve=new Float32Array(65536),this.generateColortouchCurve(t,e),this.waveShaper.curve=this.curve,this.inputNode.connect(this.preGain),this.inputNode.connect(this.dryNode),this.preGain.connect(this.waveShaper),this.waveShaper.connect(this.postGain),this.postGain.connect(this.wetNode)}function $(t,e,i,r,n){this.type="compressor",this.params=[t,e,i,r,n],this.node=o.createDynamicsCompressor();try{this.node.threshold.value=t,this.node.knee.value=e,this.node.ratio.value=i,this.node.attack.value=r,this.node.release.value=n}catch(t){}}function tt(t,e){this.type="analyser",this.params=[t,e],this.node=o.createAnalyser(),this.node.fftSize=t,this.node.smoothingTimeConstant=e,this.freqBins=new Float32Array(this.node.frequencyBinCount),this.signal=new Uint8Array(t),this.peak=0,this.rms=0}function et(){this.obj=null,this.loadUid=0}z.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},z.prototype.remove=function(){this.inputNode.disconnect(),this.filterNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},z.prototype.getInputNode=function(){return this.inputNode},z.prototype.setParam=function(t,e,i,r){switch(t){case 0:(e/=100)<0&&(e=0),e>1&&(e=1),this.params[5]=e,G(this.wetNode.gain,e,i,r),G(this.dryNode.gain,1-e,i,r);break;case 1:this.params[1]=e,G(this.filterNode.frequency,e,i,r);break;case 2:this.params[2]=e,G(this.filterNode.detune,e,i,r);break;case 3:this.params[3]=e,G(this.filterNode.Q,e,i,r);break;case 4:this.params[4]=e,G(this.filterNode.gain,e,i,r)}},X.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},X.prototype.remove=function(){this.inputNode.disconnect(),this.mainNode.disconnect(),this.delayNode.disconnect(),this.delayGainNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},X.prototype.getInputNode=function(){return this.inputNode},X.prototype.setParam=function(t,e,i,r){switch(t){case 0:(e/=100)<0&&(e=0),e>1&&(e=1),this.params[2]=e,G(this.wetNode.gain,e,i,r),G(this.dryNode.gain,1-e,i,r);break;case 4:this.params[1]=R(e),G(this.delayGainNode.gain,R(e),i,r);break;case 5:this.params[0]=e,G(this.delayNode.delayTime,e,i,r)}},q.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},q.prototype.remove=function(){this.inputNode.disconnect(),this.convolveNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},q.prototype.getInputNode=function(){return this.inputNode},q.prototype.setParam=function(t,e,i,r){if(0===t)(e/=100)<0&&(e=0),e>1&&(e=1),this.params[1]=e,G(this.wetNode.gain,e,i,r),G(this.dryNode.gain,1-e,i,r)},Y.prototype.connectTo=function(t){this.dryNode.disconnect(),this.dryNode.connect(t),this.wetNode.disconnect(),this.wetNode.connect(t)},Y.prototype.remove=function(){this.inputNode.disconnect(),this.delayNode.disconnect(),this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.dryNode.disconnect(),this.wetNode.disconnect(),this.feedbackNode.disconnect()},Y.prototype.getInputNode=function(){return this.inputNode},Y.prototype.setParam=function(t,e,i,r){switch(t){case 0:(e/=100)<0&&(e=0),e>1&&(e=1),this.params[4]=e,G(this.wetNode.gain,e/2,i,r),G(this.dryNode.gain,1-e/2,i,r);break;case 6:this.params[1]=e/1e3,G(this.oscGainNode.gain,e/1e3,i,r);break;case 7:this.params[2]=e,G(this.oscNode.frequency,e,i,r);break;case 8:this.params[3]=e/100,G(this.feedbackNode.gain,e/100,i,r)}},J.prototype.connectTo=function(t){this.dryNode.disconnect(),this.dryNode.connect(t),this.wetNode.disconnect(),this.wetNode.connect(t)},J.prototype.remove=function(){this.inputNode.disconnect(),this.filterNode.disconnect(),this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.dryNode.disconnect(),this.wetNode.disconnect()},J.prototype.getInputNode=function(){return this.inputNode},J.prototype.setParam=function(t,e,i,r){switch(t){case 0:(e/=100)<0&&(e=0),e>1&&(e=1),this.params[5]=e,G(this.wetNode.gain,e/2,i,r),G(this.dryNode.gain,1-e/2,i,r);break;case 1:this.params[0]=e,G(this.filterNode.frequency,e,i,r);break;case 2:this.params[1]=e,G(this.filterNode.detune,e,i,r);break;case 3:this.params[2]=e,G(this.filterNode.Q,e,i,r);break;case 6:this.params[3]=e,G(this.oscGainNode.gain,e,i,r);break;case 7:this.params[4]=e,G(this.oscNode.frequency,e,i,r)}},H.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},H.prototype.remove=function(){this.node.disconnect()},H.prototype.getInputNode=function(){return this.node},H.prototype.setParam=function(t,e,i,r){if(4===t)this.params[0]=R(e),G(this.node.gain,R(e),i,r)},K.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},K.prototype.remove=function(){this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.node.disconnect()},K.prototype.getInputNode=function(){return this.node},K.prototype.setParam=function(t,e,i,r){switch(t){case 0:(e/=100)<0&&(e=0),e>1&&(e=1),this.params[1]=e,G(this.node.gain.value,1-e/2,i,r),G(this.oscGainNode.gain.value,e/2,i,r);break;case 7:this.params[0]=e,G(this.oscNode.frequency,e,i,r)}},Z.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},Z.prototype.remove=function(){this.oscNode.disconnect(),this.ringNode.disconnect(),this.inputNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},Z.prototype.getInputNode=function(){return this.inputNode},Z.prototype.setParam=function(t,e,i,r){switch(t){case 0:(e/=100)<0&&(e=0),e>1&&(e=1),this.params[1]=e,G(this.wetNode.gain,e,i,r),G(this.dryNode.gain,1-e,i,r);break;case 7:this.params[0]=e,G(this.oscNode.frequency,e,i,r)}},Q.prototype.setDrive=function(t,e){t<.01&&(t=.01),this.preGain.gain.value=t,this.postGain.gain.value=Math.pow(1/t,.6)*e},Q.prototype.shape=function(t,e,i){var r=1.05*i*e-e,n=t<0?-1:1,s=t<0?-t:t,o=s<e?s:e+r*function(t,e){return 1-Math.exp(-e*t)}(s-e,1/r);return o*=n},Q.prototype.generateColortouchCurve=function(t,e){for(var i=B(t),r=B(e),n=32768,s=0,o=0;o<n;++o)s=o/n,s=this.shape(s,i,r),this.curve[n+o]=s,this.curve[n-o-1]=-s},Q.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},Q.prototype.remove=function(){this.inputNode.disconnect(),this.preGain.disconnect(),this.waveShaper.disconnect(),this.postGain.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},Q.prototype.getInputNode=function(){return this.inputNode},Q.prototype.setParam=function(t,e,i,r){if(0===t)(e/=100)<0&&(e=0),e>1&&(e=1),this.params[4]=e,G(this.wetNode.gain,e,i,r),G(this.dryNode.gain,1-e,i,r)},$.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},$.prototype.remove=function(){this.node.disconnect()},$.prototype.getInputNode=function(){return this.node},$.prototype.setParam=function(t,e,i,r){},tt.prototype.tick=function(){this.node.getFloatFrequencyData(this.freqBins),this.node.getByteTimeDomainData(this.signal);var t=this.node.fftSize,e=0;this.peak=0;for(var i=0,r=0;e<t;e++)(r=(this.signal[e]-128)/128)<0&&(r=-r),this.peak<r&&(this.peak=r),i+=r*r;this.peak=L(this.peak),this.rms=L(Math.sqrt(i/t))},tt.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},tt.prototype.remove=function(){this.node.disconnect()},tt.prototype.getInputNode=function(){return this.node},tt.prototype.setParam=function(t,e,i,r){},et.prototype.setObject=function(t){this.obj=t},et.prototype.hasObject=function(){return!!this.obj},et.prototype.tick=function(t){};function it(t,i,r){this.src=t,this.type=i,this.myapi=s,this.is_music=r,this.added_end_listener=!1;var n,a=this;switch(this.outNode=null,this.mediaSourceNode=null,this.panWhenReady=[],this.seekWhenReady=0,this.pauseWhenReady=!1,this.supportWebAudioAPI=!1,this.failedToLoad=!1,this.needsSoftwareDecode="audio/webm; codecs=opus"===this.type&&!y,this.wasEverReady=!1,this.is_music&&this.needsSoftwareDecode&&(O=!0),1!==s||!r||A||this.needsSoftwareDecode||(this.myapi=0,this.outNode=F()),this.bufferObject=null,this.audioData=null,this.myapi){case 0:this.bufferObject=new Audio,this.bufferObject.crossOrigin="anonymous",this.bufferObject.addEventListener("canplaythrough",(function(){a.wasEverReady=!0})),1===s&&o.createMediaElementSource&&!/wiiu/i.test(navigator.userAgent)&&(this.supportWebAudioAPI=!0,this.bufferObject.addEventListener("canplay",(function(){!a.mediaSourceNode&&a.bufferObject&&(a.mediaSourceNode=o.createMediaElementSource(a.bufferObject),a.mediaSourceNode.connect(a.outNode))}))),this.bufferObject.autoplay=!1,this.bufferObject.preload="auto",this.bufferObject.src=t;break;case 1:e.isWKWebView?e.fetchLocalFileViaCordovaAsArrayBuffer(t,(function(t){a.audioData=t,a.decodeAudioBuffer()}),(function(t){a.failedToLoad=!0})):((n=new XMLHttpRequest).open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){a.audioData=n.response,a.decodeAudioBuffer()},n.onerror=function(){a.failedToLoad=!0},n.send());break;case 2:this.bufferObject=!0}}function rt(t,a){var h=this;this.tag=a,this.fresh=!0,this.stopped=!0,this.src=t.src,this.buffer=t,this.myapi=s,this.is_music=t.is_music,this.playbackRate=1,this.hasPlaybackEnded=!0,this.resume_me=!1,this.is_paused=!1,this.resume_position=0,this.looping=!1,this.is_muted=!1,this.is_silent=!1,this.volume=1,this.onended_handler=function(t){if(!h.is_paused&&!h.resume_me){var n=this;n||(n=t.target),n===h.active_buffer&&(h.hasPlaybackEnded=!0,h.stopped=!0,r=h.tag,e.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,i))}},this.active_buffer=null,this.isTimescaled=1===l&&!this.is_music||2===l,this.mutevol=1,this.startTime=this.isTimescaled?e.kahanTime.sum:e.wallTime.sum,this.gainNode=null,this.pannerNode=null,this.pannerEnabled=!1,this.objectTracker=null,this.panX=0,this.panY=0,this.panAngle=0,this.panConeInner=0,this.panConeOuter=0,this.panConeOuterGain=0,this.instanceObject=null;var c=!1;switch(1!==this.myapi||0!==this.buffer.myapi||this.buffer.supportWebAudioAPI||(this.myapi=0),this.myapi){case 0:this.is_music?(this.instanceObject=t.bufferObject,c=!t.added_end_listener,t.added_end_listener=!0):(this.instanceObject=new Audio,this.instanceObject.crossOrigin="anonymous",this.instanceObject.autoplay=!1,this.instanceObject.src=t.bufferObject.src,c=!0),c&&this.instanceObject.addEventListener("ended",(function(){r=h.tag,h.stopped=!0,e.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,i)}));break;case 1:this.gainNode=F(),this.gainNode.connect(N(a)),1===this.buffer.myapi?t.bufferObject&&(this.instanceObject=o.createBufferSource(),this.instanceObject.buffer=t.bufferObject,this.instanceObject.connect(this.gainNode)):(this.instanceObject=this.buffer.bufferObject,this.buffer.outNode.connect(this.gainNode),this.buffer.added_end_listener||(this.buffer.added_end_listener=!0,this.buffer.bufferObject.addEventListener("ended",(function(){r=h.tag,h.stopped=!0,e.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,i)}))));break;case 2:this.instanceObject=new window.Media(n+this.src,null,null,(function(t){t===window.Media.MEDIA_STOPPED&&(h.hasPlaybackEnded=!0,h.stopped=!0,r=h.tag,e.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,i))}))}}it.prototype.release=function(){var t,e,i,r;for(t=0,i=0,e=h.length;t<e;++t)r=h[t],h[i]=r,r.buffer===this?r.stop():++i;h.length=i,this.mediaSourceNode&&(this.mediaSourceNode.disconnect(),this.mediaSourceNode=null),this.outNode&&(this.outNode.disconnect(),this.outNode=null),this.bufferObject=null,this.audioData=null},it.prototype.decodeAudioBuffer=function(){if(!this.bufferObject&&this.audioData){var t=this;if(this.needsSoftwareDecode){var e=this.audioData;this.audioData=null,window.OpusDecoder(e,(function(e,i){if(e)t.onDecodeError(e);else{var r=new Float32Array(i),n=o.createBuffer(1,r.length,48e3);n.getChannelData(0).set(r),t.onDecodeComplete(n)}}))}else o.decodeAudioData(this.audioData,(function(e){t.onDecodeComplete(e)}),(function(e){t.onDecodeError(e)}))}},it.prototype.onDecodeComplete=function(t){var i,r,n,s;if(this.bufferObject=t,this.audioData=null,cr.is_undefined(this.playTagWhenReady)||u){if(!cr.is_undefined(this.convolveWhenReady)){var o=this.convolveWhenReady.convolveNode;o.normalize=this.normalizeWhenReady,o.buffer=t}}else if(this.panWhenReady.length){for(r=0,n=this.panWhenReady.length;r<n;r++)if((s=new rt(this,(i=this.panWhenReady[r]).thistag)).setPannerEnabled(!0),void 0===i.objUid||(i.obj=e.getObjectByUID(i.objUid),i.obj)){if(i.obj){var a=cr.rotatePtAround(i.obj.x,i.obj.y,-i.obj.layer.getAngle(),d,f,!0),c=cr.rotatePtAround(i.obj.x,i.obj.y,-i.obj.layer.getAngle(),d,f,!1);s.setPan(a,c,cr.to_degrees(i.obj.angle-i.obj.layer.getAngle()),i.ia,i.oa,i.og),s.setObject(i.obj)}else s.setPan(i.x,i.y,i.a,i.ia,i.oa,i.og);s.play(this.loopWhenReady,this.volumeWhenReady,this.seekWhenReady),this.pauseWhenReady&&s.pause(),h.push(s)}cr.clearArray(this.panWhenReady)}else(s=new rt(this,this.playTagWhenReady||"")).play(this.loopWhenReady,this.volumeWhenReady,this.seekWhenReady),this.pauseWhenReady&&s.pause(),h.push(s)},it.prototype.onDecodeError=function(t){self.failedToLoad=!0,console.error("Failed to decode audio '"+this.src+"': "+t)},it.prototype.isLoaded=function(){switch(this.myapi){case 0:var t=this.bufferObject.readyState>=4;return t&&(this.wasEverReady=!0),t||this.wasEverReady;case 1:return!!this.audioData||!!this.bufferObject;case 2:return!0}return!1},it.prototype.isLoadedAndDecoded=function(){switch(this.myapi){case 0:return this.isLoaded();case 1:return!!this.bufferObject;case 2:return!0}return!1},it.prototype.hasFailedToLoad=function(){switch(this.myapi){case 0:return!!this.bufferObject.error;case 1:return this.failedToLoad}return!1},rt.prototype.hasEnded=function(){switch(this.myapi){case 0:return this.instanceObject.ended;case 1:return 1===this.buffer.myapi?!(!this.fresh&&!this.stopped&&this.instanceObject.loop)&&(!this.is_paused&&this.hasPlaybackEnded):this.instanceObject.ended;case 2:return this.hasPlaybackEnded}return!0},rt.prototype.canBeRecycled=function(){return!(!this.fresh&&!this.stopped)||this.hasEnded()},rt.prototype.setPannerEnabled=function(t){if(1===s)if(!this.pannerEnabled&&t){if(!this.gainNode)return;this.pannerNode||(this.pannerNode=o.createPanner(),"number"==typeof this.pannerNode.panningModel?this.pannerNode.panningModel=m:this.pannerNode.panningModel=["equalpower","HRTF","soundfield"][m],"number"==typeof this.pannerNode.distanceModel?this.pannerNode.distanceModel=_:this.pannerNode.distanceModel=["linear","inverse","exponential"][_],this.pannerNode.refDistance=v,this.pannerNode.maxDistance=b,this.pannerNode.rolloffFactor=w),this.gainNode.disconnect(),this.gainNode.connect(this.pannerNode),this.pannerNode.connect(N(this.tag)),this.pannerEnabled=!0}else if(this.pannerEnabled&&!t){if(!this.gainNode)return;this.pannerNode.disconnect(),this.gainNode.disconnect(),this.gainNode.connect(N(this.tag)),this.pannerEnabled=!1}},rt.prototype.setPan=function(t,e,i,r,n,o){this.pannerEnabled&&1===s&&(this.pannerNode.setPosition(t,e,0),this.pannerNode.setOrientation(Math.cos(cr.to_radians(i)),Math.sin(cr.to_radians(i)),0),this.pannerNode.coneInnerAngle=r,this.pannerNode.coneOuterAngle=n,this.pannerNode.coneOuterGain=o,this.panX=t,this.panY=e,this.panAngle=i,this.panConeInner=r,this.panConeOuter=n,this.panConeOuterGain=o)},rt.prototype.setObject=function(t){this.pannerEnabled&&1===s&&(this.objectTracker||(this.objectTracker=new et),this.objectTracker.setObject(t))},rt.prototype.tick=function(t){if(this.pannerEnabled&&1===s&&this.objectTracker&&this.objectTracker.hasObject()&&this.isPlaying()){this.objectTracker.tick(t);var e=this.objectTracker.obj,i=cr.rotatePtAround(e.x,e.y,-e.layer.getAngle(),d,f,!0),r=cr.rotatePtAround(e.x,e.y,-e.layer.getAngle(),d,f,!1);this.pannerNode.setPosition(i,r,0);var n=0;void 0!==this.objectTracker.obj.angle&&(n=e.angle-e.layer.getAngle(),this.pannerNode.setOrientation(Math.cos(n),Math.sin(n),0))}},rt.prototype.play=function(t,i,r,n){var s=this.instanceObject;this.looping=t,this.volume=i;var a=r||0;switch(n=n||0,this.myapi){case 0:if(1!==s.playbackRate&&(s.playbackRate=1),s.volume!==i*p&&(s.volume=i*p),s.loop!==t&&(s.loop=t),s.muted&&(s.muted=!1),s.currentTime!==a)try{s.currentTime=a}catch(t){}I(this);break;case 1:if(this.muted=!1,this.mutevol=1,1===this.buffer.myapi)this.gainNode.gain.value=i*p,this.fresh||(this.instanceObject=o.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode)),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=t,this.hasPlaybackEnded=!1,0===a?j(this.instanceObject,n):V(this.instanceObject,a,this.getDuration(),n);else{if(1!==s.playbackRate&&(s.playbackRate=1),s.loop!==t&&(s.loop=t),s.volume=i*p,s.currentTime!==a)try{s.currentTime=a}catch(t){}I(this)}break;case 2:(!this.fresh&&this.stopped||0!==a)&&s.seekTo(a),s.play(),this.hasPlaybackEnded=!1}this.playbackRate=1,this.startTime=(this.isTimescaled?e.kahanTime.sum:e.wallTime.sum)-a,this.fresh=!1,this.stopped=!1,this.is_paused=!1},rt.prototype.stop=function(){switch(this.myapi){case 0:this.instanceObject.paused||this.instanceObject.pause();break;case 1:1===this.buffer.myapi?U(this.instanceObject):this.instanceObject.paused||this.instanceObject.pause();break;case 2:this.instanceObject.stop()}this.stopped=!0,this.is_paused=!1},rt.prototype.pause=function(){if(!(this.fresh||this.stopped||this.hasEnded()||this.is_paused)){switch(this.myapi){case 0:this.instanceObject.paused||this.instanceObject.pause();break;case 1:1===this.buffer.myapi?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position=this.resume_position%this.getDuration()),this.is_paused=!0,U(this.instanceObject)):this.instanceObject.paused||this.instanceObject.pause();break;case 2:this.instanceObject.pause()}this.is_paused=!0}},rt.prototype.resume=function(){if(!(this.fresh||this.stopped||this.hasEnded())&&this.is_paused){switch(this.myapi){case 0:I(this);break;case 1:1===this.buffer.myapi?(this.instanceObject=o.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=p*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?e.kahanTime.sum:e.wallTime.sum)-this.resume_position/(this.playbackRate||.001),V(this.instanceObject,this.resume_position,this.getDuration())):I(this);break;case 2:this.instanceObject.play()}this.is_paused=!1}},rt.prototype.seek=function(t){if(!(this.fresh||this.stopped||this.hasEnded()))switch(this.myapi){case 0:try{this.instanceObject.currentTime=t}catch(t){}break;case 1:if(1===this.buffer.myapi)this.is_paused?this.resume_position=t:(this.pause(),this.resume_position=t,this.resume());else try{this.instanceObject.currentTime=t}catch(t){}}},rt.prototype.reconnect=function(t){1===this.myapi&&(this.pannerEnabled?(this.pannerNode.disconnect(),this.pannerNode.connect(t)):(this.gainNode.disconnect(),this.gainNode.connect(t)))},rt.prototype.getDuration=function(t){var e=0;switch(this.myapi){case 0:void 0!==this.instanceObject.duration&&(e=this.instanceObject.duration);break;case 1:e=this.buffer.bufferObject.duration;break;case 2:e=this.instanceObject.getDuration()}return t&&(e/=this.playbackRate||.001),e},rt.prototype.getPlaybackTime=function(t){var i=this.getDuration(),r=0;switch(this.myapi){case 0:void 0!==this.instanceObject.currentTime&&(r=this.instanceObject.currentTime);break;case 1:if(1===this.buffer.myapi){if(this.is_paused)return this.resume_position;r=(this.isTimescaled?e.kahanTime.sum:e.wallTime.sum)-this.startTime}else void 0!==this.instanceObject.currentTime&&(r=this.instanceObject.currentTime)}return t&&(r*=this.playbackRate),!this.looping&&r>i&&(r=i),r},rt.prototype.isPlaying=function(){return!(this.is_paused||this.fresh||this.stopped||this.hasEnded())},rt.prototype.shouldSave=function(){return!this.fresh&&!this.stopped&&!this.hasEnded()},rt.prototype.setVolume=function(t){this.volume=t,this.updateVolume()},rt.prototype.updateVolume=function(){var t=this.volume*p;switch(isFinite(t)||(t=0),this.myapi){case 0:void 0!==this.instanceObject.volume&&this.instanceObject.volume!==t&&(this.instanceObject.volume=t);break;case 1:1===this.buffer.myapi?this.gainNode.gain.value=t*this.mutevol:void 0!==this.instanceObject.volume&&this.instanceObject.volume!==t&&(this.instanceObject.volume=t)}},rt.prototype.getVolume=function(){return this.volume},rt.prototype.doSetMuted=function(t){switch(this.myapi){case 0:this.instanceObject.muted!==!!t&&(this.instanceObject.muted=!!t);break;case 1:1===this.buffer.myapi?(this.mutevol=t?0:1,this.gainNode.gain.value=p*this.volume*this.mutevol):this.instanceObject.muted!==!!t&&(this.instanceObject.muted=!!t)}},rt.prototype.setMuted=function(t){this.is_muted=!!t,this.doSetMuted(this.is_muted||this.is_silent)},rt.prototype.setSilent=function(t){this.is_silent=!!t,this.doSetMuted(this.is_muted||this.is_silent)},rt.prototype.setLooping=function(t){switch(this.looping=t,this.myapi){case 0:case 1:this.instanceObject.loop!==!!t&&(this.instanceObject.loop=!!t)}},rt.prototype.setPlaybackRate=function(t){this.playbackRate=t,this.updatePlaybackRate()},rt.prototype.getPlaybackRate=function(t){return this.playbackRate},rt.prototype.updatePlaybackRate=function(){var t=this.playbackRate;switch(this.isTimescaled&&(t*=e.timescale),this.myapi){case 0:this.instanceObject.playbackRate!==t&&(this.instanceObject.playbackRate=t);break;case 1:1===this.buffer.myapi?this.instanceObject.playbackRate.value!==t&&(this.instanceObject.playbackRate.value=t):this.instanceObject.playbackRate!==t&&(this.instanceObject.playbackRate=t)}},rt.prototype.setSuspended=function(t){switch(this.myapi){case 0:t?this.isPlaying()?(this.resume_me=!0,this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(this.instanceObject.play(),this.resume_me=!1);break;case 1:t?this.isPlaying()?(this.resume_me=!0,1===this.buffer.myapi?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position=this.resume_position%this.getDuration()),U(this.instanceObject)):this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(1===this.buffer.myapi?(this.instanceObject=o.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=p*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?e.kahanTime.sum:e.wallTime.sum)-this.resume_position/(this.playbackRate||.001),V(this.instanceObject,this.resume_position,this.getDuration())):this.instanceObject.play(),this.resume_me=!1);break;case 2:t?this.isPlaying()?(this.instanceObject.pause(),this.resume_me=!0):this.resume_me=!1:this.resume_me&&(this.resume_me=!1,this.instanceObject.play())}},t.Instance=function(t){if(this.type=t,this.runtime=t.runtime,e=this.runtime,i=this,this.listenerTracker=null,this.listenerZ=-600,this.runtime.isWKWebView&&(A=!0),!(this.runtime.isiOS||this.runtime.isAndroid&&(this.runtime.isChrome||this.runtime.isAndroidStockBrowser))||this.runtime.isCrosswalk||this.runtime.isAmazonWebApp||A||(T=!0),o=null,"undefined"!=typeof AudioContext?(s=1,o=new AudioContext):"undefined"!=typeof webkitAudioContext&&(s=1,o=new webkitAudioContext),this.runtime.isiOS&&o&&(o.close&&o.close(),"undefined"!=typeof AudioContext?o=new AudioContext:"undefined"!=typeof webkitAudioContext&&(o=new webkitAudioContext)),1!==s&&this.runtime.isCordova&&void 0!==window.Media&&(s=2),2===s){var r=(n=location.href).lastIndexOf("/");r>-1&&(n=n.substr(0,r+1)),n=n.replace("file://","")}this.runtime.tickMe(this)};var nt=t.Instance.prototype;nt.onCreate=function(){this.runtime.audioInstance=this,l=this.properties[0],this.saveload=this.properties[1],this.playinbackground=this.properties[2],this.nextPlayTime=0,m=this.properties[4],_=this.properties[5],this.listenerZ=-this.properties[6],v=this.properties[7],b=this.properties[8],w=this.properties[9],this.listenerTracker=new et;var t=this.runtime.draw_width||this.runtime.width,e=this.runtime.draw_height||this.runtime.height;1===s&&(o.listener.setPosition(t/2,e/2,this.listenerZ),o.listener.setOrientation(0,0,1,0,-1,0),window.c2OnAudioMicStream=function(t,e){x&&x.disconnect(),S=e.toLowerCase(),(x=o.createMediaStreamSource(t)).connect(N(S))}),this.runtime.addSuspendCallback((function(t){i.onSuspend(t)}));var r=this;this.runtime.addDestroyCallback((function(t){r.onInstanceDestroyed(t)}))},nt.onInstanceDestroyed=function(t){var e,i,r;for(e=0,i=h.length;e<i;e++)(r=h[e]).objectTracker&&r.objectTracker.obj===t&&(r.objectTracker.obj=null,r.pannerEnabled&&r.isPlaying()&&r.looping&&r.stop());this.listenerTracker.obj===t&&(this.listenerTracker.obj=null)},nt.saveToJSON=function(){var t,e,i,r,n,s,o,a={silent:u,masterVolume:p,listenerZ:this.listenerZ,listenerUid:this.listenerTracker.hasObject()?this.listenerTracker.obj.uid:-1,playing:[],effects:{}},c=a.playing;for(t=0,e=h.length;t<e;t++)(i=h[t]).shouldSave()&&3!==this.saveload&&(i.is_music&&1===this.saveload||(i.is_music||2!==this.saveload)&&(o=i.getPlaybackTime(),i.looping&&(o%=i.getDuration()),r={tag:i.tag,buffersrc:i.buffer.src,buffertype:i.buffer.type,is_music:i.is_music,playbackTime:o,volume:i.volume,looping:i.looping,muted:i.is_muted,playbackRate:i.playbackRate,paused:i.is_paused,resume_position:i.resume_position},i.pannerEnabled&&(r.pan={},s=r.pan,i.objectTracker&&i.objectTracker.hasObject()?s.objUid=i.objectTracker.obj.uid:(s.x=i.panX,s.y=i.panY,s.a=i.panAngle),s.ia=i.panConeInner,s.oa=i.panConeOuter,s.og=i.panConeOuterGain),c.push(r)));var l,d=a.effects;for(n in M)if(M.hasOwnProperty(n)){for(l=[],t=0,e=M[n].length;t<e;t++)l.push({type:M[n][t].type,params:M[n][t].params});d[n]=l}return a};var st=[];nt.loadFromJSON=function(t){var e=t.silent;p=t.masterVolume,this.listenerZ=t.listenerZ,this.listenerTracker.setObject(null);var i=t.listenerUid;-1!==i&&(this.listenerTracker.loadUid=i,st.push(this.listenerTracker));var r,n,s,o,a,c,l,d,f,g,y,m,_,v,b,w,x,S,T,C=t.playing;if(3!==this.saveload)for(r=0,n=h.length;r<n;r++)(m=h[r]).is_music&&1===this.saveload||(m.is_music||2!==this.saveload)&&m.stop();for(_ in M)if(M.hasOwnProperty(_))for(r=0,n=M[_].length;r<n;r++)M[_][r].remove();for(_ in cr.wipe(M),t.effects)if(t.effects.hasOwnProperty(_))for(r=0,n=(w=t.effects[_]).length;r<n;r++)switch(x=w[r].type,S=w[r].params,x){case"filter":ut(_,new z(S[0],S[1],S[2],S[3],S[4],S[5]));break;case"delay":ut(_,new X(S[0],S[1],S[2]));break;case"convolve":o=S[2],(y=this.getAudioBuffer(o,!1)).bufferObject?T=new q(y.bufferObject,S[0],S[1],o):(T=new q(null,S[0],S[1],o),y.normalizeWhenReady=S[0],y.convolveWhenReady=T),ut(_,T);break;case"flanger":ut(_,new Y(S[0],S[1],S[2],S[3],S[4]));break;case"phaser":ut(_,new J(S[0],S[1],S[2],S[3],S[4],S[5]));break;case"gain":ut(_,new H(S[0]));break;case"tremolo":ut(_,new K(S[0],S[1]));break;case"ringmod":ut(_,new Z(S[0],S[1]));break;case"distortion":ut(_,new Q(S[0],S[1],S[2],S[3],S[4]));break;case"compressor":ut(_,new $(S[0],S[1],S[2],S[3],S[4]));break;case"analyser":ut(_,new tt(S[0],S[1]))}for(r=0,n=C.length;r<n;r++)3!==this.saveload&&(o=(s=C[r]).buffersrc,a=s.buffertype||"",c=s.is_music,l=s.tag,d=s.playbackTime,f=s.looping,g=s.volume,b=(v=s.pan)&&v.hasOwnProperty("objUid")?v.objUid:-1,c&&1===this.saveload||(c||2!==this.saveload)&&((m=this.getAudioInstance({url:o,type:a},l,c,f,g))?(m.resume_position=s.resume_position,m.setPannerEnabled(!!v),m.play(f,g,d),m.updatePlaybackRate(),m.updateVolume(),m.doSetMuted(m.is_muted||m.is_silent),s.paused&&m.pause(),s.muted&&m.setMuted(!0),m.doSetMuted(m.is_muted||m.is_silent),v&&(-1!==b?(m.objectTracker=m.objectTracker||new et,m.objectTracker.loadUid=b,st.push(m.objectTracker)):m.setPan(v.x,v.y,v.a,v.ia,v.oa,v.og))):((y=this.getAudioBuffer({url:o,type:""},c)).seekWhenReady=d,y.pauseWhenReady=s.paused,v&&(-1!==b?y.panWhenReady.push({objUid:b,ia:v.ia,oa:v.oa,og:v.og,thistag:l}):y.panWhenReady.push({x:v.x,y:v.y,a:v.a,ia:v.ia,oa:v.oa,og:v.og,thistag:l})))));if(e&&!u){for(r=0,n=h.length;r<n;r++)h[r].setSilent(!0);u=!0}else if(!e&&u){for(r=0,n=h.length;r<n;r++)h[r].setSilent(!1);u=!1}},nt.afterLoad=function(){var t,e,i,r;for(t=0,e=st.length;t<e;t++)i=st[t],r=this.runtime.getObjectByUID(i.loadUid),i.setObject(r),i.loadUid=-1,r&&(d=r.x,f=r.y);cr.clearArray(st)},nt.onSuspend=function(t){if(!this.playinbackground){var e,i;for(!t&&o&&o.resume&&(o.resume(),g=!1),e=0,i=h.length;e<i;e++)h[e].setSuspended(t);t&&o&&o.suspend&&(o.suspend(),g=!0)}},nt.tick=function(){var t,e,i,r,n,a,c=this.runtime.dt;for(t=0,e=h.length;t<e;t++)(i=h[t]).tick(c),0!==l&&i.updatePlaybackRate();for(r in M)if(M.hasOwnProperty(r))for(t=0,e=(n=M[r]).length;t<e;t++)(a=n[t]).tick&&a.tick();1===s&&this.listenerTracker.hasObject()&&(this.listenerTracker.tick(c),d=this.listenerTracker.obj.x,f=this.listenerTracker.obj.y,o.listener.setPosition(this.listenerTracker.obj.x,this.listenerTracker.obj.y,this.listenerZ))};var ot=[];nt.setPreloadList=function(t){var e,i,r,n,s=0;for(e=0,i=t.length;e<i;++e)n=2*(r=t[e]).size,ot.push({filename:r.filename,size:n,type:r.type,obj:null}),s+=n;return s},nt.startPreloads=function(){var t,e,i,r;for(t=0,e=ot.length;t<e;++t)i=ot[t],r=this.runtime.getProjectFileUrl(i.filename),i.obj=this.getAudioBuffer({url:r,type:i.type},!1)},nt.getPreloadedSize=function(){var t,e,i,r=0;for(t=0,e=ot.length;t<e;++t)(i=ot[t]).obj.isLoadedAndDecoded()||i.obj.hasFailedToLoad()||this.runtime.isAndroidStockBrowser?r+=i.size:i.obj.isLoaded()&&(r+=Math.floor(i.size/2));return r},nt.releaseAllMusicBuffers=function(){var t,e,i,r;for(t=0,i=0,e=a.length;t<e;++t)r=a[t],a[i]=r,r.is_music?r.release():++i;a.length=i},nt.getAudioBuffer=function(t,e,i){var r,n,s,o=null,h=t.url;for(r=0,n=a.length;r<n;r++)if((s=a[r]).src===h){o=s;break}return o||i||((A||O)&&e&&this.releaseAllMusicBuffers(),o=new it(h,t.type,e),a.push(o)),o},nt.getAudioInstance=function(t,e,i,r,n){var s,o,a,c=t.url;for(s=0,o=h.length;s<o;s++)if((a=h[s]).src===c&&(a.canBeRecycled()||i))return a.tag=e,a;var l=this.getAudioBuffer(t,i);return l.bufferObject?(a=new rt(l,e),h.push(a),a):("<preload>"!==e&&(l.playTagWhenReady=e,l.loopWhenReady=r,l.volumeWhenReady=n),null)};var at=[];function ht(t,e){var i=t.isPlaying()?1:0,r=e.isPlaying()?1:0;return i===r?0:i<r?1:-1}function ct(t,e){if(cr.clearArray(at),!t.length)return!c||c.hasEnded()?void 0:(cr.clearArray(at),void(at[0]=c));var i,r,n;for(i=0,r=h.length;i<r;i++)n=h[i],cr.equals_nocase(t,n.tag)&&at.push(n);e&&at.sort(ht)}function lt(t){var e,i,r,n,s=o.destination;if(M.hasOwnProperty(t)&&(r=M[t]).length)for(s=r[0].getInputNode(),e=0,i=r.length;e<i;e++)n=r[e],e+1===i?n.connectTo(o.destination):n.connectTo(r[e+1].getInputNode());for(ct(t),e=0,i=at.length;e<i;e++)at[e].reconnect(s);x&&S===t&&(x.disconnect(),x.connect(s))}function ut(t,e){M.hasOwnProperty(t)?M[t].push(e):M[t]=[e],lt(t)}function pt(){}function dt(){}function ft(){}function gt(t,e){var i=null;return M.hasOwnProperty(t)&&(i=M[t]),i&&e>=0&&e<i.length&&i[e].freqBins?i[e]:null}pt.prototype.OnEnded=function(t){return cr.equals_nocase(r,t)},pt.prototype.PreloadsComplete=function(){var t,e;for(t=0,e=a.length;t<e;t++)if(!a[t].isLoadedAndDecoded()&&!a[t].hasFailedToLoad())return!1;return!0},pt.prototype.AdvancedAudioSupported=function(){return 1===s},pt.prototype.IsSilent=function(){return u},pt.prototype.IsAnyPlaying=function(){var t,e;for(t=0,e=h.length;t<e;t++)if(h[t].isPlaying())return!0;return!1},pt.prototype.IsTagPlaying=function(t){var e,i;for(ct(t),e=0,i=at.length;e<i;e++)if(at[e].isPlaying())return!0;return!1},t.cnds=new pt,dt.prototype.Play=function(t,e,i,r){if(!u){var n=R(i),s=t[1],o=this.runtime.getProjectAudioFileUrl(t[0]);o&&(c=this.getAudioInstance(o,r,s,0!==e,n))&&(c.setPannerEnabled(!1),c.play(0!==e,n,0,this.nextPlayTime),this.nextPlayTime=0)}},dt.prototype.PlayAtPosition=function(t,e,i,r,n,s,o,a,h,l){if(!u){var p=R(i),d=t[1],f=this.runtime.getProjectAudioFileUrl(t[0]);if(f)if(c=this.getAudioInstance(f,l,d,0!==e,p))c.setPannerEnabled(!0),c.setPan(r,n,s,o,a,R(h)),c.play(0!==e,p,0,this.nextPlayTime),this.nextPlayTime=0;else this.getAudioBuffer(f,d).panWhenReady.push({x:r,y:n,a:s,ia:o,oa:a,og:R(h),thistag:l})}},dt.prototype.PlayAtObject=function(t,e,i,r,n,s,o,a){if(!u&&r){var h=r.getFirstPicked();if(h){var l=R(i),p=t[1],g=this.runtime.getProjectAudioFileUrl(t[0]);if(g)if(c=this.getAudioInstance(g,a,p,0!==e,l)){c.setPannerEnabled(!0);var y=cr.rotatePtAround(h.x,h.y,-h.layer.getAngle(),d,f,!0),m=cr.rotatePtAround(h.x,h.y,-h.layer.getAngle(),d,f,!1);c.setPan(y,m,cr.to_degrees(h.angle-h.layer.getAngle()),n,s,R(o)),c.setObject(h),c.play(0!==e,l,0,this.nextPlayTime),this.nextPlayTime=0}else{this.getAudioBuffer(g,p).panWhenReady.push({obj:h,ia:n,oa:s,og:R(o),thistag:a})}}}},dt.prototype.PlayByName=function(t,e,i,r,n){if(!u){var s=R(r),o=1===t,a=this.runtime.getProjectAudioFileUrl(e);a&&(c=this.getAudioInstance(a,n,o,0!==i,s))&&(c.setPannerEnabled(!1),c.play(0!==i,s,0,this.nextPlayTime),this.nextPlayTime=0)}},dt.prototype.PlayAtPositionByName=function(t,e,i,r,n,s,o,a,h,l,p){if(!u){var d=R(r),f=1===t,g=this.runtime.getProjectAudioFileUrl(e);if(g)if(c=this.getAudioInstance(g,p,f,0!==i,d))c.setPannerEnabled(!0),c.setPan(n,s,o,a,h,R(l)),c.play(0!==i,d,0,this.nextPlayTime),this.nextPlayTime=0;else this.getAudioBuffer(g,f).panWhenReady.push({x:n,y:s,a:o,ia:a,oa:h,og:R(l),thistag:p})}},dt.prototype.PlayAtObjectByName=function(t,e,i,r,n,s,o,a,h){if(!u&&n){var l=n.getFirstPicked();if(l){var p=R(r),g=1===t,y=this.runtime.getProjectAudioFileUrl(e);if(y)if(c=this.getAudioInstance(y,h,g,0!==i,p)){c.setPannerEnabled(!0);var m=cr.rotatePtAround(l.x,l.y,-l.layer.getAngle(),d,f,!0),_=cr.rotatePtAround(l.x,l.y,-l.layer.getAngle(),d,f,!1);c.setPan(m,_,cr.to_degrees(l.angle-l.layer.getAngle()),s,o,R(a)),c.setObject(l),c.play(0!==i,p,0,this.nextPlayTime),this.nextPlayTime=0}else{this.getAudioBuffer(y,g).panWhenReady.push({obj:l,ia:s,oa:o,og:R(a),thistag:h})}}}},dt.prototype.SetLooping=function(t,e){var i,r;for(ct(t),i=0,r=at.length;i<r;i++)at[i].setLooping(0===e)},dt.prototype.SetMuted=function(t,e){var i,r;for(ct(t),i=0,r=at.length;i<r;i++)at[i].setMuted(0===e)},dt.prototype.SetVolume=function(t,e){ct(t);var i,r,n=R(e);for(i=0,r=at.length;i<r;i++)at[i].setVolume(n)},dt.prototype.Preload=function(t){if(!u){var e=t[1],i=this.runtime.getProjectAudioFileUrl(t[0]);i&&2!==s&&this.getAudioInstance(i,"<preload>",e,!1)}},dt.prototype.PreloadByName=function(t,e){if(!u){var i=1===t,r=this.runtime.getProjectAudioFileUrl(e);r&&2!==s&&this.getAudioInstance(r,"<preload>",i,!1)}},dt.prototype.SetPlaybackRate=function(t,e){var i,r;for(ct(t),e<0&&(e=0),i=0,r=at.length;i<r;i++)at[i].setPlaybackRate(e)},dt.prototype.Stop=function(t){var e,i;for(ct(t),e=0,i=at.length;e<i;e++)at[e].stop()},dt.prototype.StopAll=function(){var t,e;for(t=0,e=h.length;t<e;t++)h[t].stop()},dt.prototype.SetPaused=function(t,e){var i,r;for(ct(t),i=0,r=at.length;i<r;i++)0===e?at[i].pause():at[i].resume()},dt.prototype.Seek=function(t,e){var i,r;for(ct(t),i=0,r=at.length;i<r;i++)at[i].seek(e)},dt.prototype.SetSilent=function(t){var e,i;if(2===t&&(t=u?1:0),0!==t||u){if(1===t&&u){for(e=0,i=h.length;e<i;e++)h[e].setSilent(!1);u=!1}}else{for(e=0,i=h.length;e<i;e++)h[e].setSilent(!0);u=!0}},dt.prototype.SetMasterVolume=function(t){var e,i;for(p=R(t),e=0,i=h.length;e<i;e++)h[e].updateVolume()},dt.prototype.AddFilterEffect=function(t,e,i,r,n,a,h){1!==s||e<0||e>=W.length||!o.createBiquadFilter||((h/=100)<0&&(h=0),h>1&&(h=1),ut(t=t.toLowerCase(),new z(e,i,r,n,a,h)))},dt.prototype.AddDelayEffect=function(t,e,i,r){1===s&&((r/=100)<0&&(r=0),r>1&&(r=1),ut(t=t.toLowerCase(),new X(e,R(i),r)))},dt.prototype.AddFlangerEffect=function(t,e,i,r,n,a){1===s&&o.createOscillator&&((a/=100)<0&&(a=0),a>1&&(a=1),ut(t=t.toLowerCase(),new Y(e/1e3,i/1e3,r,n/100,a)))},dt.prototype.AddPhaserEffect=function(t,e,i,r,n,a,h){1===s&&o.createOscillator&&((h/=100)<0&&(h=0),h>1&&(h=1),ut(t=t.toLowerCase(),new J(e,i,r,n,a,h)))},dt.prototype.AddConvolutionEffect=function(t,e,i,r){if(1===s&&o.createConvolver){var n=0===i,a=this.runtime.getProjectAudioFileUrl(e[0]);if(a){var h,c=this.getAudioBuffer(a,!1);t=t.toLowerCase(),(r/=100)<0&&(r=0),r>1&&(r=1),c.bufferObject?h=new q(c.bufferObject,n,r,a.url):(h=new q(null,n,r,a.url),c.normalizeWhenReady=n,c.convolveWhenReady=h),ut(t,h)}}},dt.prototype.AddGainEffect=function(t,e){1===s&&ut(t=t.toLowerCase(),new H(R(e)))},dt.prototype.AddMuteEffect=function(t){1===s&&ut(t=t.toLowerCase(),new H(0))},dt.prototype.AddTremoloEffect=function(t,e,i){1===s&&o.createOscillator&&((i/=100)<0&&(i=0),i>1&&(i=1),ut(t=t.toLowerCase(),new K(e,i)))},dt.prototype.AddRingModEffect=function(t,e,i){1===s&&o.createOscillator&&((i/=100)<0&&(i=0),i>1&&(i=1),ut(t=t.toLowerCase(),new Z(e,i)))},dt.prototype.AddDistortionEffect=function(t,e,i,r,n,a){1===s&&o.createWaveShaper&&((a/=100)<0&&(a=0),a>1&&(a=1),ut(t=t.toLowerCase(),new Q(e,i,r,n,a)))},dt.prototype.AddCompressorEffect=function(t,e,i,r,n,a){1===s&&o.createDynamicsCompressor&&ut(t=t.toLowerCase(),new $(e,i,r,n/1e3,a/1e3))},dt.prototype.AddAnalyserEffect=function(t,e,i){1===s&&ut(t=t.toLowerCase(),new tt(e,i))},dt.prototype.RemoveEffects=function(t){var e,i,r;if(1===s&&(t=t.toLowerCase(),M.hasOwnProperty(t)&&(r=M[t]).length)){for(e=0,i=r.length;e<i;e++)r[e].remove();cr.clearArray(r),lt(t)}},dt.prototype.SetEffectParameter=function(t,e,i,r,n,o){var a;1===s&&(t=t.toLowerCase(),e=Math.floor(e),M.hasOwnProperty(t)&&(a=M[t],e<0||e>=a.length||a[e].setParam(i,r,n,o)))},dt.prototype.SetListenerObject=function(t){if(t&&1===s){var e=t.getFirstPicked();e&&(this.listenerTracker.setObject(e),d=e.x,f=e.y)}},dt.prototype.SetListenerZ=function(t){this.listenerZ=t},dt.prototype.ScheduleNextPlay=function(t){o&&(this.nextPlayTime=t)},dt.prototype.UnloadAudio=function(t){var e=t[1],i=this.runtime.getProjectAudioFileUrl(t[0]);if(i){var r=this.getAudioBuffer(i,e,!0);r&&(r.release(),cr.arrayFindRemove(a,r))}},dt.prototype.UnloadAudioByName=function(t,e){var i=1===t,r=this.runtime.getProjectAudioFileUrl(e);if(r){var n=this.getAudioBuffer(r,i,!0);n&&(n.release(),cr.arrayFindRemove(a,n))}},dt.prototype.UnloadAll=function(){var t,e;for(t=0,e=a.length;t<e;++t)a[t].release();cr.clearArray(a)},t.acts=new dt,ft.prototype.Duration=function(t,e){ct(e,!0),at.length?t.set_float(at[0].getDuration()):t.set_float(0)},ft.prototype.PlaybackTime=function(t,e){ct(e,!0),at.length?t.set_float(at[0].getPlaybackTime(!0)):t.set_float(0)},ft.prototype.PlaybackRate=function(t,e){ct(e,!0),at.length?t.set_float(at[0].getPlaybackRate()):t.set_float(0)},ft.prototype.Volume=function(t,e){if(ct(e,!0),at.length){var i=at[0].getVolume();t.set_float(L(i))}else t.set_float(0)},ft.prototype.MasterVolume=function(t){t.set_float(L(p))},ft.prototype.EffectCount=function(t,e){e=e.toLowerCase();var i=null;M.hasOwnProperty(e)&&(i=M[e]),t.set_int(i?i.length:0)},ft.prototype.AnalyserFreqBinCount=function(t,e,i){var r=gt(e=e.toLowerCase(),i=Math.floor(i));t.set_int(r?r.node.frequencyBinCount:0)},ft.prototype.AnalyserFreqBinAt=function(t,e,i,r){e=e.toLowerCase(),i=Math.floor(i),r=Math.floor(r);var n=gt(e,i);n?r<0||r>=n.node.frequencyBinCount?t.set_float(0):t.set_float(n.freqBins[r]):t.set_float(0)},ft.prototype.AnalyserPeakLevel=function(t,e,i){var r=gt(e=e.toLowerCase(),i=Math.floor(i));r?t.set_float(r.peak):t.set_float(0)},ft.prototype.AnalyserRMSLevel=function(t,e,i){var r=gt(e=e.toLowerCase(),i=Math.floor(i));r?t.set_float(r.rms):t.set_float(0)},ft.prototype.SampleRate=function(t){t.set_int(o?o.sampleRate:0)},ft.prototype.CurrentTime=function(t){t.set_float(o?o.currentTime:cr.performance_now())},t.exps=new ft}();var localForageInitFailed=!1;try{
/*!
    localForage -- Offline Storage, Improved
    Version 1.5.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{(void 0!==window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).localforage=t()}}((function(){return function t(e,i,r){function n(o,a){if(!i[o]){if(!e[o]){var h="function"==typeof require&&require;if(!a&&h)return h(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=i[o]={exports:{}};e[o][0].call(l.exports,(function(t){var i=e[o][1][t];return n(i||t)}),l,l.exports,t,e,i,r)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)n(r[o]);return n}({1:[function(t,e,i){function r(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(n){if("TypeError"!==n.name)throw n;for(var i=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<t.length;r+=1)i.append(t[r]);return i.getBlob(e.type)}}function n(t,e){e&&t.then((function(t){e(null,t)}),(function(t){e(t)}))}function s(t,e,i){"function"==typeof e&&t.then(e),"function"==typeof i&&t.catch(i)}function o(t){return"boolean"==typeof v?w.resolve(v):function(t){return new w((function(e){var i=t.transaction(x,"readwrite"),n=r([""]);i.objectStore(x).put(n,"key"),i.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},i.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),i=navigator.userAgent.match(/Edge\//);e(i||!t||parseInt(t[1],10)>=43)}})).catch((function(){return!1}))}(t).then((function(t){return v=t}))}function a(t,e){return new w((function(i,r){if(t.db){if(!e)return i(t.db);(function(t){var e=b[t.name],i={};i.promise=new w((function(t){i.resolve=t})),e.deferredOperations.push(i),e.dbReady?e.dbReady=e.dbReady.then((function(){return i.promise})):e.dbReady=i.promise})(t),t.db.close()}var n=[t.name];e&&n.push(t.version);var s=_.open.apply(_,n);e&&(s.onupgradeneeded=function(e){var i=s.result;try{i.createObjectStore(t.storeName),e.oldVersion<=1&&i.createObjectStore(x)}catch(i){if("ConstraintError"!==i.name)throw i;console.warn('The database "'+t.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+t.storeName+'" already exists.')}}),s.onerror=function(t){t.preventDefault(),r(s.error)},s.onsuccess=function(){i(s.result),function(t){var e=b[t.name].deferredOperations.pop();e&&e.resolve()}(t)}}))}function h(t){var e=function(t){for(var e=t.length,i=new ArrayBuffer(e),r=new Uint8Array(i),n=0;e>n;n++)r[n]=t.charCodeAt(n);return i}(atob(t.data));return r([e],{type:t.type})}function c(t){return t&&t.__local_forage_encoded_blob}function l(t){var e=this,i=e._initReady().then((function(){var t=b[e._dbInfo.name];return t&&t.dbReady?t.dbReady:void 0}));return s(i,t,t),i}function u(t){var e,i,r,n,s,o=.75*t.length,a=t.length,h=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);var c=new ArrayBuffer(o),l=new Uint8Array(c);for(e=0;a>e;e+=4)i=C.indexOf(t[e]),r=C.indexOf(t[e+1]),n=C.indexOf(t[e+2]),s=C.indexOf(t[e+3]),l[h++]=i<<2|r>>4,l[h++]=(15&r)<<4|n>>2,l[h++]=(3&n)<<6|63&s;return c}function p(t){var e,i=new Uint8Array(t),r="";for(e=0;e<i.length;e+=3)r+=C[i[e]>>2],r+=C[(3&i[e])<<4|i[e+1]>>4],r+=C[(15&i[e+1])<<2|i[e+2]>>6],r+=C[63&i[e+2]];return i.length%3==2?r=r.substring(0,r.length-1)+"=":i.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function d(t,e,i,r){var s=this;"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t));var o=new w((function(n,o){s.ready().then((function(){void 0===e&&(e=null);var a=e,h=s._dbInfo;h.serializer.serialize(e,(function(e,c){c?o(c):h.db.transaction((function(i){i.executeSql("INSERT OR REPLACE INTO "+h.storeName+" (key, value) VALUES (?, ?)",[t,e],(function(){n(a)}),(function(t,e){o(e)}))}),(function(e){if(e.code===e.QUOTA_ERR){if(r>0)return void n(d.apply(s,[t,a,i,r-1]));o(e)}}))}))})).catch(o)}));return n(o,i),o}function f(t,e){t[e]=function(){var i=arguments;return t.ready().then((function(){return t[e].apply(t,i)}))}}function g(){for(var t=1;t<arguments.length;t++){var e=arguments[t];if(e)for(var i in e)e.hasOwnProperty(i)&&(Q(e[i])?arguments[0][i]=e[i].slice():arguments[0][i]=e[i])}return arguments[0]}function y(t){for(var e in Y)if(Y.hasOwnProperty(e)&&Y[e]===t)return!0;return!1}var m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},_=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){}}();"undefined"==typeof Promise&&t("lie/polyfill");var v,b,w=Promise,x="local-forage-detect-blob-support",S=Object.prototype.toString,T={_driver:"asyncStorage",_initStorage:function(t){function e(){return w.resolve()}var i=this,r={db:null};if(t)for(var n in t)r[n]=t[n];b||(b={});var s=b[r.name];s||(s={forages:[],db:null,dbReady:null,deferredOperations:[]},b[r.name]=s),s.forages.push(i),i._initReady||(i._initReady=i.ready,i.ready=l);for(var o=[],h=0;h<s.forages.length;h++){var c=s.forages[h];c!==i&&o.push(c._initReady().catch(e))}var u=s.forages.slice(0);return w.all(o).then((function(){return r.db=s.db,function(t){return a(t,!1)}(r)})).then((function(t){return r.db=t,function(t,e){if(!t.db)return!0;var i=!t.db.objectStoreNames.contains(t.storeName),r=t.version<t.db.version,n=t.version>t.db.version;if(r&&(t.version!==e&&console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),n||i){if(i){var s=t.db.version+1;s>t.version&&(t.version=s)}return!0}return!1}(r,i._defaultConfig.version)?function(t){return a(t,!0)}(r):t})).then((function(t){r.db=s.db=t,i._dbInfo=r;for(var e=0;e<u.length;e++){var n=u[e];n!==i&&(n._dbInfo.db=r.db,n._dbInfo.version=r.version)}}))},iterate:function(t,e){var i=this,r=new w((function(e,r){i.ready().then((function(){var n=i._dbInfo,s=n.db.transaction(n.storeName,"readonly").objectStore(n.storeName).openCursor(),o=1;s.onsuccess=function(){var i=s.result;if(i){var r=i.value;c(r)&&(r=h(r));var n=t(r,i.key,o++);void 0!==n?e(n):i.continue()}else e()},s.onerror=function(){r(s.error)}})).catch(r)}));return n(r,e),r},getItem:function(t,e){var i=this;"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t));var r=new w((function(e,r){i.ready().then((function(){var n=i._dbInfo,s=n.db.transaction(n.storeName,"readonly").objectStore(n.storeName).get(t);s.onsuccess=function(){var t=s.result;void 0===t&&(t=null),c(t)&&(t=h(t)),e(t)},s.onerror=function(){r(s.error)}})).catch(r)}));return n(r,e),r},setItem:function(t,e,i){var r=this;"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t));var s=new w((function(i,n){var s;r.ready().then((function(){return s=r._dbInfo,"[object Blob]"===S.call(e)?o(s.db).then((function(t){return t?e:function(t){return new w((function(e,i){var r=new FileReader;r.onerror=i,r.onloadend=function(i){var r=btoa(i.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:t.type})},r.readAsBinaryString(t)}))}(e)})):e})).then((function(e){var r=s.db.transaction(s.storeName,"readwrite"),o=r.objectStore(s.storeName).put(e,t);null===e&&(e=void 0),r.oncomplete=function(){void 0===e&&(e=null),i(e)},r.onabort=r.onerror=function(){var t=o.error?o.error:o.transaction.error;n(t)}})).catch(n)}));return n(s,i),s},removeItem:function(t,e){var i=this;"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t));var r=new w((function(e,r){i.ready().then((function(){var n=i._dbInfo,s=n.db.transaction(n.storeName,"readwrite"),o=s.objectStore(n.storeName).delete(t);s.oncomplete=function(){e()},s.onerror=function(){r(o.error)},s.onabort=function(){var t=o.error?o.error:o.transaction.error;r(t)}})).catch(r)}));return n(r,e),r},clear:function(t){var e=this,i=new w((function(t,i){e.ready().then((function(){var r=e._dbInfo,n=r.db.transaction(r.storeName,"readwrite"),s=n.objectStore(r.storeName).clear();n.oncomplete=function(){t()},n.onabort=n.onerror=function(){var t=s.error?s.error:s.transaction.error;i(t)}})).catch(i)}));return n(i,t),i},length:function(t){var e=this,i=new w((function(t,i){e.ready().then((function(){var r=e._dbInfo,n=r.db.transaction(r.storeName,"readonly").objectStore(r.storeName).count();n.onsuccess=function(){t(n.result)},n.onerror=function(){i(n.error)}})).catch(i)}));return n(i,t),i},key:function(t,e){var i=this,r=new w((function(e,r){return 0>t?void e(null):void i.ready().then((function(){var n=i._dbInfo,s=n.db.transaction(n.storeName,"readonly").objectStore(n.storeName),o=!1,a=s.openCursor();a.onsuccess=function(){var i=a.result;return i?void(0===t||o?e(i.key):(o=!0,i.advance(t))):void e(null)},a.onerror=function(){r(a.error)}})).catch(r)}));return n(r,e),r},keys:function(t){var e=this,i=new w((function(t,i){e.ready().then((function(){var r=e._dbInfo,n=r.db.transaction(r.storeName,"readonly").objectStore(r.storeName).openCursor(),s=[];n.onsuccess=function(){var e=n.result;return e?(s.push(e.key),void e.continue()):void t(s)},n.onerror=function(){i(n.error)}})).catch(i)}));return n(i,t),i}},C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",A="~~local_forage_type~",O=/^~~local_forage_type~([^~]+)~/,E="__lfsc__:",P=E.length,I="arbf",k="blob",R="si08",L="ui08",B="uic8",M="si16",N="si32",F="ur16",D="ui32",j="fl32",V="fl64",U=P+I.length,G=Object.prototype.toString,W={serialize:function(t,e){var i="";if(t&&(i=G.call(t)),t&&("[object ArrayBuffer]"===i||t.buffer&&"[object ArrayBuffer]"===G.call(t.buffer))){var r,n=E;t instanceof ArrayBuffer?(r=t,n+=I):(r=t.buffer,"[object Int8Array]"===i?n+=R:"[object Uint8Array]"===i?n+=L:"[object Uint8ClampedArray]"===i?n+=B:"[object Int16Array]"===i?n+=M:"[object Uint16Array]"===i?n+=F:"[object Int32Array]"===i?n+=N:"[object Uint32Array]"===i?n+=D:"[object Float32Array]"===i?n+=j:"[object Float64Array]"===i?n+=V:e(new Error("Failed to get type for BinaryArray"))),e(n+p(r))}else if("[object Blob]"===i){var s=new FileReader;s.onload=function(){var i=A+t.type+"~"+p(this.result);e(E+k+i)},s.readAsArrayBuffer(t)}else try{e(JSON.stringify(t))}catch(i){console.error("Couldn't convert value into a JSON string: ",t),e(null,i)}},deserialize:function(t){if(t.substring(0,P)!==E)return JSON.parse(t);var e,i=t.substring(U),n=t.substring(P,U);if(n===k&&O.test(i)){var s=i.match(O);e=s[1],i=i.substring(s[0].length)}var o=u(i);switch(n){case I:return o;case k:return r([o],{type:e});case R:return new Int8Array(o);case L:return new Uint8Array(o);case B:return new Uint8ClampedArray(o);case M:return new Int16Array(o);case F:return new Uint16Array(o);case N:return new Int32Array(o);case D:return new Uint32Array(o);case j:return new Float32Array(o);case V:return new Float64Array(o);default:throw new Error("Unkown type: "+n)}},stringToBuffer:u,bufferToString:p},z={_driver:"webSQLStorage",_initStorage:function(t){var e=this,i={db:null};if(t)for(var r in t)i[r]="string"!=typeof t[r]?t[r].toString():t[r];var n=new w((function(t,r){try{i.db=openDatabase(i.name,String(i.version),i.description,i.size)}catch(t){return r(t)}i.db.transaction((function(n){n.executeSql("CREATE TABLE IF NOT EXISTS "+i.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],(function(){e._dbInfo=i,t()}),(function(t,e){r(e)}))}))}));return i.serializer=W,n},iterate:function(t,e){var i=this,r=new w((function(e,r){i.ready().then((function(){var n=i._dbInfo;n.db.transaction((function(i){i.executeSql("SELECT * FROM "+n.storeName,[],(function(i,r){for(var s=r.rows,o=s.length,a=0;o>a;a++){var h=s.item(a),c=h.value;if(c&&(c=n.serializer.deserialize(c)),void 0!==(c=t(c,h.key,a+1)))return void e(c)}e()}),(function(t,e){r(e)}))}))})).catch(r)}));return n(r,e),r},getItem:function(t,e){var i=this;"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t));var r=new w((function(e,r){i.ready().then((function(){var n=i._dbInfo;n.db.transaction((function(i){i.executeSql("SELECT * FROM "+n.storeName+" WHERE key = ? LIMIT 1",[t],(function(t,i){var r=i.rows.length?i.rows.item(0).value:null;r&&(r=n.serializer.deserialize(r)),e(r)}),(function(t,e){r(e)}))}))})).catch(r)}));return n(r,e),r},setItem:function(t,e,i){return d.apply(this,[t,e,i,1])},removeItem:function(t,e){var i=this;"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t));var r=new w((function(e,r){i.ready().then((function(){var n=i._dbInfo;n.db.transaction((function(i){i.executeSql("DELETE FROM "+n.storeName+" WHERE key = ?",[t],(function(){e()}),(function(t,e){r(e)}))}))})).catch(r)}));return n(r,e),r},clear:function(t){var e=this,i=new w((function(t,i){e.ready().then((function(){var r=e._dbInfo;r.db.transaction((function(e){e.executeSql("DELETE FROM "+r.storeName,[],(function(){t()}),(function(t,e){i(e)}))}))})).catch(i)}));return n(i,t),i},length:function(t){var e=this,i=new w((function(t,i){e.ready().then((function(){var r=e._dbInfo;r.db.transaction((function(e){e.executeSql("SELECT COUNT(key) as c FROM "+r.storeName,[],(function(e,i){var r=i.rows.item(0).c;t(r)}),(function(t,e){i(e)}))}))})).catch(i)}));return n(i,t),i},key:function(t,e){var i=this,r=new w((function(e,r){i.ready().then((function(){var n=i._dbInfo;n.db.transaction((function(i){i.executeSql("SELECT key FROM "+n.storeName+" WHERE id = ? LIMIT 1",[t+1],(function(t,i){var r=i.rows.length?i.rows.item(0).key:null;e(r)}),(function(t,e){r(e)}))}))})).catch(r)}));return n(r,e),r},keys:function(t){var e=this,i=new w((function(t,i){e.ready().then((function(){var r=e._dbInfo;r.db.transaction((function(e){e.executeSql("SELECT key FROM "+r.storeName,[],(function(e,i){for(var r=[],n=0;n<i.rows.length;n++)r.push(i.rows.item(n).key);t(r)}),(function(t,e){i(e)}))}))})).catch(i)}));return n(i,t),i}},X={_driver:"localStorageWrapper",_initStorage:function(t){var e={};if(t)for(var i in t)e[i]=t[i];return e.keyPrefix=e.name+"/",e.storeName!==this._defaultConfig.storeName&&(e.keyPrefix+=e.storeName+"/"),this._dbInfo=e,e.serializer=W,w.resolve()},iterate:function(t,e){var i=this,r=i.ready().then((function(){for(var e=i._dbInfo,r=e.keyPrefix,n=r.length,s=localStorage.length,o=1,a=0;s>a;a++){var h=localStorage.key(a);if(0===h.indexOf(r)){var c=localStorage.getItem(h);if(c&&(c=e.serializer.deserialize(c)),void 0!==(c=t(c,h.substring(n),o++)))return c}}}));return n(r,e),r},getItem:function(t,e){var i=this;"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t));var r=i.ready().then((function(){var e=i._dbInfo,r=localStorage.getItem(e.keyPrefix+t);return r&&(r=e.serializer.deserialize(r)),r}));return n(r,e),r},setItem:function(t,e,i){var r=this;"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t));var s=r.ready().then((function(){void 0===e&&(e=null);var i=e;return new w((function(n,s){var o=r._dbInfo;o.serializer.serialize(e,(function(e,r){if(r)s(r);else try{localStorage.setItem(o.keyPrefix+t,e),n(i)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||s(t),s(t)}}))}))}));return n(s,i),s},removeItem:function(t,e){var i=this;"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t));var r=i.ready().then((function(){var e=i._dbInfo;localStorage.removeItem(e.keyPrefix+t)}));return n(r,e),r},clear:function(t){var e=this,i=e.ready().then((function(){for(var t=e._dbInfo.keyPrefix,i=localStorage.length-1;i>=0;i--){var r=localStorage.key(i);0===r.indexOf(t)&&localStorage.removeItem(r)}}));return n(i,t),i},length:function(t){var e=this.keys().then((function(t){return t.length}));return n(e,t),e},key:function(t,e){var i=this,r=i.ready().then((function(){var e,r=i._dbInfo;try{e=localStorage.key(t)}catch(t){e=null}return e&&(e=e.substring(r.keyPrefix.length)),e}));return n(r,e),r},keys:function(t){var e=this,i=e.ready().then((function(){for(var t=e._dbInfo,i=localStorage.length,r=[],n=0;i>n;n++)0===localStorage.key(n).indexOf(t.keyPrefix)&&r.push(localStorage.key(n).substring(t.keyPrefix.length));return r}));return n(i,t),i}},q={},Y={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage"},J=[Y.INDEXEDDB,Y.WEBSQL,Y.LOCALSTORAGE],H=["clear","getItem","iterate","key","keys","length","removeItem","setItem"],K={description:"",driver:J.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},Z={};Z[Y.INDEXEDDB]=function(){try{if(!_)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return!1}}(),Z[Y.WEBSQL]="function"==typeof openDatabase,Z[Y.LOCALSTORAGE]=function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&localStorage.setItem}catch(t){return!1}}();var Q=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},$=function(){function t(e){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.INDEXEDDB=Y.INDEXEDDB,this.LOCALSTORAGE=Y.LOCALSTORAGE,this.WEBSQL=Y.WEBSQL,this._defaultConfig=g({},K),this._config=g({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return t.prototype.config=function(t){if("object"===(void 0===t?"undefined":m(t))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e]}return!("driver"in t)||!t.driver||this.setDriver(this._config.driver)}return"string"==typeof t?this._config[t]:this._config},t.prototype.defineDriver=function(t,e,i){var r=new w((function(e,i){try{var r=t._driver,n=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver"),s=new Error("Custom driver name already in use: "+t._driver);if(!t._driver)return void i(n);if(y(t._driver))return void i(s);for(var o=H.concat("_initStorage"),a=0;a<o.length;a++){var h=o[a];if(!h||!t[h]||"function"!=typeof t[h])return void i(n)}var c=w.resolve(!0);"_support"in t&&(c=t._support&&"function"==typeof t._support?t._support():w.resolve(!!t._support)),c.then((function(i){Z[r]=i,q[r]=t,e()}),i)}catch(t){i(t)}}));return s(r,e,i),r},t.prototype.driver=function(){return this._driver||null},t.prototype.getDriver=function(t,e,i){var r=this,n=w.resolve().then((function(){if(!y(t)){if(q[t])return q[t];throw new Error("Driver not found.")}switch(t){case r.INDEXEDDB:return T;case r.LOCALSTORAGE:return X;case r.WEBSQL:return z}}));return s(n,e,i),n},t.prototype.getSerializer=function(t){var e=w.resolve(W);return s(e,t),e},t.prototype.ready=function(t){var e=this,i=e._driverSet.then((function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready}));return s(i,t,t),i},t.prototype.setDriver=function(t,e,i){function r(){o._config.driver=o.driver()}function n(t){return o._extend(t),r(),o._ready=o._initStorage(o._config),o._ready}var o=this;Q(t)||(t=[t]);var a=this._getSupportedDrivers(t),h=null!==this._driverSet?this._driverSet.catch((function(){return w.resolve()})):w.resolve();return this._driverSet=h.then((function(){var t=a[0];return o._dbInfo=null,o._ready=null,o.getDriver(t).then((function(t){o._driver=t._driver,r(),o._wrapLibraryMethodsWithReady(),o._initDriver=function(t){return function(){var e=0;return function i(){for(;e<t.length;){var s=t[e];return e++,o._dbInfo=null,o._ready=null,o.getDriver(s).then(n).catch(i)}r();var a=new Error("No available storage method found.");return o._driverSet=w.reject(a),o._driverSet}()}}(a)}))})).catch((function(){r();var t=new Error("No available storage method found.");return o._driverSet=w.reject(t),o._driverSet})),s(this._driverSet,e,i),this._driverSet},t.prototype.supports=function(t){return!!Z[t]},t.prototype._extend=function(t){g(this,t)},t.prototype._getSupportedDrivers=function(t){for(var e=[],i=0,r=t.length;r>i;i++){var n=t[i];this.supports(n)&&e.push(n)}return e},t.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0;t<H.length;t++)f(this,H[t])},t.prototype.createInstance=function(e){return new t(e)},t}(),tt=new $;e.exports=tt},{undefined:void 0}]},{},[1])(1)}))}catch(t){localForageInitFailed=!0}cr.plugins_.LocalStorage=function(t){this.runtime=t},function(){var t="",e="",i=[],r="";function n(t){return t?"string"==typeof t?t:"string"==typeof t.message?t.message:"string"==typeof t.name?t.name:"string"==typeof t.data?t.data:"unknown error":"unknown error"}function s(t,e){r=e,t.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,t)}var o="",a=void 0!==window.is_scirra_arcade;function h(t){return!o||t.substr(0,o.length)===o}a&&(o="sa"+window.scirra_arcade_id+"_");var c=cr.plugins_.LocalStorage.prototype;c.Type=function(t){this.plugin=t,this.runtime=t.runtime},c.Type.prototype.onCreate=function(){},c.Instance=function(t){this.type=t,this.runtime=t.runtime};var l=c.Instance.prototype;l.onCreate=function(){this.pendingSets=0,this.pendingGets=0},l.onDestroy=function(){},l.saveToJSON=function(){return{}},l.loadFromJSON=function(t){};function u(){}function p(){}function d(){}u.prototype.OnItemSet=function(e){return t===e},u.prototype.OnAnyItemSet=function(){return!0},u.prototype.OnItemGet=function(e){return t===e},u.prototype.OnAnyItemGet=function(){return!0},u.prototype.OnItemRemoved=function(e){return t===e},u.prototype.OnAnyItemRemoved=function(){return!0},u.prototype.OnCleared=function(){return!0},u.prototype.OnAllKeyNamesLoaded=function(){return!0},u.prototype.OnError=function(){return!0},u.prototype.OnItemExists=function(e){return t===e},u.prototype.OnItemMissing=function(e){return t===e},u.prototype.CompareKey=function(e,i){return cr.do_cmp(t,e,i)},u.prototype.CompareValue=function(t,i){return cr.do_cmp(e,t,i)},u.prototype.IsProcessingSets=function(){return this.pendingSets>0},u.prototype.IsProcessingGets=function(){return this.pendingGets>0},u.prototype.OnAllSetsComplete=function(){return!0},u.prototype.OnAllGetsComplete=function(){return!0},c.cnds=new u,p.prototype.SetItem=function(i,a){if(localForageInitFailed)s(this,"storage failed to initialise - may be disabled in browser settings");else{var h=o+i;this.pendingSets++;var c=this;localforage.setItem(h,a,(function(s,o){!0,c.pendingSets--,s?(r=n(s),c.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,c)):(t=i,e=o,c.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemSet,c),c.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemSet,c),t="",e=""),0===c.pendingSets&&c.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllSetsComplete,c)}))}},p.prototype.GetItem=function(i){if(localForageInitFailed)s(this,"storage failed to initialise - may be disabled in browser settings");else{var a=o+i;this.pendingGets++;var h=this;localforage.getItem(a,(function(s,o){h.pendingGets--,s?(r=n(s),h.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,h)):(t=i,null==(e=o)&&(e=""),h.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemGet,h),h.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemGet,h),t="",e=""),0===h.pendingGets&&h.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllGetsComplete,h)}))}},p.prototype.CheckItemExists=function(i){if(localForageInitFailed)s(this,"storage failed to initialise - may be disabled in browser settings");else{var a=o+i,h=this;localforage.getItem(a,(function(s,o){s?(r=n(s),h.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,h)):(t=i,null===o?(e="",h.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemMissing,h)):(e=o,h.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemExists,h)),t="",e="")}))}},p.prototype.RemoveItem=function(i){if(localForageInitFailed)s(this,"storage failed to initialise - may be disabled in browser settings");else{var a=o+i,h=this;localforage.removeItem(a,(function(s){!0,s?(r=n(s),h.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,h)):(t=i,e="",h.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemRemoved,h),h.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemRemoved,h),t="")}))}},p.prototype.ClearStorage=function(){if(localForageInitFailed)s(this,"storage failed to initialise - may be disabled in browser settings");else if(!a){var o=this;localforage.clear((function(s){!0,s?(r=n(s),o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,o)):(t="",e="",cr.clearArray(i),o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnCleared,o))}))}},p.prototype.GetAllKeyNames=function(){if(localForageInitFailed)s(this,"storage failed to initialise - may be disabled in browser settings");else{var t=this;localforage.keys((function(e,s){var a,c,l,u;if(e)r=n(e),t.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,t);else{for(cr.clearArray(i),a=0,c=s.length;a<c;++a)h(l=s[a])&&i.push((u=l,o?h(u)?u.substr(o.length):void 0:u));t.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllKeyNamesLoaded,t)}}))}},c.acts=new p,d.prototype.ItemValue=function(t){t.set_any(e)},d.prototype.Key=function(e){e.set_string(t)},d.prototype.KeyCount=function(t){t.set_int(i.length)},d.prototype.KeyAt=function(t,e){(e=Math.floor(e))<0||e>=i.length?t.set_string(""):t.set_string(i[e])},d.prototype.ErrorMessage=function(t){t.set_string(r)},c.exps=new d}(),cr.plugins_.Browser=function(t){this.runtime=t},function(){var pluginProto=cr.plugins_.Browser.prototype;pluginProto.Type=function(t){this.plugin=t,this.runtime=t.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){};var offlineScriptReady=!1,browserPluginReady=!1;document.addEventListener("DOMContentLoaded",(function(){if(window.C3_RegisterSW&&navigator.serviceWorker){var t=document.createElement("script");t.onload=function(){offlineScriptReady=!0,checkReady()},t.src="offlineclient.js",document.head.appendChild(t)}}));var browserInstance=null;function checkReady(){offlineScriptReady&&browserPluginReady&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback((function(t){browserInstance.onSWMessage(t)}))}typeProto.onAppBegin=function(){browserPluginReady=!0,checkReady()},pluginProto.Instance=function(t){this.type=t,this.runtime=t.runtime};var instanceProto=pluginProto.Instance.prototype;instanceProto.onCreate=function(){var t=this;window.addEventListener("resize",(function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnResize,t)})),browserInstance=this,void 0!==navigator.onLine&&(window.addEventListener("online",(function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOnline,t)})),window.addEventListener("offline",(function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOffline,t)}))),document.addEventListener("backbutton",(function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t)})),document.addEventListener("menubutton",(function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,t)})),document.addEventListener("searchbutton",(function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnSearchButton,t)})),document.addEventListener("tizenhwkey",(function(e){switch(e.keyName){case"back":t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t)||window.tizen&&window.tizen.application.getCurrentApplication().exit();break;case"menu":t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,t)||e.preventDefault()}})),this.runtime.isWindows10&&"undefined"!=typeof Windows?Windows.UI.Core.SystemNavigationManager.getForCurrentView().addEventListener("backrequested",(function(e){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t)&&(e.handled=!0)})):this.runtime.isWinJS&&WinJS.Application&&(WinJS.Application.onbackclick=function(e){return!!t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t)}),this.runtime.addSuspendCallback((function(e){e?t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageHidden,t):t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageVisible,t)})),this.is_arcade=void 0!==window.is_scirra_arcade},instanceProto.onSWMessage=function(t){var e=t.data.type;"downloading-update"===e?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateFound,this):"update-ready"===e||"update-pending"===e?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,this):"offline-ready"===e&&this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOfflineReady,this)};var batteryManager=null,loadedBatteryManager=!1;function maybeLoadBatteryManager(){if(!loadedBatteryManager&&navigator.getBattery){var t=navigator.getBattery();loadedBatteryManager=!0,t&&t.then((function(t){batteryManager=t}))}}function Cnds(){}function Acts(){}Cnds.prototype.CookiesEnabled=function(){return!!navigator&&navigator.cookieEnabled},Cnds.prototype.IsOnline=function(){return!!navigator&&navigator.onLine},Cnds.prototype.HasJava=function(){return!!navigator&&navigator.javaEnabled()},Cnds.prototype.OnOnline=function(){return!0},Cnds.prototype.OnOffline=function(){return!0},Cnds.prototype.IsDownloadingUpdate=function(){return!1},Cnds.prototype.PageVisible=function(){return!this.runtime.isSuspended},Cnds.prototype.OnPageVisible=function(){return!0},Cnds.prototype.OnPageHidden=function(){return!0},Cnds.prototype.OnResize=function(){return!0},Cnds.prototype.IsFullscreen=function(){return!!(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen)},Cnds.prototype.OnBackButton=function(){return!0},Cnds.prototype.OnMenuButton=function(){return!0},Cnds.prototype.OnSearchButton=function(){return!0},Cnds.prototype.IsMetered=function(){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return!!t&&!!t.metered},Cnds.prototype.IsCharging=function(){var t=navigator.battery||navigator.mozBattery||navigator.webkitBattery;return t?!!t.charging:(maybeLoadBatteryManager(),!batteryManager||!!batteryManager.charging)},Cnds.prototype.IsPortraitLandscape=function(t){return(window.innerWidth<=window.innerHeight?0:1)===t},Cnds.prototype.SupportsFullscreen=function(){if(this.runtime.isNWjs)return!0;var t=this.runtime.canvas;return!!(t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullScreen)},Cnds.prototype.OnUpdateFound=function(){return!0},Cnds.prototype.OnUpdateReady=function(){return!0},Cnds.prototype.OnOfflineReady=function(){return!0},pluginProto.cnds=new Cnds,Acts.prototype.Alert=function(t){alert(t.toString())},Acts.prototype.Close=function(){window.tizen?window.tizen.application.getCurrentApplication().exit():navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():this.is_arcade||window.close()},Acts.prototype.Focus=function(){this.runtime.isNWjs?nw.Window.get().focus():this.is_arcade||window.focus()},Acts.prototype.Blur=function(){this.runtime.isNWjs?nw.Window.get().blur():this.is_arcade||window.blur()},Acts.prototype.GoBack=function(){navigator.app&&navigator.app.backHistory?navigator.app.backHistory():!this.is_arcade&&window.back&&window.back()},Acts.prototype.GoForward=function(){!this.is_arcade&&window.forward&&window.forward()},Acts.prototype.GoHome=function(){!this.is_arcade&&window.home&&window.home()},Acts.prototype.GoToURL=function(t,e){this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(t)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(t,{openExternal:!0}):this.runtime.isCordova?window.open(t,"_system"):this.runtime.isPreview?window.open(t,"_blank"):this.is_arcade||(2!==e||this.is_arcade?1!==e||this.is_arcade?window.location=t:window.parent.location=t:window.top.location=t)},Acts.prototype.GoToURLWindow=function(t,e){this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(t)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(t,{openExternal:!0}):this.runtime.isCordova?window.open(t,"_system"):this.is_arcade||window.open(t,e)},Acts.prototype.Reload=function(){this.is_arcade||window.location.reload()};var firstRequestFullscreen=!0,crruntime=null;function onFullscreenError(t){console&&console.warn&&console.warn("Fullscreen request failed: ",t),crruntime.setSize(window.innerWidth,window.innerHeight)}Acts.prototype.RequestFullScreen=function(t,e){if(t>=2&&(t+=1),6===t&&(t=2),!(document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement||document.fullScreen||document.fullScreenElement)){this.runtime.fullscreen_scaling=t>=2?t:0;var i={navigationUI:"auto"};1===e?i.navigationUI="hide":2===e&&(i.navigationUI="show");var r=document.documentElement;firstRequestFullscreen&&(firstRequestFullscreen=!1,crruntime=this.runtime,r.addEventListener("mozfullscreenerror",onFullscreenError),r.addEventListener("webkitfullscreenerror",onFullscreenError),r.addEventListener("MSFullscreenError",onFullscreenError),r.addEventListener("fullscreenerror",onFullscreenError)),r.requestFullscreen?r.requestFullscreen(i):r.mozRequestFullScreen?r.mozRequestFullScreen(i):r.msRequestFullscreen?r.msRequestFullscreen(i):r.webkitRequestFullScreen&&("undefined"!=typeof Element&&void 0!==Element.ALLOW_KEYBOARD_INPUT?r.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):r.webkitRequestFullScreen())}},Acts.prototype.CancelFullScreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},Acts.prototype.Vibrate=function(t){try{var e,i,r=t.split(",");for(e=0,i=r.length;e<i;e++)r[e]=parseInt(r[e],10);navigator.vibrate?navigator.vibrate(r):navigator.mozVibrate?navigator.mozVibrate(r):navigator.webkitVibrate?navigator.webkitVibrate(r):navigator.msVibrate&&navigator.msVibrate(r)}catch(t){}},Acts.prototype.InvokeDownload=function(t,e){if(e){var i=document.createElement("a");if(void 0===i.download)window.open(t);else{var r=document.getElementsByTagName("body")[0];i.textContent=e,i.href=t,i.download=e,r.appendChild(i);var n=new MouseEvent("click");i.dispatchEvent(n),r.removeChild(i)}}},Acts.prototype.InvokeDownloadString=function(t,e,i){if(i){var r="data:"+e+","+encodeURIComponent(t),n=document.createElement("a");if(void 0===n.download)window.open(r);else{var s=document.getElementsByTagName("body")[0];n.textContent=i,n.href=r,n.download=i,s.appendChild(n);var o=new MouseEvent("click");n.dispatchEvent(o),s.removeChild(n)}}},Acts.prototype.ConsoleLog=function(t,e){"undefined"!=typeof console&&(0===t&&console.log&&console.log(e.toString()),1===t&&console.warn&&console.warn(e.toString()),2===t&&console.error&&console.error(e.toString()))},Acts.prototype.ConsoleGroup=function(t){console&&console.group&&console.group(t)},Acts.prototype.ConsoleGroupEnd=function(){console&&console.groupEnd&&console.groupEnd()},Acts.prototype.ExecJs=function(js_){try{eval&&eval(js_)}catch(t){console&&console.error&&console.error("Error executing Javascript: ",t)}};var orientations=["portrait","landscape","portrait-primary","portrait-secondary","landscape-primary","landscape-secondary"];function Exps(){}Acts.prototype.LockOrientation=function(t){if(!((t=Math.floor(t))<0||t>=orientations.length)){this.runtime.autoLockOrientation=!1;var e=orientations[t];screen.orientation&&screen.orientation.lock?screen.orientation.lock(e):screen.lockOrientation?screen.lockOrientation(e):screen.webkitLockOrientation?screen.webkitLockOrientation(e):screen.mozLockOrientation?screen.mozLockOrientation(e):screen.msLockOrientation&&screen.msLockOrientation(e)}},Acts.prototype.UnlockOrientation=function(){this.runtime.autoLockOrientation=!1,screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()},pluginProto.acts=new Acts,Exps.prototype.URL=function(t){t.set_string(window.location.toString())},Exps.prototype.Protocol=function(t){t.set_string(window.location.protocol)},Exps.prototype.Domain=function(t){t.set_string(window.location.hostname)},Exps.prototype.PathName=function(t){t.set_string(window.location.pathname)},Exps.prototype.Hash=function(t){t.set_string(window.location.hash)},Exps.prototype.Referrer=function(t){t.set_string(document.referrer)},Exps.prototype.Title=function(t){t.set_string(document.title)},Exps.prototype.Name=function(t){t.set_string(navigator.appName)},Exps.prototype.Version=function(t){t.set_string(navigator.appVersion)},Exps.prototype.Language=function(t){navigator&&navigator.language?t.set_string(navigator.language):t.set_string("")},Exps.prototype.Platform=function(t){t.set_string(navigator.platform)},Exps.prototype.Product=function(t){navigator&&navigator.product?t.set_string(navigator.product):t.set_string("")},Exps.prototype.Vendor=function(t){navigator&&navigator.vendor?t.set_string(navigator.vendor):t.set_string("")},Exps.prototype.UserAgent=function(t){t.set_string(navigator.userAgent)},Exps.prototype.QueryString=function(t){t.set_string(window.location.search)},Exps.prototype.QueryParam=function(t,e){var i=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);i?t.set_string(decodeURIComponent(i[1].replace(/\+/g," "))):t.set_string("")},Exps.prototype.Bandwidth=function(t){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e?void 0!==e.bandwidth?t.set_float(e.bandwidth):void 0!==e.downlinkMax?t.set_float(e.downlinkMax):t.set_float(Number.POSITIVE_INFINITY):t.set_float(Number.POSITIVE_INFINITY)},Exps.prototype.ConnectionType=function(t){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e?t.set_string(e.type||"unknown"):t.set_string("unknown")},Exps.prototype.BatteryLevel=function(t){var e=navigator.battery||navigator.mozBattery||navigator.webkitBattery;e?t.set_float(e.level):(maybeLoadBatteryManager(),batteryManager?t.set_float(batteryManager.level):t.set_float(1))},Exps.prototype.BatteryTimeLeft=function(t){var e=navigator.battery||navigator.mozBattery||navigator.webkitBattery;e?t.set_float(e.dischargingTime):(maybeLoadBatteryManager(),batteryManager?t.set_float(batteryManager.dischargingTime):t.set_float(Number.POSITIVE_INFINITY))},Exps.prototype.ExecJS=function(ret,js_){if(eval){var result=0;try{result=eval(js_)}catch(t){console&&console.error&&console.error("Error executing Javascript: ",t)}"number"==typeof result||"string"==typeof result?ret.set_any(result):"boolean"==typeof result?ret.set_any(result?1:0):ret.set_any(0)}else ret.set_any(0)},Exps.prototype.ScreenWidth=function(t){t.set_int(screen.width)},Exps.prototype.ScreenHeight=function(t){t.set_int(screen.height)},Exps.prototype.DevicePixelRatio=function(t){t.set_float(this.runtime.devicePixelRatio)},Exps.prototype.WindowInnerWidth=function(t){t.set_int(window.innerWidth)},Exps.prototype.WindowInnerHeight=function(t){t.set_int(window.innerHeight)},Exps.prototype.WindowOuterWidth=function(t){t.set_int(window.outerWidth)},Exps.prototype.WindowOuterHeight=function(t){t.set_int(window.outerHeight)},pluginProto.exps=new Exps}(),cr.plugins_.Keyboard=function(t){this.runtime=t},function(){var t=cr.plugins_.Keyboard.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime,this.keyMap=new Array(256),this.typedKeyMap=new Array(256),this.usedKeys=new Array(256),this.triggerKey=0};var e=t.Instance.prototype;e.onCreate=function(){var t=this;document.addEventListener("keydown",(function(e){t.onKeyDown(e)})),document.addEventListener("keyup",(function(e){t.onKeyUp(e)}))};var i=[32,33,34,35,36,37,38,39,40,44];function r(){}function n(){}e.onKeyDown=function(t){var e=!1;if(window!=window.top&&i.indexOf(t.which)>-1&&(t.preventDefault(),e=!0,t.stopPropagation()),this.keyMap[t.which])this.usedKeys[t.which]&&!e&&t.preventDefault();else{var r=t.which;this.typedKeyMap[r]=t.key,this.keyMap[r]=!0,this.triggerKey=r,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKey,this);var n=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKey,this),s=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCode,this);this.runtime.isInUserInputEvent=!1,(n||s)&&(this.usedKeys[r]=!0,e||t.preventDefault())}},e.onKeyUp=function(t){var e=t.which;this.typedKeyMap[e]=t.key,this.keyMap[e]=!1,this.triggerKey=e,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var i=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),r=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);this.runtime.isInUserInputEvent=!1,(i||r||this.usedKeys[t.which])&&(this.usedKeys[e]=!0,t.preventDefault())},e.onWindowBlur=function(){var t;for(t=0;t<256;++t)if(this.keyMap[t]){this.keyMap[t]=!1,this.triggerKey=t,this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var e=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),i=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);(e||i)&&(this.usedKeys[t]=!0)}},e.saveToJSON=function(){return{triggerKey:this.triggerKey}},e.loadFromJSON=function(t){this.triggerKey=t.triggerKey},r.prototype.IsKeyDown=function(t){return this.keyMap[t]},r.prototype.OnKey=function(t){return t===this.triggerKey},r.prototype.OnAnyKey=function(t){return!0},r.prototype.OnAnyKeyReleased=function(t){return!0},r.prototype.OnKeyReleased=function(t){return t===this.triggerKey},r.prototype.IsKeyCodeDown=function(t){return!((t=Math.floor(t))<0||t>=this.keyMap.length)&&this.keyMap[t]},r.prototype.OnKeyCode=function(t){return t===this.triggerKey},r.prototype.OnKeyCodeReleased=function(t){return t===this.triggerKey},t.cnds=new r,t.acts=new function(){},n.prototype.TypedKey=function(t){t.set_string(this.typedKeyMap[this.triggerKey]||"")},n.prototype.LastKeyCode=function(t){t.set_int(this.triggerKey)},n.prototype.StringFromKeyCode=function(t,e){t.set_string(function(t){switch(t=Math.floor(t)){case 8:return"backspace";case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"control";case 18:return"alt";case 19:return"pause";case 20:return"capslock";case 27:return"esc";case 33:return"pageup";case 34:return"pagedown";case 35:return"end";case 36:return"home";case 37:return"←";case 38:return"↑";case 39:return"→";case 40:return"↓";case 45:return"insert";case 46:return"del";case 91:return"left window key";case 92:return"right window key";case 93:return"select";case 96:return"numpad 0";case 97:return"numpad 1";case 98:return"numpad 2";case 99:return"numpad 3";case 100:return"numpad 4";case 101:return"numpad 5";case 102:return"numpad 6";case 103:return"numpad 7";case 104:return"numpad 8";case 105:return"numpad 9";case 106:return"numpad *";case 107:return"numpad +";case 109:return"numpad -";case 110:return"numpad .";case 111:return"numpad /";case 112:return"F1";case 113:return"F2";case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 144:return"numlock";case 145:return"scroll lock";case 186:return";";case 187:return"=";case 188:return",";case 189:return"-";case 190:return".";case 191:return"/";case 192:return"'";case 219:return"[";case 220:return"\\";case 221:return"]";case 222:return"#";case 223:return"`";default:return String.fromCharCode(t)}}(e))},t.exps=new n}(),function(){var t="busy",e="shown",i="loaded",r="set",n="AD_FREE",s="UNKNOWN",o=["portrait","landscape","standard","large","medium","full","leaderboard"],a=["bottom","top"],h=null,c=!1,l=null,u=null,p=null,d=null,f=!0,g=null,y=null,m=null,_=null,v=null,b=null,w=null,x=null,S=null,T=null,C=null,A=null,O=null,E=null,P=null,I=null;function k(){return g===s||g===n}function R(e,i,n,s,o,a){null===l&&(h?(1===o&&(o=0),o=["eu","always","never"][o],a=["DISABLED","EEA","NOT_EEA"][a],l=t,h.Configure(e.trim(),i.trim(),n.trim(),s,o,c,a,(function(t,e){t?(l=null,E(t)):(l=r,e=e.split("_"),g=e[0],f="false"!==e[1],P())}))):E("advert plugin is not loaded"))}function L(){}function B(){}function M(){}function N(t){this.plugin=t,this.runtime=t.runtime}function F(t){this.type=t,this.runtime=t.runtime,this.errorMessage="",this.rewardType="",this.rewardValue=0}function D(t){this.runtime=t}L.prototype={CreateBanner:function(e,r,n,s){null==u&&(h?k()?v("user has not given consent"):(r=o[r],n=[!0,!1][n],s=a[s],self=this.type.plugin.acts,u=t,h.CreateBannerAdvert(e.trim(),r,c,s,(function(t,e){t?(u=null,v(t)):(u=i,y(),n&&self.ShowBanner())}))):v("advert plugin is not loaded"))},ShowBanner:function(){u==i&&(h?(u=t,h.ShowBannerAdvert((function(t,i){t?(u=null,console.error("Failed to show banner advert")):(u=e,x())}))):console.error("advert plugin is not loaded"))},HideBanner:function(){u==e&&(h?(u=t,h.HideBannerAdvert((function(t,e){u=null,t?console.error("Failed to hide banner advert"):C()}))):console.error("advert plugin is not loaded"))},CreateInterstitial:function(e,r){null==p&&(h?k()?w("user has not given consent"):(r=[!0,!1][r],self=this.type.plugin.acts,p=t,h.CreateInterstitialAdvert(e.trim(),c,(function(t,e){t?(p=null,w(t)):(p=i,_(),r&&self.ShowInterstitial())}))):w("advert plugin is not loaded"))},ShowInterstitial:function(){p==i&&(h?(p=e,h.ShowInterstitialAdvert((function(t,e){p=null,t?O(t):T()}))):O("advert plugin is not loaded"))},CreateVideo:function(e,r){null==d&&(h?k()?b("user has not given consent"):(r=[!0,!1][r],self=this.type.plugin.acts,d=t,h.CreateVideoAdvert(e.trim(),c,(function(t,e){t?(d=null,b(t)):(d=i,m(),r&&self.ShowVideo())}))):b("advert plugin is not loaded"))},ShowVideo:function(){d==i&&(h?(d=e,h.ShowVideoAdvert((function(t,e){if(d=null,t)A(t);else{var i=JSON.parse(e);S(i[0],i[1])}}))):A("advert plugin is not loaded"))},SetUserPersonalization:function(e){if(l===r)if(h){var i=s;switch(e){case 0:i="PERSONALIZED";break;case 1:i="NON_PERSONALIZED";break;case 2:i=n}l=t,h.SetUserPersonalisation(i,(function(t,e){t?(l=r,E(t)):(e===n&&(e=s),l=r,g=e,I())}))}else E("advert plugin is not loaded")},SetPublicKey:function(t,e,i,r,n,s){R(t,e,i,r=[!0,!1][r],n,s)},ShowConsentDialog:function(){l===r&&(l=t,h.RequestConsent((function(t,e){t?(l=r,E(t)):(l=r,e=e.split("_"),g=e[0],P())})))},SetMaxAdContentRating:function(t){if(l===r){var e=["G","PG","T","MA"][t];h.SetMaxAdContentRating(e,(function(t,e){}))}},TagForChildDirectedTreatment:function(t){l===r&&h.TagForChildDirectedTreatment(t?1:0,(function(t,e){}))},TagForUnderAgeOfConsent:function(t){l===r&&h.TagForUnderAgeOfConsent(t?1:0,(function(t,e){}))}},M.prototype={ErrorMessage:function(t){t.set_string(this.errorMessage||"")},RewardType:function(t){t.set_string(this.rewardType||"")},RewardValue:function(t){t.set_float(this.rewardValue||0)},ConsentStatus:function(t){t.set_string(g||"UNKNOWN")}},B.prototype={OnBannerReady:function(){return!0},OnVideoReady:function(){return!0},OnInterstitialReady:function(){return!0},OnBannerFailedToLoad:function(){return!0},OnVideoFailedToLoad:function(){return!0},OnInterstitialFailedToLoad:function(){return!0},OnBannerShown:function(){return!0},OnVideoComplete:function(){return!0},OnInterstitialComplete:function(){return!0},OnBannerHidden:function(){return!0},OnVideoCancelled:function(){return!0},OnInterstitialCancelled:function(){return!0},OnConfigurationFailed:function(){return!0},OnConfigurationComplete:function(){return!0},IsShowingBanner:function(){return u===e},IsShowingVideo:function(){return d===e},IsShowingInterstitial:function(){return p===e},IsInEeaOrUnknown:function(){return f},IsBannerLoaded:function(){return u===i},IsVideoLoaded:function(){return d===i},IsInterstitialLoaded:function(){return p===i},IsConfigured:function(){return l===r},OnUserPersonalizationUpdated:function(){return!0}},N.prototype={onCreate:function(){}},F.prototype={onCreate:function(){var t=this.runtime,e=this,i=cr.plugins_.advert.prototype.cnds,r=(cr.plugins_.advert.prototype.acts,function(t,i,r,n){var s;s=`Event (${t} Error (${i}) Type (${r}) Amount (${n}))`,console.log("[C2 advert]",s),e.errorMessage=i||"",e.rewardType=r||"",e.rewardValue=n||0});if(y=function(){r("banner ready"),t.trigger(i.OnBannerReady,e)},m=function(){r("video ready"),t.trigger(i.OnVideoReady,e)},_=function(){r("interstitial ready"),t.trigger(i.OnInterstitialReady,e)},v=function(n){r("banner load fail",n),t.trigger(i.OnBannerFailedToLoad,e)},b=function(n){r("video load fail",n),t.trigger(i.OnVideoFailedToLoad,e)},w=function(n){r("interstitial load fail",n),t.trigger(i.OnInterstitialFailedToLoad,e)},x=function(){r("banner shown"),t.trigger(i.OnBannerShown,e)},S=function(n,s){r("video reward",null,n,s),t.trigger(i.OnVideoComplete,e)},T=function(){r("interstitial complete"),t.trigger(i.OnInterstitialComplete,e)},C=function(){r("banner hidden"),t.trigger(i.OnBannerHidden,e)},A=function(n){r("video cancelled",n),t.trigger(i.OnVideoCancelled,e)},O=function(n){r("interstitial cancelled",n),t.trigger("interstitial cancelled",i.OnInterstitialCancelled,e)},E=function(n){r("configuration failed",n),t.trigger(i.OnConfigurationFailed,e)},P=function(){r("configuration complete"),t.trigger(i.OnConfigurationComplete,e)},I=function(){r("user personalisation updated"),t.trigger(i.OnUserPersonalizationUpdated,e)},this.runtime.isCordova&&cordova.plugins.ConstructAd&&(this.runtime.isiOS||this.runtime.isAndroid)){h=cordova.plugins.ConstructAd,c=!!this.properties[0];var n=this.properties[1],s=this.properties[2],o=this.properties[3],a=this.properties[4],l=this.properties[5],u=this.properties[6],p=this.properties[7],d=this.runtime.isAndroid?n:s;d&&R(d,o,l,a,u,p)}},onLayoutChange:function(){l===r&&P()},onDestroy:function(){},saveToJSON:function(){return{}},loadFromJSON:function(){},getDebuggerValues:function(){},onDebugValueEdited:function(){}},D.prototype={Type:N,Instance:F,cnds:new B,exps:new M,acts:new L},cr.plugins_.advert=D}(),cr.plugins_.Function=function(t){this.runtime=t},function(){var t=cr.plugins_.Function.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime};var e=t.Instance.prototype,i=[],r=-1;function n(){this.name="",this.retVal=0,this.params=[]}function s(){return++r===i.length&&i.push(new n),i[r]}function o(){return r<0?null:i[r]}function a(){r--}function h(){}function c(){}function l(){}e.onCreate=function(){this.runtime.isPreview;var t=this;window.c2_callFunction=function(e,i){var r,n,o,h=s();if(h.name=e.toLowerCase(),h.retVal=0,i)for(h.params.length=i.length,r=0,n=i.length;r<n;++r)o=i[r],h.params[r]="number"==typeof o||"string"==typeof o?o:"boolean"==typeof o&&o?1:0;else cr.clearArray(h.params);return t.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,t,h.name),a(),h.retVal}},h.prototype.OnFunction=function(t){var e=o();return!!e&&cr.equals_nocase(t,e.name)},h.prototype.CompareParam=function(t,e,i){var r=o();if(!r)return!1;var n=0;return(t=cr.floor(t))>=0&&t<r.params.length&&(n=r.params[t]),cr.do_cmp(n,e,i)},t.cnds=new h,c.prototype.CallFunction=function(t,e){var i=s();i.name=t.toLowerCase(),i.retVal=0,cr.shallowAssignArray(i.params,e);this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,i.name);a()},c.prototype.SetReturnValue=function(t){var e=o();e&&(e.retVal=t)},c.prototype.CallExpression=function(t){},t.acts=new c,l.prototype.ReturnValue=function(t){var e=function(){if(!i.length)return null;var t=r+1;return t>=i.length&&(t=i.length-1),i[t]}();e?t.set_any(e.retVal):t.set_int(0)},l.prototype.ParamCount=function(t){var e=o();e?t.set_int(e.params.length):t.set_int(0)},l.prototype.Param=function(t,e){e=cr.floor(e);var i=o();i&&e>=0&&e<i.params.length?t.set_any(i.params[e]):t.set_int(0)},l.prototype.Call=function(t,e){var i,r,n=s();for(n.name=e.toLowerCase(),n.retVal=0,cr.clearArray(n.params),i=2,r=arguments.length;i<r;i++)n.params.push(arguments[i]);this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,n.name);a(),t.set_any(n.retVal)},t.exps=new l}(),cr.behaviors.Anchor=function(t){this.runtime=t},function(){var t=cr.behaviors.Anchor.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}function r(){}e.onCreate=function(){this.anch_left=this.properties[0],this.anch_top=this.properties[1],this.anch_right=this.properties[2],this.anch_bottom=this.properties[3],this.inst.update_bbox(),this.xleft=this.inst.bbox.left,this.ytop=this.inst.bbox.top,this.xright=this.runtime.original_width-this.inst.bbox.left,this.ybottom=this.runtime.original_height-this.inst.bbox.top,this.rdiff=this.runtime.original_width-this.inst.bbox.right,this.bdiff=this.runtime.original_height-this.inst.bbox.bottom,this.enabled=this.properties[4]},e.saveToJSON=function(){return{xleft:this.xleft,ytop:this.ytop,xright:this.xright,ybottom:this.ybottom,rdiff:this.rdiff,bdiff:this.bdiff,enabled:this.enabled}},e.loadFromJSON=function(t){this.xleft=t.xleft,this.ytop=t.ytop,this.xright=t.xright,this.ybottom=t.ybottom,this.rdiff=t.rdiff,this.bdiff=t.bdiff,this.enabled=t.enabled},e.tick=function(){if(this.enabled){var t,e=this.inst.layer,i=this.inst,r=this.inst.bbox;0===this.anch_left?(i.update_bbox(),0!==(t=e.viewLeft+this.xleft-r.left)&&(i.x+=t,i.set_bbox_changed())):1===this.anch_left&&(i.update_bbox(),0!==(t=e.viewRight-this.xright-r.left)&&(i.x+=t,i.set_bbox_changed())),0===this.anch_top?(i.update_bbox(),0!==(t=e.viewTop+this.ytop-r.top)&&(i.y+=t,i.set_bbox_changed())):1===this.anch_top&&(i.update_bbox(),0!==(t=e.viewBottom-this.ybottom-r.top)&&(i.y+=t,i.set_bbox_changed())),1===this.anch_right&&(i.update_bbox(),0!==(t=e.viewRight-this.rdiff-r.right)&&(i.width+=t,i.width<0&&(i.width=0),i.set_bbox_changed())),1===this.anch_bottom&&(i.update_bbox(),0!==(t=e.viewBottom-this.bdiff-r.bottom)&&(i.height+=t,i.height<0&&(i.height=0),i.set_bbox_changed()))}},i.prototype.IsEnabled=function(){return this.enabled},t.cnds=new i,r.prototype.SetEnabled=function(t){this.enabled&&0===t?this.enabled=!1:this.enabled||0===t||(this.inst.update_bbox(),this.xleft=this.inst.bbox.left,this.ytop=this.inst.bbox.top,this.xright=this.runtime.original_width-this.inst.bbox.left,this.ybottom=this.runtime.original_height-this.inst.bbox.top,this.rdiff=this.runtime.original_width-this.inst.bbox.right,this.bdiff=this.runtime.original_height-this.inst.bbox.bottom,this.enabled=!0)},t.acts=new r,t.exps=new function(){}}(),cr.behaviors.Pin=function(t){this.runtime=t},function(){var t=cr.behaviors.Pin.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}function r(){}function n(){}e.onCreate=function(){this.pinObject=null,this.pinObjectUid=-1,this.pinAngle=0,this.pinDist=0,this.myStartAngle=0,this.theirStartAngle=0,this.lastKnownAngle=0,this.mode=0;var t=this;this.recycled||(this.myDestroyCallback=function(e){t.onInstanceDestroyed(e)}),this.runtime.addDestroyCallback(this.myDestroyCallback)},e.saveToJSON=function(){return{uid:this.pinObject?this.pinObject.uid:-1,pa:this.pinAngle,pd:this.pinDist,msa:this.myStartAngle,tsa:this.theirStartAngle,lka:this.lastKnownAngle,m:this.mode}},e.loadFromJSON=function(t){this.pinObjectUid=t.uid,this.pinAngle=t.pa,this.pinDist=t.pd,this.myStartAngle=t.msa,this.theirStartAngle=t.tsa,this.lastKnownAngle=t.lka,this.mode=t.m},e.afterLoad=function(){-1===this.pinObjectUid?this.pinObject=null:this.pinObject=this.runtime.getObjectByUID(this.pinObjectUid),this.pinObjectUid=-1},e.onInstanceDestroyed=function(t){this.pinObject==t&&(this.pinObject=null)},e.onDestroy=function(){this.pinObject=null,this.runtime.removeDestroyCallback(this.myDestroyCallback)},e.tick=function(){},e.tick2=function(){if(this.pinObject){this.lastKnownAngle!==this.inst.angle&&(this.myStartAngle=cr.clamp_angle(this.myStartAngle+(this.inst.angle-this.lastKnownAngle)));var t=this.inst.x,e=this.inst.y;if(3===this.mode||4===this.mode){var i=cr.distanceTo(this.inst.x,this.inst.y,this.pinObject.x,this.pinObject.y);if(i>this.pinDist||4===this.mode&&i<this.pinDist){var r=cr.angleTo(this.pinObject.x,this.pinObject.y,this.inst.x,this.inst.y);t=this.pinObject.x+Math.cos(r)*this.pinDist,e=this.pinObject.y+Math.sin(r)*this.pinDist}}else t=this.pinObject.x+Math.cos(this.pinObject.angle+this.pinAngle)*this.pinDist,e=this.pinObject.y+Math.sin(this.pinObject.angle+this.pinAngle)*this.pinDist;var n=cr.clamp_angle(this.myStartAngle+(this.pinObject.angle-this.theirStartAngle));this.lastKnownAngle=n,0!==this.mode&&1!==this.mode&&3!==this.mode&&4!==this.mode||this.inst.x===t&&this.inst.y===e||(this.inst.x=t,this.inst.y=e,this.inst.set_bbox_changed()),0!==this.mode&&2!==this.mode||this.inst.angle===n||(this.inst.angle=n,this.inst.set_bbox_changed())}},i.prototype.IsPinned=function(){return!!this.pinObject},t.cnds=new i,r.prototype.Pin=function(t,e){if(t){var i=t.getFirstPicked(this.inst);i&&(this.pinObject=i,this.pinAngle=cr.angleTo(i.x,i.y,this.inst.x,this.inst.y)-i.angle,this.pinDist=cr.distanceTo(i.x,i.y,this.inst.x,this.inst.y),this.myStartAngle=this.inst.angle,this.lastKnownAngle=this.inst.angle,this.theirStartAngle=i.angle,this.mode=e)}},r.prototype.Unpin=function(){this.pinObject=null},t.acts=new r,n.prototype.PinnedUID=function(t){t.set_int(this.pinObject?this.pinObject.uid:-1)},t.exps=new n}();var Box2D=window.Box2DFn(),b2Vec2=Box2D.b2Vec2;function createPolygonShape(t){for(var e=new Box2D.b2PolygonShape,i=Box2D._malloc(8*t.length),r=0,n=0;n<t.length;n++)Box2D.HEAPF32[i+r>>2]=t[n].get_x(),Box2D.HEAPF32[i+(r+4)>>2]=t[n].get_y(),r+=8;var s=Box2D.wrapPointer(i,Box2D.b2Vec2);return e.Set(s,t.length),Box2D._free(i),e}b2Vec2._freeCache=[],b2Vec2.Get=function(t,e){var i;return b2Vec2._freeCache.length?((i=b2Vec2._freeCache.pop()).set_x(t),i.set_y(e),i):new b2Vec2(t,e)},b2Vec2.Free=function(t){b2Vec2._freeCache.push(t)},b2Vec2.Clone=function(t){return b2Vec2.Get(t.get_x(),t.get_y())};var tmpvec2a=b2Vec2.Get(0,0),tmpvec2b=b2Vec2.Get(0,0);function getTempVec2a(t,e){return tmpvec2a.set_x(t),tmpvec2a.set_y(e),tmpvec2a}function getTempVec2b(t,e){return tmpvec2b.set_x(t),tmpvec2b.set_y(e),tmpvec2b}function SplitConvexPolysOver8Points(t){var e,i,r,n=[];for(e=0,i=t.length;e<i;++e)(r=t[e]).length<=8?n.push(r):n.push.apply(n,SplitConvexPoly(r));return n}function SplitConvexPoly(t){var e,i,r=[];r.push(t.splice(0,8));for(var n=r[0][0],s=r[0][7];t.length;)i=(e=t.splice(0,Math.min(t.length,6)))[e.length-1],e.push(b2Vec2.Clone(n)),e.push(b2Vec2.Clone(s)),r.push(e),s=i;return r}cr.b2Separator=function(){},cr.b2Separator.det=function(t,e,i,r,n,s){return t*r+i*s+n*e-e*i-r*n-s*t},cr.b2Separator.hitRay=function(t,e,i,r,n,s,o,a){var h=i-t,c=r-e,l=o-n,u=a-s,p=(l*(s-e)-u*(n-t))/(c*l-h*u),d=t+p*h,f=e+p*c,g=cr.b2Separator.isOnSegment(i,r,t,e,d,f),y=cr.b2Separator.isOnSegment(d,f,n,s,o,a);return g&&y?b2Vec2.Get(d,f):null},cr.b2Separator.isOnSegment=function(t,e,i,r,n,s){return(i+.1>=t&&t>=n-.1||i-.1<=t&&t<=n+.1)&&(r+.1>=e&&e>=s-.1||r-.1<=e&&e<=s+.1)&&cr.b2Separator.isOnLine(t,e,i,r,n,s)},cr.b2Separator.isOnLine=function(t,e,i,r,n,s){if(Math.abs(n-i)>.1){var o=(s-r)/(n-i)*(t-i)+r;return Math.abs(o-e)<.1}return Math.abs(t-i)<.1},cr.b2Separator.pointsMatch=function(t,e,i,r){return Math.abs(i-t)<.1&&Math.abs(r-e)<.1},cr.b2Separator.Separate=function(t,e){var i,r,n,s,o,a,h,c,l,u=cr.b2Separator.calcShapes(t),p=[];for(o=0,a=u.length;o<a;o++){for(r=u[o],(i=[]).length=r.length,l=0,h=0,c=r.length;h<c;h++)n=r[h],s=r[(h+1)%c],l+=n.get_x()*s.get_y()-n.get_y()*s.get_x(),i[h]=b2Vec2.Get(n.get_x(),n.get_y());if((l=Math.abs(l/2))>=.001*e)p.push(i);else for(h=0,c=i.length;h<c;h++)b2Vec2.Free(i[h])}return p=SplitConvexPolysOver8Points(p)},cr.b2Separator.calcShapes=function(t){var e,i,r,n,s,o,a,h=[],c=0,l=0,u=0,p=0,d=0,f=0,g=0,y=0,m=0,_=0,v=0,b=0,w=0,x=0,S=[],T=[],C=!1,A=[],O=[],E=!1;for(O.push(t);O.length;){for(l=(h=O[0]).length,C=!0,c=0;c<l;c++)if(m=c<l-1?c+1:c+1-l,_=c<l-2?c+2:c+2-l,e=h[y=c],i=h[m],r=h[_],cr.b2Separator.det(e.get_x(),e.get_y(),i.get_x(),i.get_y(),r.get_x(),r.get_y())<0){for(C=!1,g=1e9,u=0;u<l;u++)u!==y&&u!==m&&(b=u<l-1?u+1:0,n=h[v=u],s=h[b],(o=cr.b2Separator.hitRay(e.get_x(),e.get_y(),i.get_x(),i.get_y(),n.get_x(),n.get_y(),s.get_x(),s.get_y()))&&((p=(d=i.get_x()-o.get_x())*d+(f=i.get_y()-o.get_y())*f)<g?(x=v,w=b,a=o,g=p):b2Vec2.Free(o)));if(1e9===g)return[];for(S=[],T=[],b=w,n=h[v=x],s=h[b],E=!1,cr.b2Separator.pointsMatch(a.get_x(),a.get_y(),s.get_x(),s.get_y())||(S.push(a),E=!0),cr.b2Separator.pointsMatch(a.get_x(),a.get_y(),n.get_x(),n.get_y())||(T.push(a),E=!0),E||b2Vec2.Free(a),x=-1,w=y;;){if(w===b){if(x<0||x>=l)return[];cr.b2Separator.isOnSegment(s.get_x(),s.get_y(),h[x].get_x(),h[x].get_y(),e.get_x(),e.get_y())||S.push(h[w]);break}S.push(h[w]),x=w,w-1<0?w=l-1:w--}for(S.reverse(),x=-1,w=m;;){if(w===v){if(x<0||x>=l)return[];w!==v||cr.b2Separator.isOnSegment(n.get_x(),n.get_y(),h[x].get_x(),h[x].get_y(),i.get_x(),i.get_y())||T.push(h[w]);break}T.push(h[w]),x=w,w+1>l-1?w=0:w++}O.push(S,T),O.shift();break}C&&A.push(O.shift())}return A},cr.behaviors.Physics=function(t){this.runtime=t,this.world=new Box2D.b2World(getTempVec2a(0,10),!0),this.worldG=10,this.lastUpdateTick=-1;var e=new Box2D.JSContactListener;e.BeginContact=function(e){var i=Box2D.wrapPointer(e,Box2D.b2Contact),r=i.GetFixtureA().GetBody().c2userdata,n=i.GetFixtureB().GetBody().c2userdata;t.registerCollision(r.inst,n.inst)},e.EndContact=function(){},e.PreSolve=function(){},e.PostSolve=function(){},this.world.SetContactListener(e);var i=new Box2D.JSContactFilter,r=this;i.ShouldCollide=function(t,e){if(r.allCollisionsEnabled)return!0;var i=Box2D.wrapPointer(t,Box2D.b2Fixture),n=Box2D.wrapPointer(e,Box2D.b2Fixture),s=i.GetBody().c2userdata.inst.type,o=n.GetBody().c2userdata.inst.type,a=s.extra.Physics_DisabledCollisions;return(!a||!a.contains(o))&&(!(a=o.extra.Physics_DisabledCollisions)||!a.contains(s))},this.world.SetContactFilter(i),this.steppingMode=0,this.velocityIterations=8,this.positionIterations=3,this.allCollisionsEnabled=!0},function(){var t=Box2D.b2BodyDef,e=(Box2D.b2Body,Box2D.b2FixtureDef),i=(Box2D.b2Fixture,Box2D.b2World,Box2D.b2PolygonShape),r=Box2D.b2CircleShape,n=Box2D.b2DistanceJointDef,s=Box2D.b2RevoluteJointDef,o=-2147483648,a=1073741824,h=536870912,c=.02,l=cr.behaviors.Physics.prototype;l.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},l.Type.prototype.onCreate=function(){},l.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime,this.world=this.behavior.world};var u=l.Instance.prototype;u.onCreate=function(){this.immovable=this.properties[0],this.collisionmask=this.properties[1],this.preventRotation=this.properties[2],this.density=this.properties[3],this.friction=this.properties[4],this.restitution=this.properties[5],this.linearDamping=this.properties[6],this.angularDamping=this.properties[7],this.bullet=this.properties[8],this.enabled=this.properties[9],this.body=null,this.fixtures=[],this.inst.update_bbox(),this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y,this.lastKnownAngle=this.inst.angle,this.lastWidth=0,this.lastHeight=0,this.lastTickOverride=!1,this.recreateBody=!1,this.lastAnimation=null,this.lastAnimationFrame=-1,this.myJoints?(cr.clearArray(this.myJoints),cr.clearArray(this.myCreatedJoints),this.joiningMe.clear()):(this.myJoints=[],this.myCreatedJoints=[],this.joiningMe=new cr.ObjectSet);var t=this;this.recycled||(this.myDestroyCallback=function(e){t.onInstanceDestroyed(e)}),this.runtime.addDestroyCallback(this.myDestroyCallback)},u.postCreate=function(){this.inst.update_bbox(),this.createBody(),this.lastAnimation=this.inst.cur_animation,this.lastAnimationFrame=this.inst.cur_frame},u.onDestroy=function(){this.destroyBody(),cr.clearArray(this.myCreatedJoints),this.joiningMe.clear(),this.runtime.removeDestroyCallback(this.myDestroyCallback)},u.saveToJSON=function(){var t={e:this.enabled,im:this.immovable,pr:this.preventRotation,d:this.density,fr:this.friction,re:this.restitution,ld:this.linearDamping,ad:this.angularDamping,b:this.bullet,mcj:this.myCreatedJoints};if(this.enabled){var e=this.body.GetLinearVelocity();t.vx=e.get_x(),t.vy=e.get_y(),t.om=this.body.GetAngularVelocity()}return t},u.loadFromJSON=function(t){this.destroyBody(),cr.clearArray(this.myCreatedJoints),this.joiningMe.clear(),this.enabled=t.e,this.immovable=t.im,this.preventRotation=t.pr,this.density=t.d,this.friction=t.fr,this.restitution=t.re,this.linearDamping=t.ld,this.angularDamping=t.ad,this.bullet=t.b,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y,this.lastKnownAngle=this.inst.angle,this.lastWidth=this.inst.width,this.lastHeight=this.inst.height,this.enabled&&(this.createBody(),this.body.SetLinearVelocity(getTempVec2a(t.vx,t.vy)),this.body.SetAngularVelocity(t.om),0===t.vx&&0===t.vy&&0===t.om||this.body.SetAwake(!0),this.myCreatedJoints=t.mcj)},u.afterLoad=function(){this.enabled&&this.recreateMyJoints()},u.onInstanceDestroyed=function(t){var e,i,r,n=t.uid;for(e=0,r=0,i=this.myCreatedJoints.length;e<i;e++)this.myCreatedJoints[r]=this.myCreatedJoints[e],r<this.myJoints.length&&(this.myJoints[r]=this.myJoints[e]),this.myCreatedJoints[e].params[1]==n?e<this.myJoints.length&&this.world.DestroyJoint(this.myJoints[e]):r++;this.myCreatedJoints.length=r,r<this.myJoints.length&&(this.myJoints.length=r),this.joiningMe.remove(t)},u.destroyMyJoints=function(){var t,e;for(t=0,e=this.myJoints.length;t<e;t++)this.world.DestroyJoint(this.myJoints[t]);cr.clearArray(this.myJoints)},u.recreateMyJoints=function(){var t,e,i;for(t=0,e=this.myCreatedJoints.length;t<e;t++)switch((i=this.myCreatedJoints[t]).type){case 0:this.doCreateDistanceJoint(i.params[0],i.params[1],i.params[2],i.params[3],i.params[4]);break;case 1:this.doCreateRevoluteJoint(i.params[0],i.params[1]);break;case 2:this.doCreateLimitedRevoluteJoint(i.params[0],i.params[1],i.params[2],i.params[3])}},u.createFixture=function(t){if(this.body){var e=this.body.CreateFixture(t);return this.fixtures.push(e),e}},u.destroyFixtures=function(){if(this.body){var t,e;for(t=0,e=this.fixtures.length;t<e;++t)this.body.DestroyFixture(this.fixtures[t]);cr.clearArray(this.fixtures)}},u.destroyBody=function(){this.body&&(this.destroyMyJoints(),this.destroyFixtures(),this.world.DestroyBody(this.body),this.body=null,this.inst.extra.box2dbody=null)};var p=[];function d(){}function f(){}function g(t,e,i){var r;i?((r=t.extra.Physics_DisabledCollisions)&&r.remove(e),(r=e.extra.Physics_DisabledCollisions)&&r.remove(t)):(t.extra.Physics_DisabledCollisions||(t.extra.Physics_DisabledCollisions=new cr.ObjectSet),t.extra.Physics_DisabledCollisions.add(e),e.extra.Physics_DisabledCollisions||(e.extra.Physics_DisabledCollisions=new cr.ObjectSet),e.extra.Physics_DisabledCollisions.add(t))}function y(){}u.createBody=function(){if(this.enabled){var n,s,l,u,d,f,g,y,m,_,v,b,w,x,S,T,C,A=this.inst;if(A.update_bbox(),!this.body){var O=new t;O.set_type(this.immovable?0:2),O.set_position(getTempVec2b(A.bquad.midX()*c,A.bquad.midY()*c)),O.set_angle(A.angle),O.set_fixedRotation(this.preventRotation),O.set_linearDamping(this.linearDamping),O.set_angularDamping(this.angularDamping),O.set_bullet(this.bullet),this.body=this.world.CreateBody(O),this.body.c2userdata=this,A.extra.box2dbody=this.body,Box2D.destroy(O)}this.destroyFixtures();var E=new e;E.set_density(this.density),E.set_friction(this.friction),E.set_restitution(this.restitution);var P=this.inst.collision_poly&&!this.inst.collision_poly.is_empty(),I=this.collisionmask;P||this.inst.tilemap_exists||0!==this.collisionmask||(I=1);var k,R=Math.max(Math.abs(A.width),1),L=Math.max(Math.abs(A.height),1),B=A.width<0,M=A.height<0;if(0===I)if(A.tilemap_exists)for(S=A.bquad.midX()-A.x,T=A.bquad.midY()-A.y,A.getAllCollisionRects(p),y=[],n=0,s=p.length;n<s;++n){if(_=(m=p[n]).rc,m.poly){if(!m.poly.convexpolys){for(v=m.poly.pts_cache,b=m.poly.pts_count,l=0;l<b;++l)y.push(b2Vec2.Get(v[2*l],v[2*l+1]));var N=3758096384&m.id;for((N===o||N===a||N===h||N&o&&N&a&&N&h)&&y.reverse(),m.poly.convexpolys=cr.b2Separator.Separate(y,(_.right-_.left)*(_.bottom-_.top)),l=0,u=y.length;l<u;++l)b2Vec2.Free(y[l]);cr.clearArray(y)}for(l=0,u=m.poly.convexpolys.length;l<u;++l){for(d=0,f=(x=m.poly.convexpolys[l]).length;d<f;++d)y.push(b2Vec2.Get((_.left+x[d].get_x()-S)*c,(_.top+x[d].get_y()-T)*c));for(k=createPolygonShape(y),E.set_shape(k),this.createFixture(E),Box2D.destroy(k),d=0,f=y.length;d<f;++d)b2Vec2.Free(y[d]);cr.clearArray(y)}}else y.push(b2Vec2.Get((_.left-S)*c,(_.top-T)*c)),y.push(b2Vec2.Get((_.right-S)*c,(_.top-T)*c)),y.push(b2Vec2.Get((_.right-S)*c,(_.bottom-T)*c)),y.push(b2Vec2.Get((_.left-S)*c,(_.bottom-T)*c)),k=createPolygonShape(y),E.set_shape(k),this.createFixture(E),Box2D.destroy(k);for(l=0,u=y.length;l<u;++l)b2Vec2.Free(y[l]);cr.clearArray(y)}else{for(C=A.angle,A.angle=0,A.set_bbox_changed(),A.update_bbox(),S=A.bquad.midX()-A.x,T=A.bquad.midY()-A.y,A.angle=C,A.set_bbox_changed(),A.collision_poly.cache_poly(B?-R:R,M?-L:L,0),v=A.collision_poly.pts_cache,b=A.collision_poly.pts_count,(y=[]).length=b,n=0;n<b;n++)y[n]=b2Vec2.Get(v[2*n]-S,v[2*n+1]-T);for(B!==M&&y.reverse(),w=cr.b2Separator.Separate(y,R*L),n=0;n<b;n++)b2Vec2.Free(y[n]);if(w.length)for(n=0,s=w.length;n<s;n++){for(l=0,u=(y=w[n]).length;l<u;l++)(g=y[l]).set_x(g.get_x()*c),g.set_y(g.get_y()*c);for(k=createPolygonShape(y),E.set_shape(k),this.createFixture(E),Box2D.destroy(k),l=0,u=y.length;l<u;l++)b2Vec2.Free(y[l])}else(k=new i).SetAsBox(R*c*.5,L*c*.5),E.set_shape(k),this.createFixture(E),Box2D.destroy(k)}else 1===I?((k=new i).SetAsBox(R*c*.5,L*c*.5),E.set_shape(k),this.createFixture(E),Box2D.destroy(k)):((k=new r).set_m_radius(Math.min(R,L)*c*.5),E.set_shape(k),this.createFixture(E),Box2D.destroy(k));this.lastWidth=A.width,this.lastHeight=A.height,Box2D.destroy(E),cr.clearArray(p)}},u.tick=function(){if(this.enabled){var t,e=this.inst;0===this.behavior.steppingMode?t=this.runtime.timescale/60:(t=this.runtime.getDt(this.inst))>1/30&&(t=1/30),this.runtime.tickcount_nosave>this.behavior.lastUpdateTick&&this.runtime.timescale>0&&(0!==t&&this.world.Step(t,this.behavior.velocityIterations,this.behavior.positionIterations),this.world.ClearForces(),this.behavior.lastUpdateTick=this.runtime.tickcount_nosave),(this.recreateBody||e.width!==this.lastWidth||e.height!==this.lastHeight||e.cur_animation!==this.lastAnimation||e.cur_frame!==this.lastAnimationFrame||e.tilemap_exists&&e.physics_changed)&&(this.createBody(),this.recreateBody=!1,this.lastAnimation=e.cur_animation,this.lastAnimationFrame=e.cur_frame,e.tilemap_exists&&e.physics_changed&&(e.physics_changed=!1));var i=e.x!==this.lastKnownX||e.y!==this.lastKnownY,r=e.angle!==this.lastKnownAngle;if(i){e.update_bbox();var n=e.bquad.midX(),s=e.bquad.midY(),o=n-this.lastKnownX,a=s-this.lastKnownY;r?this.body.SetTransform(getTempVec2a(n*c,s*c),e.angle):this.body.SetTransform(getTempVec2a(n*c,s*c),this.body.GetAngle()),this.body.SetLinearVelocity(getTempVec2a(o,a)),this.lastTickOverride=!0,this.body.SetAwake(!0)}else this.lastTickOverride&&(this.lastTickOverride=!1,this.body.SetLinearVelocity(getTempVec2a(0,0)),this.body.SetTransform(getTempVec2a(e.bquad.midX()*c,e.bquad.midY()*c),this.body.GetAngle()));!i&&r&&(this.body.SetTransform(this.body.GetPosition(),e.angle),this.body.SetAwake(!0));var h=this.body.GetPosition(),l=h.get_x()/c,u=h.get_y()/c,p=this.body.GetAngle();if(l!==e.x||u!==e.y||p!==e.angle){e.x=l,e.y=u,e.angle=p,e.set_bbox_changed(),e.update_bbox();var d=e.bquad.midX()-e.x,f=e.bquad.midY()-e.y;0===d&&0===f||(e.x-=d,e.y-=f,e.set_bbox_changed())}this.lastKnownX=e.x,this.lastKnownY=e.y,this.lastKnownAngle=e.angle}},u.getInstImgPointX=function(t){return-1!==t&&this.inst.getImagePoint?0===t&&this.body?(this.body.GetPosition().get_x()+this.body.GetLocalCenter().get_x())/c:this.inst.getImagePoint(t,!0):this.inst.x},u.getInstImgPointY=function(t){return-1!==t&&this.inst.getImagePoint?0===t&&this.body?(this.body.GetPosition().get_y()+this.body.GetLocalCenter().get_y())/c:this.inst.getImagePoint(t,!1):this.inst.y},d.prototype.IsSleeping=function(){return!!this.enabled&&!this.body.IsAwake()},d.prototype.CompareVelocity=function(t,e,i){if(!this.enabled)return!1;var r,n,s,o=this.body.GetLinearVelocity();return 0===t?r=o.get_x()/c:1===t?r=o.get_y()/c:(n=o.get_x()/c,s=o.get_y()/c,r=cr.distanceTo(0,0,n,s)),cr.do_cmp(r,e,i)},d.prototype.CompareAngularVelocity=function(t,e){if(!this.enabled)return!1;var i=cr.to_degrees(this.body.GetAngularVelocity());return cr.do_cmp(i,t,e)},d.prototype.CompareMass=function(t,e){if(!this.enabled)return!1;var i=this.body.GetMass()/c;return cr.do_cmp(i,t,e)},d.prototype.IsEnabled=function(){return this.enabled},l.cnds=new d,f.prototype.ApplyForce=function(t,e,i){if(this.enabled){var r=this.getInstImgPointX(i),n=this.getInstImgPointY(i);this.body.ApplyForce(getTempVec2a(t,e),getTempVec2b(r*c,n*c),!0)}},f.prototype.ApplyForceToward=function(t,e,i,r){if(this.enabled){var n=this.getInstImgPointX(r),s=this.getInstImgPointY(r),o=cr.angleTo(n,s,e,i);this.body.ApplyForce(getTempVec2a(Math.cos(o)*t,Math.sin(o)*t),getTempVec2b(n*c,s*c),!0)}},f.prototype.ApplyForceAtAngle=function(t,e,i){if(this.enabled){e=cr.to_radians(e);var r=this.getInstImgPointX(i),n=this.getInstImgPointY(i);this.body.ApplyForce(getTempVec2a(Math.cos(e)*t,Math.sin(e)*t),getTempVec2b(r*c,n*c),!0)}},f.prototype.ApplyImpulse=function(t,e,i){if(this.enabled){var r=this.getInstImgPointX(i),n=this.getInstImgPointY(i);this.body.ApplyLinearImpulse(getTempVec2a(t,e),getTempVec2b(r*c,n*c),!0),this.lastTickOverride=!1,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y}},f.prototype.ApplyImpulseToward=function(t,e,i,r){if(this.enabled){var n=this.getInstImgPointX(r),s=this.getInstImgPointY(r),o=cr.angleTo(n,s,e,i);this.body.ApplyLinearImpulse(getTempVec2a(Math.cos(o)*t,Math.sin(o)*t),getTempVec2b(n*c,s*c),!0),this.lastTickOverride=!1,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y}},f.prototype.ApplyImpulseAtAngle=function(t,e,i){if(this.enabled){e=cr.to_radians(e);var r=this.getInstImgPointX(i),n=this.getInstImgPointY(i);this.body.ApplyLinearImpulse(getTempVec2a(Math.cos(e)*t,Math.sin(e)*t),getTempVec2b(r*c,n*c),!0),this.lastTickOverride=!1,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y}},f.prototype.ApplyTorque=function(t){this.enabled&&this.body.ApplyTorque(cr.to_radians(t),!0)},f.prototype.ApplyTorqueToAngle=function(t,e){this.enabled&&(t=cr.to_radians(t),e=cr.to_radians(e),cr.angleClockwise(this.inst.angle,e)?this.body.ApplyTorque(-t,!0):this.body.ApplyTorque(t,!0))},f.prototype.ApplyTorqueToPosition=function(t,e,i){if(this.enabled){t=cr.to_radians(t);var r=cr.angleTo(this.inst.x,this.inst.y,e,i);cr.angleClockwise(this.inst.angle,r)?this.body.ApplyTorque(-t,!0):this.body.ApplyTorque(t,!0)}},f.prototype.SetAngularVelocity=function(t){this.enabled&&(this.body.SetAngularVelocity(cr.to_radians(t)),this.body.SetAwake(!0))},f.prototype.CreateDistanceJoint=function(t,e,i,r,n){if(e&&this.enabled){var s=e.getFirstPicked(this.inst);s&&s!=this.inst&&s.extra.box2dbody&&(this.myCreatedJoints.push({type:0,params:[t,s.uid,i,r,n]}),this.doCreateDistanceJoint(t,s.uid,i,r,n))}},u.doCreateDistanceJoint=function(t,e,i,r,s){if(this.enabled){var o=this.runtime.getObjectByUID(e);if(o&&o!=this.inst&&o.extra.box2dbody){o.extra.box2dbody.c2userdata.joiningMe.add(this.inst);var a,h,l=this.getInstImgPointX(t),u=this.getInstImgPointY(t);o.getImagePoint?(a=o.getImagePoint(i,!0),h=o.getImagePoint(i,!1)):(a=o.x,h=o.y);var p=l-a,d=u-h,f=new n;f.Initialize(this.body,o.extra.box2dbody,getTempVec2a(l*c,u*c),getTempVec2b(a*c,h*c)),f.set_length(Math.sqrt(p*p+d*d)*c),f.set_dampingRatio(r),f.set_frequencyHz(s),this.myJoints.push(this.world.CreateJoint(f)),Box2D.destroy(f)}}},f.prototype.CreateRevoluteJoint=function(t,e){if(e&&this.enabled){var i=e.getFirstPicked(this.inst);i&&i!=this.inst&&i.extra.box2dbody&&(this.myCreatedJoints.push({type:1,params:[t,i.uid]}),this.doCreateRevoluteJoint(t,i.uid))}},u.doCreateRevoluteJoint=function(t,e){if(this.enabled){var i=this.runtime.getObjectByUID(e);if(i&&i!=this.inst&&i.extra.box2dbody){i.extra.box2dbody.c2userdata.joiningMe.add(this.inst);var r=this.getInstImgPointX(t),n=this.getInstImgPointY(t),o=new s;o.Initialize(this.body,i.extra.box2dbody,getTempVec2a(r*c,n*c)),this.myJoints.push(this.world.CreateJoint(o)),Box2D.destroy(o)}}},f.prototype.CreateLimitedRevoluteJoint=function(t,e,i,r){if(e&&this.enabled){var n=e.getFirstPicked(this.inst);n&&n!=this.inst&&n.extra.box2dbody&&(this.myCreatedJoints.push({type:2,params:[t,n.uid,i,r]}),this.doCreateLimitedRevoluteJoint(t,n.uid,i,r))}},u.doCreateLimitedRevoluteJoint=function(t,e,i,r){if(this.enabled){var n=this.runtime.getObjectByUID(e);if(n&&n!=this.inst&&n.extra.box2dbody){n.extra.box2dbody.c2userdata.joiningMe.add(this.inst);var o=this.getInstImgPointX(t),a=this.getInstImgPointY(t),h=new s;h.Initialize(this.body,n.extra.box2dbody,getTempVec2a(o*c,a*c)),h.set_enableLimit(!0),h.set_lowerAngle(cr.to_radians(i)),h.set_upperAngle(cr.to_radians(r)),this.myJoints.push(this.world.CreateJoint(h)),Box2D.destroy(h)}}},f.prototype.SetWorldGravity=function(t){if(t!==this.behavior.worldG){this.world.SetGravity(getTempVec2a(0,t)),this.behavior.worldG=t;var e,i,r=this.behavior.my_instances.valuesRef();for(e=0,i=r.length;e<i;e++)r[e].extra.box2dbody&&r[e].extra.box2dbody.SetAwake(!0)}},f.prototype.SetSteppingMode=function(t){this.behavior.steppingMode=t},f.prototype.SetIterations=function(t,e){t<1&&(t=1),e<1&&(e=1),this.behavior.velocityIterations=t,this.behavior.positionIterations=e},f.prototype.SetVelocity=function(t,e){this.enabled&&(this.body.SetLinearVelocity(getTempVec2a(t*c,e*c)),this.body.SetAwake(!0),this.lastTickOverride=!1,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y)},f.prototype.SetDensity=function(t){if(this.enabled&&this.density!==t){var e,i;for(this.density=t,e=0,i=this.fixtures.length;e<i;++e)this.fixtures[e].SetDensity(t);this.body.ResetMassData()}},f.prototype.SetFriction=function(t){if(this.enabled&&this.friction!==t){var e,i,r;for(this.friction=t,e=0,i=this.fixtures.length;e<i;++e)this.fixtures[e].SetFriction(t);for(r=this.body.GetContactList();Box2D.getPointer(r);r=r.get_next()){var n;(n=r.get_contact())&&n.ResetFriction()}}},f.prototype.SetElasticity=function(t){var e,i;if(this.enabled&&this.restitution!==t)for(this.restitution=t,e=0,i=this.fixtures.length;e<i;++e)this.fixtures[e].SetRestitution(t)},f.prototype.SetLinearDamping=function(t){this.enabled&&this.linearDamping!==t&&(this.linearDamping=t,this.body.SetLinearDamping(t))},f.prototype.SetAngularDamping=function(t){this.enabled&&this.angularDamping!==t&&(this.angularDamping=t,this.body.SetAngularDamping(t))},f.prototype.SetImmovable=function(t){this.enabled&&this.immovable!==(0!==t)&&(this.immovable=0!==t,this.body.SetType(this.immovable?0:2),this.body.SetAwake(!0))},f.prototype.EnableCollisions=function(t,e){if(t&&this.enabled){var i,r;if(t.is_family)for(i=0,r=t.members.length;i<r;i++)g(this.inst.type,t.members[i],0!==e);else g(this.inst.type,t,0!==e);this.behavior.allCollisionsEnabled=!1}},f.prototype.SetPreventRotate=function(t){this.enabled&&this.preventRotation!==(0!==t)&&(this.preventRotation=0!==t,this.body.SetFixedRotation(this.preventRotation),this.body.SetAngularVelocity(0),this.body.SetAwake(!0))},f.prototype.SetBullet=function(t){this.enabled&&this.bullet!==(0!==t)&&(this.bullet=0!==t,this.body.SetBullet(this.bullet),this.body.SetAwake(!0))},f.prototype.RemoveJoints=function(){this.enabled&&(this.destroyMyJoints(),cr.clearArray(this.myCreatedJoints),this.joiningMe.clear())},f.prototype.SetEnabled=function(t){this.enabled&&0===t?(this.destroyBody(),this.enabled=!1):this.enabled||1!==t||(this.enabled=!0,this.createBody())},l.acts=new f,y.prototype.VelocityX=function(t){t.set_float(this.enabled?this.body.GetLinearVelocity().get_x()/c:0)},y.prototype.VelocityY=function(t){t.set_float(this.enabled?this.body.GetLinearVelocity().get_y()/c:0)},y.prototype.AngularVelocity=function(t){t.set_float(this.enabled?cr.to_degrees(this.body.GetAngularVelocity()):0)},y.prototype.Mass=function(t){t.set_float(this.enabled?this.body.GetMass()/c:0)},y.prototype.CenterOfMassX=function(t){t.set_float(this.enabled?(this.body.GetPosition().get_x()+this.body.GetLocalCenter().get_x())/c:0)},y.prototype.CenterOfMassY=function(t){t.set_float(this.enabled?(this.body.GetPosition().get_y()+this.body.GetLocalCenter().get_y())/c:0)},y.prototype.Density=function(t){t.set_float(this.enabled?this.density:0)},y.prototype.Friction=function(t){t.set_float(this.enabled?this.friction:0)},y.prototype.Elasticity=function(t){t.set_float(this.enabled?this.restitution:0)},y.prototype.LinearDamping=function(t){t.set_float(this.enabled?this.linearDamping:0)},y.prototype.AngularDamping=function(t){t.set_float(this.enabled?this.angularDamping:0)},l.exps=new y}(),cr.behaviors.custom=function(t){this.runtime=t},function(){var t=cr.behaviors.custom.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime,this.dx=0,this.dy=0,this.cancelStep=0};var e=t.Instance.prototype;function i(){}function r(){}function n(){}e.onCreate=function(){this.stepMode=this.properties[0],this.pxPerStep=this.properties[1],this.enabled=this.properties[2]},e.saveToJSON=function(){return{dx:this.dx,dy:this.dy,cancelStep:this.cancelStep,enabled:this.enabled,stepMode:this.stepMode,pxPerStep:this.pxPerStep}},e.loadFromJSON=function(t){this.dx=t.dx,this.dy=t.dy,this.cancelStep=t.cancelStep,this.enabled=t.enabled,this.stepMode=t.stepMode,this.pxPerStep=t.pxPerStep},e.getSpeed=function(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)},e.getAngle=function(){return Math.atan2(this.dy,this.dx)},e.step=function(t,e,i){if(0!==t||0!==e){var r,n,s=this.inst.x,o=this.inst.y,a=Math.round(Math.sqrt(t*t+e*e)/this.pxPerStep);for(0===a&&(a=1),n=1;n<=a;n++){if(r=n/a,this.inst.x=s+t*r,this.inst.y=o+e*r,this.inst.set_bbox_changed(),this.runtime.trigger(i,this.inst),1===this.cancelStep)return r=--n/a,this.inst.x=s+t*r,this.inst.y=o+e*r,void this.inst.set_bbox_changed();if(2===this.cancelStep)return}}},e.tick=function(){var t=this.runtime.getDt(this.inst),e=this.dx*t,i=this.dy*t;0===this.dx&&0===this.dy||!this.enabled||(this.cancelStep=0,0===this.stepMode?(this.inst.x+=e,this.inst.y+=i):1===this.stepMode?this.step(e,i,cr.behaviors.custom.prototype.cnds.OnCMStep):2===this.stepMode?(this.step(e,0,cr.behaviors.custom.prototype.cnds.OnCMHorizStep),this.cancelStep=0,this.step(0,i,cr.behaviors.custom.prototype.cnds.OnCMVertStep)):3===this.stepMode&&(this.step(0,i,cr.behaviors.custom.prototype.cnds.OnCMVertStep),this.cancelStep=0,this.step(e,0,cr.behaviors.custom.prototype.cnds.OnCMHorizStep)),this.inst.set_bbox_changed())},i.prototype.IsMoving=function(){return 0!=this.dx||0!=this.dy},i.prototype.CompareSpeed=function(t,e,i){var r;switch(t){case 0:r=this.getSpeed();break;case 1:r=this.dx;break;case 2:r=this.dy}return cr.do_cmp(r,e,i)},i.prototype.OnCMStep=function(){return!0},i.prototype.OnCMHorizStep=function(){return!0},i.prototype.OnCMVertStep=function(){return!0},i.prototype.IsEnabled=function(){return this.enabled},t.cnds=new i,r.prototype.Stop=function(){this.dx=0,this.dy=0},r.prototype.Reverse=function(t){switch(t){case 0:this.dx*=-1,this.dy*=-1;break;case 1:this.dx*=-1;break;case 2:this.dy*=-1}},r.prototype.SetSpeed=function(t,e){var i;switch(t){case 0:i=this.getAngle(),this.dx=Math.cos(i)*e,this.dy=Math.sin(i)*e;break;case 1:this.dx=e;break;case 2:this.dy=e}},r.prototype.Accelerate=function(t,e){var i,r=e*this.runtime.getDt(this.inst);switch(t){case 0:i=this.getAngle(),this.dx+=Math.cos(i)*r,this.dy+=Math.sin(i)*r;break;case 1:this.dx+=r;break;case 2:this.dy+=r}},r.prototype.AccelerateAngle=function(t,e){var i=t*this.runtime.getDt(this.inst),r=cr.to_radians(e);this.dx+=Math.cos(r)*i,this.dy+=Math.sin(r)*i},r.prototype.AcceleratePos=function(t,e,i){var r=t*this.runtime.getDt(this.inst),n=Math.atan2(i-this.inst.y,e-this.inst.x);this.dx+=Math.cos(n)*r,this.dy+=Math.sin(n)*r},r.prototype.SetAngleOfMotion=function(t){var e=cr.to_radians(t),i=this.getSpeed();this.dx=Math.cos(e)*i,this.dy=Math.sin(e)*i},r.prototype.RotateAngleOfMotionClockwise=function(t){var e=this.getAngle()+cr.to_radians(t),i=this.getSpeed();this.dx=Math.cos(e)*i,this.dy=Math.sin(e)*i},r.prototype.RotateAngleOfMotionCounterClockwise=function(t){var e=this.getAngle()-cr.to_radians(t),i=this.getSpeed();this.dx=Math.cos(e)*i,this.dy=Math.sin(e)*i},r.prototype.StopStepping=function(t){this.cancelStep=t+1},r.prototype.PushOutSolid=function(t){var e,i,r;switch(t){case 0:e=this.getAngle(),i=Math.cos(e),r=Math.sin(e),this.runtime.pushOutSolid(this.inst,-i,-r,Math.max(3*this.getSpeed(),100));break;case 1:this.runtime.pushOutSolidNearest(this.inst);break;case 2:this.runtime.pushOutSolid(this.inst,0,-1,Math.max(3*Math.abs(this.dy),100));break;case 3:this.runtime.pushOutSolid(this.inst,0,1,Math.max(3*Math.abs(this.dy),100));break;case 4:this.runtime.pushOutSolid(this.inst,-1,0,Math.max(3*Math.abs(this.dx),100));break;case 5:this.runtime.pushOutSolid(this.inst,1,0,Math.max(3*Math.abs(this.dx),100))}},r.prototype.PushOutSolidAngle=function(t){t=cr.to_radians(t);var e=Math.cos(t),i=Math.sin(t);this.runtime.pushOutSolid(this.inst,e,i,Math.max(3*this.getSpeed(),100))},r.prototype.SetEnabled=function(t){this.enabled=1===t},t.acts=new r,n.prototype.Speed=function(t){t.set_float(this.getSpeed())},n.prototype.MovingAngle=function(t){t.set_float(cr.to_degrees(this.getAngle()))},n.prototype.dx=function(t){t.set_float(this.dx)},n.prototype.dy=function(t){t.set_float(this.dy)},t.exps=new n}(),cr.behaviors.DragnDrop=function(t){this.runtime=t;var e=this;document.addEventListener("mousemove",(function(t){e.onMouseMove(t)})),document.addEventListener("mousedown",(function(t){e.onMouseDown(t)})),document.addEventListener("mouseup",(function(t){e.onMouseUp(t)}));var i=this.runtime.fullscreen_mode>0?document:this.runtime.canvas;"undefined"!=typeof PointerEvent?(i.addEventListener("pointerdown",(function(t){e.onPointerStart(t)}),!1),i.addEventListener("pointermove",(function(t){e.onPointerMove(t)}),!1),i.addEventListener("pointerup",(function(t){e.onPointerEnd(t)}),!1),i.addEventListener("pointercancel",(function(t){e.onPointerEnd(t)}),!1)):window.navigator.msPointerEnabled?(i.addEventListener("MSPointerDown",(function(t){e.onPointerStart(t)}),!1),i.addEventListener("MSPointerMove",(function(t){e.onPointerMove(t)}),!1),i.addEventListener("MSPointerUp",(function(t){e.onPointerEnd(t)}),!1),i.addEventListener("MSPointerCancel",(function(t){e.onPointerEnd(t)}),!1)):(i.addEventListener("touchstart",(function(t){e.onTouchStart(t)}),!1),i.addEventListener("touchmove",(function(t){e.onTouchMove(t)}),!1),i.addEventListener("touchend",(function(t){e.onTouchEnd(t)}),!1),i.addEventListener("touchcancel",(function(t){e.onTouchEnd(t)}),!1))},function(){var t=cr.behaviors.DragnDrop.prototype;function e(e){var i,r;for(i=0,r=e.behavior_insts.length;i<r;i++)if(e.behavior_insts[i]instanceof t.Instance)return e.behavior_insts[i];return null}t.onMouseDown=function(t){1===t.which&&this.onInputDown("leftmouse",t.pageX,t.pageY)},t.onMouseMove=function(t){1===t.which&&this.onInputMove("leftmouse",t.pageX,t.pageY)},t.onMouseUp=function(t){1===t.which&&this.onInputUp("leftmouse")},t.onTouchStart=function(t){var e,i,r,n;for(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),e=0,i=t.changedTouches.length;e<i;e++)n=(r=t.changedTouches[e]).identifier,this.onInputDown(n?n.toString():"<none>",r.pageX,r.pageY)},t.onTouchMove=function(t){var e,i,r,n;for(t.preventDefault&&t.preventDefault(),e=0,i=t.changedTouches.length;e<i;e++)n=(r=t.changedTouches[e]).identifier,this.onInputMove(n?n.toString():"<none>",r.pageX,r.pageY)},t.onTouchEnd=function(t){var e,i,r;for(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),e=0,i=t.changedTouches.length;e<i;e++)r=t.changedTouches[e].identifier,this.onInputUp(r?r.toString():"<none>")},t.onPointerStart=function(t){t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType&&(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),this.onInputDown(t.pointerId.toString(),t.pageX,t.pageY))},t.onPointerMove=function(t){t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType&&(t.preventDefault&&t.preventDefault(),this.onInputMove(t.pointerId.toString(),t.pageX,t.pageY))},t.onPointerEnd=function(t){t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType&&(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),this.onInputUp(t.pointerId.toString()))},t.onInputDown=function(t,i,r){var n,s,o,a,h,c,l,u,p=i-this.runtime.canvas.offsetLeft,d=r-this.runtime.canvas.offsetTop,f=this.my_instances.valuesRef(),g=null;for(h=0,c=f.length;h<c;h++)(l=e(u=f[h])).enabled&&!l.dragging&&(n=u.layer.canvasToLayer(p,d,!0),s=u.layer.canvasToLayer(p,d,!1),u.update_bbox(),u.contains_pt(n,s)&&(g?(u.layer.index>g.layer.index||u.layer.index===g.layer.index&&u.get_zindex()>g.get_zindex())&&(g=u,o=n,a=s):(g=u,o=n,a=s)));g&&e(g).onDown(t,o,a)},t.onInputMove=function(t,i,r){var n,s,o,a,h,c,l=i-this.runtime.canvas.offsetLeft,u=r-this.runtime.canvas.offsetTop,p=this.my_instances.valuesRef();for(o=0,a=p.length;o<a;o++)!(h=e(c=p[o])).enabled||!h.dragging||h.dragging&&h.dragsource!==t||(n=c.layer.canvasToLayer(l,u,!0),s=c.layer.canvasToLayer(l,u,!1),h.onMove(n,s))},t.onInputUp=function(t){var i,r,n,s=this.my_instances.valuesRef();for(i=0,r=s.length;i<r;i++)(n=e(s[i])).dragging&&n.dragsource===t&&n.onUp()},t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var i=t.Instance.prototype;function r(){}function n(){}i.onCreate=function(){this.dragging=!1,this.dx=0,this.dy=0,this.dragsource="<none>",this.axes=this.properties[0],this.enabled=this.properties[1]},i.saveToJSON=function(){return{enabled:this.enabled}},i.loadFromJSON=function(t){this.enabled=t.enabled,this.dragging=!1},i.onDown=function(t,e,i){this.dx=e-this.inst.x,this.dy=i-this.inst.y,this.dragging=!0,this.dragsource=t,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.behaviors.DragnDrop.prototype.cnds.OnDragStart,this.inst),this.runtime.isInUserInputEvent=!1},i.onMove=function(t,e){var i=t-this.dx,r=e-this.dy;0===this.axes?this.inst.x===i&&this.inst.y===r||(this.inst.x=i,this.inst.y=r,this.inst.set_bbox_changed()):1===this.axes?this.inst.x!==i&&(this.inst.x=i,this.inst.set_bbox_changed()):2===this.axes&&this.inst.y!==r&&(this.inst.y=r,this.inst.set_bbox_changed())},i.onUp=function(){this.dragging=!1,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.behaviors.DragnDrop.prototype.cnds.OnDrop,this.inst),this.runtime.isInUserInputEvent=!1},i.tick=function(){},r.prototype.IsDragging=function(){return this.dragging},r.prototype.OnDragStart=function(){return!0},r.prototype.OnDrop=function(){return!0},r.prototype.IsEnabled=function(){return!!this.enabled},t.cnds=new r,n.prototype.SetEnabled=function(t){this.enabled=0!==t,this.enabled||(this.dragging=!1)},n.prototype.SetAxes=function(t){this.axes=t},n.prototype.Drop=function(){this.dragging&&this.onUp()},t.acts=new n,t.exps=new function(){}}(),cr.behaviors.scrollto=function(t){this.runtime=t,this.shakeMag=0,this.shakeStart=0,this.shakeEnd=0,this.shakeMode=0},function(){var t=cr.behaviors.scrollto.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(t){var e,i,r;for(e=0,i=t.behavior_insts.length;e<i;++e)if((r=t.behavior_insts[e]).behavior instanceof cr.behaviors.scrollto)return r;return null}function r(){}function n(){}e.onCreate=function(){this.enabled=this.properties[0]},e.saveToJSON=function(){return{smg:this.behavior.shakeMag,ss:this.behavior.shakeStart,se:this.behavior.shakeEnd,smd:this.behavior.shakeMode}},e.loadFromJSON=function(t){this.behavior.shakeMag=t.smg,this.behavior.shakeStart=t.ss,this.behavior.shakeEnd=t.se,this.behavior.shakeMode=t.smd},e.tick=function(){},e.tick2=function(){if(this.enabled){var t,e,r,n=this.behavior.my_instances.valuesRef(),s=0,o=0,a=0;for(t=0,e=n.length;t<e;t++)(r=i(n[t]))&&r.enabled&&(s+=n[t].x,o+=n[t].y,++a);var h=this.inst.layer.layout,c=this.runtime.kahanTime.sum,l=0,u=0;if(c>=this.behavior.shakeStart&&c<this.behavior.shakeEnd){var p=this.behavior.shakeMag*Math.min(this.runtime.timescale,1);0===this.behavior.shakeMode&&(p*=1-(c-this.behavior.shakeStart)/(this.behavior.shakeEnd-this.behavior.shakeStart));var d=Math.random()*Math.PI*2,f=Math.random()*p;l=Math.cos(d)*f,u=Math.sin(d)*f}h.scrollToX(s/a+l),h.scrollToY(o/a+u)}},r.prototype.IsEnabled=function(){return this.enabled},t.cnds=new r,n.prototype.Shake=function(t,e,i){this.behavior.shakeMag=t,this.behavior.shakeStart=this.runtime.kahanTime.sum,this.behavior.shakeEnd=this.behavior.shakeStart+e,this.behavior.shakeMode=i},n.prototype.SetEnabled=function(t){this.enabled=0!==t},t.acts=new n}(),cr.behaviors.Rotate=function(t){this.runtime=t},function(){var t=cr.behaviors.Rotate.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}function r(){}function n(){}e.onCreate=function(){this.speed=cr.to_radians(this.properties[0]),this.acc=cr.to_radians(this.properties[1]),this.enabled=this.properties[2]},e.saveToJSON=function(){return{speed:this.speed,acc:this.acc,e:this.enabled}},e.loadFromJSON=function(t){this.speed=t.speed,this.acc=t.acc,t.hasOwnProperty("e")?this.enabled=t.e:this.enabled=!0},e.tick=function(){if(this.enabled){var t=this.runtime.getDt(this.inst);0!==t&&(0!==this.acc&&(this.speed+=this.acc*t),0!==this.speed&&(this.inst.angle=cr.clamp_angle(this.inst.angle+this.speed*t),this.inst.set_bbox_changed()))}},i.prototype.IsEnabled=function(){return this.enabled},t.cnds=new i,r.prototype.SetSpeed=function(t){this.speed=cr.to_radians(t)},r.prototype.SetAcceleration=function(t){this.acc=cr.to_radians(t)},r.prototype.SetEnabled=function(t){this.enabled=1===t},t.acts=new r,n.prototype.Speed=function(t){t.set_float(cr.to_degrees(this.speed))},n.prototype.Acceleration=function(t){t.set_float(cr.to_degrees(this.acc))},t.exps=new n}(),cr.behaviors.Fade=function(t){this.runtime=t},function(){var t=cr.behaviors.Fade.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}function r(){}function n(){}e.onCreate=function(){this.fadeInTime=this.properties[0],this.waitTime=this.properties[1],this.fadeOutTime=this.properties[2],this.destroy=this.properties[3],this.activeAtStart=this.properties[4],this.setMaxOpacity=!1,this.stage=this.activeAtStart?0:3,this.recycled?this.stageTime.reset():this.stageTime=new cr.KahanAdder,this.maxOpacity=this.inst.opacity?this.inst.opacity:1,this.activeAtStart&&(0===this.fadeInTime?(this.stage=1,0===this.waitTime&&(this.stage=2)):(this.inst.opacity=0,this.runtime.redraw=!0))},e.saveToJSON=function(){return{fit:this.fadeInTime,wt:this.waitTime,fot:this.fadeOutTime,s:this.stage,st:this.stageTime.sum,mo:this.maxOpacity}},e.loadFromJSON=function(t){this.fadeInTime=t.fit,this.waitTime=t.wt,this.fadeOutTime=t.fot,this.stage=t.s,this.stageTime.reset(),this.stageTime.sum=t.st,this.maxOpacity=t.mo},e.tick=function(){this.stageTime.add(this.runtime.getDt(this.inst)),0===this.stage&&(this.inst.opacity=this.stageTime.sum/this.fadeInTime*this.maxOpacity,this.runtime.redraw=!0,this.inst.opacity>=this.maxOpacity&&(this.inst.opacity=this.maxOpacity,this.stage=1,this.stageTime.reset(),this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnFadeInEnd,this.inst))),1===this.stage&&this.stageTime.sum>=this.waitTime&&(this.stage=2,this.stageTime.reset(),this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnWaitEnd,this.inst)),2===this.stage&&0!==this.fadeOutTime&&(this.inst.opacity=this.maxOpacity-this.stageTime.sum/this.fadeOutTime*this.maxOpacity,this.runtime.redraw=!0,this.inst.opacity<0&&(this.inst.opacity=0,this.stage=3,this.stageTime.reset(),this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnFadeOutEnd,this.inst),this.destroy&&this.runtime.DestroyInstance(this.inst)))},e.doStart=function(){this.stage=0,this.stageTime.reset(),0===this.fadeInTime?(this.stage=1,0===this.waitTime&&(this.stage=2)):(this.inst.opacity=0,this.runtime.redraw=!0)},i.prototype.OnFadeOutEnd=function(){return!0},i.prototype.OnFadeInEnd=function(){return!0},i.prototype.OnWaitEnd=function(){return!0},t.cnds=new i,r.prototype.StartFade=function(){this.activeAtStart||this.setMaxOpacity||(this.maxOpacity=this.inst.opacity?this.inst.opacity:1,this.setMaxOpacity=!0),3===this.stage&&this.doStart()},r.prototype.RestartFade=function(){this.doStart()},r.prototype.SetFadeInTime=function(t){t<0&&(t=0),this.fadeInTime=t},r.prototype.SetWaitTime=function(t){t<0&&(t=0),this.waitTime=t},r.prototype.SetFadeOutTime=function(t){t<0&&(t=0),this.fadeOutTime=t},t.acts=new r,n.prototype.FadeInTime=function(t){t.set_float(this.fadeInTime)},n.prototype.WaitTime=function(t){t.set_float(this.waitTime)},n.prototype.FadeOutTime=function(t){t.set_float(this.fadeOutTime)},t.exps=new n}(),cr.behaviors.Sin=function(t){this.runtime=t},function(){var t=cr.behaviors.Sin.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime,this.i=0};var e=t.Instance.prototype,i=2*Math.PI,r=Math.PI/2,n=3*Math.PI/2,s=[0,1,8,3,4,2,5,6,7];function o(){}function a(){}function h(){}e.onCreate=function(){this.movement=s[this.properties[0]],this.wave=this.properties[1],this.period=this.properties[2],this.period+=Math.random()*this.properties[3],0===this.period?this.i=0:(this.i=this.properties[4]/this.period*i,this.i+=Math.random()*this.properties[5]/this.period*i),this.mag=this.properties[6],this.mag+=Math.random()*this.properties[7],this.isEnabled=this.properties[8],this.initialValue=0,this.initialValue2=0,this.ratio=0,5===this.movement&&(this.mag=cr.to_radians(this.mag)),this.init()},e.saveToJSON=function(){return{i:this.i,a:this.isEnabled,mv:this.movement,w:this.wave,p:this.period,mag:this.mag,iv:this.initialValue,iv2:this.initialValue2,r:this.ratio,lkv:this.lastKnownValue,lkv2:this.lastKnownValue2}},e.loadFromJSON=function(t){this.i=t.i,this.isEnabled=t.a,this.movement=t.mv,this.wave=t.w,this.period=t.p,this.mag=t.mag,this.initialValue=t.iv,this.initialValue2=t.iv2||0,this.ratio=t.r,this.lastKnownValue=t.lkv,this.lastKnownValue2=t.lkv2||0},e.init=function(){switch(this.movement){case 0:this.initialValue=this.inst.x;break;case 1:this.initialValue=this.inst.y;break;case 2:this.initialValue=this.inst.width,this.ratio=this.inst.height/this.inst.width;break;case 3:this.initialValue=this.inst.width;break;case 4:this.initialValue=this.inst.height;break;case 5:this.initialValue=this.inst.angle;break;case 6:this.initialValue=this.inst.opacity;break;case 7:this.initialValue=0;break;case 8:this.initialValue=this.inst.x,this.initialValue2=this.inst.y}this.lastKnownValue=this.initialValue,this.lastKnownValue2=this.initialValue2},e.waveFunc=function(t){switch(t%=i,this.wave){case 0:return Math.sin(t);case 1:return t<=r?t/r:t<=n?1-2*(t-r)/Math.PI:(t-n)/r-1;case 2:return 2*t/i-1;case 3:return-2*t/i+1;case 4:return t<Math.PI?-1:1}return 0},e.tick=function(){var t=this.runtime.getDt(this.inst);this.isEnabled&&0!==t&&(0===this.period?this.i=0:(this.i+=t/this.period*i,this.i=this.i%i),this.updateFromPhase())},e.updateFromPhase=function(){switch(this.movement){case 0:this.inst.x!==this.lastKnownValue&&(this.initialValue+=this.inst.x-this.lastKnownValue),this.inst.x=this.initialValue+this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.x;break;case 1:this.inst.y!==this.lastKnownValue&&(this.initialValue+=this.inst.y-this.lastKnownValue),this.inst.y=this.initialValue+this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.y;break;case 2:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag,this.inst.height=this.inst.width*this.ratio;break;case 3:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 4:this.inst.height=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 5:this.inst.angle!==this.lastKnownValue&&(this.initialValue=cr.clamp_angle(this.initialValue+(this.inst.angle-this.lastKnownValue))),this.inst.angle=cr.clamp_angle(this.initialValue+this.waveFunc(this.i)*this.mag),this.lastKnownValue=this.inst.angle;break;case 6:this.inst.opacity=this.initialValue+this.waveFunc(this.i)*this.mag/100,this.inst.opacity<0?this.inst.opacity=0:this.inst.opacity>1&&(this.inst.opacity=1);break;case 8:this.inst.x!==this.lastKnownValue&&(this.initialValue+=this.inst.x-this.lastKnownValue),this.inst.y!==this.lastKnownValue2&&(this.initialValue2+=this.inst.y-this.lastKnownValue2),this.inst.x=this.initialValue+Math.cos(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.inst.y=this.initialValue2+Math.sin(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.x,this.lastKnownValue2=this.inst.y}this.inst.set_bbox_changed()},e.onSpriteFrameChanged=function(t,e){switch(this.movement){case 2:this.initialValue*=e.width/t.width,this.ratio=e.height/e.width;break;case 3:this.initialValue*=e.width/t.width;break;case 4:this.initialValue*=e.height/t.height}},o.prototype.IsEnabled=function(){return this.isEnabled},o.prototype.CompareMovement=function(t){return this.movement===t},o.prototype.ComparePeriod=function(t,e){return cr.do_cmp(this.period,t,e)},o.prototype.CompareMagnitude=function(t,e){return 5===this.movement?cr.do_cmp(this.mag,t,cr.to_radians(e)):cr.do_cmp(this.mag,t,e)},o.prototype.CompareWave=function(t){return this.wave===t},t.cnds=new o,a.prototype.SetEnabled=function(t){this.isEnabled=1===t},a.prototype.SetPeriod=function(t){this.period=t},a.prototype.SetMagnitude=function(t){this.mag=t,5===this.movement&&(this.mag=cr.to_radians(this.mag))},a.prototype.SetMovement=function(t){5===this.movement&&5!==t&&(this.mag=cr.to_degrees(this.mag)),this.movement=t,this.init()},a.prototype.SetWave=function(t){this.wave=t},a.prototype.SetPhase=function(t){this.i=t*i%i,this.updateFromPhase()},a.prototype.UpdateInitialState=function(){this.init()},t.acts=new a,h.prototype.CyclePosition=function(t){t.set_float(this.i/i)},h.prototype.Period=function(t){t.set_float(this.period)},h.prototype.Magnitude=function(t){5===this.movement?t.set_float(cr.to_degrees(this.mag)):t.set_float(this.mag)},h.prototype.Value=function(t){t.set_float(this.waveFunc(this.i)*this.mag)},t.exps=new h}(),cr.getObjectRefTable=function(){return[cr.plugins_.Sprite,cr.behaviors.Anchor,cr.behaviors.Pin,cr.plugins_.ValerypopoffJSPlugin,cr.behaviors.Physics,cr.behaviors.custom,cr.behaviors.DragnDrop,cr.plugins_.Touch,cr.behaviors.scrollto,cr.plugins_.Particles,cr.behaviors.Rotate,cr.plugins_.Arr,cr.plugins_.Spritefont2,cr.plugins_.TiledBg,cr.behaviors.Fade,cr.behaviors.Sin,cr.plugins_.Audio,cr.plugins_.LocalStorage,cr.plugins_.Browser,cr.plugins_.Keyboard,cr.plugins_.advert,cr.plugins_.Function,cr.system_object.prototype.cnds.OnLayoutStart,cr.behaviors.Physics.prototype.acts.SetIterations,cr.behaviors.Physics.prototype.acts.SetWorldGravity,cr.system_object.prototype.acts.SetVar,cr.system_object.prototype.exps.layoutname,cr.system_object.prototype.acts.CreateObject,cr.plugins_.Spritefont2.prototype.acts.SetText,cr.plugins_.Browser.prototype.acts.ExecJs,cr.system_object.prototype.cnds.IsMobile,cr.system_object.prototype.cnds.CompareVar,cr.system_object.prototype.exps.floor,cr.system_object.prototype.exps.random,cr.system_object.prototype.acts.Wait,cr.plugins_.Sprite.prototype.acts.SetAnim,cr.system_object.prototype.cnds.Else,cr.plugins_.TiledBg.prototype.acts.SetSize,cr.plugins_.TiledBg.prototype.acts.ZMoveToObject,cr.plugins_.Sprite.prototype.acts.SetOpacity,cr.plugins_.Sprite.prototype.cnds.OnCreated,cr.plugins_.Sprite.prototype.exps.LayerName,cr.plugins_.Sprite.prototype.exps.ImagePointX,cr.plugins_.Sprite.prototype.exps.ImagePointY,cr.plugins_.Sprite.prototype.acts.SetAngle,cr.plugins_.Sprite.prototype.exps.Angle,cr.plugins_.Sprite.prototype.cnds.OnCollision,cr.plugins_.Sprite.prototype.cnds.IsAnimPlaying,cr.behaviors.Physics.prototype.acts.ApplyImpulseToward,cr.plugins_.Sprite.prototype.exps.X,cr.plugins_.Sprite.prototype.exps.Y,cr.behaviors.Physics.prototype.acts.SetFriction,cr.plugins_.Sprite.prototype.acts.SetBoolInstanceVar,cr.plugins_.Sprite.prototype.acts.SetPosToObject,cr.behaviors.Physics.prototype.acts.SetEnabled,cr.plugins_.Arr.prototype.acts.SetX,cr.plugins_.Audio.prototype.acts.Stop,cr.plugins_.Sprite.prototype.acts.Destroy,cr.plugins_.Audio.prototype.acts.Play,cr.plugins_.LocalStorage.prototype.acts.SetItem,cr.plugins_.Arr.prototype.exps.AsJSON,cr.plugins_.Sprite.prototype.acts.SetWidth,cr.plugins_.Sprite.prototype.exps.Width,cr.plugins_.Sprite.prototype.acts.SetHeight,cr.plugins_.Sprite.prototype.acts.SetInstanceVar,cr.plugins_.Sprite.prototype.cnds.IsOverlapping,cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,cr.behaviors.Physics.prototype.acts.SetVelocity,cr.behaviors.Pin.prototype.acts.Pin,cr.plugins_.Sprite.prototype.acts.SetAnimFrame,cr.plugins_.Sprite.prototype.cnds.CompareY,cr.behaviors.Physics.prototype.acts.SetElasticity,cr.plugins_.Sprite.prototype.cnds.IsBoolInstanceVarSet,cr.behaviors.Physics.prototype.acts.RemoveJoints,cr.behaviors.Physics.prototype.acts.ApplyImpulse,cr.plugins_.Sprite.prototype.cnds.CompareFrame,cr.system_object.prototype.cnds.EveryTick,cr.behaviors.Physics.prototype.acts.SetAngularVelocity,cr.plugins_.Sprite.prototype.cnds.CompareWidth,cr.plugins_.Sprite.prototype.acts.SetPos,cr.plugins_.Sprite.prototype.acts.MoveToLayer,cr.plugins_.Sprite.prototype.acts.ZMoveToObject,cr.plugins_.Sprite.prototype.acts.SetMirrored,cr.plugins_.Particles.prototype.acts.SetAngle,cr.plugins_.Sprite.prototype.cnds.AngleWithin,cr.plugins_.Particles.prototype.acts.SetTimeout,cr.behaviors.Physics.prototype.acts.ApplyImpulseAtAngle,cr.behaviors.Physics.prototype.acts.EnableCollisions,cr.behaviors.Physics.prototype.acts.CreateRevoluteJoint,cr.system_object.prototype.cnds.Repeat,cr.plugins_.Sprite.prototype.acts.AddInstanceVar,cr.behaviors.Physics.prototype.acts.SetImmovable,cr.system_object.prototype.acts.AddVar,cr.plugins_.Function.prototype.acts.CallFunction,cr.system_object.prototype.acts.RestartLayout,cr.behaviors.Physics.prototype.exps.VelocityX,cr.behaviors.Physics.prototype.exps.VelocityY,cr.system_object.prototype.cnds.Every,cr.plugins_.Function.prototype.cnds.OnFunction,cr.system_object.prototype.acts.SetTimescale,cr.plugins_.Audio.prototype.acts.SetMasterVolume,cr.plugins_.Browser.prototype.acts.ConsoleLog,cr.plugins_.Touch.prototype.cnds.IsInTouch,cr.plugins_.Touch.prototype.cnds.IsTouchingObject,cr.system_object.prototype.cnds.TriggerOnce,cr.behaviors.Physics.prototype.acts.SetLinearDamping,cr.behaviors.Pin.prototype.acts.Unpin,cr.plugins_.Sprite.prototype.acts.SetSize,cr.plugins_.Touch.prototype.cnds.OnTouchObject,cr.behaviors.Fade.prototype.acts.SetFadeInTime,cr.behaviors.Fade.prototype.acts.SetFadeOutTime,cr.plugins_.advert.prototype.acts.ShowBanner,cr.system_object.prototype.acts.GoToLayout,cr.plugins_.Keyboard.prototype.cnds.OnKey,cr.plugins_.Sprite.prototype.cnds.IsOnScreen,cr.plugins_.ValerypopoffJSPlugin.prototype.acts.ExecuteJSWithParamsNonvar,cr.system_object.prototype.acts.GoToLayoutByName,cr.plugins_.TiledBg.prototype.acts.Destroy,cr.plugins_.Sprite.prototype.acts.SetVisible,cr.plugins_.Sprite.prototype.cnds.OnFrameChanged,cr.plugins_.Sprite.prototype.exps.AnimationFrame,cr.plugins_.Sprite.prototype.acts.SetCollisions,cr.plugins_.Audio.prototype.cnds.IsSilent,cr.plugins_.Audio.prototype.acts.SetSilent,cr.plugins_.Sprite.prototype.exps.UID,cr.system_object.prototype.exps.distance,cr.system_object.prototype.cnds.ForEach,cr.system_object.prototype.exps.loopindex,cr.plugins_.Sprite.prototype.exps.Height,cr.system_object.prototype.cnds.Compare,cr.plugins_.Sprite.prototype.cnds.PickByUID,cr.plugins_.Sprite.prototype.acts.SetY,cr.plugins_.Sprite.prototype.acts.SetX,cr.plugins_.Audio.prototype.cnds.IsTagPlaying,cr.system_object.prototype.cnds.IsGroupActive,cr.plugins_.Arr.prototype.cnds.CompareX,cr.behaviors.custom.prototype.acts.SetSpeed,cr.plugins_.Sprite.prototype.cnds.CompareX,cr.plugins_.Spritefont2.prototype.acts.SetY,cr.plugins_.Spritefont2.prototype.exps.Y,cr.plugins_.Spritefont2.prototype.acts.SetOpacity,cr.plugins_.Arr.prototype.acts.Clear,cr.plugins_.LocalStorage.prototype.acts.ClearStorage,cr.plugins_.LocalStorage.prototype.acts.CheckItemExists,cr.plugins_.LocalStorage.prototype.cnds.OnItemExists,cr.plugins_.LocalStorage.prototype.acts.GetItem,cr.plugins_.LocalStorage.prototype.cnds.OnItemGet,cr.plugins_.Arr.prototype.acts.JSONLoad,cr.plugins_.LocalStorage.prototype.exps.ItemValue,cr.system_object.prototype.cnds.OnLoadFinished,cr.plugins_.TiledBg.prototype.acts.SetWidth,cr.plugins_.Browser.prototype.cnds.IsDownloadingUpdate,cr.system_object.prototype.exps.loadingprogress,cr.plugins_.ValerypopoffJSPlugin.prototype.cnds.AllScriptsLoaded]},self.C3_JsPropNameTable=[{pshadow:0},{Anchor:0},{bottomsnow:0},{psnow:0},{Sky:0},{icylogo:0},{PurpleHead:0},{Pin:0},{bgmount:0},{bush:0},{Tree:0},{ValerypopoffJS:0},{Physics:0},{CustomMovement:0},{DragDrop:0},{icy:0},{woodstick:0},{box:0},{Touch:0},{ScrollTo:0},{camera:0},{boxsensor:0},{stickyplatform:0},{reverser:0},{stickysensor:0},{movingplatform:0},{collisionstick:0},{movingsensor:0},{physmovingplatform:0},{punchplate:0},{sensor:0},{fan:0},{airflow:0},{airflowparticle:0},{BigWheel:0},{Bigjoint:0},{spikewheel:0},{current:0},{movingplatformblock:0},{stickyzone:0},{restartbtn:0},{speedboost:0},{Teleportentrance:0},{Teleportexit:0},{stickwallsensor:0},{stickwall:0},{Rotate:0},{bigspikewheel:0},{anchor:0},{link:0},{bob:0},{Spikes:0},{playbtn:0},{levelspot:0},{levelslist:0},{menubtnsheet:0},{levelendlogo:0},{restartbtn2:0},{Font1:0},{icebg:0},{Bigwheelcover:0},{currentspot:0},{express:0},{treeline:0},{Fade:0},{whitefade:0},{starstile:0},{cleanfont:0},{levelboxes:0},{tintblack:0},{cleanfont2:0},{fingertut:0},{Sine:0},{Fakeicy:0},{tutframe:0},{spintut:0},{stickyparticles:0},{smoke:0},{boomlight:0},{boom:0},{Pausebtn:0},{soundbtn:0},{Audio:0},{pausedsheet:0},{LocalStorage:0},{punchbox:0},{punchspring:0},{hitfx:0},{clearprogresssheet:0},{walkthroughbtn:0},{Browser:0},{TiledBackground2:0},{clearprgsheet:0},{yesnosheet:0},{yesnosheet2:0},{ratebtn:0},{moregames:0},{Keyboard:0},{banner:0},{closeban:0},{MobileAdvert:0},{Function:0},{Enemies:0},{linkb:0},{TitleMenu:0},{WorldSkin:0},{UIBTNS:0},{skip:0},{banshow:0},{Currentlevel:0},{changetype:0},{leveltype:0},{levelsbeforeads:0},{homebtn:0},{FirstTouch:0},{linkspacing:0},{prev:0},{linkSpacing2:0},{prev2:0},{gamestart:0}];